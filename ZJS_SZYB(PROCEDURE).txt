ZJS_SZYB	PROCEDURE	1	"PROCEDURE         ""ZJS_SZYB"" (
"
ZJS_SZYB	PROCEDURE	2	"        P_XTXH    IN NUMBER,
"
ZJS_SZYB	PROCEDURE	3	"        P_YHDM	  IN VARCHAR2,
"
ZJS_SZYB	PROCEDURE	4	"        P_KJQJ	  IN CHAR,
"
ZJS_SZYB	PROCEDURE	5	"	P_ZJJX	  IN NUMBER) IS
"
ZJS_SZYB	PROCEDURE	6	"BEGIN
"
ZJS_SZYB	PROCEDURE	7	"DECLARE
"
ZJS_SZYB	PROCEDURE	8	"
"
ZJS_SZYB	PROCEDURE	9	"  V_ZJJX	NUMBER;
"
ZJS_SZYB	PROCEDURE	10	"  V_JXMC	VARCHAR2(20);
"
ZJS_SZYB	PROCEDURE	11	"
"
ZJS_SZYB	PROCEDURE	12	"  CURSOR CUR_DL IS
"
ZJS_SZYB	PROCEDURE	13	"  SELECT ZJDL,DLMC FROM ZJS_ZJDL WHERE XTXH = P_XTXH
"
ZJS_SZYB	PROCEDURE	14	"  ORDER BY PXXH,ZJDL;
"
ZJS_SZYB	PROCEDURE	15	"
"
ZJS_SZYB	PROCEDURE	16	"  CURSOR CUR_LB IS
"
ZJS_SZYB	PROCEDURE	17	"  SELECT ZJLB,LBMC FROM ZJS_ZJLB
"
ZJS_SZYB	PROCEDURE	18	"  WHERE XTXH = P_XTXH AND ZJDL = P_ZJJX
"
ZJS_SZYB	PROCEDURE	19	"  ORDER BY PXXH,ZJLB;
"
ZJS_SZYB	PROCEDURE	20	"
"
ZJS_SZYB	PROCEDURE	21	"  CURSOR CUR_JX IS
"
ZJS_SZYB	PROCEDURE	22	"  SELECT ZJJX,JXMC FROM ZJS_ZJJX
"
ZJS_SZYB	PROCEDURE	23	"  WHERE XTXH = P_XTXH AND ZJLB = P_ZJJX
"
ZJS_SZYB	PROCEDURE	24	"  ORDER BY PXXH,ZJJX;
"
ZJS_SZYB	PROCEDURE	25	"
"
ZJS_SZYB	PROCEDURE	26	"BEGIN
"
ZJS_SZYB	PROCEDURE	27	"---- INIT
"
ZJS_SZYB	PROCEDURE	28	"  DELETE FROM ZJS_SZYB_TEMP WHERE XTXH = P_XTXH AND YHDM = P_YHDM;
"
ZJS_SZYB	PROCEDURE	29	"
"
ZJS_SZYB	PROCEDURE	30	"---- START
"
ZJS_SZYB	PROCEDURE	31	"
"
ZJS_SZYB	PROCEDURE	32	"  IF (P_ZJJX = 0) THEN --所有制剂大类
"
ZJS_SZYB	PROCEDURE	33	"
"
ZJS_SZYB	PROCEDURE	34	"    OPEN CUR_DL;
"
ZJS_SZYB	PROCEDURE	35	"    LOOP
"
ZJS_SZYB	PROCEDURE	36	"      FETCH CUR_DL INTO V_ZJJX,V_JXMC;
"
ZJS_SZYB	PROCEDURE	37	"      EXIT WHEN CUR_DL%NOTFOUND;
"
ZJS_SZYB	PROCEDURE	38	"
"
ZJS_SZYB	PROCEDURE	39	"      ZJS_SZYBMX(P_XTXH,P_YHDM,P_KJQJ,V_ZJJX,V_JXMC);
"
ZJS_SZYB	PROCEDURE	40	"
"
ZJS_SZYB	PROCEDURE	41	"    END LOOP;
"
ZJS_SZYB	PROCEDURE	42	"    CLOSE CUR_DL;
"
ZJS_SZYB	PROCEDURE	43	"
"
ZJS_SZYB	PROCEDURE	44	"  ELSIF LENGTH(P_ZJJX) = 1 THEN --指定大类的所有类别
"
ZJS_SZYB	PROCEDURE	45	"
"
ZJS_SZYB	PROCEDURE	46	"    OPEN CUR_LB;
"
ZJS_SZYB	PROCEDURE	47	"    LOOP
"
ZJS_SZYB	PROCEDURE	48	"      FETCH CUR_LB INTO V_ZJJX,V_JXMC;
"
ZJS_SZYB	PROCEDURE	49	"      EXIT WHEN CUR_LB%NOTFOUND;
"
ZJS_SZYB	PROCEDURE	50	"
"
ZJS_SZYB	PROCEDURE	51	"      ZJS_SZYBMX(P_XTXH,P_YHDM,P_KJQJ,V_ZJJX,V_JXMC);
"
ZJS_SZYB	PROCEDURE	52	"
"
ZJS_SZYB	PROCEDURE	53	"    END LOOP;
"
ZJS_SZYB	PROCEDURE	54	"    CLOSE CUR_LB;
"
ZJS_SZYB	PROCEDURE	55	"
"
ZJS_SZYB	PROCEDURE	56	"  ELSIF LENGTH(P_ZJJX) = 2 THEN --指定类别的所有制剂剂型
"
ZJS_SZYB	PROCEDURE	57	"
"
ZJS_SZYB	PROCEDURE	58	"    OPEN CUR_JX;
"
ZJS_SZYB	PROCEDURE	59	"    LOOP
"
ZJS_SZYB	PROCEDURE	60	"      FETCH CUR_JX INTO V_ZJJX,V_JXMC;
"
ZJS_SZYB	PROCEDURE	61	"      EXIT WHEN CUR_JX%NOTFOUND;
"
ZJS_SZYB	PROCEDURE	62	"
"
ZJS_SZYB	PROCEDURE	63	"      ZJS_SZYBMX(P_XTXH,P_YHDM,P_KJQJ,V_ZJJX,V_JXMC);
"
ZJS_SZYB	PROCEDURE	64	"
"
ZJS_SZYB	PROCEDURE	65	"    END LOOP;
"
ZJS_SZYB	PROCEDURE	66	"    CLOSE CUR_JX;
"
ZJS_SZYB	PROCEDURE	67	"
"
ZJS_SZYB	PROCEDURE	68	"  ELSIF LENGTH(P_ZJJX) = 4 THEN --单个制剂剂型
"
ZJS_SZYB	PROCEDURE	69	"
"
ZJS_SZYB	PROCEDURE	70	"    SELECT JXMC INTO V_JXMC
"
ZJS_SZYB	PROCEDURE	71	"    FROM ZJS_ZJJX WHERE XTXH = P_XTXH AND ZJJX = P_ZJJX;
"
ZJS_SZYB	PROCEDURE	72	"
"
ZJS_SZYB	PROCEDURE	73	"    ZJS_SZYBMX(P_XTXH,P_YHDM,P_KJQJ,P_ZJJX,V_JXMC);
"
ZJS_SZYB	PROCEDURE	74	"
"
ZJS_SZYB	PROCEDURE	75	"  ELSE
"
ZJS_SZYB	PROCEDURE	76	"    NULL;
"
ZJS_SZYB	PROCEDURE	77	"  END IF;
"
ZJS_SZYB	PROCEDURE	78	"
"
ZJS_SZYB	PROCEDURE	79	"--EXCEPTION  -- exception handlers begin
"
ZJS_SZYB	PROCEDURE	80	"--   WHEN OTHERS THEN  -- handles all other errors
"
ZJS_SZYB	PROCEDURE	81	"--        ROLLBACK;
"
ZJS_SZYB	PROCEDURE	82	"--	RAISE_APPLICATION_ERROR(-20103,'ZJS_SZYB FAILS');
"
ZJS_SZYB	PROCEDURE	83	"END;
"
ZJS_SZYB	PROCEDURE	84	"END;
"
ZJS_SZYB	PROCEDURE	85	"
"
ZJS_SZYB	PROCEDURE	86	 
