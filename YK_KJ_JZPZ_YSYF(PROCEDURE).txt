YK_KJ_JZPZ_YSYF	PROCEDURE	1	"PROCEDURE         ""YK_KJ_JZPZ_YSYF"" (
"
YK_KJ_JZPZ_YSYF	PROCEDURE	2	"        P_XTXH    IN NUMBER,
"
YK_KJ_JZPZ_YSYF	PROCEDURE	3	"	P_CRKFSDM IN NUMBER,
"
YK_KJ_JZPZ_YSYF	PROCEDURE	4	"	P_JSDH	  IN NUMBER ) IS
"
YK_KJ_JZPZ_YSYF	PROCEDURE	5	"BEGIN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	6	"DECLARE
"
YK_KJ_JZPZ_YSYF	PROCEDURE	7	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	8	"   V_COUNT	NUMBER;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	9	"   V_JZRQ	DATE;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	10	"   V_HSDWBH	VARCHAR2(8);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	11	"   V_HSDWMC	VARCHAR2(40);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	12	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	13	"   V_KMBM	NUMBER(15);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	14	"   V_FLKMBM	NUMBER(15);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	15	"   V_KMMC	VARCHAR2(36);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	16	"   V_KMMC_ALL	VARCHAR2(100);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	17	"   V_DWMC	VARCHAR2(40);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	18	"   V_DWMC_KM	VARCHAR2(40);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	19	"   V_YEFX	VARCHAR2(2);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	20	"   V_ZBLB	NUMBER(2);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	21	"   V_XH		NUMBER(4) := 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	22	"   V_ZY		VARCHAR2(100);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	23	"   V_CRKFSMC	VARCHAR2(12);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	24	"   V_PXLX	NUMBER(2);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	25	"   V_JFJE	NUMBER(14,4) := 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	26	"   V_DFJE	NUMBER(14,4) := 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	27	"   V_JFJE_SUM	NUMBER(14,4) := 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	28	"   V_DFJE_SUM	NUMBER(14,4) := 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	29	"   V_DYHS	NUMBER(2);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	30	"   V_PAGE	NUMBER(2) := 1;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	31	"   V_KCFX	NUMBER(1);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	32	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	33	"   V_ZJFX	CHAR(2);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	34	"   V_HSFF	CHAR(4);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	35	"   V_JE		NUMBER(14,4);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	36	"   V_ZBLBMC	CHAR(2);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	37	"   V_DWDY	NUMBER(1);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	38	"   V_HDPB	NUMBER(1);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	39	"   V_DWBH	VARCHAR2(8);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	40	"   V_RKDH       CHAR(8);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	41	"   V_CRKFSDM    NUMBER(2);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	42	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	43	"   CURSOR CUR_KJKM IS
"
YK_KJ_JZPZ_YSYF	PROCEDURE	44	"    SELECT A.KMBM,A.FLKMBM,LTRIM(RTRIM(A.KMMC)),A.YEFX,A.ZBLB
"
YK_KJ_JZPZ_YSYF	PROCEDURE	45	"    FROM YK_KJ_KMSZ A,YK_KJ_KMDZ B
"
YK_KJ_JZPZ_YSYF	PROCEDURE	46	"    WHERE (A.XTXH = P_XTXH AND A.XTXH = B.XTXH AND A.KMBM = B.KMBM AND B.CRKFSDM = P_CRKFSDM)
"
YK_KJ_JZPZ_YSYF	PROCEDURE	47	"    ORDER BY B.XH;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	48	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	49	"   CURSOR CUR_RKDH IS
"
YK_KJ_JZPZ_YSYF	PROCEDURE	50	"    SELECT RKDH,CRKFSDM
"
YK_KJ_JZPZ_YSYF	PROCEDURE	51	"    FROM YK_YPRKD WHERE XTXH = P_XTXH AND JSDH = P_JSDH;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	52	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	53	"BEGIN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	54	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	55	"---- INIT
"
YK_KJ_JZPZ_YSYF	PROCEDURE	56	"     DELETE FROM YK_JZPZ   WHERE XTXH = P_XTXH AND CRKDH = P_JSDH AND CRKFSDM = P_CRKFSDM ;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	57	"     DELETE FROM YK_JZPZ_MX WHERE XTXH = P_XTXH AND CRKDH = P_JSDH AND CRKFSDM = P_CRKFSDM ;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	58	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	59	"---- START
"
YK_KJ_JZPZ_YSYF	PROCEDURE	60	"---  YK_JZPZ
"
YK_KJ_JZPZ_YSYF	PROCEDURE	61	"-- DYHS,DWBH,HSDW
"
YK_KJ_JZPZ_YSYF	PROCEDURE	62	"	Yk_Kj_Getdyhs(P_XTXH,V_DYHS,V_HSDWBH,V_HSDWMC);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	63	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	64	"-- DWMC
"
YK_KJ_JZPZ_YSYF	PROCEDURE	65	"       BEGIN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	66	"        SELECT GHDWBH INTO V_DWBH
"
YK_KJ_JZPZ_YSYF	PROCEDURE	67	"        FROM YK_YPRKD
"
YK_KJ_JZPZ_YSYF	PROCEDURE	68	"        WHERE XTXH = P_XTXH AND JSDH = P_JSDH AND ROWNUM = 1;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	69	"        EXCEPTION WHEN OTHERS THEN  -- handles all other errors
"
YK_KJ_JZPZ_YSYF	PROCEDURE	70	"            V_DWBH := 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	71	"       END;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	72	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	73	"       BEGIN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	74	"        SELECT DWMC INTO V_DWMC
"
YK_KJ_JZPZ_YSYF	PROCEDURE	75	"        FROM YK_JHDW
"
YK_KJ_JZPZ_YSYF	PROCEDURE	76	"        WHERE XTXH = P_XTXH AND DWBH = V_DWBH;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	77	"        EXCEPTION WHEN OTHERS THEN  -- handles all other errors
"
YK_KJ_JZPZ_YSYF	PROCEDURE	78	"            V_DWMC := '错误';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	79	"       END;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	80	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	81	"---  YK_JZPZ_MX
"
YK_KJ_JZPZ_YSYF	PROCEDURE	82	"  OPEN CUR_KJKM;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	83	"  LOOP
"
YK_KJ_JZPZ_YSYF	PROCEDURE	84	"       FETCH CUR_KJKM INTO V_KMBM,V_FLKMBM,V_KMMC,V_YEFX,V_ZBLB;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	85	"       EXIT WHEN CUR_KJKM%NOTFOUND;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	86	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	87	"       IF V_ZBLB > 0 THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	88	"	  V_ZBLBMC := TO_CHAR(V_ZBLB);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	89	"       ELSE
"
YK_KJ_JZPZ_YSYF	PROCEDURE	90	"          V_ZBLBMC := '';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	91	"       END IF;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	92	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	93	"       Yk_Kj_Getdmdz(P_XTXH,P_CRKFSDM,V_KMBM,V_ZJFX,V_HSFF,V_DWDY);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	94	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	95	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	96	"       OPEN CUR_RKDH;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	97	"       LOOP
"
YK_KJ_JZPZ_YSYF	PROCEDURE	98	"            FETCH CUR_RKDH INTO V_RKDH,V_CRKFSDM;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	99	"            EXIT WHEN CUR_RKDH%NOTFOUND;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	100	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	101	"---- HSFF
"
YK_KJ_JZPZ_YSYF	PROCEDURE	102	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	103	"       IF V_HSFF = 'JJHS' THEN   --进价核算
"
YK_KJ_JZPZ_YSYF	PROCEDURE	104	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	105	"        SELECT NVL(SUM(ROUND(NVL(RKSL*JJ,0),2)),0) INTO V_JE
"
YK_KJ_JZPZ_YSYF	PROCEDURE	106	"	FROM YK_YPRKDMX
"
YK_KJ_JZPZ_YSYF	PROCEDURE	107	"	WHERE XTXH = P_XTXH AND RKDH LIKE V_RKDH||'%' AND CRKFSDM = V_CRKFSDM AND ZBLB like LTRIM(RTRIM(V_ZBLBMC))||'%';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	108	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	109	"       ELSIF V_HSFF = 'PJHS' THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	110	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	111	"        SELECT NVL(SUM(ROUND(NVL(RKSL*PFJ,0),2)),0) INTO V_JE
"
YK_KJ_JZPZ_YSYF	PROCEDURE	112	"	FROM YK_YPRKDMX
"
YK_KJ_JZPZ_YSYF	PROCEDURE	113	"	WHERE XTXH = P_XTXH AND RKDH LIKE V_RKDH||'%' AND CRKFSDM = V_CRKFSDM AND ZBLB like LTRIM(RTRIM(V_ZBLBMC))||'%';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	114	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	115	"       ELSIF V_HSFF = 'LJHS' THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	116	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	117	"        SELECT NVL(SUM(ROUND(NVL(RKSL*LSJ,0),2)),0) INTO V_JE
"
YK_KJ_JZPZ_YSYF	PROCEDURE	118	"	FROM YK_YPRKDMX
"
YK_KJ_JZPZ_YSYF	PROCEDURE	119	"	WHERE XTXH = P_XTXH AND RKDH LIKE V_RKDH||'%' AND CRKFSDM = V_CRKFSDM AND ZBLB like LTRIM(RTRIM(V_ZBLBMC))||'%';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	120	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	121	"       ELSIF V_HSFF = 'JXCE' THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	122	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	123	"        SELECT NVL(SUM(ROUND(NVL(RKSL*LSJ,0),2)),0) - NVL(SUM(ROUND(NVL(RKSL*JJ,0),2)),0)
"
YK_KJ_JZPZ_YSYF	PROCEDURE	124	"        INTO V_JE  FROM YK_YPRKDMX
"
YK_KJ_JZPZ_YSYF	PROCEDURE	125	"	WHERE XTXH = P_XTXH AND RKDH LIKE V_RKDH||'%' AND CRKFSDM = V_CRKFSDM AND ZBLB like LTRIM(RTRIM(V_ZBLBMC))||'%';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	126	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	127	"       ELSIF V_HSFF = 'RLCE' THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	128	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	129	"        SELECT NVL(SUM(ROUND(NVL(RKSL*PFJ,0),2)),0) - NVL(SUM(ROUND(NVL(RKSL*JJ,0),2)),0)
"
YK_KJ_JZPZ_YSYF	PROCEDURE	130	"        INTO V_JE  FROM YK_YPRKDMX
"
YK_KJ_JZPZ_YSYF	PROCEDURE	131	"	WHERE XTXH = P_XTXH AND RKDH LIKE V_RKDH||'%' AND CRKFSDM = V_CRKFSDM AND ZBLB like LTRIM(RTRIM(V_ZBLBMC))||'%';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	132	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	133	"       ELSIF V_HSFF = 'PLCE' THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	134	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	135	"        SELECT NVL(SUM(ROUND(NVL(RKSL*LSJ,0),2)),0) - NVL(SUM(ROUND(NVL(RKSL*PFJ,0),2)),0)
"
YK_KJ_JZPZ_YSYF	PROCEDURE	136	"        INTO V_JE  FROM YK_YPRKDMX
"
YK_KJ_JZPZ_YSYF	PROCEDURE	137	"	WHERE XTXH = P_XTXH AND RKDH LIKE V_RKDH||'%' AND CRKFSDM = V_CRKFSDM AND ZBLB like LTRIM(RTRIM(V_ZBLBMC))||'%';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	138	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	139	"       ELSIF V_HSFF = '错误' THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	140	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	141	"        V_JE := -1;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	142	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	143	"       END IF;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	144	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	145	"--- YEFX
"
YK_KJ_JZPZ_YSYF	PROCEDURE	146	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	147	"       IF V_YEFX = '借' THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	148	"          IF V_ZJFX = '增' THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	149	"             V_JFJE := V_JFJE + V_JE;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	150	"             V_DFJE := V_DFJE + 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	151	"          ELSIF V_ZJFX = '减' THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	152	"             V_JFJE := V_JFJE + 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	153	"             V_DFJE := V_DFJE + V_JE;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	154	"          ELSE
"
YK_KJ_JZPZ_YSYF	PROCEDURE	155	"             V_JFJE := 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	156	"             V_DFJE := 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	157	"          END IF;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	158	"       ELSE
"
YK_KJ_JZPZ_YSYF	PROCEDURE	159	"          IF V_ZJFX = '增' THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	160	"             V_JFJE := V_JFJE + 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	161	"             V_DFJE := V_DFJE + V_JE;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	162	"          ELSIF V_ZJFX = '减' THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	163	"             V_JFJE := V_JFJE + V_JE;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	164	"             V_DFJE := V_DFJE + 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	165	"          ELSE
"
YK_KJ_JZPZ_YSYF	PROCEDURE	166	"             V_JFJE := -1;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	167	"             V_DFJE := -1;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	168	"          END IF;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	169	"        END IF;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	170	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	171	"       END LOOP;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	172	"       CLOSE CUR_RKDH;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	173	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	174	"       IF V_JFJE = 0 AND V_DFJE = 0 THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	175	"          GOTO NEXT_KMBM;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	176	"       END IF;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	177	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	178	"---KMMC
"
YK_KJ_JZPZ_YSYF	PROCEDURE	179	"       IF V_FLKMBM = 0 THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	180	"          V_KMMC_ALL := V_KMMC||'('||TO_CHAR(V_KMBM)||')';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	181	"       ELSE
"
YK_KJ_JZPZ_YSYF	PROCEDURE	182	"	  V_KMMC_ALL := V_KMMC||'('||TO_CHAR(V_KMBM)||')';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	183	"         LOOP
"
YK_KJ_JZPZ_YSYF	PROCEDURE	184	"           BEGIN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	185	"   	      SELECT KMBM,FLKMBM,LTRIM(RTRIM(NVL(KMMC,'')))
"
YK_KJ_JZPZ_YSYF	PROCEDURE	186	"              INTO V_KMBM,V_FLKMBM,V_KMMC
"
YK_KJ_JZPZ_YSYF	PROCEDURE	187	"	      FROM YK_KJ_KMSZ WHERE XTXH = P_XTXH and KMBM = V_FLKMBM;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	188	"            EXCEPTION
"
YK_KJ_JZPZ_YSYF	PROCEDURE	189	"	       WHEN OTHERS THEN  -- handles all other errors
"
YK_KJ_JZPZ_YSYF	PROCEDURE	190	"                V_KMMC := '错误';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	191	"                V_FLKMBM := 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	192	"           END;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	193	"	   V_KMMC_ALL := V_KMMC||'/'||V_KMMC_ALL;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	194	"  	 EXIT WHEN V_FLKMBM = 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	195	"         END LOOP;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	196	"       END IF;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	197	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	198	"-- ZY
"
YK_KJ_JZPZ_YSYF	PROCEDURE	199	"       IF P_XTXH = 6 THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	200	"  	  V_ZY := '西药';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	201	"       ELSIF P_XTXH = 7 THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	202	"  	  V_ZY := '中成药';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	203	"       ELSIF P_XTXH = 9 THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	204	"  	  V_ZY := '草药';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	205	"       ELSE
"
YK_KJ_JZPZ_YSYF	PROCEDURE	206	"	  V_ZY := '其它';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	207	"       END IF;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	208	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	209	"       V_ZY := '支付'||V_ZY||'款-'||V_DWMC;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	210	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	211	"      SELECT DECODE(ZYDYFS,1,REPLACE(UPPER(ZYDYGS),'DWMC',V_DWMC),V_ZY) INTO V_ZY
"
YK_KJ_JZPZ_YSYF	PROCEDURE	212	"      FROM YK_CRKFS WHERE XTXH = P_XTXH AND CRKFSDM = 51;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	213	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	214	"      V_XH := V_XH + 1;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	215	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	216	"      IF V_XH = (V_DYHS+1)*V_PAGE THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	217	"        INSERT INTO YK_JZPZ_MX(XTXH,CRKDH,CRKFSDM,XH,ZY,KJKM,JFJE,DFJE)
"
YK_KJ_JZPZ_YSYF	PROCEDURE	218	"         VALUES(P_XTXH,P_JSDH,P_CRKFSDM,V_XH,'附单据数    张','合计',0,0);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	219	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	220	"         V_XH   := V_XH + 1;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	221	"         V_PAGE := V_PAGE + 1;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	222	"      END IF;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	223	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	224	"      V_JFJE_SUM := V_JFJE_SUM + V_JFJE;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	225	"      V_DFJE_SUM := V_DFJE_SUM + V_DFJE;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	226	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	227	"      IF V_DWDY = 1 THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	228	"         V_DWMC_KM := V_DWMC;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	229	"      END IF;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	230	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	231	"      INSERT INTO YK_JZPZ_MX(XTXH,CRKDH,CRKFSDM,XH,ZY,KJKM,JFJE,DFJE,DWMC)
"
YK_KJ_JZPZ_YSYF	PROCEDURE	232	"      VALUES(P_XTXH,P_JSDH,P_CRKFSDM,V_XH,V_ZY,V_KMMC_ALL,V_JFJE,V_DFJE,V_DWMC_KM);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	233	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	234	"      <<NEXT_KMBM>>
"
YK_KJ_JZPZ_YSYF	PROCEDURE	235	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	236	"       V_DWMC_KM := '';
"
YK_KJ_JZPZ_YSYF	PROCEDURE	237	"       V_JFJE := 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	238	"       V_DFJE := 0;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	239	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	240	"  END LOOP;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	241	"  CLOSE CUR_KJKM;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	242	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	243	"--FILL THE BLANK
"
YK_KJ_JZPZ_YSYF	PROCEDURE	244	"  LOOP
"
YK_KJ_JZPZ_YSYF	PROCEDURE	245	"     V_XH := V_XH + 1;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	246	"     EXIT WHEN V_XH = (V_DYHS+1)*V_PAGE;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	247	"     INSERT INTO YK_JZPZ_MX(XTXH,CRKDH,CRKFSDM,XH,ZY,KJKM,JFJE,DFJE)
"
YK_KJ_JZPZ_YSYF	PROCEDURE	248	"     VALUES(P_XTXH,P_JSDH,P_CRKFSDM,V_XH,'','',0,0);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	249	"  END LOOP;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	250	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	251	"--CHECK JF DF
"
YK_KJ_JZPZ_YSYF	PROCEDURE	252	"  IF V_JFJE_SUM <> V_DFJE_SUM THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	253	"    INSERT INTO YK_JZPZ_MX(XTXH,CRKDH,CRKFSDM,XH,ZY,KJKM,JFJE,DFJE)
"
YK_KJ_JZPZ_YSYF	PROCEDURE	254	"    VALUES(P_XTXH,P_JSDH,P_CRKFSDM,V_XH,'错误：借贷不平衡','错误',V_JFJE_SUM,V_DFJE_SUM);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	255	"  ELSE
"
YK_KJ_JZPZ_YSYF	PROCEDURE	256	"    INSERT INTO YK_JZPZ_MX(XTXH,CRKDH,CRKFSDM,XH,ZY,KJKM,JFJE,DFJE)
"
YK_KJ_JZPZ_YSYF	PROCEDURE	257	"    VALUES(P_XTXH,P_JSDH,P_CRKFSDM,V_XH,'附单据数    张','合计',V_JFJE_SUM,V_DFJE_SUM);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	258	"  END IF;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	259	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	260	"IF V_XH > 0 THEN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	261	"---  YK_JZPZ
"
YK_KJ_JZPZ_YSYF	PROCEDURE	262	"-- JZRQ
"
YK_KJ_JZPZ_YSYF	PROCEDURE	263	"       BEGIN
"
YK_KJ_JZPZ_YSYF	PROCEDURE	264	"        SELECT TO_DATE(SYSDATE) INTO V_JZRQ
"
YK_KJ_JZPZ_YSYF	PROCEDURE	265	"        FROM DUAL;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	266	"        EXCEPTION
"
YK_KJ_JZPZ_YSYF	PROCEDURE	267	"	    WHEN OTHERS THEN  -- handles all other errors
"
YK_KJ_JZPZ_YSYF	PROCEDURE	268	"	    V_JZRQ := TO_DATE('1900/01/01','YYYY/MM/DD');
"
YK_KJ_JZPZ_YSYF	PROCEDURE	269	"       END;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	270	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	271	"-- INSERT
"
YK_KJ_JZPZ_YSYF	PROCEDURE	272	"       INSERT INTO YK_JZPZ(XTXH,CRKDH,CRKFSDM,DWBH,DWMC,JZRQ)
"
YK_KJ_JZPZ_YSYF	PROCEDURE	273	"       VALUES(P_XTXH,P_JSDH,P_CRKFSDM,V_HSDWBH,V_HSDWMC,V_JZRQ);
"
YK_KJ_JZPZ_YSYF	PROCEDURE	274	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	275	"END IF;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	276	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	277	"--COMMIT;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	278	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	279	"/*
"
YK_KJ_JZPZ_YSYF	PROCEDURE	280	"EXCEPTION  -- exception handlers begin
"
YK_KJ_JZPZ_YSYF	PROCEDURE	281	"   WHEN OTHERS THEN  -- handles all other errors
"
YK_KJ_JZPZ_YSYF	PROCEDURE	282	"        ROLLBACK;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	283	"	RAISE_APPLICATION_ERROR(-20110,'Yk_Kj_Jzpz_Ysyf FAILS');
"
YK_KJ_JZPZ_YSYF	PROCEDURE	284	"*/
"
YK_KJ_JZPZ_YSYF	PROCEDURE	285	"END;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	286	"END;
"
YK_KJ_JZPZ_YSYF	PROCEDURE	287	"
"
YK_KJ_JZPZ_YSYF	PROCEDURE	288	 
