YK_QYKC	PROCEDURE	1	"PROCEDURE         ""YK_QYKC"" (
"
YK_QYKC	PROCEDURE	2	"        P_XTXH   IN NUMBER,
"
YK_QYKC	PROCEDURE	3	"	P_YPXH   IN NUMBER,
"
YK_QYKC	PROCEDURE	4	"	P_YPCDDM IN NUMBER) IS
"
YK_QYKC	PROCEDURE	5	"BEGIN
"
YK_QYKC	PROCEDURE	6	"DECLARE
"
YK_QYKC	PROCEDURE	7	"
"
YK_QYKC	PROCEDURE	8	"   V_YPBZL	NUMBER(8,3);
"
YK_QYKC	PROCEDURE	9	"   V_YKKC       NUMBER(14,4);
"
YK_QYKC	PROCEDURE	10	"   V_MYKC	NUMBER(14,4);
"
YK_QYKC	PROCEDURE	11	"   V_MYKC_FZ	NUMBER(14,4);
"
YK_QYKC	PROCEDURE	12	"   V_BYKC	NUMBER(14,4);
"
YK_QYKC	PROCEDURE	13	"   V_BYKC_FZ	NUMBER(14,4);
"
YK_QYKC	PROCEDURE	14	"   V_ZBLB	NUMBER(2);
"
YK_QYKC	PROCEDURE	15	"   V_PFJ	NUMBER(16,6);
"
YK_QYKC	PROCEDURE	16	"   V_LSJ	NUMBER(16,6);
"
YK_QYKC	PROCEDURE	17	"  
"
YK_QYKC	PROCEDURE	18	"   V_COUNT	NUMBER;
"
YK_QYKC	PROCEDURE	19	"
"
YK_QYKC	PROCEDURE	20	"BEGIN
"
YK_QYKC	PROCEDURE	21	"
"
YK_QYKC	PROCEDURE	22	"---- 药库库存
"
YK_QYKC	PROCEDURE	23	"BEGIN
"
YK_QYKC	PROCEDURE	24	"   SELECT NVL(YPBZL,1),ZBLB INTO V_YPBZL,V_ZBLB
"
YK_QYKC	PROCEDURE	25	"   FROM GY_YPMCGGZD WHERE YPXH = P_YPXH;
"
YK_QYKC	PROCEDURE	26	"   EXCEPTION      
"
YK_QYKC	PROCEDURE	27	"    WHEN NO_DATA_FOUND THEN
"
YK_QYKC	PROCEDURE	28	"   V_YPBZL := 1;
"
YK_QYKC	PROCEDURE	29	"   V_ZBLB  := 0;
"
YK_QYKC	PROCEDURE	30	"END;
"
YK_QYKC	PROCEDURE	31	"
"
YK_QYKC	PROCEDURE	32	"BEGIN
"
YK_QYKC	PROCEDURE	33	"   SELECT PFJ,LSJ INTO V_PFJ,V_LSJ
"
YK_QYKC	PROCEDURE	34	"   FROM GY_YPCDJG
"
YK_QYKC	PROCEDURE	35	"   WHERE BMXH IS NULL AND KFBZ IS NOT NULL AND
"
YK_QYKC	PROCEDURE	36	"   YPXH = P_YPXH AND YPCDDM = P_YPCDDM;
"
YK_QYKC	PROCEDURE	37	"   EXCEPTION      
"
YK_QYKC	PROCEDURE	38	"     WHEN OTHERS THEN
"
YK_QYKC	PROCEDURE	39	"   V_PFJ := 0;
"
YK_QYKC	PROCEDURE	40	"   V_LSJ := 0;
"
YK_QYKC	PROCEDURE	41	"END;
"
YK_QYKC	PROCEDURE	42	"
"
YK_QYKC	PROCEDURE	43	"BEGIN
"
YK_QYKC	PROCEDURE	44	"   SELECT NVL(SUM(NVL(KCS,0)),0) INTO V_YKKC
"
YK_QYKC	PROCEDURE	45	"   FROM YK_YPKCZB WHERE YPXH = P_YPXH AND YPCDDM = P_YPCDDM ;
"
YK_QYKC	PROCEDURE	46	"   EXCEPTION      
"
YK_QYKC	PROCEDURE	47	"	   WHEN NO_DATA_FOUND THEN
"
YK_QYKC	PROCEDURE	48	"   V_YKKC := 0;
"
YK_QYKC	PROCEDURE	49	"END;
"
YK_QYKC	PROCEDURE	50	"
"
YK_QYKC	PROCEDURE	51	"---- 门诊药房
"
YK_QYKC	PROCEDURE	52	"BEGIN
"
YK_QYKC	PROCEDURE	53	"   SELECT NVL(SUM(NVL(SKC,0)) - SUM(NVL(XSKC,0)),0) INTO V_MYKC
"
YK_QYKC	PROCEDURE	54	"   FROM MY_YPKCZ  WHERE YPXH = P_YPXH AND YPCDDM = P_YPCDDM ;
"
YK_QYKC	PROCEDURE	55	"
"
YK_QYKC	PROCEDURE	56	"   EXCEPTION      
"
YK_QYKC	PROCEDURE	57	"	   WHEN NO_DATA_FOUND THEN
"
YK_QYKC	PROCEDURE	58	"   V_MYKC := 0; 	
"
YK_QYKC	PROCEDURE	59	"END;
"
YK_QYKC	PROCEDURE	60	"
"
YK_QYKC	PROCEDURE	61	"BEGIN
"
YK_QYKC	PROCEDURE	62	"   SELECT NVL(SUM(NVL(SKC,0)) - SUM(NVL(XSKC,0)),0) INTO V_MYKC_FZ
"
YK_QYKC	PROCEDURE	63	"   FROM MY_YPKCZ  WHERE FZFL = P_YPXH AND YPCDDM = P_YPCDDM ;
"
YK_QYKC	PROCEDURE	64	"
"
YK_QYKC	PROCEDURE	65	"   EXCEPTION      
"
YK_QYKC	PROCEDURE	66	"	   WHEN NO_DATA_FOUND THEN
"
YK_QYKC	PROCEDURE	67	"   V_MYKC_FZ := 0; 	
"
YK_QYKC	PROCEDURE	68	"END ;
"
YK_QYKC	PROCEDURE	69	"
"
YK_QYKC	PROCEDURE	70	"   IF V_MYKC = 0 THEN
"
YK_QYKC	PROCEDURE	71	"      V_MYKC := ROUND(V_MYKC_FZ/V_YPBZL,2);
"
YK_QYKC	PROCEDURE	72	"   END IF ;
"
YK_QYKC	PROCEDURE	73	"
"
YK_QYKC	PROCEDURE	74	"---- 住院药房				
"
YK_QYKC	PROCEDURE	75	"BEGIN
"
YK_QYKC	PROCEDURE	76	"   SELECT NVL(SUM(NVL(SKC,0)) - SUM(NVL(XSKC,0)),0) INTO V_BYKC
"
YK_QYKC	PROCEDURE	77	"   FROM BY_YPKCZ  WHERE YPXH = P_YPXH AND YPCDDM = P_YPCDDM ;
"
YK_QYKC	PROCEDURE	78	"
"
YK_QYKC	PROCEDURE	79	"   EXCEPTION      
"
YK_QYKC	PROCEDURE	80	"	   WHEN NO_DATA_FOUND THEN
"
YK_QYKC	PROCEDURE	81	"   V_BYKC := 0;
"
YK_QYKC	PROCEDURE	82	"END;
"
YK_QYKC	PROCEDURE	83	"
"
YK_QYKC	PROCEDURE	84	"BEGIN
"
YK_QYKC	PROCEDURE	85	"   SELECT NVL(SUM(NVL(SKC,0)) - SUM(NVL(XSKC,0)),0) INTO V_BYKC_FZ
"
YK_QYKC	PROCEDURE	86	"   FROM BY_YPKCZ  WHERE FZFL = P_YPXH AND YPCDDM = P_YPCDDM ;
"
YK_QYKC	PROCEDURE	87	"
"
YK_QYKC	PROCEDURE	88	"   EXCEPTION      
"
YK_QYKC	PROCEDURE	89	"	   WHEN NO_DATA_FOUND THEN
"
YK_QYKC	PROCEDURE	90	"   V_BYKC_FZ := 0;
"
YK_QYKC	PROCEDURE	91	"END;
"
YK_QYKC	PROCEDURE	92	"
"
YK_QYKC	PROCEDURE	93	"   IF V_BYKC = 0 THEN
"
YK_QYKC	PROCEDURE	94	"      V_BYKC := ROUND(V_BYKC_FZ/V_YPBZL,2);
"
YK_QYKC	PROCEDURE	95	"   END IF ;
"
YK_QYKC	PROCEDURE	96	"
"
YK_QYKC	PROCEDURE	97	"---- FINISH
"
YK_QYKC	PROCEDURE	98	"    SELECT COUNT(*) INTO V_COUNT 
"
YK_QYKC	PROCEDURE	99	"    FROM YK_QYKC_TEMP WHERE YPXH = P_YPXH AND YPCDDM = P_YPCDDM AND XTXH = P_XTXH;
"
YK_QYKC	PROCEDURE	100	"
"
YK_QYKC	PROCEDURE	101	"    IF V_COUNT = 1 THEN
"
YK_QYKC	PROCEDURE	102	"       UPDATE YK_QYKC_TEMP
"
YK_QYKC	PROCEDURE	103	"       SET YKKC = V_YKKC,MYKC = V_MYKC,BYKC = V_BYKC,PFJ = V_PFJ,LSJ = V_LSJ
"
YK_QYKC	PROCEDURE	104	"       WHERE YPXH = P_YPXH AND YPCDDM = P_YPCDDM AND XTXH = P_XTXH;
"
YK_QYKC	PROCEDURE	105	"     ELSE
"
YK_QYKC	PROCEDURE	106	"       INSERT INTO YK_QYKC_TEMP (XTXH,YPXH,YPCDDM,YKKC,MYKC,BYKC,ZBLB,PFJ,LSJ)
"
YK_QYKC	PROCEDURE	107	"       VALUES (P_XTXH,P_YPXH,P_YPCDDM,V_YKKC,V_MYKC,V_BYKC,V_ZBLB,V_PFJ,V_LSJ);
"
YK_QYKC	PROCEDURE	108	"     END IF;
"
YK_QYKC	PROCEDURE	109	"
"
YK_QYKC	PROCEDURE	110	"/*EXCEPTION  -- exception handlers begin
"
YK_QYKC	PROCEDURE	111	"   WHEN OTHERS THEN  -- handles all other errors
"
YK_QYKC	PROCEDURE	112	"        ROLLBACK;
"
YK_QYKC	PROCEDURE	113	"	RAISE_APPLICATION_ERROR(-20103,'YK_QYKC FAILS');
"
YK_QYKC	PROCEDURE	114	"*/
"
YK_QYKC	PROCEDURE	115	"END;
"
YK_QYKC	PROCEDURE	116	"END;
"
YK_QYKC	PROCEDURE	117	"
"
YK_QYKC	PROCEDURE	118	"
"
YK_QYKC	PROCEDURE	119	"
"
YK_QYKC	PROCEDURE	120	 
