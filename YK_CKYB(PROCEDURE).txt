YK_CKYB	PROCEDURE	1	"PROCEDURE         ""YK_CKYB"" (FORMDATE IN VARCHAR2,VXTXH IN NUMBER,VCZGH IN VARCHAR2)
"
YK_CKYB	PROCEDURE	2	"AS
"
YK_CKYB	PROCEDURE	3	"BEGIN   /*sdate 月报时间   */
"
YK_CKYB	PROCEDURE	4	"DECLARE
"
YK_CKYB	PROCEDURE	5	" ZBMCTEMP VARCHAR2(12);   --插入空行时的帐簿名称
"
YK_CKYB	PROCEDURE	6	" ZBLBTEMP NUMBER(2);
"
YK_CKYB	PROCEDURE	7	" MZKSDM VARCHAR2(10);
"
YK_CKYB	PROCEDURE	8	" ZYKSDM VARCHAR2(10);
"
YK_CKYB	PROCEDURE	9	" ZJKSDM VARCHAR2(10);
"
YK_CKYB	PROCEDURE	10	" VCRKFSDM NUMBER(2);
"
YK_CKYB	PROCEDURE	11	" VCRKFSMC VARCHAR2(12);
"
YK_CKYB	PROCEDURE	12	" VJJHS NUMBER(1);
"
YK_CKYB	PROCEDURE	13	" VDWFX NUMBER(1);
"
YK_CKYB	PROCEDURE	14	" I NUMBER ;
"
YK_CKYB	PROCEDURE	15	" CURSOR CKFSCUR IS
"
YK_CKYB	PROCEDURE	16	"    SELECT CRKFSDM,CRKFSMC,JJHS,DWFX FROM YK_CRKFS
"
YK_CKYB	PROCEDURE	17	"     WHERE XTXH=VXTXH AND CRKFX=2 AND KCFX=2 ORDER BY CRKFSDM;
"
YK_CKYB	PROCEDURE	18	"
"
YK_CKYB	PROCEDURE	19	"BEGIN
"
YK_CKYB	PROCEDURE	20	" DELETE FROM YK_YPJXFLZ_TEMP WHERE XTXH=VXTXH AND CZGH=VCZGH;
"
YK_CKYB	PROCEDURE	21	"
"
YK_CKYB	PROCEDURE	22	" SELECT ZBMC,ZBLB INTO ZBMCTEMP,ZBLBTEMP FROM YK_ZBLB WHERE XTXH=VXTXH AND ROWNUM=1 ORDER BY ZBLB;
"
YK_CKYB	PROCEDURE	23	" I := 0 ;
"
YK_CKYB	PROCEDURE	24	" INSERT INTO YK_YPJXFLZ_TEMP(XTXH,CZGH,HDYSX,ZY,LDYSX,LM,LZ)    --上月结转 82
"
YK_CKYB	PROCEDURE	25	"    SELECT VXTXH,VCZGH,I,' ',B.ZBLB,B.ZBMC,SUM(ROUND(A.JFJE,2))
"
YK_CKYB	PROCEDURE	26	"       FROM YK_KCMXZB A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	27	"       WHERE A.XTXH=VXTXH AND A.CRKFSDM=82 AND A.CRKDH LIKE FORMDATE
"
YK_CKYB	PROCEDURE	28	"             AND B.XTXH=VXTXH AND A.ZBLB=B.ZBLB
"
YK_CKYB	PROCEDURE	29	"       GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	30	" IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	31	"    INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,' ',ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	32	" END IF;
"
YK_CKYB	PROCEDURE	33	"
"
YK_CKYB	PROCEDURE	34	" I := 1000 ;
"
YK_CKYB	PROCEDURE	35	" INSERT INTO YK_YPJXFLZ_TEMP(XTXH,CZGH,HDYSX,ZY,LDYSX,LM,LZ)    --入库(购入,调拨入库,退货)
"
YK_CKYB	PROCEDURE	36	"    SELECT VXTXH,VCZGH,I,'购入',B.ZBLB,B.ZBMC,SUM(ROUND(A.JFJE,2))
"
YK_CKYB	PROCEDURE	37	"       FROM YK_KCMXZB A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	38	"       WHERE A.XTXH=VXTXH AND A.CRKFSDM IN (SELECT CRKFSDM FROM YK_CRKFS WHERE XTXH=VXTXH AND CRKFX=1 AND JJHS<>0)
"
YK_CKYB	PROCEDURE	39	"             AND A.CRKDH LIKE FORMDATE AND B.XTXH=VXTXH AND A.ZBLB=B.ZBLB
"
YK_CKYB	PROCEDURE	40	"       GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	41	" IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	42	"    INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,'购入',ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	43	" END IF;
"
YK_CKYB	PROCEDURE	44	" I := I + 1 ;
"
YK_CKYB	PROCEDURE	45	"
"
YK_CKYB	PROCEDURE	46	" INSERT INTO YK_YPJXFLZ_TEMP(XTXH,CZGH,HDYSX,ZY,LDYSX,LM,LZ)     --赠品
"
YK_CKYB	PROCEDURE	47	"    SELECT VXTXH,VCZGH,I,'赠送',B.ZBLB,B.ZBMC,SUM(ROUND(A.JFJE,2))
"
YK_CKYB	PROCEDURE	48	"       FROM YK_KCMXZB A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	49	"       WHERE A.XTXH=VXTXH AND A.CRKFSDM IN (SELECT CRKFSDM FROM YK_CRKFS WHERE XTXH=VXTXH AND CRKFX=1 AND JJHS=0)
"
YK_CKYB	PROCEDURE	50	"             AND A.CRKDH LIKE FORMDATE AND B.XTXH=VXTXH AND A.ZBLB=B.ZBLB
"
YK_CKYB	PROCEDURE	51	"       GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	52	" IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	53	"    INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,'赠送',ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	54	" END IF;
"
YK_CKYB	PROCEDURE	55	" I := I + 1 ;
"
YK_CKYB	PROCEDURE	56	"
"
YK_CKYB	PROCEDURE	57	" INSERT INTO YK_YPJXFLZ_TEMP(XTXH,CZGH,HDYSX,ZY,LDYSX,LM,LZ)      --调升 21
"
YK_CKYB	PROCEDURE	58	"    SELECT VXTXH,VCZGH,I,'调升',B.ZBLB,B.ZBMC,SUM(ROUND(A.JFJE,2))
"
YK_CKYB	PROCEDURE	59	"       FROM YK_KCMXZB A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	60	"       WHERE A.XTXH=VXTXH AND A.CRKFSDM=21 AND A.CRKDH LIKE FORMDATE
"
YK_CKYB	PROCEDURE	61	"             AND B.XTXH=VXTXH AND A.ZBLB=B.ZBLB
"
YK_CKYB	PROCEDURE	62	"       GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	63	" IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	64	"    INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,'调升',ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	65	" END IF;
"
YK_CKYB	PROCEDURE	66	" I := I + 1 ;
"
YK_CKYB	PROCEDURE	67	"
"
YK_CKYB	PROCEDURE	68	" INSERT INTO YK_YPJXFLZ_TEMP(XTXH,CZGH,HDYSX,ZY,LDYSX,LM,LZ)       --盘盈 22
"
YK_CKYB	PROCEDURE	69	"    SELECT VXTXH,VCZGH,I,'盘盈',B.ZBLB,B.ZBMC,SUM(ROUND(A.JFJE,2))
"
YK_CKYB	PROCEDURE	70	"       FROM YK_KCMXZB A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	71	"       WHERE A.XTXH=VXTXH AND A.CRKFSDM=22 AND A.CRKDH LIKE FORMDATE
"
YK_CKYB	PROCEDURE	72	"             AND B.XTXH=VXTXH AND A.ZBLB=B.ZBLB
"
YK_CKYB	PROCEDURE	73	"       GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	74	" IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	75	"    INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,'盘盈',ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	76	" END IF;
"
YK_CKYB	PROCEDURE	77	"
"
YK_CKYB	PROCEDURE	78	" I := 1999 ;
"
YK_CKYB	PROCEDURE	79	" INSERT INTO YK_YPJXFLZ_TEMP(XTXH,CZGH,HDYSX,ZY,LDYSX,LM,LZ)        --本月收入
"
YK_CKYB	PROCEDURE	80	"    SELECT VXTXH,VCZGH,I,'小计',B.ZBLB,B.ZBMC,SUM(ROUND(A.LZ,2))
"
YK_CKYB	PROCEDURE	81	"       FROM YK_YPJXFLZ_TEMP A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	82	"       WHERE A.XTXH=VXTXH AND A.CZGH=VCZGH AND A.HDYSX >=1000 AND A.HDYSX < 1999
"
YK_CKYB	PROCEDURE	83	"             AND B.XTXH=VXTXH AND A.LDYSX=B.ZBLB
"
YK_CKYB	PROCEDURE	84	"       GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	85	" IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	86	"    INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,'小计',ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	87	" END IF;
"
YK_CKYB	PROCEDURE	88	"
"
YK_CKYB	PROCEDURE	89	"--********************************************************************  本月出库
"
YK_CKYB	PROCEDURE	90	" I := 2000 ;
"
YK_CKYB	PROCEDURE	91	" OPEN CKFSCUR ;
"
YK_CKYB	PROCEDURE	92	" LOOP
"
YK_CKYB	PROCEDURE	93	"    FETCH CKFSCUR INTO VCRKFSDM,VCRKFSMC,VJJHS,VDWFX;
"
YK_CKYB	PROCEDURE	94	"    EXIT WHEN CKFSCUR%NOTFOUND ;
"
YK_CKYB	PROCEDURE	95	"    INSERT INTO YK_YPJXFLZ_TEMP(XTXH,CZGH,HDYSX,ZY,LDYSX,LM,LZ)
"
YK_CKYB	PROCEDURE	96	"       SELECT VXTXH,VCZGH,I,VCRKFSMC,B.ZBLB,B.ZBMC,SUM(ROUND(A.DFJE,2))
"
YK_CKYB	PROCEDURE	97	"         FROM YK_KCMXZB A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	98	"        WHERE A.XTXH=VXTXH AND (A.CRKFSDM=VCRKFSDM OR A.FZFS=VCRKFSDM)
"
YK_CKYB	PROCEDURE	99	"              AND A.CRKDH LIKE FORMDATE AND B.XTXH=VXTXH AND A.ZBLB=B.ZBLB
"
YK_CKYB	PROCEDURE	100	"        GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	101	"    IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	102	"       INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,VCRKFSMC,ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	103	"    END IF;
"
YK_CKYB	PROCEDURE	104	"    I := I + 1 ;
"
YK_CKYB	PROCEDURE	105	" END LOOP;
"
YK_CKYB	PROCEDURE	106	" CLOSE CKFSCUR ;
"
YK_CKYB	PROCEDURE	107	"
"
YK_CKYB	PROCEDURE	108	" INSERT INTO YK_YPJXFLZ_TEMP(XTXH,CZGH,HDYSX,ZY,LDYSX,LM,LZ)      --调降 21
"
YK_CKYB	PROCEDURE	109	"    SELECT VXTXH,VCZGH,I,'调降',B.ZBLB,B.ZBMC,SUM(ROUND(A.DFJE,2))
"
YK_CKYB	PROCEDURE	110	"       FROM YK_KCMXZB A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	111	"       WHERE A.XTXH=VXTXH AND A.CRKFSDM=21 AND A.CRKDH LIKE FORMDATE
"
YK_CKYB	PROCEDURE	112	"             AND B.XTXH=VXTXH AND A.ZBLB=B.ZBLB
"
YK_CKYB	PROCEDURE	113	"       GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	114	" IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	115	"    INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,'调降',ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	116	" END IF;
"
YK_CKYB	PROCEDURE	117	" I := I + 1 ;
"
YK_CKYB	PROCEDURE	118	"
"
YK_CKYB	PROCEDURE	119	" INSERT INTO YK_YPJXFLZ_TEMP(XTXH,CZGH,HDYSX,ZY,LDYSX,LM,LZ)       --盘亏 22
"
YK_CKYB	PROCEDURE	120	"    SELECT VXTXH,VCZGH,I,'盘亏',B.ZBLB,B.ZBMC,SUM(ROUND(A.DFJE,2))
"
YK_CKYB	PROCEDURE	121	"       FROM YK_KCMXZB A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	122	"       WHERE A.XTXH=VXTXH AND A.CRKFSDM=22 AND A.CRKDH LIKE FORMDATE
"
YK_CKYB	PROCEDURE	123	"             AND B.XTXH=VXTXH AND A.ZBLB=B.ZBLB
"
YK_CKYB	PROCEDURE	124	"       GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	125	" IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	126	"    INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,'盘亏',ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	127	" END IF;
"
YK_CKYB	PROCEDURE	128	" I := I + 1 ;
"
YK_CKYB	PROCEDURE	129	"
"
YK_CKYB	PROCEDURE	130	" INSERT INTO YK_YPJXFLZ_TEMP        --报损  23
"
YK_CKYB	PROCEDURE	131	"    SELECT VXTXH,VCZGH,I,'报损',B.ZBLB,B.ZBMC,SUM(ROUND(A.DFJE,2))
"
YK_CKYB	PROCEDURE	132	"       FROM YK_KCMXZB A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	133	"       WHERE A.XTXH=VXTXH AND A.CRKFSDM=23 AND A.CRKDH LIKE FORMDATE
"
YK_CKYB	PROCEDURE	134	"             AND B.XTXH=VXTXH AND A.ZBLB=B.ZBLB
"
YK_CKYB	PROCEDURE	135	"       GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	136	" IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	137	"    INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,'报损',ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	138	" END IF;
"
YK_CKYB	PROCEDURE	139	"
"
YK_CKYB	PROCEDURE	140	" I := 2999 ;
"
YK_CKYB	PROCEDURE	141	" INSERT INTO YK_YPJXFLZ_TEMP            --本月支出
"
YK_CKYB	PROCEDURE	142	"    SELECT VXTXH,VCZGH,I,'小计',B.ZBLB,B.ZBMC,SUM(ROUND(A.LZ,2))
"
YK_CKYB	PROCEDURE	143	"       FROM YK_YPJXFLZ_TEMP A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	144	"       WHERE A.XTXH=VXTXH AND A.CZGH=VCZGH AND A.HDYSX >= 2000 AND A.HDYSX < 2999
"
YK_CKYB	PROCEDURE	145	"             AND B.XTXH=VXTXH AND A.LDYSX=B.ZBLB
"
YK_CKYB	PROCEDURE	146	"       GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	147	" IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	148	"    INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,'小计',ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	149	" END IF;
"
YK_CKYB	PROCEDURE	150	"
"
YK_CKYB	PROCEDURE	151	" I := 3000 ;
"
YK_CKYB	PROCEDURE	152	" INSERT INTO YK_YPJXFLZ_TEMP          --尾差 81
"
YK_CKYB	PROCEDURE	153	"    SELECT VXTXH,VCZGH,I,' ',B.ZBLB,B.ZBMC,SUM(ROUND(A.JFJE-A.DFJE,2))
"
YK_CKYB	PROCEDURE	154	"       FROM YK_KCMXZB A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	155	"       WHERE A.XTXH=VXTXH AND A.CRKFSDM=81 AND A.CRKDH LIKE FORMDATE
"
YK_CKYB	PROCEDURE	156	"             AND B.XTXH=VXTXH AND A.ZBLB=B.ZBLB
"
YK_CKYB	PROCEDURE	157	"       GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	158	" IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	159	"    INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,' ',ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	160	" END IF;
"
YK_CKYB	PROCEDURE	161	"
"
YK_CKYB	PROCEDURE	162	" I := 4000 ;
"
YK_CKYB	PROCEDURE	163	" INSERT INTO YK_YPJXFLZ_TEMP           --本期结存 83
"
YK_CKYB	PROCEDURE	164	"    SELECT VXTXH,VCZGH,I,' ',B.ZBLB,B.ZBMC,SUM(ROUND(DECODE(A.HDYSX,2999,-1*A.LZ,A.LZ),2))
"
YK_CKYB	PROCEDURE	165	"       FROM YK_YPJXFLZ_TEMP A,YK_ZBLB B
"
YK_CKYB	PROCEDURE	166	"       WHERE A.XTXH=VXTXH AND A.CZGH=VCZGH AND A.HDYSX IN (0,1999,2999,3000)
"
YK_CKYB	PROCEDURE	167	"             AND B.XTXH=VXTXH AND A.LDYSX=B.ZBLB
"
YK_CKYB	PROCEDURE	168	"       GROUP BY B.ZBLB,B.ZBMC;
"
YK_CKYB	PROCEDURE	169	" IF SQL%ROWCOUNT=0 THEN
"
YK_CKYB	PROCEDURE	170	"    INSERT INTO YK_YPJXFLZ_TEMP VALUES (VXTXH,VCZGH,I,' ',ZBLBTEMP,ZBMCTEMP,0);
"
YK_CKYB	PROCEDURE	171	" END IF;
"
YK_CKYB	PROCEDURE	172	"
"
YK_CKYB	PROCEDURE	173	" COMMIT;
"
YK_CKYB	PROCEDURE	174	"
"
YK_CKYB	PROCEDURE	175	"END;
"
YK_CKYB	PROCEDURE	176	"
"
YK_CKYB	PROCEDURE	177	"END;
"
YK_CKYB	PROCEDURE	178	"
"
YK_CKYB	PROCEDURE	179	 
