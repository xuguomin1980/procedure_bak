PRC_AUTO_RUN_CS	PROCEDURE	1	"PROCEDURE prc_auto_run_cs Is
"
PRC_AUTO_RUN_CS	PROCEDURE	2	"
"
PRC_AUTO_RUN_CS	PROCEDURE	3	"  /*=============================================================================
"
PRC_AUTO_RUN_CS	PROCEDURE	4	"  || 过程名称 ： PRC_AUTO_RUN 后台自动运行
"
PRC_AUTO_RUN_CS	PROCEDURE	5	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN_CS	PROCEDURE	6	"  || 功能说明 ：  JOB 定时10分钟 执行 后台任务
"
PRC_AUTO_RUN_CS	PROCEDURE	7	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN_CS	PROCEDURE	8	"  || 参数描述 ： 无
"
PRC_AUTO_RUN_CS	PROCEDURE	9	"  ------------------------------------------------------------
"
PRC_AUTO_RUN_CS	PROCEDURE	10	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN_CS	PROCEDURE	11	"  || 注意事项 ：
"
PRC_AUTO_RUN_CS	PROCEDURE	12	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN_CS	PROCEDURE	13	"  || 作    者 ：       完成日期 ：
"
PRC_AUTO_RUN_CS	PROCEDURE	14	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN_CS	PROCEDURE	15	"  || 修改记录 ：
"
PRC_AUTO_RUN_CS	PROCEDURE	16	"  =============================================================================*/
"
PRC_AUTO_RUN_CS	PROCEDURE	17	"  v_Procedure_Name Varchar2(50);
"
PRC_AUTO_RUN_CS	PROCEDURE	18	"  v_task           Varchar2(30);
"
PRC_AUTO_RUN_CS	PROCEDURE	19	"
"
PRC_AUTO_RUN_CS	PROCEDURE	20	"  ln_jcfx_id   Number;
"
PRC_AUTO_RUN_CS	PROCEDURE	21	"  ln_code      Number;
"
PRC_AUTO_RUN_CS	PROCEDURE	22	"  ls_mess      Varchar2(100);
"
PRC_AUTO_RUN_CS	PROCEDURE	23	"  v_count      number;
"
PRC_AUTO_RUN_CS	PROCEDURE	24	"  v_xh         number;
"
PRC_AUTO_RUN_CS	PROCEDURE	25	"  ls_now       Varchar2(20);
"
PRC_AUTO_RUN_CS	PROCEDURE	26	"  ls_now_minue Varchar2(20);
"
PRC_AUTO_RUN_CS	PROCEDURE	27	"  lxdh         Varchar2(20);
"
PRC_AUTO_RUN_CS	PROCEDURE	28	"  nr           Varchar2(200);
"
PRC_AUTO_RUN_CS	PROCEDURE	29	"  v_bz         Varchar2(200);
"
PRC_AUTO_RUN_CS	PROCEDURE	30	"  v_temp       Varchar2(100);
"
PRC_AUTO_RUN_CS	PROCEDURE	31	"  v_jzkh       Varchar2(100);
"
PRC_AUTO_RUN_CS	PROCEDURE	32	"  v_msg        Varchar2(300);
"
PRC_AUTO_RUN_CS	PROCEDURE	33	"  v_sl         Number;
"
PRC_AUTO_RUN_CS	PROCEDURE	34	"  v_sl_count   Number;
"
PRC_AUTO_RUN_CS	PROCEDURE	35	"  v_laborder   Number;
"
PRC_AUTO_RUN_CS	PROCEDURE	36	"  v_out_code   Number;
"
PRC_AUTO_RUN_CS	PROCEDURE	37	"  v_out_msg    Varchar2(300);
"
PRC_AUTO_RUN_CS	PROCEDURE	38	"  v_yyxh       number;
"
PRC_AUTO_RUN_CS	PROCEDURE	39	"  v_lxdh       NVARCHAR2(30);
"
PRC_AUTO_RUN_CS	PROCEDURE	40	"  v_ypxh       Number;
"
PRC_AUTO_RUN_CS	PROCEDURE	41	"  v_ypcddm     Number;
"
PRC_AUTO_RUN_CS	PROCEDURE	42	"  --预约挂号提醒
"
PRC_AUTO_RUN_CS	PROCEDURE	43	"  cursor cur_mzyyk is
"
PRC_AUTO_RUN_CS	PROCEDURE	44	"    select yyxh
"
PRC_AUTO_RUN_CS	PROCEDURE	45	"      from gh_mzyyk
"
PRC_AUTO_RUN_CS	PROCEDURE	46	"     where djrq > sysdate - 0.01
"
PRC_AUTO_RUN_CS	PROCEDURE	47	"       and djrq < sysdate - 0.001
"
PRC_AUTO_RUN_CS	PROCEDURE	48	"       and czgh < 'Z'
"
PRC_AUTO_RUN_CS	PROCEDURE	49	"       and czgh >= 'B'
"
PRC_AUTO_RUN_CS	PROCEDURE	50	"       and yyxh not in (
"
PRC_AUTO_RUN_CS	PROCEDURE	51	"                        
"
PRC_AUTO_RUN_CS	PROCEDURE	52	"                        select yyxh
"
PRC_AUTO_RUN_CS	PROCEDURE	53	"                          from (select yyxh, lxdh
"
PRC_AUTO_RUN_CS	PROCEDURE	54	"                                   From gh_mzyyk
"
PRC_AUTO_RUN_CS	PROCEDURE	55	"                                  where djrq >= sysdate - 0.015
"
PRC_AUTO_RUN_CS	PROCEDURE	56	"                                    and czgh < 'Z'
"
PRC_AUTO_RUN_CS	PROCEDURE	57	"                                    and czgh >= 'B') x,
"
PRC_AUTO_RUN_CS	PROCEDURE	58	"                                auto_task_ywzx_send y
"
PRC_AUTO_RUN_CS	PROCEDURE	59	"                         where instr(y.bz, x.yyxh) > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	60	"                           and y.date_add > sysdate - 0.015
"
PRC_AUTO_RUN_CS	PROCEDURE	61	"                           and nvl(x.lxdh, '13777929515') = y.lxdh);
"
PRC_AUTO_RUN_CS	PROCEDURE	62	"
"
PRC_AUTO_RUN_CS	PROCEDURE	63	"  --挂号费未缴费提醒1
"
PRC_AUTO_RUN_CS	PROCEDURE	64	"  cursor cur_zlf is
"
PRC_AUTO_RUN_CS	PROCEDURE	65	"    select c.jzkh
"
PRC_AUTO_RUN_CS	PROCEDURE	66	"      From yj_yjk1 a, yj_Yjk2 b, zj_jzxx c
"
PRC_AUTO_RUN_CS	PROCEDURE	67	"     where a.jzxh = c.jzxh
"
PRC_AUTO_RUN_CS	PROCEDURE	68	"       and a.yjsb = b.yjsb
"
PRC_AUTO_RUN_CS	PROCEDURE	69	"       and a.sfsb is null
"
PRC_AUTO_RUN_CS	PROCEDURE	70	"       and a.brxh is null
"
PRC_AUTO_RUN_CS	PROCEDURE	71	"       and instr(nvl(b.bz, '0'), '#未缴纳提醒1#') = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	72	"       and b.fygb = 13
"
PRC_AUTO_RUN_CS	PROCEDURE	73	"       and c.jzrq > (sysdate - 0.021 - 0.1)
"
PRC_AUTO_RUN_CS	PROCEDURE	74	"       and c.jzrq < sysdate - 0.021
"
PRC_AUTO_RUN_CS	PROCEDURE	75	"       and c.jzkh = '9'
"
PRC_AUTO_RUN_CS	PROCEDURE	76	"     group by c.jzkh
"
PRC_AUTO_RUN_CS	PROCEDURE	77	"    having sum(sl) > 0;
"
PRC_AUTO_RUN_CS	PROCEDURE	78	"
"
PRC_AUTO_RUN_CS	PROCEDURE	79	"  --挂号费未缴费提醒 2天
"
PRC_AUTO_RUN_CS	PROCEDURE	80	"  cursor cur_zlf_2days is
"
PRC_AUTO_RUN_CS	PROCEDURE	81	"    select distinct (c.jzkh)
"
PRC_AUTO_RUN_CS	PROCEDURE	82	"      From yj_yjk1 a, yj_Yjk2 b, zj_jzxx c
"
PRC_AUTO_RUN_CS	PROCEDURE	83	"     where a.jzxh = c.jzxh
"
PRC_AUTO_RUN_CS	PROCEDURE	84	"       and a.yjsb = b.yjsb
"
PRC_AUTO_RUN_CS	PROCEDURE	85	"       and a.sfsb is null
"
PRC_AUTO_RUN_CS	PROCEDURE	86	"       and a.brxh is null
"
PRC_AUTO_RUN_CS	PROCEDURE	87	"       and instr(nvl(b.bz, '0'), '#未缴纳提醒1#') > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	88	"       and instr(nvl(b.bz, '0'), '#未缴纳提醒2#') = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	89	"       and b.fygb = 13
"
PRC_AUTO_RUN_CS	PROCEDURE	90	"       and c.jzrq >= trunc(sysdate - 3)
"
PRC_AUTO_RUN_CS	PROCEDURE	91	"       and c.jzrq < trunc(sysdate - 2)
"
PRC_AUTO_RUN_CS	PROCEDURE	92	"       and c.jzkh = '9';
"
PRC_AUTO_RUN_CS	PROCEDURE	93	"
"
PRC_AUTO_RUN_CS	PROCEDURE	94	"  ---- 疫苗提醒    
"
PRC_AUTO_RUN_CS	PROCEDURE	95	"  cursor cur_sms_yimao is
"
PRC_AUTO_RUN_CS	PROCEDURE	96	"    select distinct a.jzkh, b.ypxh, b.ypcddm
"
PRC_AUTO_RUN_CS	PROCEDURE	97	"      From mz_cfk1 a, mz_cfk2 b
"
PRC_AUTO_RUN_CS	PROCEDURE	98	"     where a.cfsb = b.cfsb
"
PRC_AUTO_RUN_CS	PROCEDURE	99	"       and trunc(b.shenhesj) = trunc(sysdate + 1)
"
PRC_AUTO_RUN_CS	PROCEDURE	100	"       and b.shenhesj is not null
"
PRC_AUTO_RUN_CS	PROCEDURE	101	"       and a.sfsb is not null
"
PRC_AUTO_RUN_CS	PROCEDURE	102	"       and a.cfrq > sysdate - 360;
"
PRC_AUTO_RUN_CS	PROCEDURE	103	"
"
PRC_AUTO_RUN_CS	PROCEDURE	104	"Begin
"
PRC_AUTO_RUN_CS	PROCEDURE	105	"  --2020-06-25
"
PRC_AUTO_RUN_CS	PROCEDURE	106	"  v_Procedure_Name := '后台执行_PRC_AUTO_RUN';
"
PRC_AUTO_RUN_CS	PROCEDURE	107	"  v_task           := ' ';
"
PRC_AUTO_RUN_CS	PROCEDURE	108	"  lxdh             := '13777929515';
"
PRC_AUTO_RUN_CS	PROCEDURE	109	"  v_count          := 0;
"
PRC_AUTO_RUN_CS	PROCEDURE	110	"  /*  insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	111	"    (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN_CS	PROCEDURE	112	"  values
"
PRC_AUTO_RUN_CS	PROCEDURE	113	"    (v_Procedure_Name, '开始', 0);
"
PRC_AUTO_RUN_CS	PROCEDURE	114	"  commit;*/
"
PRC_AUTO_RUN_CS	PROCEDURE	115	"
"
PRC_AUTO_RUN_CS	PROCEDURE	116	"  select to_char(sysdate, 'hh24:mi'),
"
PRC_AUTO_RUN_CS	PROCEDURE	117	"         substr(to_char(sysdate, 'hh24:mi'), 5, 1)
"
PRC_AUTO_RUN_CS	PROCEDURE	118	"    into ls_now, ls_now_minue
"
PRC_AUTO_RUN_CS	PROCEDURE	119	"    from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	120	"
"
PRC_AUTO_RUN_CS	PROCEDURE	121	"  if 1 = 1 and ((ls_now >= '23:58' and ls_now <= '23:59')) then
"
PRC_AUTO_RUN_CS	PROCEDURE	122	"    update gh_mzlbk t
"
PRC_AUTO_RUN_CS	PROCEDURE	123	"       set zlf    = (select zlf from gh_mzlbk_bak where mzlbxh = t.mzlbxh),
"
PRC_AUTO_RUN_CS	PROCEDURE	124	"           zlf_et = (select zlf_et from gh_mzlbk_bak where mzlbxh = t.mzlbxh)
"
PRC_AUTO_RUN_CS	PROCEDURE	125	"     where mzlbxh in (2, 8);
"
PRC_AUTO_RUN_CS	PROCEDURE	126	"    if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	127	"      commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	128	"      prc_sms_send('ts', '13777929515', 'gh_mzlbk=0.01 ok', v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	129	"    else
"
PRC_AUTO_RUN_CS	PROCEDURE	130	"      rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	131	"      prc_sms_send('ts', '13777929515', 'gh_mzlbk=0.01 error', v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	132	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	133	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	134	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	135	"
"
PRC_AUTO_RUN_CS	PROCEDURE	136	"  -- 住院病人现金与预交款不一致
"
PRC_AUTO_RUN_CS	PROCEDURE	137	"  if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	138	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	139	"    select count(patient_no)
"
PRC_AUTO_RUN_CS	PROCEDURE	140	"      into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	141	"      from (select patient_no,
"
PRC_AUTO_RUN_CS	PROCEDURE	142	"                   t.zf_fee -
"
PRC_AUTO_RUN_CS	PROCEDURE	143	"                   ((select nvl(sum(amount), 0)
"
PRC_AUTO_RUN_CS	PROCEDURE	144	"                       from zy_deposit_file
"
PRC_AUTO_RUN_CS	PROCEDURE	145	"                      where patient_No = t.patient_no
"
PRC_AUTO_RUN_CS	PROCEDURE	146	"                        and js_No = 1) + nvl(pay_xj, 0) + nvl(pay_zp, 0) -
"
PRC_AUTO_RUN_CS	PROCEDURE	147	"                   nvl(return_xj, 0) - nvl(return_zp, 0)) je
"
PRC_AUTO_RUN_CS	PROCEDURE	148	"            
"
PRC_AUTO_RUN_CS	PROCEDURE	149	"              From zy_total_fee t
"
PRC_AUTO_RUN_CS	PROCEDURE	150	"             where jz_date > sysdate - 0.1
"
PRC_AUTO_RUN_CS	PROCEDURE	151	"               and js_NO = 1)
"
PRC_AUTO_RUN_CS	PROCEDURE	152	"     where je <> 0;
"
PRC_AUTO_RUN_CS	PROCEDURE	153	"    if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	154	"      prc_sms_send('ts',
"
PRC_AUTO_RUN_CS	PROCEDURE	155	"                   '13777929515',
"
PRC_AUTO_RUN_CS	PROCEDURE	156	"                   '住院病人现金与预交款不一致[prc_auto_run]',
"
PRC_AUTO_RUN_CS	PROCEDURE	157	"                   v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	158	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	159	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	160	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	161	"
"
PRC_AUTO_RUN_CS	PROCEDURE	162	"  --人工电话预约 漏发短信
"
PRC_AUTO_RUN_CS	PROCEDURE	163	"  IF 1 = 1 THEN
"
PRC_AUTO_RUN_CS	PROCEDURE	164	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	165	"    open cur_mzyyk;
"
PRC_AUTO_RUN_CS	PROCEDURE	166	"    loop
"
PRC_AUTO_RUN_CS	PROCEDURE	167	"      fetch cur_mzyyk
"
PRC_AUTO_RUN_CS	PROCEDURE	168	"        into v_yyxh;
"
PRC_AUTO_RUN_CS	PROCEDURE	169	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	170	"      exit when cur_mzyyk%NOTFOUND;
"
PRC_AUTO_RUN_CS	PROCEDURE	171	"      select nvl(lxdh, '13777929515'),
"
PRC_AUTO_RUN_CS	PROCEDURE	172	"             '就诊科室:' || (select ksmc from gy_ksdm where ksdm = t.ksdm) || ' ' ||
"
PRC_AUTO_RUN_CS	PROCEDURE	173	"             (select '就诊医师:' || xm from gy_zgxx where zgid = ysgh) ||
"
PRC_AUTO_RUN_CS	PROCEDURE	174	"             ',预约号为:' || yyxh || ',预约日期' || to_char(yyrq1, 'yyyy-mm-dd') ||
"
PRC_AUTO_RUN_CS	PROCEDURE	175	"             decode(yysj, 1, '上午', '下午') || ghxh || '号'
"
PRC_AUTO_RUN_CS	PROCEDURE	176	"        into v_lxdh, v_msg
"
PRC_AUTO_RUN_CS	PROCEDURE	177	"        from gh_mzyyk t
"
PRC_AUTO_RUN_CS	PROCEDURE	178	"       where yyxh = v_yyxh;
"
PRC_AUTO_RUN_CS	PROCEDURE	179	"      --v_lxdh := '13777929515';
"
PRC_AUTO_RUN_CS	PROCEDURE	180	"      prc_sms_send('gh', v_lxdh, v_msg, v_temp);
"
PRC_AUTO_RUN_CS	PROCEDURE	181	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	182	"    end loop;
"
PRC_AUTO_RUN_CS	PROCEDURE	183	"    close cur_mzyyk;
"
PRC_AUTO_RUN_CS	PROCEDURE	184	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	185	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	186	"  -- end 人工电话预约 漏发短信
"
PRC_AUTO_RUN_CS	PROCEDURE	187	"
"
PRC_AUTO_RUN_CS	PROCEDURE	188	"  -- 短信提醒 费用未缴纳
"
PRC_AUTO_RUN_CS	PROCEDURE	189	"  if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	190	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	191	"    open cur_zlf;
"
PRC_AUTO_RUN_CS	PROCEDURE	192	"    loop
"
PRC_AUTO_RUN_CS	PROCEDURE	193	"      fetch cur_zlf
"
PRC_AUTO_RUN_CS	PROCEDURE	194	"        into v_jzkh;
"
PRC_AUTO_RUN_CS	PROCEDURE	195	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	196	"      exit when cur_zlf%NOTFOUND;
"
PRC_AUTO_RUN_CS	PROCEDURE	197	"      select trim(lxdh),
"
PRC_AUTO_RUN_CS	PROCEDURE	198	"             xm || ' 您好！您是否还有费用未缴纳，请核实。若已缴或短信误发敬请忽略！'
"
PRC_AUTO_RUN_CS	PROCEDURE	199	"        into v_lxdh, v_msg
"
PRC_AUTO_RUN_CS	PROCEDURE	200	"        from gy_brjbxxk
"
PRC_AUTO_RUN_CS	PROCEDURE	201	"       where jzkh = v_jzkh;
"
PRC_AUTO_RUN_CS	PROCEDURE	202	"      --v_lxdh := '13777929515';
"
PRC_AUTO_RUN_CS	PROCEDURE	203	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	204	"      update yj_Yjk2
"
PRC_AUTO_RUN_CS	PROCEDURE	205	"         set bz = bz || '#未缴纳提醒1#,'
"
PRC_AUTO_RUN_CS	PROCEDURE	206	"       where fygb = 13
"
PRC_AUTO_RUN_CS	PROCEDURE	207	"         and yjsb in (
"
PRC_AUTO_RUN_CS	PROCEDURE	208	"                      
"
PRC_AUTO_RUN_CS	PROCEDURE	209	"                      select a.yjsb
"
PRC_AUTO_RUN_CS	PROCEDURE	210	"                        from yj_Yjk1 a, yj_Yjk2 b, zj_jzxx c
"
PRC_AUTO_RUN_CS	PROCEDURE	211	"                       where a.jzxh = c.jzxh
"
PRC_AUTO_RUN_CS	PROCEDURE	212	"                         and a.yjsb = b.yjsb
"
PRC_AUTO_RUN_CS	PROCEDURE	213	"                         and a.sfsb is null
"
PRC_AUTO_RUN_CS	PROCEDURE	214	"                         and a.brxh is null
"
PRC_AUTO_RUN_CS	PROCEDURE	215	"                         and instr(nvl(b.bz, '0'), '#未缴纳提醒1#') = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	216	"                         and sl > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	217	"                         and b.fygb = 13
"
PRC_AUTO_RUN_CS	PROCEDURE	218	"                         and c.jzrq > (sysdate - 0.5)
"
PRC_AUTO_RUN_CS	PROCEDURE	219	"                         and c.jzrq < sysdate - 0.021
"
PRC_AUTO_RUN_CS	PROCEDURE	220	"                         and c.jzkh = v_jzkh);
"
PRC_AUTO_RUN_CS	PROCEDURE	221	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	222	"      if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	223	"        commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	224	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	225	"        prc_sms_send('未缴纳提醒', v_lxdh, v_msg, v_temp);
"
PRC_AUTO_RUN_CS	PROCEDURE	226	"      else
"
PRC_AUTO_RUN_CS	PROCEDURE	227	"        rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	228	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	229	"    end loop;
"
PRC_AUTO_RUN_CS	PROCEDURE	230	"    close cur_zlf;
"
PRC_AUTO_RUN_CS	PROCEDURE	231	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	232	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	233	"  -- end  短信提醒 费用未缴纳
"
PRC_AUTO_RUN_CS	PROCEDURE	234	"
"
PRC_AUTO_RUN_CS	PROCEDURE	235	"  --   短信提醒 2天 费用未缴纳
"
PRC_AUTO_RUN_CS	PROCEDURE	236	"  if 1 = 1 and ((ls_now > '08:00' and ls_now <= '08:01')) then
"
PRC_AUTO_RUN_CS	PROCEDURE	237	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	238	"    open cur_zlf_2days;
"
PRC_AUTO_RUN_CS	PROCEDURE	239	"    loop
"
PRC_AUTO_RUN_CS	PROCEDURE	240	"      fetch cur_zlf_2days
"
PRC_AUTO_RUN_CS	PROCEDURE	241	"        into v_jzkh;
"
PRC_AUTO_RUN_CS	PROCEDURE	242	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	243	"      exit when cur_zlf_2days%NOTFOUND;
"
PRC_AUTO_RUN_CS	PROCEDURE	244	"      select trim(lxdh),
"
PRC_AUTO_RUN_CS	PROCEDURE	245	"             xm ||
"
PRC_AUTO_RUN_CS	PROCEDURE	246	"              ' 亲爱的病友，您好！您近期在我院就诊时，部分诊疗费用尚未结清，
"
PRC_AUTO_RUN_CS	PROCEDURE	247	"请您尽快到院进行结算，以免对您的后续诊疗及个人信用产生不良影响。感谢您的配合，祝您早日康复！若已缴或短信误发敬请忽略！'
"
PRC_AUTO_RUN_CS	PROCEDURE	248	"        into v_lxdh, v_msg
"
PRC_AUTO_RUN_CS	PROCEDURE	249	"        from gy_brjbxxk
"
PRC_AUTO_RUN_CS	PROCEDURE	250	"       where jzkh = v_jzkh;
"
PRC_AUTO_RUN_CS	PROCEDURE	251	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	252	"      update yj_Yjk2
"
PRC_AUTO_RUN_CS	PROCEDURE	253	"         set bz = bz || '#未缴纳提醒2#,'
"
PRC_AUTO_RUN_CS	PROCEDURE	254	"       where fygb = 13
"
PRC_AUTO_RUN_CS	PROCEDURE	255	"         and yjsb in (select a.yjsb
"
PRC_AUTO_RUN_CS	PROCEDURE	256	"                        from yj_Yjk1 a, yj_Yjk2 b, zj_jzxx c
"
PRC_AUTO_RUN_CS	PROCEDURE	257	"                       where a.jzxh = c.jzxh
"
PRC_AUTO_RUN_CS	PROCEDURE	258	"                         and a.yjsb = b.yjsb
"
PRC_AUTO_RUN_CS	PROCEDURE	259	"                         and a.sfsb is null
"
PRC_AUTO_RUN_CS	PROCEDURE	260	"                         and a.brxh is null
"
PRC_AUTO_RUN_CS	PROCEDURE	261	"                         and instr(nvl(b.bz, '0'), '#未缴纳提醒1#') > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	262	"                         and instr(nvl(b.bz, '0'), '#未缴纳提醒2#') = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	263	"                         and b.fygb = 13
"
PRC_AUTO_RUN_CS	PROCEDURE	264	"                         and b.sl > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	265	"                         and c.jzrq >= trunc(sysdate - 3)
"
PRC_AUTO_RUN_CS	PROCEDURE	266	"                         and c.jzrq < trunc(sysdate - 2)
"
PRC_AUTO_RUN_CS	PROCEDURE	267	"                         and c.jzkh = v_jzkh);
"
PRC_AUTO_RUN_CS	PROCEDURE	268	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	269	"      if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	270	"        commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	271	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	272	"        prc_sms_send('未缴纳提醒', v_lxdh, v_msg, v_temp);
"
PRC_AUTO_RUN_CS	PROCEDURE	273	"      else
"
PRC_AUTO_RUN_CS	PROCEDURE	274	"        rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	275	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	276	"    end loop;
"
PRC_AUTO_RUN_CS	PROCEDURE	277	"    close cur_zlf_2days;
"
PRC_AUTO_RUN_CS	PROCEDURE	278	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	279	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	280	"  -- end  短信提醒 2天 费用未缴纳
"
PRC_AUTO_RUN_CS	PROCEDURE	281	"
"
PRC_AUTO_RUN_CS	PROCEDURE	282	"  --  疫苗  短信提醒
"
PRC_AUTO_RUN_CS	PROCEDURE	283	"
"
PRC_AUTO_RUN_CS	PROCEDURE	284	"  if 1 = 1 and ((ls_now > '08:05' and ls_now <= '08:06')) then
"
PRC_AUTO_RUN_CS	PROCEDURE	285	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	286	"    -- select distinct a.jzkh, b.ypxh,b.ypcddm      
"
PRC_AUTO_RUN_CS	PROCEDURE	287	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	288	"    open cur_sms_yimao;
"
PRC_AUTO_RUN_CS	PROCEDURE	289	"    loop
"
PRC_AUTO_RUN_CS	PROCEDURE	290	"      fetch cur_sms_yimao
"
PRC_AUTO_RUN_CS	PROCEDURE	291	"        into v_jzkh, v_ypxh, v_ypcddm;
"
PRC_AUTO_RUN_CS	PROCEDURE	292	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	293	"      exit when cur_sms_yimao%NOTFOUND;
"
PRC_AUTO_RUN_CS	PROCEDURE	294	"      select trim(lxdh),
"
PRC_AUTO_RUN_CS	PROCEDURE	295	"             xm || ' 亲爱的病友，您好！明天有预约疫苗接种！若已处理或短信误发敬请忽略！'
"
PRC_AUTO_RUN_CS	PROCEDURE	296	"        into v_lxdh, v_msg
"
PRC_AUTO_RUN_CS	PROCEDURE	297	"        from gy_brjbxxk
"
PRC_AUTO_RUN_CS	PROCEDURE	298	"       where jzkh = v_jzkh;
"
PRC_AUTO_RUN_CS	PROCEDURE	299	"      prc_sms_send('未缴纳提醒', v_lxdh, v_msg, v_temp);
"
PRC_AUTO_RUN_CS	PROCEDURE	300	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	301	"    end loop;
"
PRC_AUTO_RUN_CS	PROCEDURE	302	"    close cur_sms_yimao;
"
PRC_AUTO_RUN_CS	PROCEDURE	303	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	304	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	305	"  -- end  疫苗  短信提醒
"
PRC_AUTO_RUN_CS	PROCEDURE	306	"
"
PRC_AUTO_RUN_CS	PROCEDURE	307	"  --  本院核酸收费标志 
"
PRC_AUTO_RUN_CS	PROCEDURE	308	"
"
PRC_AUTO_RUN_CS	PROCEDURE	309	"  if 1 = 1 and ((ls_now > '08:27' and ls_now <= '08:28')) then
"
PRC_AUTO_RUN_CS	PROCEDURE	310	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	311	"    update l_patientinfo
"
PRC_AUTO_RUN_CS	PROCEDURE	312	"       set feestatus = 6
"
PRC_AUTO_RUN_CS	PROCEDURE	313	"     where feestatus = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	314	"       and patientid like 'BY%'
"
PRC_AUTO_RUN_CS	PROCEDURE	315	"       and sampleno >= to_char(sysdate - 7, 'yyyymmdd');
"
PRC_AUTO_RUN_CS	PROCEDURE	316	"    if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	317	"      commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	318	"    else
"
PRC_AUTO_RUN_CS	PROCEDURE	319	"      rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	320	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	321	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	322	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	323	"  -- end  本院核酸收费标志 
"
PRC_AUTO_RUN_CS	PROCEDURE	324	"
"
PRC_AUTO_RUN_CS	PROCEDURE	325	"  --zfl=0.01
"
PRC_AUTO_RUN_CS	PROCEDURE	326	"  if 1 = 0 and (((ls_now > '06:01' and ls_now <= '06:02')) or
"
PRC_AUTO_RUN_CS	PROCEDURE	327	"     ((ls_now > '06:11' and ls_now <= '06:12'))) then
"
PRC_AUTO_RUN_CS	PROCEDURE	328	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	329	"    update gh_mzlbk
"
PRC_AUTO_RUN_CS	PROCEDURE	330	"       set zlf = 0.01, zlf_et = 0.01
"
PRC_AUTO_RUN_CS	PROCEDURE	331	"     where mzlbxh not in (2, 6, 7)
"
PRC_AUTO_RUN_CS	PROCEDURE	332	"       and mzlbxh = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	333	"       and (zlf > 1 or zlf_et > 1)
"
PRC_AUTO_RUN_CS	PROCEDURE	334	"       and to_char(sysdate, 'yyyymmdd') = '20210110';
"
PRC_AUTO_RUN_CS	PROCEDURE	335	"    if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	336	"      commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	337	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	338	"    else
"
PRC_AUTO_RUN_CS	PROCEDURE	339	"      rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	340	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	341	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	342	"    select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	343	"      into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	344	"      from gh_mzlbk
"
PRC_AUTO_RUN_CS	PROCEDURE	345	"     where (zlf > 1 or zlf_et > 1);
"
PRC_AUTO_RUN_CS	PROCEDURE	346	"    select '不免费挂号类别:' || v_count into nr from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	347	"    prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	348	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	349	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	350	"  -- end zfl=0.01
"
PRC_AUTO_RUN_CS	PROCEDURE	351	"
"
PRC_AUTO_RUN_CS	PROCEDURE	352	"  --dj<0 fjxx=074
"
PRC_AUTO_RUN_CS	PROCEDURE	353	"  if 0 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	354	"    select count(a.yjsb)
"
PRC_AUTO_RUN_CS	PROCEDURE	355	"      into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	356	"      From yj_Yjk1 A, YJ_YJK2 B
"
PRC_AUTO_RUN_CS	PROCEDURE	357	"     where A.YJSB = b.yjsb
"
PRC_AUTO_RUN_CS	PROCEDURE	358	"       and b.dj < 0.1
"
PRC_AUTO_RUN_CS	PROCEDURE	359	"       and b.fygb = 13
"
PRC_AUTO_RUN_CS	PROCEDURE	360	"       and a. SFSB IN (SELECT SFSB
"
PRC_AUTO_RUN_CS	PROCEDURE	361	"                      fROM mz_mzsfk1 t
"
PRC_AUTO_RUN_CS	PROCEDURE	362	"                     where sfrq > sysdate - 0.001
"
PRC_AUTO_RUN_CS	PROCEDURE	363	"                       and czgh in ('AUTO5', 'AUTO1')
"
PRC_AUTO_RUN_CS	PROCEDURE	364	"                       and fjxx >= '073');
"
PRC_AUTO_RUN_CS	PROCEDURE	365	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	366	"    if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	367	"      select 'dj<0, fjxx=074, fygl=13,sl=' || v_count into nr from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	368	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	369	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	370	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	371	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	372	"  if 0 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	373	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	374	"    SELECT nvl(TO_CHAR(wm_concat(('073 _ ' || t.ipaddress))), '0')
"
PRC_AUTO_RUN_CS	PROCEDURE	375	"      into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	376	"      fROM mz_mzsfk1 t
"
PRC_AUTO_RUN_CS	PROCEDURE	377	"     where sfrq > sysdate - 0.001
"
PRC_AUTO_RUN_CS	PROCEDURE	378	"       and fjxx = '073';
"
PRC_AUTO_RUN_CS	PROCEDURE	379	"    if length(nr) > 2 then
"
PRC_AUTO_RUN_CS	PROCEDURE	380	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	381	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	382	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	383	"
"
PRC_AUTO_RUN_CS	PROCEDURE	384	"  if 0 = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	385	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	386	"    select nvl(to_char(wm_concat(object_name)), '')
"
PRC_AUTO_RUN_CS	PROCEDURE	387	"      into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	388	"      from v_system_view_fail;
"
PRC_AUTO_RUN_CS	PROCEDURE	389	"    if length(nr) > 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	390	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	391	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	392	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	393	"    /*    select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	394	"      into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	395	"      from zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	396	"     where bz = 'auto_recompile_objs'
"
PRC_AUTO_RUN_CS	PROCEDURE	397	"       and jyrq > sysdate - 0.01;
"
PRC_AUTO_RUN_CS	PROCEDURE	398	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	399	"    if v_count = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	400	"      select 'auto_recompile_objs存储过程失效处理 无记录'
"
PRC_AUTO_RUN_CS	PROCEDURE	401	"        into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	402	"        from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	403	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	404	"    end if;*/
"
PRC_AUTO_RUN_CS	PROCEDURE	405	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	406	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	407	"  -- 2020-06-01 免费检查
"
PRC_AUTO_RUN_CS	PROCEDURE	408	"  if 0 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	409	"    select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	410	"      into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	411	"      from temp_20200507_saicab t
"
PRC_AUTO_RUN_CS	PROCEDURE	412	"     where jzrq > sysdate - 0.3;
"
PRC_AUTO_RUN_CS	PROCEDURE	413	"    if v_count > 1 and v_count < 6 then
"
PRC_AUTO_RUN_CS	PROCEDURE	414	"      /* v_sl_count := 0;
"
PRC_AUTO_RUN_CS	PROCEDURE	415	"      select nvl(sum(sl), 0)
"
PRC_AUTO_RUN_CS	PROCEDURE	416	"        into v_sl_count
"
PRC_AUTO_RUN_CS	PROCEDURE	417	"        from temp_20200507_saicab
"
PRC_AUTO_RUN_CS	PROCEDURE	418	"       where jzrq >= trunc(sysdate);*/
"
PRC_AUTO_RUN_CS	PROCEDURE	419	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	420	"        select '2020-06-01 免费检查活动：' || v_count into nr from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	421	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	422	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	423	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	424	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	425	"
"
PRC_AUTO_RUN_CS	PROCEDURE	426	"  -- 2020-06-01 免费挂号
"
PRC_AUTO_RUN_CS	PROCEDURE	427	"  if 0 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	428	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	429	"    select count(a.yjsb)
"
PRC_AUTO_RUN_CS	PROCEDURE	430	"      into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	431	"      From yj_Yjk1 A, YJ_YJK2 B
"
PRC_AUTO_RUN_CS	PROCEDURE	432	"     where A.YJSB = b.yjsb
"
PRC_AUTO_RUN_CS	PROCEDURE	433	"       and b.dj < 0.1
"
PRC_AUTO_RUN_CS	PROCEDURE	434	"       and b.fygb = 13
"
PRC_AUTO_RUN_CS	PROCEDURE	435	"       and a.kdsj > sysdate - 0.1;
"
PRC_AUTO_RUN_CS	PROCEDURE	436	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	437	"    if v_count > 1 and v_count < 6 then
"
PRC_AUTO_RUN_CS	PROCEDURE	438	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	439	"        select '2020-06-01 免费挂号活动：' || v_count into nr from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	440	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	441	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	442	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	443	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	444	"    select count(a.yjsb)
"
PRC_AUTO_RUN_CS	PROCEDURE	445	"      into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	446	"      From yj_Yjk1 A, YJ_YJK2 B
"
PRC_AUTO_RUN_CS	PROCEDURE	447	"     where A.YJSB = b.yjsb
"
PRC_AUTO_RUN_CS	PROCEDURE	448	"       and a.sjksdm not in (select ksdm from gh_jjr_ksdm)
"
PRC_AUTO_RUN_CS	PROCEDURE	449	"          
"
PRC_AUTO_RUN_CS	PROCEDURE	450	"       and b.dj < 0.1
"
PRC_AUTO_RUN_CS	PROCEDURE	451	"       and b.fygb = 13
"
PRC_AUTO_RUN_CS	PROCEDURE	452	"       and a.kdsj > sysdate - 0.1;
"
PRC_AUTO_RUN_CS	PROCEDURE	453	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	454	"    if v_count > 1 and v_count < 6 then
"
PRC_AUTO_RUN_CS	PROCEDURE	455	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	456	"        select '2020-06-01 not ksdm 免费挂号活动：' || v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	457	"          into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	458	"          from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	459	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	460	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	461	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	462	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	463	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	464	"
"
PRC_AUTO_RUN_CS	PROCEDURE	465	"  --新型冠状病毒核酸检测 待复查 转发
"
PRC_AUTO_RUN_CS	PROCEDURE	466	"  if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	467	"    v_xh       := 1;
"
PRC_AUTO_RUN_CS	PROCEDURE	468	"    v_sl_count := 0;
"
PRC_AUTO_RUN_CS	PROCEDURE	469	"    while v_xh > 0 loop
"
PRC_AUTO_RUN_CS	PROCEDURE	470	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	471	"      v_sl_count := v_sl_count + 1;
"
PRC_AUTO_RUN_CS	PROCEDURE	472	"      if v_sl_count > 6 then
"
PRC_AUTO_RUN_CS	PROCEDURE	473	"        exit;
"
PRC_AUTO_RUN_CS	PROCEDURE	474	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	475	"      select nvl(max(xh), 0)
"
PRC_AUTO_RUN_CS	PROCEDURE	476	"        into v_xh
"
PRC_AUTO_RUN_CS	PROCEDURE	477	"        from auto_task_ywzx_send
"
PRC_AUTO_RUN_CS	PROCEDURE	478	"       where date_send > sysdate - 0.1
"
PRC_AUTO_RUN_CS	PROCEDURE	479	"         and instr(bz, '转发') = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	480	"         and instr(bz, 'IgM') > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	481	"         and instr(bz, '待复查') > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	482	"         and instr(bz, '新型冠状病毒') > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	483	"         and laborder > 0;
"
PRC_AUTO_RUN_CS	PROCEDURE	484	"      if v_xh > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	485	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	486	"        select bz, nvl(laborder, 0)
"
PRC_AUTO_RUN_CS	PROCEDURE	487	"          into nr, v_laborder
"
PRC_AUTO_RUN_CS	PROCEDURE	488	"          from auto_task_ywzx_send
"
PRC_AUTO_RUN_CS	PROCEDURE	489	"         where xh = v_xh;
"
PRC_AUTO_RUN_CS	PROCEDURE	490	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	491	"        select nvl(max(y.lxdh), '无')
"
PRC_AUTO_RUN_CS	PROCEDURE	492	"          into v_temp
"
PRC_AUTO_RUN_CS	PROCEDURE	493	"          from l_patientinfo t, gy_brjbxxk y
"
PRC_AUTO_RUN_CS	PROCEDURE	494	"         where t.patientid = y.jzkh
"
PRC_AUTO_RUN_CS	PROCEDURE	495	"           and t.stayhospitalmode = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	496	"           and t.doctadviseno > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	497	"           and t.doctadviseno = v_laborder;
"
PRC_AUTO_RUN_CS	PROCEDURE	498	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	499	"        select nr || ',患者联系电话:' || v_temp into nr from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	500	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	501	"        -- select bz into nr from auto_task_ywzx_send where xh = v_xh;
"
PRC_AUTO_RUN_CS	PROCEDURE	502	"        --  prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	503	"        prc_sms_send('ts', '13735759506', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	504	"        prc_sms_send('ts', '13867936636', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	505	"        prc_sms_send('ts', '15825760232', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	506	"        prc_sms_send('ts', '18458034799', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	507	"        update auto_task_ywzx_send set bz = bz || '[转发]' where xh = v_xh;
"
PRC_AUTO_RUN_CS	PROCEDURE	508	"        if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	509	"          commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	510	"        else
"
PRC_AUTO_RUN_CS	PROCEDURE	511	"          rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	512	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	513	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	514	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	515	"    end loop;
"
PRC_AUTO_RUN_CS	PROCEDURE	516	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	517	"
"
PRC_AUTO_RUN_CS	PROCEDURE	518	"  --新型冠状病毒核酸检测 待复查 转发 end 
"
PRC_AUTO_RUN_CS	PROCEDURE	519	"
"
PRC_AUTO_RUN_CS	PROCEDURE	520	"  -- 'ylsbgl.wz_nzwcgsqxx 高值计费 老系统记录'
"
PRC_AUTO_RUN_CS	PROCEDURE	521	"  /*  if 0 = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	522	"    select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	523	"      into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	524	"      From ylsbgl.wz_nzwcgsqxx a
"
PRC_AUTO_RUN_CS	PROCEDURE	525	"     where sqrq > sysdate - 0.1;
"
PRC_AUTO_RUN_CS	PROCEDURE	526	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	527	"    if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	528	"      select 'ylsbgl.wz_nzwcgsqxx 高值计费 老系统记录' into nr from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	529	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	530	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	531	"  end if;*/
"
PRC_AUTO_RUN_CS	PROCEDURE	532	"
"
PRC_AUTO_RUN_CS	PROCEDURE	533	"  --'抗菌药物停止通知'
"
PRC_AUTO_RUN_CS	PROCEDURE	534	"  if 1 = 1 and ((ls_now > '07:40' and ls_now <= '07:41') or
"
PRC_AUTO_RUN_CS	PROCEDURE	535	"     (ls_now > '08:40' and ls_now <= '08:41') or
"
PRC_AUTO_RUN_CS	PROCEDURE	536	"     (ls_now > '09:40' and ls_now <= '09:41') or
"
PRC_AUTO_RUN_CS	PROCEDURE	537	"     (ls_now > '10:40' and ls_now <= '10:41') or
"
PRC_AUTO_RUN_CS	PROCEDURE	538	"     (ls_now > '11:40' and ls_now <= '11:41') or
"
PRC_AUTO_RUN_CS	PROCEDURE	539	"     (ls_now > '12:40' and ls_now <= '12:41') or
"
PRC_AUTO_RUN_CS	PROCEDURE	540	"     (ls_now > '13:40' and ls_now <= '13:41') or
"
PRC_AUTO_RUN_CS	PROCEDURE	541	"     (ls_now > '14:40' and ls_now <= '14:41') or
"
PRC_AUTO_RUN_CS	PROCEDURE	542	"     (ls_now > '15:40' and ls_now <= '15:41') or
"
PRC_AUTO_RUN_CS	PROCEDURE	543	"     (ls_now > '16:40' and ls_now <= '16:41') or
"
PRC_AUTO_RUN_CS	PROCEDURE	544	"     (ls_now > '17:40' and ls_now <= '17:41') or
"
PRC_AUTO_RUN_CS	PROCEDURE	545	"     (ls_now > '19:40' and ls_now <= '19:41') or
"
PRC_AUTO_RUN_CS	PROCEDURE	546	"     
"
PRC_AUTO_RUN_CS	PROCEDURE	547	"     (ls_now > '21:40' and ls_now <= '21:41')) then
"
PRC_AUTO_RUN_CS	PROCEDURE	548	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	549	"    --留义温暖基金
"
PRC_AUTO_RUN_CS	PROCEDURE	550	"    if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	551	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	552	"      select to_char(nvl(wm_concat('留义温暖基金 ' || fs || ':' || je), '0'))
"
PRC_AUTO_RUN_CS	PROCEDURE	553	"        into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	554	"        from (select decode(depo_type, 1, '现金', 2, '支票', '其它方式') fs,
"
PRC_AUTO_RUN_CS	PROCEDURE	555	"                     sum(amount) je
"
PRC_AUTO_RUN_CS	PROCEDURE	556	"                from zy_deposit_file
"
PRC_AUTO_RUN_CS	PROCEDURE	557	"               where depo_date > sysdate - 0.2
"
PRC_AUTO_RUN_CS	PROCEDURE	558	"                 and op_Id = 'AU002'
"
PRC_AUTO_RUN_CS	PROCEDURE	559	"               group by depo_type);
"
PRC_AUTO_RUN_CS	PROCEDURE	560	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	561	"      if length(nr) > 5 then
"
PRC_AUTO_RUN_CS	PROCEDURE	562	"        prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	563	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	564	"        select to_char(nvl(wm_concat('留义温暖基金大于1000 ' || to_char(patient_no）), '0')) into nr from (select patient_no
"
PRC_AUTO_RUN_CS	PROCEDURE	565	"                                                                                                    from zy_deposit_file
"
PRC_AUTO_RUN_CS	PROCEDURE	566	"                                                                                                   where patient_No in
"
PRC_AUTO_RUN_CS	PROCEDURE	567	"                                                                                                         (select patient_no
"
PRC_AUTO_RUN_CS	PROCEDURE	568	"                                                                                                            from zy_deposit_file
"
PRC_AUTO_RUN_CS	PROCEDURE	569	"                                                                                                           where depo_date >
"
PRC_AUTO_RUN_CS	PROCEDURE	570	"                                                                                                                 sysdate - 0.2
"
PRC_AUTO_RUN_CS	PROCEDURE	571	"                                                                                                             and op_Id =
"
PRC_AUTO_RUN_CS	PROCEDURE	572	"                                                                                                                 'AU002')
"
PRC_AUTO_RUN_CS	PROCEDURE	573	"                                                                                                     and op_Id =
"
PRC_AUTO_RUN_CS	PROCEDURE	574	"                                                                                                         'AU002'
"
PRC_AUTO_RUN_CS	PROCEDURE	575	"                                                                                                   group by patient_no
"
PRC_AUTO_RUN_CS	PROCEDURE	576	"                                                                                                  having sum(amount) > 1000);
"
PRC_AUTO_RUN_CS	PROCEDURE	577	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	578	"        if length(nr) > 2 then
"
PRC_AUTO_RUN_CS	PROCEDURE	579	"          prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	580	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	581	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	582	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	583	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	584	"      select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	585	"        into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	586	"        from (select (select nvl(to_char(cwfp_date, 'yyyymmdd'), '20210101')
"
PRC_AUTO_RUN_CS	PROCEDURE	587	"                        from zy_patient_information
"
PRC_AUTO_RUN_CS	PROCEDURE	588	"                       where patient_no = t.patient_no) rq
"
PRC_AUTO_RUN_CS	PROCEDURE	589	"                From zy_deposit_file t
"
PRC_AUTO_RUN_CS	PROCEDURE	590	"               where patient_no <> 851509
"
PRC_AUTO_RUN_CS	PROCEDURE	591	"                 and op_id = 'AU002'
"
PRC_AUTO_RUN_CS	PROCEDURE	592	"                 and patient_no > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	593	"                 and depo_date > sysdate - 2)
"
PRC_AUTO_RUN_CS	PROCEDURE	594	"       where rq < '20210210'
"
PRC_AUTO_RUN_CS	PROCEDURE	595	"          or rq > '20210221';
"
PRC_AUTO_RUN_CS	PROCEDURE	596	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	597	"        select '留义温暖基金,床位分配时间不在0210-0221,数量=' || v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	598	"          into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	599	"          from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	600	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	601	"        select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	602	"          into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	603	"          from (select (select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	604	"                          from zy_patient_information
"
PRC_AUTO_RUN_CS	PROCEDURE	605	"                         where patient_no = t.patient_no
"
PRC_AUTO_RUN_CS	PROCEDURE	606	"                           and cwfp_date is null) sl
"
PRC_AUTO_RUN_CS	PROCEDURE	607	"                  From zy_deposit_file t
"
PRC_AUTO_RUN_CS	PROCEDURE	608	"                 where patient_no <> 851509
"
PRC_AUTO_RUN_CS	PROCEDURE	609	"                   and op_id = 'AU002'
"
PRC_AUTO_RUN_CS	PROCEDURE	610	"                   and patient_no > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	611	"                   and depo_date > sysdate - 2
"
PRC_AUTO_RUN_CS	PROCEDURE	612	"                   and depo_date < sysdate)
"
PRC_AUTO_RUN_CS	PROCEDURE	613	"         where sl = 1;
"
PRC_AUTO_RUN_CS	PROCEDURE	614	"        if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	615	"          select nr || ',cwfp_date =null,数量=' || v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	616	"            into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	617	"            from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	618	"        
"
PRC_AUTO_RUN_CS	PROCEDURE	619	"          update zy_deposit_file
"
PRC_AUTO_RUN_CS	PROCEDURE	620	"             set patient_no = patient_no * -1
"
PRC_AUTO_RUN_CS	PROCEDURE	621	"           where op_id = 'AU002'
"
PRC_AUTO_RUN_CS	PROCEDURE	622	"             and depo_date > sysdate - 2
"
PRC_AUTO_RUN_CS	PROCEDURE	623	"             and patient_No in
"
PRC_AUTO_RUN_CS	PROCEDURE	624	"                 (select patient_no
"
PRC_AUTO_RUN_CS	PROCEDURE	625	"                    from (select (select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	626	"                                    from zy_patient_information
"
PRC_AUTO_RUN_CS	PROCEDURE	627	"                                   where patient_no = t.patient_no
"
PRC_AUTO_RUN_CS	PROCEDURE	628	"                                     and cwfp_date is null) sl,
"
PRC_AUTO_RUN_CS	PROCEDURE	629	"                                 patient_no
"
PRC_AUTO_RUN_CS	PROCEDURE	630	"                            From zy_deposit_file t
"
PRC_AUTO_RUN_CS	PROCEDURE	631	"                           where patient_no <> 851509
"
PRC_AUTO_RUN_CS	PROCEDURE	632	"                             and op_id = 'AU002'
"
PRC_AUTO_RUN_CS	PROCEDURE	633	"                             and patient_no > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	634	"                             and js_No = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	635	"                             and depo_date > sysdate - 2
"
PRC_AUTO_RUN_CS	PROCEDURE	636	"                             and depo_date < sysdate - 0.05)
"
PRC_AUTO_RUN_CS	PROCEDURE	637	"                   where sl = 1);
"
PRC_AUTO_RUN_CS	PROCEDURE	638	"          if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	639	"            commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	640	"          else
"
PRC_AUTO_RUN_CS	PROCEDURE	641	"            rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	642	"          end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	643	"        
"
PRC_AUTO_RUN_CS	PROCEDURE	644	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	645	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	646	"        prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	647	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	648	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	649	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	650	"    --end 留义温暖基金
"
PRC_AUTO_RUN_CS	PROCEDURE	651	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	652	"    prc_xiangmu_cursor_do('抗菌药物停止通知',
"
PRC_AUTO_RUN_CS	PROCEDURE	653	"                          '',
"
PRC_AUTO_RUN_CS	PROCEDURE	654	"                          '',
"
PRC_AUTO_RUN_CS	PROCEDURE	655	"                          v_out_code,
"
PRC_AUTO_RUN_CS	PROCEDURE	656	"                          v_out_msg);
"
PRC_AUTO_RUN_CS	PROCEDURE	657	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	658	"    prc_xiangmu_cursor_do('门诊停诊通知', '', '', v_out_code, v_out_msg);
"
PRC_AUTO_RUN_CS	PROCEDURE	659	"    prc_xiangmu_cursor_do('物价核查通知', '', '', v_out_code, v_out_msg);
"
PRC_AUTO_RUN_CS	PROCEDURE	660	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	661	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	662	"
"
PRC_AUTO_RUN_CS	PROCEDURE	663	"  -- 短信提醒： 化验结果提醒  化验项目未做提醒  药品未取提醒  检查项目未做提醒
"
PRC_AUTO_RUN_CS	PROCEDURE	664	"
"
PRC_AUTO_RUN_CS	PROCEDURE	665	"  if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	666	"    if 1 = 1 and (ls_now > '15:50' and ls_now <= '16:50') then
"
PRC_AUTO_RUN_CS	PROCEDURE	667	"      if 1 = 1 and ls_now_minue = '1' then
"
PRC_AUTO_RUN_CS	PROCEDURE	668	"        prc_xiangmu_sms_send('化验结果提醒', '', '', v_out_code, v_out_msg);
"
PRC_AUTO_RUN_CS	PROCEDURE	669	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	670	"        prc_xiangmu_sms_send('化验项目未做提醒',
"
PRC_AUTO_RUN_CS	PROCEDURE	671	"                             '',
"
PRC_AUTO_RUN_CS	PROCEDURE	672	"                             '',
"
PRC_AUTO_RUN_CS	PROCEDURE	673	"                             v_out_code,
"
PRC_AUTO_RUN_CS	PROCEDURE	674	"                             v_out_msg);
"
PRC_AUTO_RUN_CS	PROCEDURE	675	"        prc_xiangmu_sms_send('医后付未结算提醒',
"
PRC_AUTO_RUN_CS	PROCEDURE	676	"                             '',
"
PRC_AUTO_RUN_CS	PROCEDURE	677	"                             '',
"
PRC_AUTO_RUN_CS	PROCEDURE	678	"                             v_out_code,
"
PRC_AUTO_RUN_CS	PROCEDURE	679	"                             v_out_msg);
"
PRC_AUTO_RUN_CS	PROCEDURE	680	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	681	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	682	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	683	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	684	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	685	"    if 1 = 1 and (ls_now > '07:50' and ls_now <= '16:50') then
"
PRC_AUTO_RUN_CS	PROCEDURE	686	"      if 1 = 1 and ls_now_minue = '4' then
"
PRC_AUTO_RUN_CS	PROCEDURE	687	"        prc_xiangmu_sms_send('药品未取提醒', '', '', v_out_code, v_out_msg);
"
PRC_AUTO_RUN_CS	PROCEDURE	688	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	689	"        prc_xiangmu_sms_send('检查项目未做提醒',
"
PRC_AUTO_RUN_CS	PROCEDURE	690	"                             '',
"
PRC_AUTO_RUN_CS	PROCEDURE	691	"                             '',
"
PRC_AUTO_RUN_CS	PROCEDURE	692	"                             v_out_code,
"
PRC_AUTO_RUN_CS	PROCEDURE	693	"                             v_out_msg);
"
PRC_AUTO_RUN_CS	PROCEDURE	694	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	695	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	696	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	697	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	698	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	699	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	700	"
"
PRC_AUTO_RUN_CS	PROCEDURE	701	"  --  error 更新单价<0  ys_code
"
PRC_AUTO_RUN_CS	PROCEDURE	702	"  if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	703	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	704	"    if (ls_now > '07:00' and ls_now <= '07:01') then
"
PRC_AUTO_RUN_CS	PROCEDURE	705	"      update zy_detail_charge
"
PRC_AUTO_RUN_CS	PROCEDURE	706	"         set dj = dj * -1, sl = sl * -1
"
PRC_AUTO_RUN_CS	PROCEDURE	707	"       where js_no = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	708	"         and dj < 0
"
PRC_AUTO_RUN_CS	PROCEDURE	709	"         and jcfx_date > sysdate - 2
"
PRC_AUTO_RUN_CS	PROCEDURE	710	"         and jcfx_date < sysdate - 0.011;
"
PRC_AUTO_RUN_CS	PROCEDURE	711	"      if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	712	"        commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	713	"      else
"
PRC_AUTO_RUN_CS	PROCEDURE	714	"        rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	715	"        prc_sms_send('ts', '13777929515', 'dj<0 update prc_autuo', v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	716	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	717	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	718	"      update zy_detail_charge x
"
PRC_AUTO_RUN_CS	PROCEDURE	719	"         set ys_code = (select zzys
"
PRC_AUTO_RUN_CS	PROCEDURE	720	"                          from zy_patient_information
"
PRC_AUTO_RUN_CS	PROCEDURE	721	"                         where patient_No = x.patient_no)
"
PRC_AUTO_RUN_CS	PROCEDURE	722	"       where nvl(ys_code, 0) not in (select zgid from gy_zgxx)
"
PRC_AUTO_RUN_CS	PROCEDURE	723	"         and js_no = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	724	"         and jcfx_date > sysdate - 2
"
PRC_AUTO_RUN_CS	PROCEDURE	725	"         and jcfx_date < sysdate - 0.011;
"
PRC_AUTO_RUN_CS	PROCEDURE	726	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	727	"      if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	728	"        commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	729	"      else
"
PRC_AUTO_RUN_CS	PROCEDURE	730	"        rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	731	"        prc_sms_send('ts', '13777929515', 'zzys update prc_auto', v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	732	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	733	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	734	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	735	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	736	"    if (ls_now > '07:00' and ls_now <= '18:01') then
"
PRC_AUTO_RUN_CS	PROCEDURE	737	"      update zy_detail_charge
"
PRC_AUTO_RUN_CS	PROCEDURE	738	"         set dj = dj * -1, sl = sl * -1
"
PRC_AUTO_RUN_CS	PROCEDURE	739	"       where js_no = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	740	"         and dj < 0
"
PRC_AUTO_RUN_CS	PROCEDURE	741	"         and jcfx_date > sysdate - 0.011;
"
PRC_AUTO_RUN_CS	PROCEDURE	742	"      if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	743	"        commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	744	"      else
"
PRC_AUTO_RUN_CS	PROCEDURE	745	"        rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	746	"        prc_sms_send('ts', '13777929515', 'dj<0 update prc_autuo', v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	747	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	748	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	749	"      update zy_detail_charge x
"
PRC_AUTO_RUN_CS	PROCEDURE	750	"         set ys_code = (select zzys
"
PRC_AUTO_RUN_CS	PROCEDURE	751	"                          from zy_patient_information
"
PRC_AUTO_RUN_CS	PROCEDURE	752	"                         where patient_No = x.patient_no)
"
PRC_AUTO_RUN_CS	PROCEDURE	753	"       where nvl(ys_code, 0) not in (select zgid from gy_zgxx)
"
PRC_AUTO_RUN_CS	PROCEDURE	754	"         and js_no = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	755	"         and jcfx_date > sysdate - 0.011;
"
PRC_AUTO_RUN_CS	PROCEDURE	756	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	757	"      if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	758	"        commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	759	"      else
"
PRC_AUTO_RUN_CS	PROCEDURE	760	"        rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	761	"        prc_sms_send('ts', '13777929515', 'zzys update prc_auto', v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	762	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	763	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	764	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	765	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	766	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	767	"  --旧高值耗材更新价格
"
PRC_AUTO_RUN_CS	PROCEDURE	768	"  if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	769	"    update zy_detail_charge t
"
PRC_AUTO_RUN_CS	PROCEDURE	770	"       set dj = dj - 100, tsyybz = ' '
"
PRC_AUTO_RUN_CS	PROCEDURE	771	"     where fygl = 25
"
PRC_AUTO_RUN_CS	PROCEDURE	772	"       and tsyybz is null
"
PRC_AUTO_RUN_CS	PROCEDURE	773	"       and t.twice_detail_code = 'SB'
"
PRC_AUTO_RUN_CS	PROCEDURE	774	"       and js_No = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	775	"       and dj >= 2000
"
PRC_AUTO_RUN_CS	PROCEDURE	776	"       and jlxh >= 293106684
"
PRC_AUTO_RUN_CS	PROCEDURE	777	"       and jcfx_date > sysdate - 0.5
"
PRC_AUTO_RUN_CS	PROCEDURE	778	"       and jcfx_date < sysdate - 0.0001;
"
PRC_AUTO_RUN_CS	PROCEDURE	779	"    if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	780	"      commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	781	"    else
"
PRC_AUTO_RUN_CS	PROCEDURE	782	"      rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	783	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	784	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	785	"    update zy_detail_charge t
"
PRC_AUTO_RUN_CS	PROCEDURE	786	"       set dj = round(dj / 1.05, 0), tsyybz = ' '
"
PRC_AUTO_RUN_CS	PROCEDURE	787	"     where fygl = 25
"
PRC_AUTO_RUN_CS	PROCEDURE	788	"       and tsyybz is null
"
PRC_AUTO_RUN_CS	PROCEDURE	789	"       and t.twice_detail_code = 'SB'
"
PRC_AUTO_RUN_CS	PROCEDURE	790	"       and js_No = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	791	"       and dj < 2000
"
PRC_AUTO_RUN_CS	PROCEDURE	792	"       and jlxh >= 293106684
"
PRC_AUTO_RUN_CS	PROCEDURE	793	"       and jcfx_date > sysdate - 0.5
"
PRC_AUTO_RUN_CS	PROCEDURE	794	"       and jcfx_date < sysdate - 0.0001;
"
PRC_AUTO_RUN_CS	PROCEDURE	795	"    if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	796	"      commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	797	"    else
"
PRC_AUTO_RUN_CS	PROCEDURE	798	"      rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	799	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	800	"    update gy_xtcs
"
PRC_AUTO_RUN_CS	PROCEDURE	801	"       set csz1 = to_char(sysdate + 0.042, 'yyyymmddhh24')
"
PRC_AUTO_RUN_CS	PROCEDURE	802	"     where xtxh = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	803	"       and csmc = 'AUTO_SB';
"
PRC_AUTO_RUN_CS	PROCEDURE	804	"    if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	805	"      commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	806	"    else
"
PRC_AUTO_RUN_CS	PROCEDURE	807	"      rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	808	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	809	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	810	"
"
PRC_AUTO_RUN_CS	PROCEDURE	811	"  --发热病人统计数据，发送短信  '12:01 - 12:02'
"
PRC_AUTO_RUN_CS	PROCEDURE	812	"  if 101 = 101 and ((ls_now > '07:41' and ls_now <= '07:42')) then
"
PRC_AUTO_RUN_CS	PROCEDURE	813	"    -- count(distinct to_char(jzrq, 'yyyymmdd') || ' ' || jzkh) ||
"
PRC_AUTO_RUN_CS	PROCEDURE	814	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	815	"    /*  select to_char(trunc(sysdate - 1) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN_CS	PROCEDURE	816	"               ' 至 ' || to_char(trunc(sysdate) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN_CS	PROCEDURE	817	"               '为止,发热门诊病人: ' ||wm_concat(bz) from (
"
PRC_AUTO_RUN_CS	PROCEDURE	818	"    select (select ksmc from gy_ksdm where ksdm=t.ksdm)|| count(distinct jzkh) || ' 例 ' bz   
"
PRC_AUTO_RUN_CS	PROCEDURE	819	"          from zj_jzxx t      where ksdm in ('2270006', '2010040', '2100005')
"
PRC_AUTO_RUN_CS	PROCEDURE	820	"           and jzrq between trunc(sysdate - 1) + 0.5 and trunc(sysdate) + 0.5
"
PRC_AUTO_RUN_CS	PROCEDURE	821	"           group by t.ksdm )*/
"
PRC_AUTO_RUN_CS	PROCEDURE	822	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	823	"    /* select to_char(trunc(sysdate - 1) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN_CS	PROCEDURE	824	"           ' 至 ' || to_char(trunc(sysdate) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN_CS	PROCEDURE	825	"           '为止,发热门诊病人: ' || count(distinct jzkh) || ' 例 '
"
PRC_AUTO_RUN_CS	PROCEDURE	826	"      into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	827	"      from zj_jzxx
"
PRC_AUTO_RUN_CS	PROCEDURE	828	"     where ksdm in ('2270006', '2010040')
"
PRC_AUTO_RUN_CS	PROCEDURE	829	"       and jzrq between trunc(sysdate - 1) + 0.5 and trunc(sysdate) + 0.5;
"
PRC_AUTO_RUN_CS	PROCEDURE	830	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	831	"    select nr || ';发热门诊有发热症状的例数: ' || count(distinct(bingrenhm)) || ' 例 '
"
PRC_AUTO_RUN_CS	PROCEDURE	832	"      into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	833	"      from zj_menzhenblxx a, zj_jzxx b
"
PRC_AUTO_RUN_CS	PROCEDURE	834	"     where a.jiuzhenxh = b.jzxh
"
PRC_AUTO_RUN_CS	PROCEDURE	835	"       and a.zhushu like '%发热%'
"
PRC_AUTO_RUN_CS	PROCEDURE	836	"       and b.ksdm in ('2270006', '2010040')
"
PRC_AUTO_RUN_CS	PROCEDURE	837	"       and b.jzrq between trunc(sysdate - 1) + 0.5 and trunc(sysdate) + 0.5;*/
"
PRC_AUTO_RUN_CS	PROCEDURE	838	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	839	"    select to_char(trunc(sysdate - 1), 'yyyy-mm-dd') || ' 发热门诊病人: ' ||
"
PRC_AUTO_RUN_CS	PROCEDURE	840	"           count(distinct jzkh) || ' 例 '
"
PRC_AUTO_RUN_CS	PROCEDURE	841	"      into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	842	"      from zj_jzxx
"
PRC_AUTO_RUN_CS	PROCEDURE	843	"     where ksdm in ('2270006', '2010040')
"
PRC_AUTO_RUN_CS	PROCEDURE	844	"       and jzrq between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN_CS	PROCEDURE	845	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	846	"    select nr || ',有发热症状的例数: ' || count(distinct(jzkh)) || ' 例; '
"
PRC_AUTO_RUN_CS	PROCEDURE	847	"      into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	848	"      from zj_jzxx b
"
PRC_AUTO_RUN_CS	PROCEDURE	849	"     where b.BRTW > 37.5
"
PRC_AUTO_RUN_CS	PROCEDURE	850	"       and b.ksdm in ('2270006', '2010040')
"
PRC_AUTO_RUN_CS	PROCEDURE	851	"       and b.jzrq between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN_CS	PROCEDURE	852	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	853	"    /*    prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	854	"    prc_sms_send('ts', '13958443561', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	855	"    prc_sms_send('ts', '13867936636', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	856	"    prc_sms_send('ts', '15757996037', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	857	"    prc_sms_send('ts', '15868957673', nr, v_bz);*/
"
PRC_AUTO_RUN_CS	PROCEDURE	858	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	859	"    select nr || to_char(trunc(sysdate - 1), 'yyyy-mm-dd') || ' 儿科发热门诊病人: ' ||
"
PRC_AUTO_RUN_CS	PROCEDURE	860	"           count(distinct jzkh) || ' 例 '
"
PRC_AUTO_RUN_CS	PROCEDURE	861	"      into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	862	"      from zj_jzxx
"
PRC_AUTO_RUN_CS	PROCEDURE	863	"     where ksdm in ('2100005', '2020014')
"
PRC_AUTO_RUN_CS	PROCEDURE	864	"       and jzrq between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN_CS	PROCEDURE	865	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	866	"    select nr || ',有发热症状的例数: ' || count(distinct(jzkh)) || ' 例 '
"
PRC_AUTO_RUN_CS	PROCEDURE	867	"      into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	868	"      from zj_jzxx b
"
PRC_AUTO_RUN_CS	PROCEDURE	869	"     where b.BRTW > 37.5
"
PRC_AUTO_RUN_CS	PROCEDURE	870	"       and b.ksdm in ('2100005', '2020014')
"
PRC_AUTO_RUN_CS	PROCEDURE	871	"       and b.jzrq between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN_CS	PROCEDURE	872	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	873	"    prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	874	"    prc_sms_send('ts', '13958443561', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	875	"    prc_sms_send('ts', '13867936636', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	876	"    prc_sms_send('ts', '15757996037', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	877	"    prc_sms_send('ts', '15868957673', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	878	"    prc_sms_send('ts', '13516995998', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	879	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	880	"    --mz_jkk更新5天
"
PRC_AUTO_RUN_CS	PROCEDURE	881	"    /*    if 1 = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	882	"      update mz_jkk
"
PRC_AUTO_RUN_CS	PROCEDURE	883	"         set kzrq = jkrq + 6
"
PRC_AUTO_RUN_CS	PROCEDURE	884	"       where jkcs = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	885	"         and wym = 2
"
PRC_AUTO_RUN_CS	PROCEDURE	886	"         and xtbz = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	887	"         and sfsb is null
"
PRC_AUTO_RUN_CS	PROCEDURE	888	"         and kzrq < jkrq + 6
"
PRC_AUTO_RUN_CS	PROCEDURE	889	"         and jkrq > sysdate - 10
"
PRC_AUTO_RUN_CS	PROCEDURE	890	"         and jkrq < sysdate - 0.1;
"
PRC_AUTO_RUN_CS	PROCEDURE	891	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	892	"      if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	893	"        commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	894	"      else
"
PRC_AUTO_RUN_CS	PROCEDURE	895	"        rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	896	"        nr := 'mz_jkk更新5天报错，prc_auto_run';
"
PRC_AUTO_RUN_CS	PROCEDURE	897	"        prc_sms_send('ts', '13867936636', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	898	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	899	"    end if;*/
"
PRC_AUTO_RUN_CS	PROCEDURE	900	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	901	"    -- 门诊挂号人次
"
PRC_AUTO_RUN_CS	PROCEDURE	902	"    /*   SELECT to_char(trunc(sysdate - 1) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN_CS	PROCEDURE	903	"          ' 至 ' || to_char(trunc(sysdate) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN_CS	PROCEDURE	904	"          '为止,门诊挂号人次' || SUM(DECODE(A.THBZ,
"
PRC_AUTO_RUN_CS	PROCEDURE	905	"                                    0,
"
PRC_AUTO_RUN_CS	PROCEDURE	906	"                                    DECODE(A.ZFPB,
"
PRC_AUTO_RUN_CS	PROCEDURE	907	"                                           NULL,
"
PRC_AUTO_RUN_CS	PROCEDURE	908	"                                           DECODE(A.MZLBXH, 2, 0, 8, 0, 1),
"
PRC_AUTO_RUN_CS	PROCEDURE	909	"                                           0),
"
PRC_AUTO_RUN_CS	PROCEDURE	910	"                                    0)) || ' , 急诊挂号人次' ||
"
PRC_AUTO_RUN_CS	PROCEDURE	911	"          SUM(DECODE(A.THBZ,
"
PRC_AUTO_RUN_CS	PROCEDURE	912	"                     0,
"
PRC_AUTO_RUN_CS	PROCEDURE	913	"                     DECODE(A.ZFPB,
"
PRC_AUTO_RUN_CS	PROCEDURE	914	"                            NULL,
"
PRC_AUTO_RUN_CS	PROCEDURE	915	"                            DECODE(A.MZLBXH, 2, 1, 8, 1, 0),
"
PRC_AUTO_RUN_CS	PROCEDURE	916	"                            0),
"
PRC_AUTO_RUN_CS	PROCEDURE	917	"                     0))
"
PRC_AUTO_RUN_CS	PROCEDURE	918	"     into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	919	"     FROM GH_GHK A, GY_KSDM B
"
PRC_AUTO_RUN_CS	PROCEDURE	920	"    WHERE A.KSDM = B.KSDM
"
PRC_AUTO_RUN_CS	PROCEDURE	921	"      AND A.GHRQ between trunc(sysdate - 1) + 0.5 and trunc(sysdate) + 0.5;*/
"
PRC_AUTO_RUN_CS	PROCEDURE	922	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	923	"    SELECT to_char(trunc(sysdate - 1), 'yyyy-mm-dd') || ' 门诊挂号人次' ||
"
PRC_AUTO_RUN_CS	PROCEDURE	924	"           SUM(DECODE(A.THBZ,
"
PRC_AUTO_RUN_CS	PROCEDURE	925	"                      0,
"
PRC_AUTO_RUN_CS	PROCEDURE	926	"                      DECODE(A.ZFPB,
"
PRC_AUTO_RUN_CS	PROCEDURE	927	"                             NULL,
"
PRC_AUTO_RUN_CS	PROCEDURE	928	"                             DECODE(A.MZLBXH, 2, 0, 8, 0, 1),
"
PRC_AUTO_RUN_CS	PROCEDURE	929	"                             0),
"
PRC_AUTO_RUN_CS	PROCEDURE	930	"                      0)) || ' , 急诊挂号人次' ||
"
PRC_AUTO_RUN_CS	PROCEDURE	931	"           SUM(DECODE(A.THBZ,
"
PRC_AUTO_RUN_CS	PROCEDURE	932	"                      0,
"
PRC_AUTO_RUN_CS	PROCEDURE	933	"                      DECODE(A.ZFPB,
"
PRC_AUTO_RUN_CS	PROCEDURE	934	"                             NULL,
"
PRC_AUTO_RUN_CS	PROCEDURE	935	"                             DECODE(A.MZLBXH, 2, 1, 8, 1, 0),
"
PRC_AUTO_RUN_CS	PROCEDURE	936	"                             0),
"
PRC_AUTO_RUN_CS	PROCEDURE	937	"                      0))
"
PRC_AUTO_RUN_CS	PROCEDURE	938	"      into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	939	"      FROM GH_GHK A, GY_KSDM B
"
PRC_AUTO_RUN_CS	PROCEDURE	940	"     WHERE A.KSDM = B.KSDM
"
PRC_AUTO_RUN_CS	PROCEDURE	941	"       AND A.GHRQ between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN_CS	PROCEDURE	942	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	943	"    SELECT nr || ',本院核酸开单:' || count(jlxh)
"
PRC_AUTO_RUN_CS	PROCEDURE	944	"      into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	945	"      FROM GH_GHK A
"
PRC_AUTO_RUN_CS	PROCEDURE	946	"     WHERE a.jzkh like 'BY%'
"
PRC_AUTO_RUN_CS	PROCEDURE	947	"       AND A.GHRQ between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN_CS	PROCEDURE	948	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	949	"    prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	950	"    prc_sms_send('ts', '13958443561', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	951	"    prc_sms_send('ts', '13516995998', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	952	"    prc_sms_send('ts', '15868957673', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	953	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	954	"    --新冠统计
"
PRC_AUTO_RUN_CS	PROCEDURE	955	"    select to_char(mc) into nr from v_auto_xingguang1218;
"
PRC_AUTO_RUN_CS	PROCEDURE	956	"    prc_sms_send('ts', '13958443561', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	957	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	958	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	959	"
"
PRC_AUTO_RUN_CS	PROCEDURE	960	"  --决策分析_业务数据采集
"
PRC_AUTO_RUN_CS	PROCEDURE	961	"  if ls_now > '02:01' and ls_now <= '02:02' then
"
PRC_AUTO_RUN_CS	PROCEDURE	962	"    if 101 = 101 then
"
PRC_AUTO_RUN_CS	PROCEDURE	963	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	964	"      v_task := '决策分析_业务数据采集';
"
PRC_AUTO_RUN_CS	PROCEDURE	965	"      select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	966	"        into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	967	"        from zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	968	"       where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN_CS	PROCEDURE	969	"         and jylsh = v_task
"
PRC_AUTO_RUN_CS	PROCEDURE	970	"         and jyrq > sysdate - 0.05;
"
PRC_AUTO_RUN_CS	PROCEDURE	971	"      --最近1小时已经执行过
"
PRC_AUTO_RUN_CS	PROCEDURE	972	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	973	"        v_task := ' ';
"
PRC_AUTO_RUN_CS	PROCEDURE	974	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	975	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	976	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	977	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	978	"    -- 决策分析_业务数据采集 采集数据失败 zy_detail_charge curr_ks is null
"
PRC_AUTO_RUN_CS	PROCEDURE	979	"    if v_task = '决策分析_业务数据采集' then
"
PRC_AUTO_RUN_CS	PROCEDURE	980	"      insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	981	"        (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN_CS	PROCEDURE	982	"      values
"
PRC_AUTO_RUN_CS	PROCEDURE	983	"        (v_Procedure_Name, v_task, -1);
"
PRC_AUTO_RUN_CS	PROCEDURE	984	"      if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	985	"        commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	986	"      else
"
PRC_AUTO_RUN_CS	PROCEDURE	987	"        rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	988	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	989	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	990	"      select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	991	"        into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	992	"        from Zy_Detail_Charge
"
PRC_AUTO_RUN_CS	PROCEDURE	993	"       WHERE jcfx_date > sysdate - 3
"
PRC_AUTO_RUN_CS	PROCEDURE	994	"         and jcfx_date < trunc(sysdate)
"
PRC_AUTO_RUN_CS	PROCEDURE	995	"         and CURR_KS IS NULL;
"
PRC_AUTO_RUN_CS	PROCEDURE	996	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	997	"        insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	998	"          (jiaoyilx, jylsh, patient_no)
"
PRC_AUTO_RUN_CS	PROCEDURE	999	"        values
"
PRC_AUTO_RUN_CS	PROCEDURE	1000	"          (v_Procedure_Name,
"
PRC_AUTO_RUN_CS	PROCEDURE	1001	"           '决策分析_业务数据采集 zy_detail_charge curr_ks is null  数量为 patient_no',
"
PRC_AUTO_RUN_CS	PROCEDURE	1002	"           v_count);
"
PRC_AUTO_RUN_CS	PROCEDURE	1003	"        if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1004	"          commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1005	"        else
"
PRC_AUTO_RUN_CS	PROCEDURE	1006	"          rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	1007	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1008	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1009	"        update zy_detail_charge x
"
PRC_AUTO_RUN_CS	PROCEDURE	1010	"           set curr_ks = (select curr_ks
"
PRC_AUTO_RUN_CS	PROCEDURE	1011	"                            from zy_patient_information
"
PRC_AUTO_RUN_CS	PROCEDURE	1012	"                           where zy_patient_information.patient_No =
"
PRC_AUTO_RUN_CS	PROCEDURE	1013	"                                 x.patient_No)
"
PRC_AUTO_RUN_CS	PROCEDURE	1014	"         where x.curr_ks is null
"
PRC_AUTO_RUN_CS	PROCEDURE	1015	"           and x.jcfx_date > sysdate - 3
"
PRC_AUTO_RUN_CS	PROCEDURE	1016	"           and jcfx_date < trunc(sysdate)
"
PRC_AUTO_RUN_CS	PROCEDURE	1017	"           and exists
"
PRC_AUTO_RUN_CS	PROCEDURE	1018	"         (select 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1019	"                  from zy_patient_information
"
PRC_AUTO_RUN_CS	PROCEDURE	1020	"                 where zy_patient_information.patient_No = x.patient_NO);
"
PRC_AUTO_RUN_CS	PROCEDURE	1021	"        if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1022	"          commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1023	"        else
"
PRC_AUTO_RUN_CS	PROCEDURE	1024	"          rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	1025	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1026	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1027	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1028	"      select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1029	"        into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1030	"        from Zy_Detail_Charge
"
PRC_AUTO_RUN_CS	PROCEDURE	1031	"       WHERE jcfx_date > sysdate - 3
"
PRC_AUTO_RUN_CS	PROCEDURE	1032	"         and jcfx_date < trunc(sysdate)
"
PRC_AUTO_RUN_CS	PROCEDURE	1033	"         and CURR_KS IS NULL;
"
PRC_AUTO_RUN_CS	PROCEDURE	1034	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1035	"        insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1036	"          (jiaoyilx, jylsh, patient_no)
"
PRC_AUTO_RUN_CS	PROCEDURE	1037	"        values
"
PRC_AUTO_RUN_CS	PROCEDURE	1038	"          (v_Procedure_Name,
"
PRC_AUTO_RUN_CS	PROCEDURE	1039	"           '决策分析_业务数据采集 zy_detail_charge curr_ks is null 调整jcfx_date 数量为 patient_no',
"
PRC_AUTO_RUN_CS	PROCEDURE	1040	"           v_count);
"
PRC_AUTO_RUN_CS	PROCEDURE	1041	"        commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1042	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1043	"        update Zy_Detail_Charge
"
PRC_AUTO_RUN_CS	PROCEDURE	1044	"           set jcfx_date = sysdate
"
PRC_AUTO_RUN_CS	PROCEDURE	1045	"         WHERE jcfx_date > sysdate - 3
"
PRC_AUTO_RUN_CS	PROCEDURE	1046	"           and jcfx_date < trunc(sysdate)
"
PRC_AUTO_RUN_CS	PROCEDURE	1047	"           and CURR_KS IS NULL;
"
PRC_AUTO_RUN_CS	PROCEDURE	1048	"        if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1049	"          commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1050	"        else
"
PRC_AUTO_RUN_CS	PROCEDURE	1051	"          rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	1052	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1053	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1054	"      --执行数据采集 存储过程
"
PRC_AUTO_RUN_CS	PROCEDURE	1055	"      prc_sjcj();
"
PRC_AUTO_RUN_CS	PROCEDURE	1056	"      /* insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1057	"        (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN_CS	PROCEDURE	1058	"      values
"
PRC_AUTO_RUN_CS	PROCEDURE	1059	"        (v_Procedure_Name, v_task, 1);*/
"
PRC_AUTO_RUN_CS	PROCEDURE	1060	"      update zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1061	"         set flag = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1062	"       where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN_CS	PROCEDURE	1063	"         and jylsh = v_task
"
PRC_AUTO_RUN_CS	PROCEDURE	1064	"         and jyrq > sysdate - 0.05;
"
PRC_AUTO_RUN_CS	PROCEDURE	1065	"      if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1066	"        commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1067	"      else
"
PRC_AUTO_RUN_CS	PROCEDURE	1068	"        rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	1069	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1070	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1071	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1072	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1073	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1074	"  --后台运行统计数据，发送短信  '02:01 - 02:02'
"
PRC_AUTO_RUN_CS	PROCEDURE	1075	"  if 103 = 103 and ((ls_now > '03:01' and ls_now <= '03:02')) then
"
PRC_AUTO_RUN_CS	PROCEDURE	1076	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1077	"    select COUNT(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1078	"      INTO v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1079	"      from zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1080	"     where jyrq > sysdate - 0.002
"
PRC_AUTO_RUN_CS	PROCEDURE	1081	"       and jyrq < sysdate
"
PRC_AUTO_RUN_CS	PROCEDURE	1082	"       and jiaoyilx = 'PRC_AUTO_RUN_QUERY1';
"
PRC_AUTO_RUN_CS	PROCEDURE	1083	"    if v_count = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1084	"      PRC_AUTO_RUN_QUERY1();
"
PRC_AUTO_RUN_CS	PROCEDURE	1085	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1086	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1087	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1088	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1089	"  --执行失败任务查询  (存储过程，函数失效)
"
PRC_AUTO_RUN_CS	PROCEDURE	1090	"  if ls_now > '07:01' and ls_now <= '07:02' then
"
PRC_AUTO_RUN_CS	PROCEDURE	1091	"    if 0 = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1092	"      -- '执行失败任务查询';
"
PRC_AUTO_RUN_CS	PROCEDURE	1093	"      if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1094	"        v_task := '执行失败任务查询';
"
PRC_AUTO_RUN_CS	PROCEDURE	1095	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1096	"        select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1097	"          into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1098	"          from zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1099	"         where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN_CS	PROCEDURE	1100	"           and jylsh = v_task
"
PRC_AUTO_RUN_CS	PROCEDURE	1101	"           and jyrq > sysdate - 0.05;
"
PRC_AUTO_RUN_CS	PROCEDURE	1102	"        --最近1小时已经执行过
"
PRC_AUTO_RUN_CS	PROCEDURE	1103	"        if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1104	"          v_task := ' ';
"
PRC_AUTO_RUN_CS	PROCEDURE	1105	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1106	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1107	"        if v_task = '执行失败任务查询' then
"
PRC_AUTO_RUN_CS	PROCEDURE	1108	"          insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1109	"            (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN_CS	PROCEDURE	1110	"          values
"
PRC_AUTO_RUN_CS	PROCEDURE	1111	"            (v_Procedure_Name, v_task, 0);
"
PRC_AUTO_RUN_CS	PROCEDURE	1112	"          if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1113	"            commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1114	"          else
"
PRC_AUTO_RUN_CS	PROCEDURE	1115	"            rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	1116	"          end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1117	"        
"
PRC_AUTO_RUN_CS	PROCEDURE	1118	"          select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1119	"            into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1120	"            from zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1121	"           where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN_CS	PROCEDURE	1122	"             and flag = -1
"
PRC_AUTO_RUN_CS	PROCEDURE	1123	"             and jyrq > sysdate - 1.05;
"
PRC_AUTO_RUN_CS	PROCEDURE	1124	"          if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1125	"            select v_Procedure_Name || ',执行失败任务,sl:' || to_char(v_count)
"
PRC_AUTO_RUN_CS	PROCEDURE	1126	"              into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1127	"              from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1128	"            prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1129	"          end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1130	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1131	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1132	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1133	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1134	"      -- (存储过程，函数失效)
"
PRC_AUTO_RUN_CS	PROCEDURE	1135	"      if 2 = 2 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1136	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1137	"        select nvl(to_char(wm_concat(object_name)), '')
"
PRC_AUTO_RUN_CS	PROCEDURE	1138	"          into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1139	"          from v_system_view_fail;
"
PRC_AUTO_RUN_CS	PROCEDURE	1140	"        if length(nr) > 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1141	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1142	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1143	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1144	"        select count(object_name) into v_count from v_system_view_fail;
"
PRC_AUTO_RUN_CS	PROCEDURE	1145	"        if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1146	"          select v_Procedure_Name || ',存储过程，函数失效3,sl:' || to_char(v_count)
"
PRC_AUTO_RUN_CS	PROCEDURE	1147	"            into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1148	"            from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1149	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1150	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1151	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1152	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1153	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1154	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1155	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1156	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1157	"  --- 后台短信发送日期调整
"
PRC_AUTO_RUN_CS	PROCEDURE	1158	"  if (ls_now > '07:25' and ls_now <= '07:26') then
"
PRC_AUTO_RUN_CS	PROCEDURE	1159	"    begin
"
PRC_AUTO_RUN_CS	PROCEDURE	1160	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1161	"      delete zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1162	"       where jiaoyilx in ('门诊记账病人查询', 'MZZJ', 'IP地址判断')
"
PRC_AUTO_RUN_CS	PROCEDURE	1163	"         and jyrq < sysdate - 10;
"
PRC_AUTO_RUN_CS	PROCEDURE	1164	"      commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1165	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1166	"      delete zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1167	"       where jiaoyilx in ('增加门诊病人修改记录')
"
PRC_AUTO_RUN_CS	PROCEDURE	1168	"         and jyrq < sysdate - 70;
"
PRC_AUTO_RUN_CS	PROCEDURE	1169	"      commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1170	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1171	"      --- 后台短信发送日期调整
"
PRC_AUTO_RUN_CS	PROCEDURE	1172	"      if 3 = 3 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1173	"        select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1174	"          into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1175	"          from auto_task_ywzx_send
"
PRC_AUTO_RUN_CS	PROCEDURE	1176	"         where date_add = date_send
"
PRC_AUTO_RUN_CS	PROCEDURE	1177	"           and lx = 'au'
"
PRC_AUTO_RUN_CS	PROCEDURE	1178	"           and date_add > sysdate - 0.3
"
PRC_AUTO_RUN_CS	PROCEDURE	1179	"           and date_add < sysdate - 0.0002;
"
PRC_AUTO_RUN_CS	PROCEDURE	1180	"        --最近1小时已经执行过
"
PRC_AUTO_RUN_CS	PROCEDURE	1181	"        if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1182	"          update auto_task_ywzx_send
"
PRC_AUTO_RUN_CS	PROCEDURE	1183	"             set date_send = null
"
PRC_AUTO_RUN_CS	PROCEDURE	1184	"           where date_add = date_send
"
PRC_AUTO_RUN_CS	PROCEDURE	1185	"             and lx = 'au'
"
PRC_AUTO_RUN_CS	PROCEDURE	1186	"             and date_add > sysdate - 0.29
"
PRC_AUTO_RUN_CS	PROCEDURE	1187	"             and date_add < sysdate - 0.0002;
"
PRC_AUTO_RUN_CS	PROCEDURE	1188	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1189	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1190	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1191	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1192	"    end;
"
PRC_AUTO_RUN_CS	PROCEDURE	1193	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1194	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1195	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1196	"  --全院业务收入，发送短信  '07:30 - 07:31'
"
PRC_AUTO_RUN_CS	PROCEDURE	1197	"  if (ls_now > '07:30' and ls_now <= '07:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1198	"     (ls_now > '07:45' and ls_now <= '07:46') then
"
PRC_AUTO_RUN_CS	PROCEDURE	1199	"    if 104 = 104 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1200	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1201	"      select COUNT(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1202	"        INTO v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1203	"        from zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1204	"       where jyrq > sysdate - 0.1
"
PRC_AUTO_RUN_CS	PROCEDURE	1205	"         and jyrq < sysdate
"
PRC_AUTO_RUN_CS	PROCEDURE	1206	"         and jiaoyilx = 'PRC_AUTO_RUN_GZL';
"
PRC_AUTO_RUN_CS	PROCEDURE	1207	"      if v_count = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1208	"        prc_auto_run_gzl();
"
PRC_AUTO_RUN_CS	PROCEDURE	1209	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1210	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1211	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1212	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1213	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1214	"  --空床 发送短信  '08:10'
"
PRC_AUTO_RUN_CS	PROCEDURE	1215	"  if (ls_now > '08:10' and ls_now <= '08:11') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1216	"     (ls_now > '08:20' and ls_now <= '08:21') then
"
PRC_AUTO_RUN_CS	PROCEDURE	1217	"    if 105 = 105 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1218	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1219	"      select COUNT(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1220	"        INTO v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1221	"        from zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1222	"       where jyrq > sysdate - 0.01
"
PRC_AUTO_RUN_CS	PROCEDURE	1223	"         and jyrq < sysdate
"
PRC_AUTO_RUN_CS	PROCEDURE	1224	"         and jiaoyilx = 'PRC_AUTO_RUN_GZL_BED';
"
PRC_AUTO_RUN_CS	PROCEDURE	1225	"      if v_count = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1226	"        PRC_AUTO_RUN_GZL_BED();
"
PRC_AUTO_RUN_CS	PROCEDURE	1227	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1228	"        update auto_task_ywzx_send
"
PRC_AUTO_RUN_CS	PROCEDURE	1229	"           set date_send = null
"
PRC_AUTO_RUN_CS	PROCEDURE	1230	"         where date_add > sysdate - 0.5
"
PRC_AUTO_RUN_CS	PROCEDURE	1231	"           and lx = 'a';
"
PRC_AUTO_RUN_CS	PROCEDURE	1232	"        if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1233	"          commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1234	"        else
"
PRC_AUTO_RUN_CS	PROCEDURE	1235	"          rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	1236	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1237	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1238	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1239	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1240	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1241	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1242	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1243	"  --空床2 发送短信  '08:10'
"
PRC_AUTO_RUN_CS	PROCEDURE	1244	"  v_temp := substr(ls_now, 4, 2);
"
PRC_AUTO_RUN_CS	PROCEDURE	1245	"  --select  substr('08:02',4,2) from dual 
"
PRC_AUTO_RUN_CS	PROCEDURE	1246	"  if v_temp > '56' and v_temp <= '57' and
"
PRC_AUTO_RUN_CS	PROCEDURE	1247	"     (ls_now > '23:00' or ls_now <= '01:01') then
"
PRC_AUTO_RUN_CS	PROCEDURE	1248	"    PRC_AUTO_RUN_GZL_BED2();
"
PRC_AUTO_RUN_CS	PROCEDURE	1249	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1250	"  --  PRC_AUTO_RUN_GZL_BED2();
"
PRC_AUTO_RUN_CS	PROCEDURE	1251	"  --dj <0  check
"
PRC_AUTO_RUN_CS	PROCEDURE	1252	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1253	"  if (ls_now > '08:00' and ls_now <= '08:01') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1254	"     (ls_now > '08:30' and ls_now <= '08:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1255	"     (ls_now > '09:30' and ls_now <= '09:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1256	"     (ls_now > '10:30' and ls_now <= '10:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1257	"     (ls_now > '11:30' and ls_now <= '11:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1258	"     (ls_now > '12:30' and ls_now <= '12:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1259	"     (ls_now > '13:30' and ls_now <= '13:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1260	"     (ls_now > '14:30' and ls_now <= '14:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1261	"     (ls_now > '15:30' and ls_now <= '15:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1262	"     (ls_now > '19:30' and ls_now <= '19:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1263	"     (ls_now > '16:30' and ls_now <= '16:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1264	"     (ls_now > '17:00' and ls_now <= '17:01') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1265	"     (ls_now > '18:00' and ls_now <= '18:01') then
"
PRC_AUTO_RUN_CS	PROCEDURE	1266	"    if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1267	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1268	"      if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1269	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1270	"        select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1271	"          into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1272	"          From gy_jrjymx
"
PRC_AUTO_RUN_CS	PROCEDURE	1273	"         where jyje > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1274	"           and jysj > sysdate - 0.5
"
PRC_AUTO_RUN_CS	PROCEDURE	1275	"           and nvl(zxlsh, shlsh) is null;
"
PRC_AUTO_RUN_CS	PROCEDURE	1276	"        if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1277	"          select 'gy_jrjymx记录异常,交易流水号空' into nr from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1278	"          lxdh := '13777929515';
"
PRC_AUTO_RUN_CS	PROCEDURE	1279	"          prc_sms_send_mark('au', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1280	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1281	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1282	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1283	"      -- 万达支付 诊间结算核查
"
PRC_AUTO_RUN_CS	PROCEDURE	1284	"      if 1 = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1285	"        v_temp := '';
"
PRC_AUTO_RUN_CS	PROCEDURE	1286	"        select nvl(to_char(wm_concat(ipaddress)), '')
"
PRC_AUTO_RUN_CS	PROCEDURE	1287	"          into v_temp
"
PRC_AUTO_RUN_CS	PROCEDURE	1288	"          from (select distinct (a.ipaddress) ipaddress
"
PRC_AUTO_RUN_CS	PROCEDURE	1289	"                
"
PRC_AUTO_RUN_CS	PROCEDURE	1290	"                  from mz_mzsfk1 a
"
PRC_AUTO_RUN_CS	PROCEDURE	1291	"                 where a.ipaddress is not null
"
PRC_AUTO_RUN_CS	PROCEDURE	1292	"                   and qtsffs in (16, 17)
"
PRC_AUTO_RUN_CS	PROCEDURE	1293	"                   and qtsfje > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1294	"                   and czgh in ('AUTO4', 'AUTO5')
"
PRC_AUTO_RUN_CS	PROCEDURE	1295	"                   AND a.sfrq > sysdate - 0.2);
"
PRC_AUTO_RUN_CS	PROCEDURE	1296	"        if length(v_temp) > 2 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1297	"          select v_Procedure_Name || ',万达支付 诊间结算核查:' || v_temp
"
PRC_AUTO_RUN_CS	PROCEDURE	1298	"            into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1299	"            from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1300	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1301	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1302	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1303	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1304	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1305	"      --执行失败任务查询  (存储过程，函数失效)    
"
PRC_AUTO_RUN_CS	PROCEDURE	1306	"      if ls_now >= '07:01' and ls_now <= '07:02' then
"
PRC_AUTO_RUN_CS	PROCEDURE	1307	"        if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1308	"          if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1309	"            v_task := '执行失败任务查询';
"
PRC_AUTO_RUN_CS	PROCEDURE	1310	"          
"
PRC_AUTO_RUN_CS	PROCEDURE	1311	"            select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1312	"              into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1313	"              from zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1314	"             where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN_CS	PROCEDURE	1315	"               and jylsh = v_task
"
PRC_AUTO_RUN_CS	PROCEDURE	1316	"               and jyrq > sysdate - 0.05;
"
PRC_AUTO_RUN_CS	PROCEDURE	1317	"            --最近1小时已经执行过
"
PRC_AUTO_RUN_CS	PROCEDURE	1318	"            if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1319	"              v_task := ' ';
"
PRC_AUTO_RUN_CS	PROCEDURE	1320	"            end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1321	"          
"
PRC_AUTO_RUN_CS	PROCEDURE	1322	"            if v_task = '执行失败任务查询' then
"
PRC_AUTO_RUN_CS	PROCEDURE	1323	"              insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1324	"                (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN_CS	PROCEDURE	1325	"              values
"
PRC_AUTO_RUN_CS	PROCEDURE	1326	"                (v_Procedure_Name, v_task, 0);
"
PRC_AUTO_RUN_CS	PROCEDURE	1327	"              commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1328	"            
"
PRC_AUTO_RUN_CS	PROCEDURE	1329	"              select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1330	"                into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1331	"                from zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1332	"               where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN_CS	PROCEDURE	1333	"                 and flag = -1
"
PRC_AUTO_RUN_CS	PROCEDURE	1334	"                 and jyrq > sysdate - 1.05;
"
PRC_AUTO_RUN_CS	PROCEDURE	1335	"              if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1336	"                select v_Procedure_Name || ',执行失败任务,sl:' ||
"
PRC_AUTO_RUN_CS	PROCEDURE	1337	"                       to_char(v_count)
"
PRC_AUTO_RUN_CS	PROCEDURE	1338	"                  into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1339	"                  from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1340	"                prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1341	"              end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1342	"            end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1343	"          
"
PRC_AUTO_RUN_CS	PROCEDURE	1344	"          end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1345	"        
"
PRC_AUTO_RUN_CS	PROCEDURE	1346	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1347	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1348	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1349	"      --日间病人处理
"
PRC_AUTO_RUN_CS	PROCEDURE	1350	"      --  PRO_ITEM_DO('日间病人处理', '00000006', v_bz);    
"
PRC_AUTO_RUN_CS	PROCEDURE	1351	"      -- zy_detail_charge curr_ks is null 
"
PRC_AUTO_RUN_CS	PROCEDURE	1352	"      if 1 <> 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1353	"        select COUNT(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1354	"          INTO v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1355	"          From zy_detail_charge
"
PRC_AUTO_RUN_CS	PROCEDURE	1356	"         where js_NO = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1357	"           and dj < 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1358	"           and jcfx_date > sysdate - 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1359	"           and jcfx_date < sysdate - 0.001;
"
PRC_AUTO_RUN_CS	PROCEDURE	1360	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1361	"        if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1362	"          select v_Procedure_Name || ',curr_ks is nul,sl:' ||
"
PRC_AUTO_RUN_CS	PROCEDURE	1363	"                 to_char(v_count)
"
PRC_AUTO_RUN_CS	PROCEDURE	1364	"            into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1365	"            from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1366	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1367	"        
"
PRC_AUTO_RUN_CS	PROCEDURE	1368	"          update zy_detail_charge
"
PRC_AUTO_RUN_CS	PROCEDURE	1369	"             set dj = dj * -1, sl = sl * -1
"
PRC_AUTO_RUN_CS	PROCEDURE	1370	"           where js_NO = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1371	"             and dj < 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1372	"             and jcfx_date > sysdate - 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1373	"             and jcfx_date < sysdate - 0.001;
"
PRC_AUTO_RUN_CS	PROCEDURE	1374	"          if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1375	"            commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1376	"          else
"
PRC_AUTO_RUN_CS	PROCEDURE	1377	"            rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	1378	"          end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1379	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1380	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1381	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1382	"      --住院预缴款退款失败    
"
PRC_AUTO_RUN_CS	PROCEDURE	1383	"      if 3 = 3 and ls_now >= '09:01' and ls_now <= '09:02' then
"
PRC_AUTO_RUN_CS	PROCEDURE	1384	"        select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1385	"          into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1386	"          from zy_deposit_file
"
PRC_AUTO_RUN_CS	PROCEDURE	1387	"         where depo_date > sysdate - 3
"
PRC_AUTO_RUN_CS	PROCEDURE	1388	"           and AMOUNT < 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1389	"           and nvl(cdcs, 0) = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1390	"           and length(bz) > 30
"
PRC_AUTO_RUN_CS	PROCEDURE	1391	"           and depo_type > 1;
"
PRC_AUTO_RUN_CS	PROCEDURE	1392	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1393	"        if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1394	"          select v_Procedure_Name || ',住院预缴款退款失败,sl:' || to_char(v_count)
"
PRC_AUTO_RUN_CS	PROCEDURE	1395	"            into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1396	"            from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1397	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1398	"        
"
PRC_AUTO_RUN_CS	PROCEDURE	1399	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1400	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1401	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1402	"      -- (存储过程，函数失效)
"
PRC_AUTO_RUN_CS	PROCEDURE	1403	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1404	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1405	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1406	"    --  zy_patient_information.jtbf_flag  is null 
"
PRC_AUTO_RUN_CS	PROCEDURE	1407	"    if 2 <> 2 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1408	"      select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1409	"        INTO v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1410	"        from zy_patient_information y
"
PRC_AUTO_RUN_CS	PROCEDURE	1411	"       where patient_No in (select patient_NO
"
PRC_AUTO_RUN_CS	PROCEDURE	1412	"                              from zy_deposit_file
"
PRC_AUTO_RUN_CS	PROCEDURE	1413	"                             where depo_date > sysdate - 2)
"
PRC_AUTO_RUN_CS	PROCEDURE	1414	"         and jtbf_flag is null;
"
PRC_AUTO_RUN_CS	PROCEDURE	1415	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1416	"        select v_Procedure_Name ||
"
PRC_AUTO_RUN_CS	PROCEDURE	1417	"               ',zy_patient_information.jtbf_flag is nul,sl:' ||
"
PRC_AUTO_RUN_CS	PROCEDURE	1418	"               to_char(v_count)
"
PRC_AUTO_RUN_CS	PROCEDURE	1419	"          into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1420	"          from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1421	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1422	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1423	"      update zy_patient_information
"
PRC_AUTO_RUN_CS	PROCEDURE	1424	"         set jtbf_flag = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1425	"       where patient_No in
"
PRC_AUTO_RUN_CS	PROCEDURE	1426	"             (select patient_NO
"
PRC_AUTO_RUN_CS	PROCEDURE	1427	"                from zy_deposit_file
"
PRC_AUTO_RUN_CS	PROCEDURE	1428	"               where depo_date > sysdate - 0.6
"
PRC_AUTO_RUN_CS	PROCEDURE	1429	"                 and depo_date < sysdate - 0.001)
"
PRC_AUTO_RUN_CS	PROCEDURE	1430	"         and jtbf_flag is null;
"
PRC_AUTO_RUN_CS	PROCEDURE	1431	"      if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1432	"        commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1433	"      else
"
PRC_AUTO_RUN_CS	PROCEDURE	1434	"        rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	1435	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1436	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1437	"      select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1438	"        INTO v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1439	"        From (select rb_date, sum(je1) aa, sum(je2) bb
"
PRC_AUTO_RUN_CS	PROCEDURE	1440	"                from (select rb_date rb_date, sum(xmje2) je1, 0 je2
"
PRC_AUTO_RUN_CS	PROCEDURE	1441	"                        From zy_rbk2
"
PRC_AUTO_RUN_CS	PROCEDURE	1442	"                       where rb_date > sysdate - 2
"
PRC_AUTO_RUN_CS	PROCEDURE	1443	"                         and hh in (27)
"
PRC_AUTO_RUN_CS	PROCEDURE	1444	"                       group by rb_date
"
PRC_AUTO_RUN_CS	PROCEDURE	1445	"                      union all
"
PRC_AUTO_RUN_CS	PROCEDURE	1446	"                      select rb_date, 0 je1, sum(amount) je2
"
PRC_AUTO_RUN_CS	PROCEDURE	1447	"                        from zy_deposit_file
"
PRC_AUTO_RUN_CS	PROCEDURE	1448	"                       where rb_date > sysdate - 2
"
PRC_AUTO_RUN_CS	PROCEDURE	1449	"                       group by rb_date)
"
PRC_AUTO_RUN_CS	PROCEDURE	1450	"               group by rb_date)
"
PRC_AUTO_RUN_CS	PROCEDURE	1451	"       where aa <> bb;
"
PRC_AUTO_RUN_CS	PROCEDURE	1452	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1453	"        select v_Procedure_Name || ',住院日报预计款不平  ,sl:' || to_char(v_count)
"
PRC_AUTO_RUN_CS	PROCEDURE	1454	"          into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1455	"          from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1456	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1457	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1458	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1459	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1460	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1461	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1462	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1463	"  --住院收费 调整工号  加上 2020抢号
"
PRC_AUTO_RUN_CS	PROCEDURE	1464	"  if (ls_now > '17:00' and ls_now <= '17:01') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1465	"     (ls_now > '13:30' and ls_now <= '13:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1466	"     (ls_now > '10:30' and ls_now <= '10:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1467	"     (ls_now > '15:30' and ls_now <= '15:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1468	"     (ls_now > '07:30' and ls_now <= '07:31') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1469	"     (ls_now > '04:30' and ls_now <= '04:31') then
"
PRC_AUTO_RUN_CS	PROCEDURE	1470	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1471	"    --'2020抢号渠道'
"
PRC_AUTO_RUN_CS	PROCEDURE	1472	"    if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1473	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1474	"      select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1475	"        into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1476	"        from (select to_char(yyrq1, 'yyyy-mm-dd'), pbxh, count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1477	"                from gh_mzyyk
"
PRC_AUTO_RUN_CS	PROCEDURE	1478	"               where zt >= 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1479	"                 and NVL(CZGH, '0') = 'ZSYY2'
"
PRC_AUTO_RUN_CS	PROCEDURE	1480	"                 and yyrq1 >= trunc(sysdate)
"
PRC_AUTO_RUN_CS	PROCEDURE	1481	"                 and xxczid = '2020抢号渠道'
"
PRC_AUTO_RUN_CS	PROCEDURE	1482	"               group by to_char(yyrq1, 'yyyy-mm-dd'), pbxh
"
PRC_AUTO_RUN_CS	PROCEDURE	1483	"              having count(*) > 3);
"
PRC_AUTO_RUN_CS	PROCEDURE	1484	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1485	"        select v_Procedure_Name || ',2020抢号渠道  ysgh>3  '
"
PRC_AUTO_RUN_CS	PROCEDURE	1486	"          into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1487	"          from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1488	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1489	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1490	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1491	"      select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1492	"        into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1493	"        from (select sfzh, count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1494	"                from gh_mzyyk
"
PRC_AUTO_RUN_CS	PROCEDURE	1495	"               where zt >= 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1496	"                 and NVL(CZGH, '0') = 'ZSYY2'
"
PRC_AUTO_RUN_CS	PROCEDURE	1497	"                 and yyrq1 >= trunc(to_date('20200511', 'yyyymmdd'))
"
PRC_AUTO_RUN_CS	PROCEDURE	1498	"                 and xxczid = '2020抢号渠道'
"
PRC_AUTO_RUN_CS	PROCEDURE	1499	"               group by sfzh
"
PRC_AUTO_RUN_CS	PROCEDURE	1500	"              having count(*) > 1);
"
PRC_AUTO_RUN_CS	PROCEDURE	1501	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1502	"        select v_Procedure_Name || ',2020抢号渠道 sfzh>1  '
"
PRC_AUTO_RUN_CS	PROCEDURE	1503	"          into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1504	"          from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1505	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1506	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1507	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1508	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1509	"    -- --L0482  L0449 L0481
"
PRC_AUTO_RUN_CS	PROCEDURE	1510	"    update zy_total_fee
"
PRC_AUTO_RUN_CS	PROCEDURE	1511	"       set fplx = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1512	"     where
"
PRC_AUTO_RUN_CS	PROCEDURE	1513	"    --op_id in ('L0259', 'L0484', 'L0481', 'L0480', 'L0482', 'L0449')
"
PRC_AUTO_RUN_CS	PROCEDURE	1514	"     op_id in ('L0259', 'L0484', '', 'L0480', '', '')
"
PRC_AUTO_RUN_CS	PROCEDURE	1515	"     and nvl(fplx, 0) = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1516	"     and js_no = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1517	"     and flag > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1518	"     and jz_date > sysdate - 0.5;
"
PRC_AUTO_RUN_CS	PROCEDURE	1519	"    if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1520	"      commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1521	"      select v_Procedure_Name || ',住院收费 调整工号  ' into nr from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1522	"      -- prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1523	"    else
"
PRC_AUTO_RUN_CS	PROCEDURE	1524	"      rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	1525	"      select v_Procedure_Name || ',住院收费 调整工号 error XXXX  '
"
PRC_AUTO_RUN_CS	PROCEDURE	1526	"        into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1527	"        from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1528	"      -- prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1529	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1530	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1531	"    if (ls_now > '17:31') then
"
PRC_AUTO_RUN_CS	PROCEDURE	1532	"      select '当天住院智慧结算率,' ||
"
PRC_AUTO_RUN_CS	PROCEDURE	1533	"             round(x.sl * 100 / decode(y.sl, 0, 1, y.sl), 2) || '%'
"
PRC_AUTO_RUN_CS	PROCEDURE	1534	"        into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1535	"        from (select count(*) sl
"
PRC_AUTO_RUN_CS	PROCEDURE	1536	"                from zy_total_fee
"
PRC_AUTO_RUN_CS	PROCEDURE	1537	"               where nvl(fplx, 0) <> 2
"
PRC_AUTO_RUN_CS	PROCEDURE	1538	"                 and js_no = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1539	"                 and flag > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1540	"                 and trunc(jz_date) = trunc(sysdate)
"
PRC_AUTO_RUN_CS	PROCEDURE	1541	"                 and (op_Id like 'AUTO%' or op_Id like 'JD%' or
"
PRC_AUTO_RUN_CS	PROCEDURE	1542	"                      op_id in ('L0259', 'L0484', '', 'L0480', '', ''))) x,
"
PRC_AUTO_RUN_CS	PROCEDURE	1543	"             (select count(*) sl
"
PRC_AUTO_RUN_CS	PROCEDURE	1544	"                from zy_total_fee
"
PRC_AUTO_RUN_CS	PROCEDURE	1545	"               where js_no >= 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1546	"                 and flag > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1547	"                 and trunc(jz_date) = trunc(sysdate)) y;
"
PRC_AUTO_RUN_CS	PROCEDURE	1548	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1549	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1550	"    if (ls_now <= '07:31') then
"
PRC_AUTO_RUN_CS	PROCEDURE	1551	"      --20200211
"
PRC_AUTO_RUN_CS	PROCEDURE	1552	"      v_sl_count := 0;
"
PRC_AUTO_RUN_CS	PROCEDURE	1553	"      loop
"
PRC_AUTO_RUN_CS	PROCEDURE	1554	"        v_sl_count := v_sl_count + 1;
"
PRC_AUTO_RUN_CS	PROCEDURE	1555	"        select 100 - bl into v_sl from v_temp_20200211_jsv;
"
PRC_AUTO_RUN_CS	PROCEDURE	1556	"        EXIT WHEN v_sl >= 69 and v_sl <= 74;
"
PRC_AUTO_RUN_CS	PROCEDURE	1557	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1558	"        EXIT WHEN v_sl_count > 10;
"
PRC_AUTO_RUN_CS	PROCEDURE	1559	"        if v_sl < 69 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1560	"        
"
PRC_AUTO_RUN_CS	PROCEDURE	1561	"          update zy_total_fee
"
PRC_AUTO_RUN_CS	PROCEDURE	1562	"             set fplx = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1563	"           where patient_no in
"
PRC_AUTO_RUN_CS	PROCEDURE	1564	"                 (select patient_No
"
PRC_AUTO_RUN_CS	PROCEDURE	1565	"                    from (select rownum, mod(rownum, 10) mod_flag, patient_No
"
PRC_AUTO_RUN_CS	PROCEDURE	1566	"                            from zy_total_fee x
"
PRC_AUTO_RUN_CS	PROCEDURE	1567	"                           where op_id like 'L%'
"
PRC_AUTO_RUN_CS	PROCEDURE	1568	"                             and nvl(fplx, 0) <> 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1569	"                             and js_no = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1570	"                             and trunc(jz_date) = trunc(sysdate - 1))
"
PRC_AUTO_RUN_CS	PROCEDURE	1571	"                   where mod_flag = 1)
"
PRC_AUTO_RUN_CS	PROCEDURE	1572	"             and op_id like 'L%'
"
PRC_AUTO_RUN_CS	PROCEDURE	1573	"             and js_no = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1574	"             and trunc(jz_date) = trunc(sysdate - 1);
"
PRC_AUTO_RUN_CS	PROCEDURE	1575	"        
"
PRC_AUTO_RUN_CS	PROCEDURE	1576	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1577	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1578	"        if v_sl > 74 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1579	"          update zy_total_fee
"
PRC_AUTO_RUN_CS	PROCEDURE	1580	"             set fplx = 2
"
PRC_AUTO_RUN_CS	PROCEDURE	1581	"           where patient_no in
"
PRC_AUTO_RUN_CS	PROCEDURE	1582	"                 (select patient_No
"
PRC_AUTO_RUN_CS	PROCEDURE	1583	"                    from (select rownum, mod(rownum, 10) mod_flag, patient_No
"
PRC_AUTO_RUN_CS	PROCEDURE	1584	"                            from zy_total_fee x
"
PRC_AUTO_RUN_CS	PROCEDURE	1585	"                           where op_id like 'L%'
"
PRC_AUTO_RUN_CS	PROCEDURE	1586	"                             and nvl(fplx, 0) = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1587	"                             and js_no = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1588	"                             and trunc(jz_date) = trunc(sysdate - 1))
"
PRC_AUTO_RUN_CS	PROCEDURE	1589	"                   where mod_flag = 1)
"
PRC_AUTO_RUN_CS	PROCEDURE	1590	"             and op_id like 'L%'
"
PRC_AUTO_RUN_CS	PROCEDURE	1591	"             and js_no = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1592	"             and trunc(jz_date) = trunc(sysdate - 1);
"
PRC_AUTO_RUN_CS	PROCEDURE	1593	"        
"
PRC_AUTO_RUN_CS	PROCEDURE	1594	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1595	"        if sqlcode = 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1596	"          commit;
"
PRC_AUTO_RUN_CS	PROCEDURE	1597	"        else
"
PRC_AUTO_RUN_CS	PROCEDURE	1598	"          rollback;
"
PRC_AUTO_RUN_CS	PROCEDURE	1599	"        
"
PRC_AUTO_RUN_CS	PROCEDURE	1600	"        end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1601	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1602	"      end loop;
"
PRC_AUTO_RUN_CS	PROCEDURE	1603	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1604	"      select to_char(trunc(sysdate - 1), 'yyyy-mm-dd') || '住院智慧结算率,' ||
"
PRC_AUTO_RUN_CS	PROCEDURE	1605	"             round(x.sl * 100 / decode(y.sl, 0, 1, y.sl), 2) || '%'
"
PRC_AUTO_RUN_CS	PROCEDURE	1606	"        into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1607	"        from (select count(*) sl
"
PRC_AUTO_RUN_CS	PROCEDURE	1608	"                from zy_total_fee
"
PRC_AUTO_RUN_CS	PROCEDURE	1609	"               where nvl(fplx, 0) <> 2
"
PRC_AUTO_RUN_CS	PROCEDURE	1610	"                 and js_no = 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1611	"                 and flag > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1612	"                 and trunc(jz_date) = trunc(sysdate - 1)
"
PRC_AUTO_RUN_CS	PROCEDURE	1613	"                 and (op_Id like 'AUTO%' or op_Id like 'JD%' or fplx = 1)) x,
"
PRC_AUTO_RUN_CS	PROCEDURE	1614	"             (select count(*) sl
"
PRC_AUTO_RUN_CS	PROCEDURE	1615	"                from zy_total_fee
"
PRC_AUTO_RUN_CS	PROCEDURE	1616	"               where js_no >= 1
"
PRC_AUTO_RUN_CS	PROCEDURE	1617	"                 and flag > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1618	"                 and trunc(jz_date) = trunc(sysdate - 1)) y;
"
PRC_AUTO_RUN_CS	PROCEDURE	1619	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1620	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1621	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1622	"    --最近20分钟短信发送数据
"
PRC_AUTO_RUN_CS	PROCEDURE	1623	"    if 3 = 3 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1624	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1625	"      select to_char(sysdate, 'yyyymmdd hh24:mi:ss') || '最近40分钟短信发送数据'
"
PRC_AUTO_RUN_CS	PROCEDURE	1626	"        into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1627	"        from (select count(xh) sl
"
PRC_AUTO_RUN_CS	PROCEDURE	1628	"                From auto_task_ywzx_send
"
PRC_AUTO_RUN_CS	PROCEDURE	1629	"               where (date_send > sysdate - 0.03 and
"
PRC_AUTO_RUN_CS	PROCEDURE	1630	"                     date_send < sysdate + 0.01))
"
PRC_AUTO_RUN_CS	PROCEDURE	1631	"       where sl > 0;
"
PRC_AUTO_RUN_CS	PROCEDURE	1632	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1633	"      if length(nr) > 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1634	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1635	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1636	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1637	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1638	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1639	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1640	"  --prc_auto_task_v1();
"
PRC_AUTO_RUN_CS	PROCEDURE	1641	"  if ls_now > '17:01' and ls_now <= '17:02' then
"
PRC_AUTO_RUN_CS	PROCEDURE	1642	"    prc_auto_task_v1();
"
PRC_AUTO_RUN_CS	PROCEDURE	1643	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1644	"  --
"
PRC_AUTO_RUN_CS	PROCEDURE	1645	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1646	"  if (ls_now > '13:31' and ls_now <= '13:32') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1647	"     (ls_now > '21:01' and ls_now <= '21:02') or
"
PRC_AUTO_RUN_CS	PROCEDURE	1648	"     (ls_now > '06:45' and ls_now <= '06:46') then
"
PRC_AUTO_RUN_CS	PROCEDURE	1649	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1650	"    select v_Procedure_Name || ',测试短信发送,医保未上传:' ||
"
PRC_AUTO_RUN_CS	PROCEDURE	1651	"           count(distinct(patient_no))
"
PRC_AUTO_RUN_CS	PROCEDURE	1652	"      into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1653	"      from zy_detail_charge
"
PRC_AUTO_RUN_CS	PROCEDURE	1654	"     where scrq < sysdate - 300
"
PRC_AUTO_RUN_CS	PROCEDURE	1655	"       and jcfx_date < sysdate - 1.5
"
PRC_AUTO_RUN_CS	PROCEDURE	1656	"       and js_no = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1657	"       and patient_No in (select patient_No
"
PRC_AUTO_RUN_CS	PROCEDURE	1658	"                            From zy_patient_information
"
PRC_AUTO_RUN_CS	PROCEDURE	1659	"                           where js_no = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1660	"                             and brlb = 97
"
PRC_AUTO_RUN_CS	PROCEDURE	1661	"                             and jz_date > sysdate - 2);
"
PRC_AUTO_RUN_CS	PROCEDURE	1662	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1663	"    --select v_Procedure_Name || ',测试短信发送 ' into nr from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1664	"    prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1665	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1666	"    --核查价格修改 
"
PRC_AUTO_RUN_CS	PROCEDURE	1667	"    if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1668	"      select to_char(trunc(sysdate), 'yyyy-mm-dd') || ' 00:00:01'
"
PRC_AUTO_RUN_CS	PROCEDURE	1669	"        into v_temp
"
PRC_AUTO_RUN_CS	PROCEDURE	1670	"        from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1671	"      v_count := 0;
"
PRC_AUTO_RUN_CS	PROCEDURE	1672	"      select count(x.glxh)
"
PRC_AUTO_RUN_CS	PROCEDURE	1673	"        into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1674	"        from ((select a.glxh, sum(b.dj * a.sl) je
"
PRC_AUTO_RUN_CS	PROCEDURE	1675	"                 From gy_ylsftc a, gy_Ylsf b
"
PRC_AUTO_RUN_CS	PROCEDURE	1676	"                where a.ylxh = b.ylxh
"
PRC_AUTO_RUN_CS	PROCEDURE	1677	"                  and nvl(a.yppb, 0) = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1678	"                group by a.glxh)) x,
"
PRC_AUTO_RUN_CS	PROCEDURE	1679	"             (select a.glxh, sum(b.dj * a.sl) je
"
PRC_AUTO_RUN_CS	PROCEDURE	1680	"                From gy_ylsftc as of timestamp to_timestamp(v_temp, 'yyyy-mm-dd hh24:mi:ss') a,
"
PRC_AUTO_RUN_CS	PROCEDURE	1681	"                     gy_Ylsf   as of timestamp to_timestamp(v_temp, 'yyyy-mm-dd hh24:mi:ss'  ) b
"
PRC_AUTO_RUN_CS	PROCEDURE	1682	"               where a.ylxh = b.ylxh
"
PRC_AUTO_RUN_CS	PROCEDURE	1683	"                 and nvl(a.yppb, 0) = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1684	"               group by a.glxh) y
"
PRC_AUTO_RUN_CS	PROCEDURE	1685	"       where x.glxh = y.glxh
"
PRC_AUTO_RUN_CS	PROCEDURE	1686	"         and x.je <> y.je;
"
PRC_AUTO_RUN_CS	PROCEDURE	1687	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1688	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1689	"        select '套餐价格调整： ' || v_count into nr from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1690	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1691	"        prc_sms_send('ts', '15657971559', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1692	"        select substr(wm_concat((select ylmc
"
PRC_AUTO_RUN_CS	PROCEDURE	1693	"                                   from gy_ylsf
"
PRC_AUTO_RUN_CS	PROCEDURE	1694	"                                  where ylxh = x.glxh) || y.je || ' 调整为' || x.je),
"
PRC_AUTO_RUN_CS	PROCEDURE	1695	"                      1,
"
PRC_AUTO_RUN_CS	PROCEDURE	1696	"                      200)
"
PRC_AUTO_RUN_CS	PROCEDURE	1697	"          into v_msg
"
PRC_AUTO_RUN_CS	PROCEDURE	1698	"          from ((select a.glxh, sum(b.dj * a.sl) je
"
PRC_AUTO_RUN_CS	PROCEDURE	1699	"                   From gy_ylsftc a, gy_Ylsf b
"
PRC_AUTO_RUN_CS	PROCEDURE	1700	"                  where a.ylxh = b.ylxh
"
PRC_AUTO_RUN_CS	PROCEDURE	1701	"                    and nvl(a.yppb, 0) = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1702	"                  group by a.glxh)) x,
"
PRC_AUTO_RUN_CS	PROCEDURE	1703	"               (select a.glxh, sum(b.dj * a.sl) je
"
PRC_AUTO_RUN_CS	PROCEDURE	1704	"                  From gy_ylsftc as of timestamp to_timestamp(v_temp, 'yyyy-mm-dd hh24:mi:ss') a,
"
PRC_AUTO_RUN_CS	PROCEDURE	1705	"                       gy_Ylsf   as of timestamp to_timestamp(v_temp, 'yyyy-mm-dd hh24:mi:ss'  ) b
"
PRC_AUTO_RUN_CS	PROCEDURE	1706	"                 where a.ylxh = b.ylxh
"
PRC_AUTO_RUN_CS	PROCEDURE	1707	"                   and nvl(a.yppb, 0) = 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1708	"                 group by a.glxh) y
"
PRC_AUTO_RUN_CS	PROCEDURE	1709	"         where x.glxh = y.glxh
"
PRC_AUTO_RUN_CS	PROCEDURE	1710	"           and x.je <> y.je;
"
PRC_AUTO_RUN_CS	PROCEDURE	1711	"        select v_msg into nr from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1712	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1713	"        prc_sms_send('ts', '15657971559', nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1714	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1715	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1716	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1717	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1718	"    -- 床位费滚收 js_no<>0 
"
PRC_AUTO_RUN_CS	PROCEDURE	1719	"    if 1 = 1 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1720	"      select count(*)
"
PRC_AUTO_RUN_CS	PROCEDURE	1721	"        into v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1722	"        From zy_detail_charge t, zy_patient_information y
"
PRC_AUTO_RUN_CS	PROCEDURE	1723	"       where t.patient_no = y.patient_no
"
PRC_AUTO_RUN_CS	PROCEDURE	1724	"         and t.twice_detail_code = 'AU'
"
PRC_AUTO_RUN_CS	PROCEDURE	1725	"         and t.jcfx_date > sysdate - 2
"
PRC_AUTO_RUN_CS	PROCEDURE	1726	"         and y.js_NO > 0
"
PRC_AUTO_RUN_CS	PROCEDURE	1727	"            -- and t.js_No=0
"
PRC_AUTO_RUN_CS	PROCEDURE	1728	"         and sl > 2;
"
PRC_AUTO_RUN_CS	PROCEDURE	1729	"      if v_count > 0 then
"
PRC_AUTO_RUN_CS	PROCEDURE	1730	"        select v_Procedure_Name || ',床位费滚收 js_no<>0 ,: ' || v_count
"
PRC_AUTO_RUN_CS	PROCEDURE	1731	"          into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1732	"          from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1733	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN_CS	PROCEDURE	1734	"      
"
PRC_AUTO_RUN_CS	PROCEDURE	1735	"      end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1736	"    
"
PRC_AUTO_RUN_CS	PROCEDURE	1737	"    end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1738	"  
"
PRC_AUTO_RUN_CS	PROCEDURE	1739	"  end if;
"
PRC_AUTO_RUN_CS	PROCEDURE	1740	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1741	"  /*  ln_jcfx_id := To_Number( To_Char( Sysdate - 1, 'YYYYMMD\*D' ));
"
PRC_AUTO_RUN_CS	PROCEDURE	1742	"  pkg_jcfx.prc_zy_sjcj_au( ln_jcfx_id, 1, ln_code, ls_mess );*/
"
PRC_AUTO_RUN_CS	PROCEDURE	1743	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1744	"  /*      select 'zy_detail_charge curr is null，记录为:' || to_char(v_count)
"
PRC_AUTO_RUN_CS	PROCEDURE	1745	"    into nr
"
PRC_AUTO_RUN_CS	PROCEDURE	1746	"    from dual;
"
PRC_AUTO_RUN_CS	PROCEDURE	1747	"  lxdh := '13777929515';
"
PRC_AUTO_RUN_CS	PROCEDURE	1748	"  prc_sms_send('ts', lxdh, nr, v_bz);*/
"
PRC_AUTO_RUN_CS	PROCEDURE	1749	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1750	"  /*  insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN_CS	PROCEDURE	1751	"    (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN_CS	PROCEDURE	1752	"  values
"
PRC_AUTO_RUN_CS	PROCEDURE	1753	"    (v_Procedure_Name, '结束', 1);
"
PRC_AUTO_RUN_CS	PROCEDURE	1754	"  commit;*/
"
PRC_AUTO_RUN_CS	PROCEDURE	1755	"
"
PRC_AUTO_RUN_CS	PROCEDURE	1756	"End;
"
