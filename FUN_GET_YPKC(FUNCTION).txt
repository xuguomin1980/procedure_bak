FUN_GET_YPKC	FUNCTION	1	"function fun_get_ypkc     (arg_type in number,arg_XTXH in NUMBER,arg_ypxh in number,arg_ypcddm in number)    return number      is     ls_return number(11,3);     ls_ypsx   varchar2(2);     li_ypbzl  number(5);     li_yflb   number(2);     li_yplx   number(1);     begin   	 Select  yflb     	  Into li_yflb   	  From yf_xtdz   	  Where xtxh=arg_xtxh;   	 Select to_number(f_bf_getypxx(arg_ypxh,arg_ypcddm,'yplx'))   		 into li_yplx   		 from  dual;    If li_yflb=2 Then    	if arg_type=1 then    		  select nvl(skc,0) - nvl(xskc,0) into ls_return from by_ypkcz   		  where  (ypxh=arg_ypxh or fzfl=arg_ypxh) and ypcddm=arg_ypcddm AND XTXH=ARG_XTXH AND ksdm=  					  (select ksdm from by_ckxh where kssx=1 and xtxh=arg_xtxh);  	 end if; 	if arg_type=2 then  	  select nvl(skc,0)  into ls_return from by_ypkcz   		  where  (ypxh=arg_ypxh or fzfl=arg_ypxh) and ypcddm=arg_ypcddm AND XTXH=ARG_XTXH AND ksdm=  					  (select ksdm from by_ckxh where kssx=1 and xtxh=arg_xtxh);  	end if;   	select decode(li_yplx,1,substr(ypsx,2,1)||substr(ypsx,4,1),2,substr(ypsx,5,1)||substr(ypsx,7,1),4,substr(ypsx,8,1)||substr(ypsx,9,1)) ,ypbzl  		 into ls_ypsx, li_ypbzl   		from  gy_ypmcggzd    	  where ypxh=arg_ypxh;    ElsIf li_yflb =1  Then    	 if arg_type=1 then    	  select nvl(yswfkc,0) - nvl(xskc,0) into ls_return from my_ypkcz   		  where  (ypxh=arg_ypxh or fzfl=arg_ypxh) and ypcddm=arg_ypcddm AND XTXH=ARG_XTXH AND ksdm=   					  (select ksdm from my_ckxh where kssx=1 and xtxh=arg_xtxh);    	 end if;   	 if arg_type=2 then    	  select nvl(yswfkc,0)  into ls_return from my_ypkcz   		  where  (ypxh=arg_ypxh or fzfl=arg_ypxh) and ypcddm=arg_ypcddm AND XTXH=ARG_XTXH AND ksdm=   					  (select ksdm from my_ckxh where kssx=1 and xtxh=arg_xtxh);   	 end if;   	  select decode(li_yplx,1,substr(ypsx,2,1)||substr(ypsx,3,1),2,substr(ypsx,5,1)||substr(ypsx,6,1),4,substr(ypsx,8,1)||substr(ypsx,9,1)) ,ypbzl  		 into ls_ypsx, li_ypbzl   		from  gy_ypmcggzd    	  where ypxh=arg_ypxh;   	End If;   	if ls_ypsx='10' or ls_ypsx='01' then    		ls_return := round(ls_return/li_ypbzl,2);   	end if;    return(ls_return);    end; "
