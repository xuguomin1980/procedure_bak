FUN_GET_XWYH	FUNCTION	1	"FUNCTION ""FUN_GET_XWYH""(NO IN NUMBER) RETURN VARCHAR2 IS
"
FUN_GET_XWYH	FUNCTION	2	"  RESULT VARCHAR2(100);
"
FUN_GET_XWYH	FUNCTION	3	"  V_YYRS NUMBER(3);
"
FUN_GET_XWYH	FUNCTION	4	"  V_GHRS NUMBER(3);
"
FUN_GET_XWYH	FUNCTION	5	"
"
FUN_GET_XWYH	FUNCTION	6	"BEGIN
"
FUN_GET_XWYH	FUNCTION	7	"
"
FUN_GET_XWYH	FUNCTION	8	"  BEGIN
"
FUN_GET_XWYH	FUNCTION	9	"    SELECT COUNT(*)
"
FUN_GET_XWYH	FUNCTION	10	"      INTO V_YYRS
"
FUN_GET_XWYH	FUNCTION	11	"      FROM ZJHIS.GH_MZYYK A, ZJHIS.GH_MZPBK B
"
FUN_GET_XWYH	FUNCTION	12	"     WHERE (A.PBXH = B.JLXH OR A.PBXH = B.PBJLXH)
"
FUN_GET_XWYH	FUNCTION	13	"       AND TO_DATE(A.YYRQ1) = TO_DATE(B.RQ)
"
FUN_GET_XWYH	FUNCTION	14	"       AND A.ZT = 0
"
FUN_GET_XWYH	FUNCTION	15	"       AND A.YYSJ = 2
"
FUN_GET_XWYH	FUNCTION	16	"       AND A.GHXH <= B.XWZGXH
"
FUN_GET_XWYH	FUNCTION	17	"       AND B.JLXH = NO;
"
FUN_GET_XWYH	FUNCTION	18	"  END;
"
FUN_GET_XWYH	FUNCTION	19	"
"
FUN_GET_XWYH	FUNCTION	20	"  BEGIN
"
FUN_GET_XWYH	FUNCTION	21	"    SELECT COUNT(*)
"
FUN_GET_XWYH	FUNCTION	22	"      INTO V_GHRS
"
FUN_GET_XWYH	FUNCTION	23	"      FROM ZJHIS.GH_GHK
"
FUN_GET_XWYH	FUNCTION	24	"     WHERE PBXH IN (SELECT JLXH FROM ZJHIS.GH_MZPBK WHERE JLXH = NO)
"
FUN_GET_XWYH	FUNCTION	25	"       AND GHRQ > trunc(SYSDATE)
"
FUN_GET_XWYH	FUNCTION	26	"       AND SJLB = 2
"
FUN_GET_XWYH	FUNCTION	27	"       AND THBZ = 0
"
FUN_GET_XWYH	FUNCTION	28	"       AND nvl(zfpb, 0) = 0;
"
FUN_GET_XWYH	FUNCTION	29	"  END;
"
FUN_GET_XWYH	FUNCTION	30	"  BEGIN
"
FUN_GET_XWYH	FUNCTION	31	"    SELECT NVL(A.xwzgxh, 0) - V_YYRS - V_GHRS
"
FUN_GET_XWYH	FUNCTION	32	"      INTO RESULT
"
FUN_GET_XWYH	FUNCTION	33	"      from ZJHIS.GH_MZPBK A
"
FUN_GET_XWYH	FUNCTION	34	"     WHERE A.jlxh = NO;
"
FUN_GET_XWYH	FUNCTION	35	"  exception
"
FUN_GET_XWYH	FUNCTION	36	"    when no_data_found then
"
FUN_GET_XWYH	FUNCTION	37	"      RESULT := null;
"
FUN_GET_XWYH	FUNCTION	38	"  END;
"
FUN_GET_XWYH	FUNCTION	39	"
"
FUN_GET_XWYH	FUNCTION	40	"  if RESULT >= 0 then
"
FUN_GET_XWYH	FUNCTION	41	"    V_GHRS := 0;
"
FUN_GET_XWYH	FUNCTION	42	"  else
"
FUN_GET_XWYH	FUNCTION	43	"    SELECT COUNT(*)
"
FUN_GET_XWYH	FUNCTION	44	"      INTO V_YYRS
"
FUN_GET_XWYH	FUNCTION	45	"      FROM ZJHIS.GH_MZYYK A
"
FUN_GET_XWYH	FUNCTION	46	"     WHERE TO_DATE(A.YYRQ1) > trunc(sysdate)
"
FUN_GET_XWYH	FUNCTION	47	"       AND A.ZT = 0
"
FUN_GET_XWYH	FUNCTION	48	"       AND A.YYSJ = 2
"
FUN_GET_XWYH	FUNCTION	49	"       and A.PBXH = NO;
"
FUN_GET_XWYH	FUNCTION	50	"    SELECT NVL(A.xwzgxh, 0) - V_YYRS
"
FUN_GET_XWYH	FUNCTION	51	"      INTO RESULT
"
FUN_GET_XWYH	FUNCTION	52	"      from ZJHIS.GH_yzpbk A
"
FUN_GET_XWYH	FUNCTION	53	"     WHERE A.jlxh = NO;
"
FUN_GET_XWYH	FUNCTION	54	"  end if;
"
FUN_GET_XWYH	FUNCTION	55	"
"
FUN_GET_XWYH	FUNCTION	56	"  RETURN(RESULT);
"
FUN_GET_XWYH	FUNCTION	57	"END FUN_GET_xWYH;
"
