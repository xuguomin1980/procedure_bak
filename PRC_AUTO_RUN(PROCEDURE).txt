PRC_AUTO_RUN	PROCEDURE	1	"PROCEDURE prc_auto_run Is
"
PRC_AUTO_RUN	PROCEDURE	2	"
"
PRC_AUTO_RUN	PROCEDURE	3	"  /*=============================================================================
"
PRC_AUTO_RUN	PROCEDURE	4	"  || 过程名称 ： PRC_AUTO_RUN 后台自动运行
"
PRC_AUTO_RUN	PROCEDURE	5	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN	PROCEDURE	6	"  || 功能说明 ：  JOB 定时10分钟 执行 后台任务
"
PRC_AUTO_RUN	PROCEDURE	7	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN	PROCEDURE	8	"  || 参数描述 ： 无
"
PRC_AUTO_RUN	PROCEDURE	9	"  ------------------------------------------------------------
"
PRC_AUTO_RUN	PROCEDURE	10	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN	PROCEDURE	11	"  || 注意事项 ：
"
PRC_AUTO_RUN	PROCEDURE	12	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN	PROCEDURE	13	"  || 作    者 ：       完成日期 ：
"
PRC_AUTO_RUN	PROCEDURE	14	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN	PROCEDURE	15	"  || 修改记录 ：
"
PRC_AUTO_RUN	PROCEDURE	16	"  =============================================================================*/
"
PRC_AUTO_RUN	PROCEDURE	17	"  v_Procedure_Name Varchar2(50);
"
PRC_AUTO_RUN	PROCEDURE	18	"  v_task           Varchar2(30);
"
PRC_AUTO_RUN	PROCEDURE	19	"
"
PRC_AUTO_RUN	PROCEDURE	20	"  ln_jcfx_id   Number;
"
PRC_AUTO_RUN	PROCEDURE	21	"  ln_code      Number;
"
PRC_AUTO_RUN	PROCEDURE	22	"  ls_mess      Varchar2(100);
"
PRC_AUTO_RUN	PROCEDURE	23	"  v_count      number;
"
PRC_AUTO_RUN	PROCEDURE	24	"  v_xh         number;
"
PRC_AUTO_RUN	PROCEDURE	25	"  ls_now       Varchar2(20);
"
PRC_AUTO_RUN	PROCEDURE	26	"  ls_now_minue Varchar2(20);
"
PRC_AUTO_RUN	PROCEDURE	27	"  lxdh         Varchar2(20);
"
PRC_AUTO_RUN	PROCEDURE	28	"  nr           Varchar2(200);
"
PRC_AUTO_RUN	PROCEDURE	29	"  v_bz         Varchar2(200);
"
PRC_AUTO_RUN	PROCEDURE	30	"  v_temp       Varchar2(100);
"
PRC_AUTO_RUN	PROCEDURE	31	"  v_jzkh       Varchar2(100);
"
PRC_AUTO_RUN	PROCEDURE	32	"  v_msg        Varchar2(300);
"
PRC_AUTO_RUN	PROCEDURE	33	"  v_sl         Number;
"
PRC_AUTO_RUN	PROCEDURE	34	"  v_sl_count   Number;
"
PRC_AUTO_RUN	PROCEDURE	35	"  v_laborder   Number;
"
PRC_AUTO_RUN	PROCEDURE	36	"  v_out_code   Number;
"
PRC_AUTO_RUN	PROCEDURE	37	"  v_out_msg    Varchar2(300);
"
PRC_AUTO_RUN	PROCEDURE	38	"  v_yyxh       number;
"
PRC_AUTO_RUN	PROCEDURE	39	"  v_lxdh       NVARCHAR2(30);
"
PRC_AUTO_RUN	PROCEDURE	40	"  v_ypxh       Number;
"
PRC_AUTO_RUN	PROCEDURE	41	"  v_ypcddm     Number;
"
PRC_AUTO_RUN	PROCEDURE	42	"  --预约挂号提醒
"
PRC_AUTO_RUN	PROCEDURE	43	"  cursor cur_mzyyk is
"
PRC_AUTO_RUN	PROCEDURE	44	"    select yyxh
"
PRC_AUTO_RUN	PROCEDURE	45	"      from gh_mzyyk
"
PRC_AUTO_RUN	PROCEDURE	46	"     where djrq > sysdate - 0.01
"
PRC_AUTO_RUN	PROCEDURE	47	"       and djrq < sysdate - 0.001
"
PRC_AUTO_RUN	PROCEDURE	48	"       and czgh < 'Z'
"
PRC_AUTO_RUN	PROCEDURE	49	"       and czgh >= 'B'
"
PRC_AUTO_RUN	PROCEDURE	50	"       and yyxh not in (
"
PRC_AUTO_RUN	PROCEDURE	51	"                        
"
PRC_AUTO_RUN	PROCEDURE	52	"                        select yyxh
"
PRC_AUTO_RUN	PROCEDURE	53	"                          from (select yyxh, lxdh
"
PRC_AUTO_RUN	PROCEDURE	54	"                                   From gh_mzyyk
"
PRC_AUTO_RUN	PROCEDURE	55	"                                  where djrq >= sysdate - 0.015
"
PRC_AUTO_RUN	PROCEDURE	56	"                                    and czgh < 'Z'
"
PRC_AUTO_RUN	PROCEDURE	57	"                                    and czgh >= 'B') x,
"
PRC_AUTO_RUN	PROCEDURE	58	"                                auto_task_ywzx_send y
"
PRC_AUTO_RUN	PROCEDURE	59	"                         where instr(y.bz, x.yyxh) > 0
"
PRC_AUTO_RUN	PROCEDURE	60	"                           and y.date_add > sysdate - 0.015
"
PRC_AUTO_RUN	PROCEDURE	61	"                           and nvl(x.lxdh, '13777929515') = y.lxdh);
"
PRC_AUTO_RUN	PROCEDURE	62	"
"
PRC_AUTO_RUN	PROCEDURE	63	"  --挂号费未缴费提醒1
"
PRC_AUTO_RUN	PROCEDURE	64	"  cursor cur_zlf is
"
PRC_AUTO_RUN	PROCEDURE	65	"    select c.jzkh
"
PRC_AUTO_RUN	PROCEDURE	66	"      From yj_yjk1 a, yj_Yjk2 b, zj_jzxx c
"
PRC_AUTO_RUN	PROCEDURE	67	"     where a.jzxh = c.jzxh
"
PRC_AUTO_RUN	PROCEDURE	68	"       and a.yjsb = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	69	"       and a.sfsb is null
"
PRC_AUTO_RUN	PROCEDURE	70	"       and a.brxh is null
"
PRC_AUTO_RUN	PROCEDURE	71	"       and instr(nvl(b.bz, '0'), '#未缴纳提醒1#') = 0
"
PRC_AUTO_RUN	PROCEDURE	72	"       and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	73	"       and c.jzrq > (sysdate - 0.021 - 0.1)
"
PRC_AUTO_RUN	PROCEDURE	74	"       and c.jzrq < sysdate - 0.021
"
PRC_AUTO_RUN	PROCEDURE	75	"       and c.jzkh = '9'
"
PRC_AUTO_RUN	PROCEDURE	76	"     group by c.jzkh
"
PRC_AUTO_RUN	PROCEDURE	77	"    having sum(sl) > 0;
"
PRC_AUTO_RUN	PROCEDURE	78	"
"
PRC_AUTO_RUN	PROCEDURE	79	"  --挂号费未缴费提醒 2天
"
PRC_AUTO_RUN	PROCEDURE	80	"  cursor cur_zlf_2days is
"
PRC_AUTO_RUN	PROCEDURE	81	"    select distinct (c.jzkh)
"
PRC_AUTO_RUN	PROCEDURE	82	"      From yj_yjk1 a, yj_Yjk2 b, zj_jzxx c
"
PRC_AUTO_RUN	PROCEDURE	83	"     where a.jzxh = c.jzxh
"
PRC_AUTO_RUN	PROCEDURE	84	"       and a.yjsb = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	85	"       and a.sfsb is null
"
PRC_AUTO_RUN	PROCEDURE	86	"       and a.brxh is null
"
PRC_AUTO_RUN	PROCEDURE	87	"       and instr(nvl(b.bz, '0'), '#未缴纳提醒1#') > 0
"
PRC_AUTO_RUN	PROCEDURE	88	"       and instr(nvl(b.bz, '0'), '#未缴纳提醒2#') = 0
"
PRC_AUTO_RUN	PROCEDURE	89	"       and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	90	"       and c.jzrq >= trunc(sysdate - 3)
"
PRC_AUTO_RUN	PROCEDURE	91	"       and c.jzrq < trunc(sysdate - 2)
"
PRC_AUTO_RUN	PROCEDURE	92	"       and c.jzkh = '9';
"
PRC_AUTO_RUN	PROCEDURE	93	"
"
PRC_AUTO_RUN	PROCEDURE	94	"  ---- 疫苗提醒    
"
PRC_AUTO_RUN	PROCEDURE	95	"  cursor cur_sms_yimao is
"
PRC_AUTO_RUN	PROCEDURE	96	"    select distinct a.jzkh, b.ypxh, b.ypcddm
"
PRC_AUTO_RUN	PROCEDURE	97	"      From mz_cfk1 a, mz_cfk2 b
"
PRC_AUTO_RUN	PROCEDURE	98	"     where a.cfsb = b.cfsb
"
PRC_AUTO_RUN	PROCEDURE	99	"       and trunc(b.shenhesj) = trunc(sysdate + 1)
"
PRC_AUTO_RUN	PROCEDURE	100	"       and b.shenhesj is not null
"
PRC_AUTO_RUN	PROCEDURE	101	"       and a.sfsb is not null
"
PRC_AUTO_RUN	PROCEDURE	102	"       and a.cfrq > sysdate - 360;
"
PRC_AUTO_RUN	PROCEDURE	103	"
"
PRC_AUTO_RUN	PROCEDURE	104	"Begin
"
PRC_AUTO_RUN	PROCEDURE	105	"  --2020-06-25
"
PRC_AUTO_RUN	PROCEDURE	106	"  v_Procedure_Name := '后台执行_PRC_AUTO_RUN';
"
PRC_AUTO_RUN	PROCEDURE	107	"  v_task           := ' ';
"
PRC_AUTO_RUN	PROCEDURE	108	"  lxdh             := '13777929515';
"
PRC_AUTO_RUN	PROCEDURE	109	"  v_count          := 0;
"
PRC_AUTO_RUN	PROCEDURE	110	"  /*  insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	111	"    (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN	PROCEDURE	112	"  values
"
PRC_AUTO_RUN	PROCEDURE	113	"    (v_Procedure_Name, '开始', 0);
"
PRC_AUTO_RUN	PROCEDURE	114	"  commit;*/
"
PRC_AUTO_RUN	PROCEDURE	115	"
"
PRC_AUTO_RUN	PROCEDURE	116	"  select to_char(sysdate, 'hh24:mi'),
"
PRC_AUTO_RUN	PROCEDURE	117	"         substr(to_char(sysdate, 'hh24:mi'), 5, 1)
"
PRC_AUTO_RUN	PROCEDURE	118	"    into ls_now, ls_now_minue
"
PRC_AUTO_RUN	PROCEDURE	119	"    from dual;
"
PRC_AUTO_RUN	PROCEDURE	120	"
"
PRC_AUTO_RUN	PROCEDURE	121	"  if 1 = 0 and ((ls_now >= '23:58' and ls_now <= '23:59')) then
"
PRC_AUTO_RUN	PROCEDURE	122	"    update gh_mzlbk set zlf = 0.01, zlf_et = 0.01 where mzlbxh > 0;
"
PRC_AUTO_RUN	PROCEDURE	123	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	124	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	125	"      prc_sms_send('ts', '13777929515', 'gh_mzlbk=0.01 ok', v_bz);
"
PRC_AUTO_RUN	PROCEDURE	126	"    else
"
PRC_AUTO_RUN	PROCEDURE	127	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	128	"      prc_sms_send('ts', '13777929515', 'gh_mzlbk=0.01 error', v_bz);
"
PRC_AUTO_RUN	PROCEDURE	129	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	130	"  
"
PRC_AUTO_RUN	PROCEDURE	131	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	132	"
"
PRC_AUTO_RUN	PROCEDURE	133	"  -- 住院病人现金与预交款不一致
"
PRC_AUTO_RUN	PROCEDURE	134	"  if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	135	"  
"
PRC_AUTO_RUN	PROCEDURE	136	"    select count(patient_no)
"
PRC_AUTO_RUN	PROCEDURE	137	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	138	"      from (select patient_no,
"
PRC_AUTO_RUN	PROCEDURE	139	"                   t.zf_fee -
"
PRC_AUTO_RUN	PROCEDURE	140	"                   ((select nvl(sum(amount), 0)
"
PRC_AUTO_RUN	PROCEDURE	141	"                       from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	142	"                      where patient_No = t.patient_no
"
PRC_AUTO_RUN	PROCEDURE	143	"                        and js_No = 1) + nvl(pay_xj, 0) + nvl(pay_zp, 0) -
"
PRC_AUTO_RUN	PROCEDURE	144	"                   nvl(return_xj, 0) - nvl(return_zp, 0)) je
"
PRC_AUTO_RUN	PROCEDURE	145	"            
"
PRC_AUTO_RUN	PROCEDURE	146	"              From zy_total_fee t
"
PRC_AUTO_RUN	PROCEDURE	147	"             where jz_date > sysdate - 0.1
"
PRC_AUTO_RUN	PROCEDURE	148	"               and js_NO = 1)
"
PRC_AUTO_RUN	PROCEDURE	149	"     where je <> 0;
"
PRC_AUTO_RUN	PROCEDURE	150	"    if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	151	"      prc_sms_send('ts',
"
PRC_AUTO_RUN	PROCEDURE	152	"                   '13777929515',
"
PRC_AUTO_RUN	PROCEDURE	153	"                   '住院病人现金与预交款不一致[prc_auto_run]',
"
PRC_AUTO_RUN	PROCEDURE	154	"                   v_bz);
"
PRC_AUTO_RUN	PROCEDURE	155	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	156	"  
"
PRC_AUTO_RUN	PROCEDURE	157	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	158	"
"
PRC_AUTO_RUN	PROCEDURE	159	"  --人工电话预约 漏发短信
"
PRC_AUTO_RUN	PROCEDURE	160	"  IF 1 = 1 THEN
"
PRC_AUTO_RUN	PROCEDURE	161	"  
"
PRC_AUTO_RUN	PROCEDURE	162	"    open cur_mzyyk;
"
PRC_AUTO_RUN	PROCEDURE	163	"    loop
"
PRC_AUTO_RUN	PROCEDURE	164	"      fetch cur_mzyyk
"
PRC_AUTO_RUN	PROCEDURE	165	"        into v_yyxh;
"
PRC_AUTO_RUN	PROCEDURE	166	"    
"
PRC_AUTO_RUN	PROCEDURE	167	"      exit when cur_mzyyk%NOTFOUND;
"
PRC_AUTO_RUN	PROCEDURE	168	"      select nvl(lxdh, '13777929515'),
"
PRC_AUTO_RUN	PROCEDURE	169	"             '就诊科室:' || (select ksmc from gy_ksdm where ksdm = t.ksdm) || ' ' ||
"
PRC_AUTO_RUN	PROCEDURE	170	"             (select '就诊医师:' || xm from gy_zgxx where zgid = ysgh) ||
"
PRC_AUTO_RUN	PROCEDURE	171	"             ',预约号为:' || yyxh || ',预约日期' || to_char(yyrq1, 'yyyy-mm-dd') ||
"
PRC_AUTO_RUN	PROCEDURE	172	"             decode(yysj, 1, '上午', '下午') || ghxh || '号'
"
PRC_AUTO_RUN	PROCEDURE	173	"        into v_lxdh, v_msg
"
PRC_AUTO_RUN	PROCEDURE	174	"        from gh_mzyyk t
"
PRC_AUTO_RUN	PROCEDURE	175	"       where yyxh = v_yyxh;
"
PRC_AUTO_RUN	PROCEDURE	176	"      --v_lxdh := '13777929515';
"
PRC_AUTO_RUN	PROCEDURE	177	"      prc_sms_send('gh', v_lxdh, v_msg, v_temp);
"
PRC_AUTO_RUN	PROCEDURE	178	"    
"
PRC_AUTO_RUN	PROCEDURE	179	"    end loop;
"
PRC_AUTO_RUN	PROCEDURE	180	"    close cur_mzyyk;
"
PRC_AUTO_RUN	PROCEDURE	181	"  
"
PRC_AUTO_RUN	PROCEDURE	182	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	183	"  -- end 人工电话预约 漏发短信
"
PRC_AUTO_RUN	PROCEDURE	184	"
"
PRC_AUTO_RUN	PROCEDURE	185	"  -- 短信提醒 费用未缴纳
"
PRC_AUTO_RUN	PROCEDURE	186	"  if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	187	"  
"
PRC_AUTO_RUN	PROCEDURE	188	"    open cur_zlf;
"
PRC_AUTO_RUN	PROCEDURE	189	"    loop
"
PRC_AUTO_RUN	PROCEDURE	190	"      fetch cur_zlf
"
PRC_AUTO_RUN	PROCEDURE	191	"        into v_jzkh;
"
PRC_AUTO_RUN	PROCEDURE	192	"    
"
PRC_AUTO_RUN	PROCEDURE	193	"      exit when cur_zlf%NOTFOUND;
"
PRC_AUTO_RUN	PROCEDURE	194	"      select trim(lxdh),
"
PRC_AUTO_RUN	PROCEDURE	195	"             xm || ' 您好！您是否还有费用未缴纳，请核实。若已缴或短信误发敬请忽略！'
"
PRC_AUTO_RUN	PROCEDURE	196	"        into v_lxdh, v_msg
"
PRC_AUTO_RUN	PROCEDURE	197	"        from gy_brjbxxk
"
PRC_AUTO_RUN	PROCEDURE	198	"       where jzkh = v_jzkh;
"
PRC_AUTO_RUN	PROCEDURE	199	"      --v_lxdh := '13777929515';
"
PRC_AUTO_RUN	PROCEDURE	200	"    
"
PRC_AUTO_RUN	PROCEDURE	201	"      update yj_Yjk2
"
PRC_AUTO_RUN	PROCEDURE	202	"         set bz = bz || '#未缴纳提醒1#,'
"
PRC_AUTO_RUN	PROCEDURE	203	"       where fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	204	"         and yjsb in (
"
PRC_AUTO_RUN	PROCEDURE	205	"                      
"
PRC_AUTO_RUN	PROCEDURE	206	"                      select a.yjsb
"
PRC_AUTO_RUN	PROCEDURE	207	"                        from yj_Yjk1 a, yj_Yjk2 b, zj_jzxx c
"
PRC_AUTO_RUN	PROCEDURE	208	"                       where a.jzxh = c.jzxh
"
PRC_AUTO_RUN	PROCEDURE	209	"                         and a.yjsb = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	210	"                         and a.sfsb is null
"
PRC_AUTO_RUN	PROCEDURE	211	"                         and a.brxh is null
"
PRC_AUTO_RUN	PROCEDURE	212	"                         and instr(nvl(b.bz, '0'), '#未缴纳提醒1#') = 0
"
PRC_AUTO_RUN	PROCEDURE	213	"                         and sl > 0
"
PRC_AUTO_RUN	PROCEDURE	214	"                         and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	215	"                         and c.jzrq > (sysdate - 0.5)
"
PRC_AUTO_RUN	PROCEDURE	216	"                         and c.jzrq < sysdate - 0.021
"
PRC_AUTO_RUN	PROCEDURE	217	"                         and c.jzkh = v_jzkh);
"
PRC_AUTO_RUN	PROCEDURE	218	"    
"
PRC_AUTO_RUN	PROCEDURE	219	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	220	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	221	"      
"
PRC_AUTO_RUN	PROCEDURE	222	"        prc_sms_send('未缴纳提醒', v_lxdh, v_msg, v_temp);
"
PRC_AUTO_RUN	PROCEDURE	223	"      else
"
PRC_AUTO_RUN	PROCEDURE	224	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	225	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	226	"    end loop;
"
PRC_AUTO_RUN	PROCEDURE	227	"    close cur_zlf;
"
PRC_AUTO_RUN	PROCEDURE	228	"  
"
PRC_AUTO_RUN	PROCEDURE	229	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	230	"  -- end  短信提醒 费用未缴纳
"
PRC_AUTO_RUN	PROCEDURE	231	"
"
PRC_AUTO_RUN	PROCEDURE	232	"  --   短信提醒 2天 费用未缴纳
"
PRC_AUTO_RUN	PROCEDURE	233	"  if 1 = 1 and ((ls_now > '08:00' and ls_now <= '08:01')) then
"
PRC_AUTO_RUN	PROCEDURE	234	"  
"
PRC_AUTO_RUN	PROCEDURE	235	"    open cur_zlf_2days;
"
PRC_AUTO_RUN	PROCEDURE	236	"    loop
"
PRC_AUTO_RUN	PROCEDURE	237	"      fetch cur_zlf_2days
"
PRC_AUTO_RUN	PROCEDURE	238	"        into v_jzkh;
"
PRC_AUTO_RUN	PROCEDURE	239	"    
"
PRC_AUTO_RUN	PROCEDURE	240	"      exit when cur_zlf_2days%NOTFOUND;
"
PRC_AUTO_RUN	PROCEDURE	241	"      select trim(lxdh),
"
PRC_AUTO_RUN	PROCEDURE	242	"             xm ||
"
PRC_AUTO_RUN	PROCEDURE	243	"              ' 亲爱的病友，您好！您近期在我院就诊时，部分诊疗费用尚未结清，
"
PRC_AUTO_RUN	PROCEDURE	244	"请您尽快到院进行结算，以免对您的后续诊疗及个人信用产生不良影响。感谢您的配合，祝您早日康复！若已缴或短信误发敬请忽略！'
"
PRC_AUTO_RUN	PROCEDURE	245	"        into v_lxdh, v_msg
"
PRC_AUTO_RUN	PROCEDURE	246	"        from gy_brjbxxk
"
PRC_AUTO_RUN	PROCEDURE	247	"       where jzkh = v_jzkh;
"
PRC_AUTO_RUN	PROCEDURE	248	"    
"
PRC_AUTO_RUN	PROCEDURE	249	"      update yj_Yjk2
"
PRC_AUTO_RUN	PROCEDURE	250	"         set bz = bz || '#未缴纳提醒2#,'
"
PRC_AUTO_RUN	PROCEDURE	251	"       where fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	252	"         and yjsb in (select a.yjsb
"
PRC_AUTO_RUN	PROCEDURE	253	"                        from yj_Yjk1 a, yj_Yjk2 b, zj_jzxx c
"
PRC_AUTO_RUN	PROCEDURE	254	"                       where a.jzxh = c.jzxh
"
PRC_AUTO_RUN	PROCEDURE	255	"                         and a.yjsb = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	256	"                         and a.sfsb is null
"
PRC_AUTO_RUN	PROCEDURE	257	"                         and a.brxh is null
"
PRC_AUTO_RUN	PROCEDURE	258	"                         and instr(nvl(b.bz, '0'), '#未缴纳提醒1#') > 0
"
PRC_AUTO_RUN	PROCEDURE	259	"                         and instr(nvl(b.bz, '0'), '#未缴纳提醒2#') = 0
"
PRC_AUTO_RUN	PROCEDURE	260	"                         and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	261	"                         and b.sl > 0
"
PRC_AUTO_RUN	PROCEDURE	262	"                         and c.jzrq >= trunc(sysdate - 3)
"
PRC_AUTO_RUN	PROCEDURE	263	"                         and c.jzrq < trunc(sysdate - 2)
"
PRC_AUTO_RUN	PROCEDURE	264	"                         and c.jzkh = v_jzkh);
"
PRC_AUTO_RUN	PROCEDURE	265	"    
"
PRC_AUTO_RUN	PROCEDURE	266	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	267	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	268	"      
"
PRC_AUTO_RUN	PROCEDURE	269	"        prc_sms_send('未缴纳提醒', v_lxdh, v_msg, v_temp);
"
PRC_AUTO_RUN	PROCEDURE	270	"      else
"
PRC_AUTO_RUN	PROCEDURE	271	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	272	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	273	"    end loop;
"
PRC_AUTO_RUN	PROCEDURE	274	"    close cur_zlf_2days;
"
PRC_AUTO_RUN	PROCEDURE	275	"  
"
PRC_AUTO_RUN	PROCEDURE	276	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	277	"  -- end  短信提醒 2天 费用未缴纳
"
PRC_AUTO_RUN	PROCEDURE	278	"
"
PRC_AUTO_RUN	PROCEDURE	279	"  --  疫苗  短信提醒
"
PRC_AUTO_RUN	PROCEDURE	280	"
"
PRC_AUTO_RUN	PROCEDURE	281	"  if 1 = 1 and ((ls_now > '08:05' and ls_now <= '08:06')) then
"
PRC_AUTO_RUN	PROCEDURE	282	"  
"
PRC_AUTO_RUN	PROCEDURE	283	"    -- select distinct a.jzkh, b.ypxh,b.ypcddm      
"
PRC_AUTO_RUN	PROCEDURE	284	"  
"
PRC_AUTO_RUN	PROCEDURE	285	"    open cur_sms_yimao;
"
PRC_AUTO_RUN	PROCEDURE	286	"    loop
"
PRC_AUTO_RUN	PROCEDURE	287	"      fetch cur_sms_yimao
"
PRC_AUTO_RUN	PROCEDURE	288	"        into v_jzkh, v_ypxh, v_ypcddm;
"
PRC_AUTO_RUN	PROCEDURE	289	"    
"
PRC_AUTO_RUN	PROCEDURE	290	"      exit when cur_sms_yimao%NOTFOUND;
"
PRC_AUTO_RUN	PROCEDURE	291	"      select trim(lxdh),
"
PRC_AUTO_RUN	PROCEDURE	292	"             xm || ' 亲爱的病友，您好！明天有预约疫苗接种！若已处理或短信误发敬请忽略！'
"
PRC_AUTO_RUN	PROCEDURE	293	"        into v_lxdh, v_msg
"
PRC_AUTO_RUN	PROCEDURE	294	"        from gy_brjbxxk
"
PRC_AUTO_RUN	PROCEDURE	295	"       where jzkh = v_jzkh;
"
PRC_AUTO_RUN	PROCEDURE	296	"      prc_sms_send('未缴纳提醒', v_lxdh, v_msg, v_temp);
"
PRC_AUTO_RUN	PROCEDURE	297	"    
"
PRC_AUTO_RUN	PROCEDURE	298	"    end loop;
"
PRC_AUTO_RUN	PROCEDURE	299	"    close cur_sms_yimao;
"
PRC_AUTO_RUN	PROCEDURE	300	"  
"
PRC_AUTO_RUN	PROCEDURE	301	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	302	"  -- end  疫苗  短信提醒
"
PRC_AUTO_RUN	PROCEDURE	303	"
"
PRC_AUTO_RUN	PROCEDURE	304	"  --  本院核酸收费标志 
"
PRC_AUTO_RUN	PROCEDURE	305	"
"
PRC_AUTO_RUN	PROCEDURE	306	"  if 1 = 1 and ((ls_now > '08:27' and ls_now <= '08:28')) then
"
PRC_AUTO_RUN	PROCEDURE	307	"  
"
PRC_AUTO_RUN	PROCEDURE	308	"    update l_patientinfo
"
PRC_AUTO_RUN	PROCEDURE	309	"       set feestatus = 6
"
PRC_AUTO_RUN	PROCEDURE	310	"     where feestatus = 1
"
PRC_AUTO_RUN	PROCEDURE	311	"       and patientid like 'BY%'
"
PRC_AUTO_RUN	PROCEDURE	312	"       and sampleno >= to_char(sysdate - 7, 'yyyymmdd');
"
PRC_AUTO_RUN	PROCEDURE	313	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	314	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	315	"    else
"
PRC_AUTO_RUN	PROCEDURE	316	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	317	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	318	"  
"
PRC_AUTO_RUN	PROCEDURE	319	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	320	"  -- end  本院核酸收费标志 
"
PRC_AUTO_RUN	PROCEDURE	321	"
"
PRC_AUTO_RUN	PROCEDURE	322	"  --zfl=0.01
"
PRC_AUTO_RUN	PROCEDURE	323	"  if 1 = 0 and (((ls_now > '06:01' and ls_now <= '06:02')) or
"
PRC_AUTO_RUN	PROCEDURE	324	"     ((ls_now > '06:11' and ls_now <= '06:12'))) then
"
PRC_AUTO_RUN	PROCEDURE	325	"  
"
PRC_AUTO_RUN	PROCEDURE	326	"    update gh_mzlbk
"
PRC_AUTO_RUN	PROCEDURE	327	"       set zlf = 0.01, zlf_et = 0.01
"
PRC_AUTO_RUN	PROCEDURE	328	"     where mzlbxh not in (2, 6, 7)
"
PRC_AUTO_RUN	PROCEDURE	329	"       and mzlbxh = 0
"
PRC_AUTO_RUN	PROCEDURE	330	"       and (zlf > 1 or zlf_et > 1)
"
PRC_AUTO_RUN	PROCEDURE	331	"       and to_char(sysdate, 'yyyymmdd') = '20210110';
"
PRC_AUTO_RUN	PROCEDURE	332	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	333	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	334	"    
"
PRC_AUTO_RUN	PROCEDURE	335	"    else
"
PRC_AUTO_RUN	PROCEDURE	336	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	337	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	338	"  
"
PRC_AUTO_RUN	PROCEDURE	339	"    select count(*)
"
PRC_AUTO_RUN	PROCEDURE	340	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	341	"      from gh_mzlbk
"
PRC_AUTO_RUN	PROCEDURE	342	"     where (zlf > 1 or zlf_et > 1);
"
PRC_AUTO_RUN	PROCEDURE	343	"    select '不免费挂号类别:' || v_count into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	344	"    prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	345	"  
"
PRC_AUTO_RUN	PROCEDURE	346	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	347	"  -- end zfl=0.01
"
PRC_AUTO_RUN	PROCEDURE	348	"
"
PRC_AUTO_RUN	PROCEDURE	349	"  --dj<0 fjxx=074
"
PRC_AUTO_RUN	PROCEDURE	350	"  if 0 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	351	"    select count(a.yjsb)
"
PRC_AUTO_RUN	PROCEDURE	352	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	353	"      From yj_Yjk1 A, YJ_YJK2 B
"
PRC_AUTO_RUN	PROCEDURE	354	"     where A.YJSB = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	355	"       and b.dj < 0.1
"
PRC_AUTO_RUN	PROCEDURE	356	"       and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	357	"       and a. SFSB IN (SELECT SFSB
"
PRC_AUTO_RUN	PROCEDURE	358	"                      fROM mz_mzsfk1 t
"
PRC_AUTO_RUN	PROCEDURE	359	"                     where sfrq > sysdate - 0.001
"
PRC_AUTO_RUN	PROCEDURE	360	"                       and czgh in ('AUTO5', 'AUTO1')
"
PRC_AUTO_RUN	PROCEDURE	361	"                       and fjxx >= '073');
"
PRC_AUTO_RUN	PROCEDURE	362	"  
"
PRC_AUTO_RUN	PROCEDURE	363	"    if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	364	"      select 'dj<0, fjxx=074, fygl=13,sl=' || v_count into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	365	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	366	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	367	"  
"
PRC_AUTO_RUN	PROCEDURE	368	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	369	"  if 0 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	370	"  
"
PRC_AUTO_RUN	PROCEDURE	371	"    SELECT nvl(TO_CHAR(wm_concat(('073 _ ' || t.ipaddress))), '0')
"
PRC_AUTO_RUN	PROCEDURE	372	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	373	"      fROM mz_mzsfk1 t
"
PRC_AUTO_RUN	PROCEDURE	374	"     where sfrq > sysdate - 0.001
"
PRC_AUTO_RUN	PROCEDURE	375	"       and fjxx = '073';
"
PRC_AUTO_RUN	PROCEDURE	376	"    if length(nr) > 2 then
"
PRC_AUTO_RUN	PROCEDURE	377	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	378	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	379	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	380	"
"
PRC_AUTO_RUN	PROCEDURE	381	"  if 0 = 0 then
"
PRC_AUTO_RUN	PROCEDURE	382	"  
"
PRC_AUTO_RUN	PROCEDURE	383	"    select nvl(to_char(wm_concat(object_name)), '')
"
PRC_AUTO_RUN	PROCEDURE	384	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	385	"      from v_system_view_fail;
"
PRC_AUTO_RUN	PROCEDURE	386	"    if length(nr) > 1 then
"
PRC_AUTO_RUN	PROCEDURE	387	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	388	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	389	"  
"
PRC_AUTO_RUN	PROCEDURE	390	"    /*    select count(*)
"
PRC_AUTO_RUN	PROCEDURE	391	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	392	"      from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	393	"     where bz = 'auto_recompile_objs'
"
PRC_AUTO_RUN	PROCEDURE	394	"       and jyrq > sysdate - 0.01;
"
PRC_AUTO_RUN	PROCEDURE	395	"    
"
PRC_AUTO_RUN	PROCEDURE	396	"    if v_count = 0 then
"
PRC_AUTO_RUN	PROCEDURE	397	"      select 'auto_recompile_objs存储过程失效处理 无记录'
"
PRC_AUTO_RUN	PROCEDURE	398	"        into nr
"
PRC_AUTO_RUN	PROCEDURE	399	"        from dual;
"
PRC_AUTO_RUN	PROCEDURE	400	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	401	"    end if;*/
"
PRC_AUTO_RUN	PROCEDURE	402	"  
"
PRC_AUTO_RUN	PROCEDURE	403	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	404	"  -- 2020-06-01 免费检查
"
PRC_AUTO_RUN	PROCEDURE	405	"  if 0 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	406	"    select count(*)
"
PRC_AUTO_RUN	PROCEDURE	407	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	408	"      from temp_20200507_saicab t
"
PRC_AUTO_RUN	PROCEDURE	409	"     where jzrq > sysdate - 0.3;
"
PRC_AUTO_RUN	PROCEDURE	410	"    if v_count > 1 and v_count < 6 then
"
PRC_AUTO_RUN	PROCEDURE	411	"      /* v_sl_count := 0;
"
PRC_AUTO_RUN	PROCEDURE	412	"      select nvl(sum(sl), 0)
"
PRC_AUTO_RUN	PROCEDURE	413	"        into v_sl_count
"
PRC_AUTO_RUN	PROCEDURE	414	"        from temp_20200507_saicab
"
PRC_AUTO_RUN	PROCEDURE	415	"       where jzrq >= trunc(sysdate);*/
"
PRC_AUTO_RUN	PROCEDURE	416	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	417	"        select '2020-06-01 免费检查活动：' || v_count into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	418	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	419	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	420	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	421	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	422	"
"
PRC_AUTO_RUN	PROCEDURE	423	"  -- 2020-06-01 免费挂号
"
PRC_AUTO_RUN	PROCEDURE	424	"  if 0 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	425	"  
"
PRC_AUTO_RUN	PROCEDURE	426	"    select count(a.yjsb)
"
PRC_AUTO_RUN	PROCEDURE	427	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	428	"      From yj_Yjk1 A, YJ_YJK2 B
"
PRC_AUTO_RUN	PROCEDURE	429	"     where A.YJSB = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	430	"       and b.dj < 0.1
"
PRC_AUTO_RUN	PROCEDURE	431	"       and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	432	"       and a.kdsj > sysdate - 0.1;
"
PRC_AUTO_RUN	PROCEDURE	433	"  
"
PRC_AUTO_RUN	PROCEDURE	434	"    if v_count > 1 and v_count < 6 then
"
PRC_AUTO_RUN	PROCEDURE	435	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	436	"        select '2020-06-01 免费挂号活动：' || v_count into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	437	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	438	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	439	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	440	"  
"
PRC_AUTO_RUN	PROCEDURE	441	"    select count(a.yjsb)
"
PRC_AUTO_RUN	PROCEDURE	442	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	443	"      From yj_Yjk1 A, YJ_YJK2 B
"
PRC_AUTO_RUN	PROCEDURE	444	"     where A.YJSB = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	445	"       and a.sjksdm not in (select ksdm from gh_jjr_ksdm)
"
PRC_AUTO_RUN	PROCEDURE	446	"          
"
PRC_AUTO_RUN	PROCEDURE	447	"       and b.dj < 0.1
"
PRC_AUTO_RUN	PROCEDURE	448	"       and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	449	"       and a.kdsj > sysdate - 0.1;
"
PRC_AUTO_RUN	PROCEDURE	450	"  
"
PRC_AUTO_RUN	PROCEDURE	451	"    if v_count > 1 and v_count < 6 then
"
PRC_AUTO_RUN	PROCEDURE	452	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	453	"        select '2020-06-01 not ksdm 免费挂号活动：' || v_count
"
PRC_AUTO_RUN	PROCEDURE	454	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	455	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	456	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	457	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	458	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	459	"  
"
PRC_AUTO_RUN	PROCEDURE	460	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	461	"
"
PRC_AUTO_RUN	PROCEDURE	462	"  --新型冠状病毒核酸检测 待复查 转发
"
PRC_AUTO_RUN	PROCEDURE	463	"  if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	464	"    v_xh       := 1;
"
PRC_AUTO_RUN	PROCEDURE	465	"    v_sl_count := 0;
"
PRC_AUTO_RUN	PROCEDURE	466	"    while v_xh > 0 loop
"
PRC_AUTO_RUN	PROCEDURE	467	"    
"
PRC_AUTO_RUN	PROCEDURE	468	"      v_sl_count := v_sl_count + 1;
"
PRC_AUTO_RUN	PROCEDURE	469	"      if v_sl_count > 6 then
"
PRC_AUTO_RUN	PROCEDURE	470	"        exit;
"
PRC_AUTO_RUN	PROCEDURE	471	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	472	"      select nvl(max(xh), 0)
"
PRC_AUTO_RUN	PROCEDURE	473	"        into v_xh
"
PRC_AUTO_RUN	PROCEDURE	474	"        from auto_task_ywzx_send
"
PRC_AUTO_RUN	PROCEDURE	475	"       where date_send > sysdate - 0.1
"
PRC_AUTO_RUN	PROCEDURE	476	"         and instr(bz, '转发') = 0
"
PRC_AUTO_RUN	PROCEDURE	477	"         and instr(bz, 'IgM') > 0
"
PRC_AUTO_RUN	PROCEDURE	478	"         and instr(bz, '待复查') > 0
"
PRC_AUTO_RUN	PROCEDURE	479	"         and instr(bz, '新型冠状病毒') > 0
"
PRC_AUTO_RUN	PROCEDURE	480	"         and laborder > 0;
"
PRC_AUTO_RUN	PROCEDURE	481	"      if v_xh > 0 then
"
PRC_AUTO_RUN	PROCEDURE	482	"      
"
PRC_AUTO_RUN	PROCEDURE	483	"        select bz, nvl(laborder, 0)
"
PRC_AUTO_RUN	PROCEDURE	484	"          into nr, v_laborder
"
PRC_AUTO_RUN	PROCEDURE	485	"          from auto_task_ywzx_send
"
PRC_AUTO_RUN	PROCEDURE	486	"         where xh = v_xh;
"
PRC_AUTO_RUN	PROCEDURE	487	"      
"
PRC_AUTO_RUN	PROCEDURE	488	"        select nvl(max(y.lxdh), '无')
"
PRC_AUTO_RUN	PROCEDURE	489	"          into v_temp
"
PRC_AUTO_RUN	PROCEDURE	490	"          from l_patientinfo t, gy_brjbxxk y
"
PRC_AUTO_RUN	PROCEDURE	491	"         where t.patientid = y.jzkh
"
PRC_AUTO_RUN	PROCEDURE	492	"           and t.stayhospitalmode = 1
"
PRC_AUTO_RUN	PROCEDURE	493	"           and t.doctadviseno > 0
"
PRC_AUTO_RUN	PROCEDURE	494	"           and t.doctadviseno = v_laborder;
"
PRC_AUTO_RUN	PROCEDURE	495	"      
"
PRC_AUTO_RUN	PROCEDURE	496	"        select nr || ',患者联系电话:' || v_temp into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	497	"      
"
PRC_AUTO_RUN	PROCEDURE	498	"        -- select bz into nr from auto_task_ywzx_send where xh = v_xh;
"
PRC_AUTO_RUN	PROCEDURE	499	"        --  prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	500	"        prc_sms_send('ts', '13735759506', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	501	"        prc_sms_send('ts', '13867936636', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	502	"        prc_sms_send('ts', '15825760232', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	503	"        prc_sms_send('ts', '18458034799', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	504	"        update auto_task_ywzx_send set bz = bz || '[转发]' where xh = v_xh;
"
PRC_AUTO_RUN	PROCEDURE	505	"        if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	506	"          commit;
"
PRC_AUTO_RUN	PROCEDURE	507	"        else
"
PRC_AUTO_RUN	PROCEDURE	508	"          rollback;
"
PRC_AUTO_RUN	PROCEDURE	509	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	510	"      
"
PRC_AUTO_RUN	PROCEDURE	511	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	512	"    end loop;
"
PRC_AUTO_RUN	PROCEDURE	513	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	514	"
"
PRC_AUTO_RUN	PROCEDURE	515	"  --新型冠状病毒核酸检测 待复查 转发 end 
"
PRC_AUTO_RUN	PROCEDURE	516	"
"
PRC_AUTO_RUN	PROCEDURE	517	"  -- 'ylsbgl.wz_nzwcgsqxx 高值计费 老系统记录'
"
PRC_AUTO_RUN	PROCEDURE	518	"  /*  if 0 = 0 then
"
PRC_AUTO_RUN	PROCEDURE	519	"    select count(*)
"
PRC_AUTO_RUN	PROCEDURE	520	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	521	"      From ylsbgl.wz_nzwcgsqxx a
"
PRC_AUTO_RUN	PROCEDURE	522	"     where sqrq > sysdate - 0.1;
"
PRC_AUTO_RUN	PROCEDURE	523	"  
"
PRC_AUTO_RUN	PROCEDURE	524	"    if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	525	"      select 'ylsbgl.wz_nzwcgsqxx 高值计费 老系统记录' into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	526	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	527	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	528	"  end if;*/
"
PRC_AUTO_RUN	PROCEDURE	529	"
"
PRC_AUTO_RUN	PROCEDURE	530	"  --'抗菌药物停止通知'
"
PRC_AUTO_RUN	PROCEDURE	531	"  if 1 = 1 and ((ls_now > '07:40' and ls_now <= '07:41') or
"
PRC_AUTO_RUN	PROCEDURE	532	"     (ls_now > '08:40' and ls_now <= '08:41') or
"
PRC_AUTO_RUN	PROCEDURE	533	"     (ls_now > '09:40' and ls_now <= '09:41') or
"
PRC_AUTO_RUN	PROCEDURE	534	"     (ls_now > '10:40' and ls_now <= '10:41') or
"
PRC_AUTO_RUN	PROCEDURE	535	"     (ls_now > '11:40' and ls_now <= '11:41') or
"
PRC_AUTO_RUN	PROCEDURE	536	"     (ls_now > '12:40' and ls_now <= '12:41') or
"
PRC_AUTO_RUN	PROCEDURE	537	"     (ls_now > '13:40' and ls_now <= '13:41') or
"
PRC_AUTO_RUN	PROCEDURE	538	"     (ls_now > '14:40' and ls_now <= '14:41') or
"
PRC_AUTO_RUN	PROCEDURE	539	"     (ls_now > '15:40' and ls_now <= '15:41') or
"
PRC_AUTO_RUN	PROCEDURE	540	"     (ls_now > '16:40' and ls_now <= '16:41') or
"
PRC_AUTO_RUN	PROCEDURE	541	"     (ls_now > '17:40' and ls_now <= '17:41') or
"
PRC_AUTO_RUN	PROCEDURE	542	"     (ls_now > '19:40' and ls_now <= '19:41') or
"
PRC_AUTO_RUN	PROCEDURE	543	"     
"
PRC_AUTO_RUN	PROCEDURE	544	"     (ls_now > '21:40' and ls_now <= '21:41')) then
"
PRC_AUTO_RUN	PROCEDURE	545	"  
"
PRC_AUTO_RUN	PROCEDURE	546	"    --留义温暖基金
"
PRC_AUTO_RUN	PROCEDURE	547	"    if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	548	"    
"
PRC_AUTO_RUN	PROCEDURE	549	"      select to_char(nvl(wm_concat('留义温暖基金 ' || fs || ':' || je), '0'))
"
PRC_AUTO_RUN	PROCEDURE	550	"        into nr
"
PRC_AUTO_RUN	PROCEDURE	551	"        from (select decode(depo_type, 1, '现金', 2, '支票', '其它方式') fs,
"
PRC_AUTO_RUN	PROCEDURE	552	"                     sum(amount) je
"
PRC_AUTO_RUN	PROCEDURE	553	"                from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	554	"               where depo_date > sysdate - 0.2
"
PRC_AUTO_RUN	PROCEDURE	555	"                 and op_Id = 'AU002'
"
PRC_AUTO_RUN	PROCEDURE	556	"               group by depo_type);
"
PRC_AUTO_RUN	PROCEDURE	557	"    
"
PRC_AUTO_RUN	PROCEDURE	558	"      if length(nr) > 5 then
"
PRC_AUTO_RUN	PROCEDURE	559	"        prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	560	"      
"
PRC_AUTO_RUN	PROCEDURE	561	"        select to_char(nvl(wm_concat('留义温暖基金大于1000 ' || to_char(patient_no）), '0')) into nr from (select patient_no
"
PRC_AUTO_RUN	PROCEDURE	562	"                                                                                                    from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	563	"                                                                                                   where patient_No in
"
PRC_AUTO_RUN	PROCEDURE	564	"                                                                                                         (select patient_no
"
PRC_AUTO_RUN	PROCEDURE	565	"                                                                                                            from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	566	"                                                                                                           where depo_date >
"
PRC_AUTO_RUN	PROCEDURE	567	"                                                                                                                 sysdate - 0.2
"
PRC_AUTO_RUN	PROCEDURE	568	"                                                                                                             and op_Id =
"
PRC_AUTO_RUN	PROCEDURE	569	"                                                                                                                 'AU002')
"
PRC_AUTO_RUN	PROCEDURE	570	"                                                                                                     and op_Id =
"
PRC_AUTO_RUN	PROCEDURE	571	"                                                                                                         'AU002'
"
PRC_AUTO_RUN	PROCEDURE	572	"                                                                                                   group by patient_no
"
PRC_AUTO_RUN	PROCEDURE	573	"                                                                                                  having sum(amount) > 1000);
"
PRC_AUTO_RUN	PROCEDURE	574	"      
"
PRC_AUTO_RUN	PROCEDURE	575	"        if length(nr) > 2 then
"
PRC_AUTO_RUN	PROCEDURE	576	"          prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	577	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	578	"      
"
PRC_AUTO_RUN	PROCEDURE	579	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	580	"    
"
PRC_AUTO_RUN	PROCEDURE	581	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	582	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	583	"        from (select (select nvl(to_char(cwfp_date, 'yyyymmdd'), '20210101')
"
PRC_AUTO_RUN	PROCEDURE	584	"                        from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	585	"                       where patient_no = t.patient_no) rq
"
PRC_AUTO_RUN	PROCEDURE	586	"                From zy_deposit_file t
"
PRC_AUTO_RUN	PROCEDURE	587	"               where patient_no <> 851509
"
PRC_AUTO_RUN	PROCEDURE	588	"                 and op_id = 'AU002'
"
PRC_AUTO_RUN	PROCEDURE	589	"                 and patient_no > 0
"
PRC_AUTO_RUN	PROCEDURE	590	"                 and depo_date > sysdate - 2)
"
PRC_AUTO_RUN	PROCEDURE	591	"       where rq < '20210210'
"
PRC_AUTO_RUN	PROCEDURE	592	"          or rq > '20210221';
"
PRC_AUTO_RUN	PROCEDURE	593	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	594	"        select '留义温暖基金,床位分配时间不在0210-0221,数量=' || v_count
"
PRC_AUTO_RUN	PROCEDURE	595	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	596	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	597	"      
"
PRC_AUTO_RUN	PROCEDURE	598	"        select count(*)
"
PRC_AUTO_RUN	PROCEDURE	599	"          into v_count
"
PRC_AUTO_RUN	PROCEDURE	600	"          from (select (select count(*)
"
PRC_AUTO_RUN	PROCEDURE	601	"                          from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	602	"                         where patient_no = t.patient_no
"
PRC_AUTO_RUN	PROCEDURE	603	"                           and cwfp_date is null) sl
"
PRC_AUTO_RUN	PROCEDURE	604	"                  From zy_deposit_file t
"
PRC_AUTO_RUN	PROCEDURE	605	"                 where patient_no <> 851509
"
PRC_AUTO_RUN	PROCEDURE	606	"                   and op_id = 'AU002'
"
PRC_AUTO_RUN	PROCEDURE	607	"                   and patient_no > 0
"
PRC_AUTO_RUN	PROCEDURE	608	"                   and depo_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	609	"                   and depo_date < sysdate)
"
PRC_AUTO_RUN	PROCEDURE	610	"         where sl = 1;
"
PRC_AUTO_RUN	PROCEDURE	611	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	612	"          select nr || ',cwfp_date =null,数量=' || v_count
"
PRC_AUTO_RUN	PROCEDURE	613	"            into nr
"
PRC_AUTO_RUN	PROCEDURE	614	"            from dual;
"
PRC_AUTO_RUN	PROCEDURE	615	"        
"
PRC_AUTO_RUN	PROCEDURE	616	"          update zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	617	"             set patient_no = patient_no * -1
"
PRC_AUTO_RUN	PROCEDURE	618	"           where op_id = 'AU002'
"
PRC_AUTO_RUN	PROCEDURE	619	"             and depo_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	620	"             and patient_No in
"
PRC_AUTO_RUN	PROCEDURE	621	"                 (select patient_no
"
PRC_AUTO_RUN	PROCEDURE	622	"                    from (select (select count(*)
"
PRC_AUTO_RUN	PROCEDURE	623	"                                    from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	624	"                                   where patient_no = t.patient_no
"
PRC_AUTO_RUN	PROCEDURE	625	"                                     and cwfp_date is null) sl,
"
PRC_AUTO_RUN	PROCEDURE	626	"                                 patient_no
"
PRC_AUTO_RUN	PROCEDURE	627	"                            From zy_deposit_file t
"
PRC_AUTO_RUN	PROCEDURE	628	"                           where patient_no <> 851509
"
PRC_AUTO_RUN	PROCEDURE	629	"                             and op_id = 'AU002'
"
PRC_AUTO_RUN	PROCEDURE	630	"                             and patient_no > 0
"
PRC_AUTO_RUN	PROCEDURE	631	"                             and js_No = 0
"
PRC_AUTO_RUN	PROCEDURE	632	"                             and depo_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	633	"                             and depo_date < sysdate - 0.05)
"
PRC_AUTO_RUN	PROCEDURE	634	"                   where sl = 1);
"
PRC_AUTO_RUN	PROCEDURE	635	"          if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	636	"            commit;
"
PRC_AUTO_RUN	PROCEDURE	637	"          else
"
PRC_AUTO_RUN	PROCEDURE	638	"            rollback;
"
PRC_AUTO_RUN	PROCEDURE	639	"          end if;
"
PRC_AUTO_RUN	PROCEDURE	640	"        
"
PRC_AUTO_RUN	PROCEDURE	641	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	642	"      
"
PRC_AUTO_RUN	PROCEDURE	643	"        prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	644	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	645	"    
"
PRC_AUTO_RUN	PROCEDURE	646	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	647	"    --end 留义温暖基金
"
PRC_AUTO_RUN	PROCEDURE	648	"  
"
PRC_AUTO_RUN	PROCEDURE	649	"    prc_xiangmu_cursor_do('抗菌药物停止通知',
"
PRC_AUTO_RUN	PROCEDURE	650	"                          '',
"
PRC_AUTO_RUN	PROCEDURE	651	"                          '',
"
PRC_AUTO_RUN	PROCEDURE	652	"                          v_out_code,
"
PRC_AUTO_RUN	PROCEDURE	653	"                          v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	654	"  
"
PRC_AUTO_RUN	PROCEDURE	655	"    prc_xiangmu_cursor_do('门诊停诊通知', '', '', v_out_code, v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	656	"    prc_xiangmu_cursor_do('物价核查通知', '', '', v_out_code, v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	657	"  
"
PRC_AUTO_RUN	PROCEDURE	658	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	659	"
"
PRC_AUTO_RUN	PROCEDURE	660	"  -- 短信提醒： 化验结果提醒  化验项目未做提醒  药品未取提醒  检查项目未做提醒
"
PRC_AUTO_RUN	PROCEDURE	661	"
"
PRC_AUTO_RUN	PROCEDURE	662	"  if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	663	"    if 1 = 1 and (ls_now > '15:50' and ls_now <= '16:50') then
"
PRC_AUTO_RUN	PROCEDURE	664	"      if 1 = 1 and ls_now_minue = '1' then
"
PRC_AUTO_RUN	PROCEDURE	665	"        prc_xiangmu_sms_send('化验结果提醒', '', '', v_out_code, v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	666	"      
"
PRC_AUTO_RUN	PROCEDURE	667	"        prc_xiangmu_sms_send('化验项目未做提醒',
"
PRC_AUTO_RUN	PROCEDURE	668	"                             '',
"
PRC_AUTO_RUN	PROCEDURE	669	"                             '',
"
PRC_AUTO_RUN	PROCEDURE	670	"                             v_out_code,
"
PRC_AUTO_RUN	PROCEDURE	671	"                             v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	672	"        prc_xiangmu_sms_send('医后付未结算提醒',
"
PRC_AUTO_RUN	PROCEDURE	673	"                             '',
"
PRC_AUTO_RUN	PROCEDURE	674	"                             '',
"
PRC_AUTO_RUN	PROCEDURE	675	"                             v_out_code,
"
PRC_AUTO_RUN	PROCEDURE	676	"                             v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	677	"      
"
PRC_AUTO_RUN	PROCEDURE	678	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	679	"    
"
PRC_AUTO_RUN	PROCEDURE	680	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	681	"  
"
PRC_AUTO_RUN	PROCEDURE	682	"    if 1 = 1 and (ls_now > '07:50' and ls_now <= '16:50') then
"
PRC_AUTO_RUN	PROCEDURE	683	"      if 1 = 1 and ls_now_minue = '4' then
"
PRC_AUTO_RUN	PROCEDURE	684	"        prc_xiangmu_sms_send('药品未取提醒', '', '', v_out_code, v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	685	"      
"
PRC_AUTO_RUN	PROCEDURE	686	"        prc_xiangmu_sms_send('检查项目未做提醒',
"
PRC_AUTO_RUN	PROCEDURE	687	"                             '',
"
PRC_AUTO_RUN	PROCEDURE	688	"                             '',
"
PRC_AUTO_RUN	PROCEDURE	689	"                             v_out_code,
"
PRC_AUTO_RUN	PROCEDURE	690	"                             v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	691	"      
"
PRC_AUTO_RUN	PROCEDURE	692	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	693	"    
"
PRC_AUTO_RUN	PROCEDURE	694	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	695	"  
"
PRC_AUTO_RUN	PROCEDURE	696	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	697	"
"
PRC_AUTO_RUN	PROCEDURE	698	"  --  error 更新单价<0  ys_code
"
PRC_AUTO_RUN	PROCEDURE	699	"  if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	700	"  
"
PRC_AUTO_RUN	PROCEDURE	701	"    if (ls_now > '07:00' and ls_now <= '07:01') then
"
PRC_AUTO_RUN	PROCEDURE	702	"      update zy_detail_charge
"
PRC_AUTO_RUN	PROCEDURE	703	"         set dj = dj * -1, sl = sl * -1
"
PRC_AUTO_RUN	PROCEDURE	704	"       where js_no = 0
"
PRC_AUTO_RUN	PROCEDURE	705	"         and dj < 0
"
PRC_AUTO_RUN	PROCEDURE	706	"         and jcfx_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	707	"         and jcfx_date < sysdate - 0.011;
"
PRC_AUTO_RUN	PROCEDURE	708	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	709	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	710	"      else
"
PRC_AUTO_RUN	PROCEDURE	711	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	712	"        prc_sms_send('ts', '13777929515', 'dj<0 update prc_autuo', v_bz);
"
PRC_AUTO_RUN	PROCEDURE	713	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	714	"    
"
PRC_AUTO_RUN	PROCEDURE	715	"      update zy_detail_charge x
"
PRC_AUTO_RUN	PROCEDURE	716	"         set ys_code = (select zzys
"
PRC_AUTO_RUN	PROCEDURE	717	"                          from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	718	"                         where patient_No = x.patient_no)
"
PRC_AUTO_RUN	PROCEDURE	719	"       where nvl(ys_code, 0) not in (select zgid from gy_zgxx)
"
PRC_AUTO_RUN	PROCEDURE	720	"         and js_no = 0
"
PRC_AUTO_RUN	PROCEDURE	721	"         and jcfx_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	722	"         and jcfx_date < sysdate - 0.011;
"
PRC_AUTO_RUN	PROCEDURE	723	"    
"
PRC_AUTO_RUN	PROCEDURE	724	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	725	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	726	"      else
"
PRC_AUTO_RUN	PROCEDURE	727	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	728	"        prc_sms_send('ts', '13777929515', 'zzys update prc_auto', v_bz);
"
PRC_AUTO_RUN	PROCEDURE	729	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	730	"    
"
PRC_AUTO_RUN	PROCEDURE	731	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	732	"  
"
PRC_AUTO_RUN	PROCEDURE	733	"    if (ls_now > '07:00' and ls_now <= '18:01') then
"
PRC_AUTO_RUN	PROCEDURE	734	"      update zy_detail_charge
"
PRC_AUTO_RUN	PROCEDURE	735	"         set dj = dj * -1, sl = sl * -1
"
PRC_AUTO_RUN	PROCEDURE	736	"       where js_no = 0
"
PRC_AUTO_RUN	PROCEDURE	737	"         and dj < 0
"
PRC_AUTO_RUN	PROCEDURE	738	"         and jcfx_date > sysdate - 0.011;
"
PRC_AUTO_RUN	PROCEDURE	739	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	740	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	741	"      else
"
PRC_AUTO_RUN	PROCEDURE	742	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	743	"        prc_sms_send('ts', '13777929515', 'dj<0 update prc_autuo', v_bz);
"
PRC_AUTO_RUN	PROCEDURE	744	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	745	"    
"
PRC_AUTO_RUN	PROCEDURE	746	"      update zy_detail_charge x
"
PRC_AUTO_RUN	PROCEDURE	747	"         set ys_code = (select zzys
"
PRC_AUTO_RUN	PROCEDURE	748	"                          from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	749	"                         where patient_No = x.patient_no)
"
PRC_AUTO_RUN	PROCEDURE	750	"       where nvl(ys_code, 0) not in (select zgid from gy_zgxx)
"
PRC_AUTO_RUN	PROCEDURE	751	"         and js_no = 0
"
PRC_AUTO_RUN	PROCEDURE	752	"         and jcfx_date > sysdate - 0.011;
"
PRC_AUTO_RUN	PROCEDURE	753	"    
"
PRC_AUTO_RUN	PROCEDURE	754	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	755	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	756	"      else
"
PRC_AUTO_RUN	PROCEDURE	757	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	758	"        prc_sms_send('ts', '13777929515', 'zzys update prc_auto', v_bz);
"
PRC_AUTO_RUN	PROCEDURE	759	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	760	"    
"
PRC_AUTO_RUN	PROCEDURE	761	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	762	"  
"
PRC_AUTO_RUN	PROCEDURE	763	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	764	"  --旧高值耗材更新价格
"
PRC_AUTO_RUN	PROCEDURE	765	"  if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	766	"    update zy_detail_charge t
"
PRC_AUTO_RUN	PROCEDURE	767	"       set dj = dj - 100, tsyybz = ' '
"
PRC_AUTO_RUN	PROCEDURE	768	"     where fygl = 25
"
PRC_AUTO_RUN	PROCEDURE	769	"       and tsyybz is null
"
PRC_AUTO_RUN	PROCEDURE	770	"       and t.twice_detail_code = 'SB'
"
PRC_AUTO_RUN	PROCEDURE	771	"       and js_No = 0
"
PRC_AUTO_RUN	PROCEDURE	772	"       and dj >= 2000
"
PRC_AUTO_RUN	PROCEDURE	773	"       and jlxh >= 293106684
"
PRC_AUTO_RUN	PROCEDURE	774	"       and jcfx_date > sysdate - 0.5
"
PRC_AUTO_RUN	PROCEDURE	775	"       and jcfx_date < sysdate - 0.0001;
"
PRC_AUTO_RUN	PROCEDURE	776	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	777	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	778	"    else
"
PRC_AUTO_RUN	PROCEDURE	779	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	780	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	781	"  
"
PRC_AUTO_RUN	PROCEDURE	782	"    update zy_detail_charge t
"
PRC_AUTO_RUN	PROCEDURE	783	"       set dj = round(dj / 1.05, 0), tsyybz = ' '
"
PRC_AUTO_RUN	PROCEDURE	784	"     where fygl = 25
"
PRC_AUTO_RUN	PROCEDURE	785	"       and tsyybz is null
"
PRC_AUTO_RUN	PROCEDURE	786	"       and t.twice_detail_code = 'SB'
"
PRC_AUTO_RUN	PROCEDURE	787	"       and js_No = 0
"
PRC_AUTO_RUN	PROCEDURE	788	"       and dj < 2000
"
PRC_AUTO_RUN	PROCEDURE	789	"       and jlxh >= 293106684
"
PRC_AUTO_RUN	PROCEDURE	790	"       and jcfx_date > sysdate - 0.5
"
PRC_AUTO_RUN	PROCEDURE	791	"       and jcfx_date < sysdate - 0.0001;
"
PRC_AUTO_RUN	PROCEDURE	792	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	793	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	794	"    else
"
PRC_AUTO_RUN	PROCEDURE	795	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	796	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	797	"    update gy_xtcs
"
PRC_AUTO_RUN	PROCEDURE	798	"       set csz1 = to_char(sysdate + 0.042, 'yyyymmddhh24')
"
PRC_AUTO_RUN	PROCEDURE	799	"     where xtxh = 0
"
PRC_AUTO_RUN	PROCEDURE	800	"       and csmc = 'AUTO_SB';
"
PRC_AUTO_RUN	PROCEDURE	801	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	802	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	803	"    else
"
PRC_AUTO_RUN	PROCEDURE	804	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	805	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	806	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	807	"
"
PRC_AUTO_RUN	PROCEDURE	808	"  --发热病人统计数据，发送短信  '12:01 - 12:02'
"
PRC_AUTO_RUN	PROCEDURE	809	"  if 101 = 101 and ((ls_now > '07:41' and ls_now <= '07:42')) then
"
PRC_AUTO_RUN	PROCEDURE	810	"    -- count(distinct to_char(jzrq, 'yyyymmdd') || ' ' || jzkh) ||
"
PRC_AUTO_RUN	PROCEDURE	811	"  
"
PRC_AUTO_RUN	PROCEDURE	812	"    /*  select to_char(trunc(sysdate - 1) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN	PROCEDURE	813	"               ' 至 ' || to_char(trunc(sysdate) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN	PROCEDURE	814	"               '为止,发热门诊病人: ' ||wm_concat(bz) from (
"
PRC_AUTO_RUN	PROCEDURE	815	"    select (select ksmc from gy_ksdm where ksdm=t.ksdm)|| count(distinct jzkh) || ' 例 ' bz   
"
PRC_AUTO_RUN	PROCEDURE	816	"          from zj_jzxx t      where ksdm in ('2270006', '2010040', '2100005')
"
PRC_AUTO_RUN	PROCEDURE	817	"           and jzrq between trunc(sysdate - 1) + 0.5 and trunc(sysdate) + 0.5
"
PRC_AUTO_RUN	PROCEDURE	818	"           group by t.ksdm )*/
"
PRC_AUTO_RUN	PROCEDURE	819	"  
"
PRC_AUTO_RUN	PROCEDURE	820	"    /* select to_char(trunc(sysdate - 1) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN	PROCEDURE	821	"           ' 至 ' || to_char(trunc(sysdate) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN	PROCEDURE	822	"           '为止,发热门诊病人: ' || count(distinct jzkh) || ' 例 '
"
PRC_AUTO_RUN	PROCEDURE	823	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	824	"      from zj_jzxx
"
PRC_AUTO_RUN	PROCEDURE	825	"     where ksdm in ('2270006', '2010040')
"
PRC_AUTO_RUN	PROCEDURE	826	"       and jzrq between trunc(sysdate - 1) + 0.5 and trunc(sysdate) + 0.5;
"
PRC_AUTO_RUN	PROCEDURE	827	"    
"
PRC_AUTO_RUN	PROCEDURE	828	"    select nr || ';发热门诊有发热症状的例数: ' || count(distinct(bingrenhm)) || ' 例 '
"
PRC_AUTO_RUN	PROCEDURE	829	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	830	"      from zj_menzhenblxx a, zj_jzxx b
"
PRC_AUTO_RUN	PROCEDURE	831	"     where a.jiuzhenxh = b.jzxh
"
PRC_AUTO_RUN	PROCEDURE	832	"       and a.zhushu like '%发热%'
"
PRC_AUTO_RUN	PROCEDURE	833	"       and b.ksdm in ('2270006', '2010040')
"
PRC_AUTO_RUN	PROCEDURE	834	"       and b.jzrq between trunc(sysdate - 1) + 0.5 and trunc(sysdate) + 0.5;*/
"
PRC_AUTO_RUN	PROCEDURE	835	"  
"
PRC_AUTO_RUN	PROCEDURE	836	"    select to_char(trunc(sysdate - 1), 'yyyy-mm-dd') || ' 发热门诊病人: ' ||
"
PRC_AUTO_RUN	PROCEDURE	837	"           count(distinct jzkh) || ' 例 '
"
PRC_AUTO_RUN	PROCEDURE	838	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	839	"      from zj_jzxx
"
PRC_AUTO_RUN	PROCEDURE	840	"     where ksdm in ('2270006', '2010040')
"
PRC_AUTO_RUN	PROCEDURE	841	"       and jzrq between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN	PROCEDURE	842	"  
"
PRC_AUTO_RUN	PROCEDURE	843	"    select nr || ',有发热症状的例数: ' || count(distinct(jzkh)) || ' 例; '
"
PRC_AUTO_RUN	PROCEDURE	844	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	845	"      from zj_jzxx b
"
PRC_AUTO_RUN	PROCEDURE	846	"     where b.BRTW > 37.5
"
PRC_AUTO_RUN	PROCEDURE	847	"       and b.ksdm in ('2270006', '2010040')
"
PRC_AUTO_RUN	PROCEDURE	848	"       and b.jzrq between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN	PROCEDURE	849	"  
"
PRC_AUTO_RUN	PROCEDURE	850	"    /*    prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	851	"    prc_sms_send('ts', '13958443561', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	852	"    prc_sms_send('ts', '13867936636', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	853	"    prc_sms_send('ts', '15757996037', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	854	"    prc_sms_send('ts', '15868957673', nr, v_bz);*/
"
PRC_AUTO_RUN	PROCEDURE	855	"  
"
PRC_AUTO_RUN	PROCEDURE	856	"    select nr || to_char(trunc(sysdate - 1), 'yyyy-mm-dd') || ' 儿科发热门诊病人: ' ||
"
PRC_AUTO_RUN	PROCEDURE	857	"           count(distinct jzkh) || ' 例 '
"
PRC_AUTO_RUN	PROCEDURE	858	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	859	"      from zj_jzxx
"
PRC_AUTO_RUN	PROCEDURE	860	"     where ksdm in ('2100005', '2020014')
"
PRC_AUTO_RUN	PROCEDURE	861	"       and jzrq between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN	PROCEDURE	862	"  
"
PRC_AUTO_RUN	PROCEDURE	863	"    select nr || ',有发热症状的例数: ' || count(distinct(jzkh)) || ' 例 '
"
PRC_AUTO_RUN	PROCEDURE	864	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	865	"      from zj_jzxx b
"
PRC_AUTO_RUN	PROCEDURE	866	"     where b.BRTW > 37.5
"
PRC_AUTO_RUN	PROCEDURE	867	"       and b.ksdm in ('2100005', '2020014')
"
PRC_AUTO_RUN	PROCEDURE	868	"       and b.jzrq between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN	PROCEDURE	869	"  
"
PRC_AUTO_RUN	PROCEDURE	870	"    prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	871	"    prc_sms_send('ts', '13958443561', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	872	"    prc_sms_send('ts', '13867936636', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	873	"    prc_sms_send('ts', '15757996037', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	874	"    prc_sms_send('ts', '15868957673', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	875	"    prc_sms_send('ts', '13516995998', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	876	"  
"
PRC_AUTO_RUN	PROCEDURE	877	"    --mz_jkk更新5天
"
PRC_AUTO_RUN	PROCEDURE	878	"    /*    if 1 = 0 then
"
PRC_AUTO_RUN	PROCEDURE	879	"      update mz_jkk
"
PRC_AUTO_RUN	PROCEDURE	880	"         set kzrq = jkrq + 6
"
PRC_AUTO_RUN	PROCEDURE	881	"       where jkcs = 1
"
PRC_AUTO_RUN	PROCEDURE	882	"         and wym = 2
"
PRC_AUTO_RUN	PROCEDURE	883	"         and xtbz = 0
"
PRC_AUTO_RUN	PROCEDURE	884	"         and sfsb is null
"
PRC_AUTO_RUN	PROCEDURE	885	"         and kzrq < jkrq + 6
"
PRC_AUTO_RUN	PROCEDURE	886	"         and jkrq > sysdate - 10
"
PRC_AUTO_RUN	PROCEDURE	887	"         and jkrq < sysdate - 0.1;
"
PRC_AUTO_RUN	PROCEDURE	888	"    
"
PRC_AUTO_RUN	PROCEDURE	889	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	890	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	891	"      else
"
PRC_AUTO_RUN	PROCEDURE	892	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	893	"        nr := 'mz_jkk更新5天报错，prc_auto_run';
"
PRC_AUTO_RUN	PROCEDURE	894	"        prc_sms_send('ts', '13867936636', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	895	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	896	"    end if;*/
"
PRC_AUTO_RUN	PROCEDURE	897	"  
"
PRC_AUTO_RUN	PROCEDURE	898	"    -- 门诊挂号人次
"
PRC_AUTO_RUN	PROCEDURE	899	"    /*   SELECT to_char(trunc(sysdate - 1) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN	PROCEDURE	900	"          ' 至 ' || to_char(trunc(sysdate) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN	PROCEDURE	901	"          '为止,门诊挂号人次' || SUM(DECODE(A.THBZ,
"
PRC_AUTO_RUN	PROCEDURE	902	"                                    0,
"
PRC_AUTO_RUN	PROCEDURE	903	"                                    DECODE(A.ZFPB,
"
PRC_AUTO_RUN	PROCEDURE	904	"                                           NULL,
"
PRC_AUTO_RUN	PROCEDURE	905	"                                           DECODE(A.MZLBXH, 2, 0, 8, 0, 1),
"
PRC_AUTO_RUN	PROCEDURE	906	"                                           0),
"
PRC_AUTO_RUN	PROCEDURE	907	"                                    0)) || ' , 急诊挂号人次' ||
"
PRC_AUTO_RUN	PROCEDURE	908	"          SUM(DECODE(A.THBZ,
"
PRC_AUTO_RUN	PROCEDURE	909	"                     0,
"
PRC_AUTO_RUN	PROCEDURE	910	"                     DECODE(A.ZFPB,
"
PRC_AUTO_RUN	PROCEDURE	911	"                            NULL,
"
PRC_AUTO_RUN	PROCEDURE	912	"                            DECODE(A.MZLBXH, 2, 1, 8, 1, 0),
"
PRC_AUTO_RUN	PROCEDURE	913	"                            0),
"
PRC_AUTO_RUN	PROCEDURE	914	"                     0))
"
PRC_AUTO_RUN	PROCEDURE	915	"     into nr
"
PRC_AUTO_RUN	PROCEDURE	916	"     FROM GH_GHK A, GY_KSDM B
"
PRC_AUTO_RUN	PROCEDURE	917	"    WHERE A.KSDM = B.KSDM
"
PRC_AUTO_RUN	PROCEDURE	918	"      AND A.GHRQ between trunc(sysdate - 1) + 0.5 and trunc(sysdate) + 0.5;*/
"
PRC_AUTO_RUN	PROCEDURE	919	"  
"
PRC_AUTO_RUN	PROCEDURE	920	"    SELECT to_char(trunc(sysdate - 1), 'yyyy-mm-dd') || ' 门诊挂号人次' ||
"
PRC_AUTO_RUN	PROCEDURE	921	"           SUM(DECODE(A.THBZ,
"
PRC_AUTO_RUN	PROCEDURE	922	"                      0,
"
PRC_AUTO_RUN	PROCEDURE	923	"                      DECODE(A.ZFPB,
"
PRC_AUTO_RUN	PROCEDURE	924	"                             NULL,
"
PRC_AUTO_RUN	PROCEDURE	925	"                             DECODE(A.MZLBXH, 2, 0, 8, 0, 1),
"
PRC_AUTO_RUN	PROCEDURE	926	"                             0),
"
PRC_AUTO_RUN	PROCEDURE	927	"                      0)) || ' , 急诊挂号人次' ||
"
PRC_AUTO_RUN	PROCEDURE	928	"           SUM(DECODE(A.THBZ,
"
PRC_AUTO_RUN	PROCEDURE	929	"                      0,
"
PRC_AUTO_RUN	PROCEDURE	930	"                      DECODE(A.ZFPB,
"
PRC_AUTO_RUN	PROCEDURE	931	"                             NULL,
"
PRC_AUTO_RUN	PROCEDURE	932	"                             DECODE(A.MZLBXH, 2, 1, 8, 1, 0),
"
PRC_AUTO_RUN	PROCEDURE	933	"                             0),
"
PRC_AUTO_RUN	PROCEDURE	934	"                      0))
"
PRC_AUTO_RUN	PROCEDURE	935	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	936	"      FROM GH_GHK A, GY_KSDM B
"
PRC_AUTO_RUN	PROCEDURE	937	"     WHERE A.KSDM = B.KSDM
"
PRC_AUTO_RUN	PROCEDURE	938	"       AND A.GHRQ between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN	PROCEDURE	939	"  
"
PRC_AUTO_RUN	PROCEDURE	940	"    SELECT nr || ',本院核酸开单:' || count(jlxh)
"
PRC_AUTO_RUN	PROCEDURE	941	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	942	"      FROM GH_GHK A
"
PRC_AUTO_RUN	PROCEDURE	943	"     WHERE a.jzkh like 'BY%'
"
PRC_AUTO_RUN	PROCEDURE	944	"       AND A.GHRQ between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN	PROCEDURE	945	"  
"
PRC_AUTO_RUN	PROCEDURE	946	"    prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	947	"    prc_sms_send('ts', '13958443561', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	948	"    prc_sms_send('ts', '13516995998', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	949	"    prc_sms_send('ts', '15868957673', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	950	"  
"
PRC_AUTO_RUN	PROCEDURE	951	"    --新冠统计
"
PRC_AUTO_RUN	PROCEDURE	952	"    select to_char(mc) into nr from v_auto_xingguang1218;
"
PRC_AUTO_RUN	PROCEDURE	953	"    prc_sms_send('ts', '13958443561', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	954	"  
"
PRC_AUTO_RUN	PROCEDURE	955	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	956	"
"
PRC_AUTO_RUN	PROCEDURE	957	"  --决策分析_业务数据采集
"
PRC_AUTO_RUN	PROCEDURE	958	"  if ls_now > '02:01' and ls_now <= '02:02' then
"
PRC_AUTO_RUN	PROCEDURE	959	"    if 101 = 101 then
"
PRC_AUTO_RUN	PROCEDURE	960	"    
"
PRC_AUTO_RUN	PROCEDURE	961	"      v_task := '决策分析_业务数据采集';
"
PRC_AUTO_RUN	PROCEDURE	962	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	963	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	964	"        from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	965	"       where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN	PROCEDURE	966	"         and jylsh = v_task
"
PRC_AUTO_RUN	PROCEDURE	967	"         and jyrq > sysdate - 0.05;
"
PRC_AUTO_RUN	PROCEDURE	968	"      --最近1小时已经执行过
"
PRC_AUTO_RUN	PROCEDURE	969	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	970	"        v_task := ' ';
"
PRC_AUTO_RUN	PROCEDURE	971	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	972	"    
"
PRC_AUTO_RUN	PROCEDURE	973	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	974	"  
"
PRC_AUTO_RUN	PROCEDURE	975	"    -- 决策分析_业务数据采集 采集数据失败 zy_detail_charge curr_ks is null
"
PRC_AUTO_RUN	PROCEDURE	976	"    if v_task = '决策分析_业务数据采集' then
"
PRC_AUTO_RUN	PROCEDURE	977	"      insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	978	"        (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN	PROCEDURE	979	"      values
"
PRC_AUTO_RUN	PROCEDURE	980	"        (v_Procedure_Name, v_task, -1);
"
PRC_AUTO_RUN	PROCEDURE	981	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	982	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	983	"      else
"
PRC_AUTO_RUN	PROCEDURE	984	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	985	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	986	"    
"
PRC_AUTO_RUN	PROCEDURE	987	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	988	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	989	"        from Zy_Detail_Charge
"
PRC_AUTO_RUN	PROCEDURE	990	"       WHERE jcfx_date > sysdate - 3
"
PRC_AUTO_RUN	PROCEDURE	991	"         and jcfx_date < trunc(sysdate)
"
PRC_AUTO_RUN	PROCEDURE	992	"         and CURR_KS IS NULL;
"
PRC_AUTO_RUN	PROCEDURE	993	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	994	"        insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	995	"          (jiaoyilx, jylsh, patient_no)
"
PRC_AUTO_RUN	PROCEDURE	996	"        values
"
PRC_AUTO_RUN	PROCEDURE	997	"          (v_Procedure_Name,
"
PRC_AUTO_RUN	PROCEDURE	998	"           '决策分析_业务数据采集 zy_detail_charge curr_ks is null  数量为 patient_no',
"
PRC_AUTO_RUN	PROCEDURE	999	"           v_count);
"
PRC_AUTO_RUN	PROCEDURE	1000	"        if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1001	"          commit;
"
PRC_AUTO_RUN	PROCEDURE	1002	"        else
"
PRC_AUTO_RUN	PROCEDURE	1003	"          rollback;
"
PRC_AUTO_RUN	PROCEDURE	1004	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1005	"      
"
PRC_AUTO_RUN	PROCEDURE	1006	"        update zy_detail_charge x
"
PRC_AUTO_RUN	PROCEDURE	1007	"           set curr_ks = (select curr_ks
"
PRC_AUTO_RUN	PROCEDURE	1008	"                            from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	1009	"                           where zy_patient_information.patient_No =
"
PRC_AUTO_RUN	PROCEDURE	1010	"                                 x.patient_No)
"
PRC_AUTO_RUN	PROCEDURE	1011	"         where x.curr_ks is null
"
PRC_AUTO_RUN	PROCEDURE	1012	"           and x.jcfx_date > sysdate - 3
"
PRC_AUTO_RUN	PROCEDURE	1013	"           and jcfx_date < trunc(sysdate)
"
PRC_AUTO_RUN	PROCEDURE	1014	"           and exists
"
PRC_AUTO_RUN	PROCEDURE	1015	"         (select 1
"
PRC_AUTO_RUN	PROCEDURE	1016	"                  from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	1017	"                 where zy_patient_information.patient_No = x.patient_NO);
"
PRC_AUTO_RUN	PROCEDURE	1018	"        if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1019	"          commit;
"
PRC_AUTO_RUN	PROCEDURE	1020	"        else
"
PRC_AUTO_RUN	PROCEDURE	1021	"          rollback;
"
PRC_AUTO_RUN	PROCEDURE	1022	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1023	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1024	"    
"
PRC_AUTO_RUN	PROCEDURE	1025	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1026	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	1027	"        from Zy_Detail_Charge
"
PRC_AUTO_RUN	PROCEDURE	1028	"       WHERE jcfx_date > sysdate - 3
"
PRC_AUTO_RUN	PROCEDURE	1029	"         and jcfx_date < trunc(sysdate)
"
PRC_AUTO_RUN	PROCEDURE	1030	"         and CURR_KS IS NULL;
"
PRC_AUTO_RUN	PROCEDURE	1031	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1032	"        insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1033	"          (jiaoyilx, jylsh, patient_no)
"
PRC_AUTO_RUN	PROCEDURE	1034	"        values
"
PRC_AUTO_RUN	PROCEDURE	1035	"          (v_Procedure_Name,
"
PRC_AUTO_RUN	PROCEDURE	1036	"           '决策分析_业务数据采集 zy_detail_charge curr_ks is null 调整jcfx_date 数量为 patient_no',
"
PRC_AUTO_RUN	PROCEDURE	1037	"           v_count);
"
PRC_AUTO_RUN	PROCEDURE	1038	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	1039	"      
"
PRC_AUTO_RUN	PROCEDURE	1040	"        update Zy_Detail_Charge
"
PRC_AUTO_RUN	PROCEDURE	1041	"           set jcfx_date = sysdate
"
PRC_AUTO_RUN	PROCEDURE	1042	"         WHERE jcfx_date > sysdate - 3
"
PRC_AUTO_RUN	PROCEDURE	1043	"           and jcfx_date < trunc(sysdate)
"
PRC_AUTO_RUN	PROCEDURE	1044	"           and CURR_KS IS NULL;
"
PRC_AUTO_RUN	PROCEDURE	1045	"        if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1046	"          commit;
"
PRC_AUTO_RUN	PROCEDURE	1047	"        else
"
PRC_AUTO_RUN	PROCEDURE	1048	"          rollback;
"
PRC_AUTO_RUN	PROCEDURE	1049	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1050	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1051	"      --执行数据采集 存储过程
"
PRC_AUTO_RUN	PROCEDURE	1052	"      prc_sjcj();
"
PRC_AUTO_RUN	PROCEDURE	1053	"      /* insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1054	"        (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN	PROCEDURE	1055	"      values
"
PRC_AUTO_RUN	PROCEDURE	1056	"        (v_Procedure_Name, v_task, 1);*/
"
PRC_AUTO_RUN	PROCEDURE	1057	"      update zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1058	"         set flag = 1
"
PRC_AUTO_RUN	PROCEDURE	1059	"       where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN	PROCEDURE	1060	"         and jylsh = v_task
"
PRC_AUTO_RUN	PROCEDURE	1061	"         and jyrq > sysdate - 0.05;
"
PRC_AUTO_RUN	PROCEDURE	1062	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1063	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	1064	"      else
"
PRC_AUTO_RUN	PROCEDURE	1065	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	1066	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1067	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1068	"  
"
PRC_AUTO_RUN	PROCEDURE	1069	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1070	"
"
PRC_AUTO_RUN	PROCEDURE	1071	"  --后台运行统计数据，发送短信  '02:01 - 02:02'
"
PRC_AUTO_RUN	PROCEDURE	1072	"  if 103 = 103 and ((ls_now > '03:01' and ls_now <= '03:02')) then
"
PRC_AUTO_RUN	PROCEDURE	1073	"  
"
PRC_AUTO_RUN	PROCEDURE	1074	"    select COUNT(*)
"
PRC_AUTO_RUN	PROCEDURE	1075	"      INTO v_count
"
PRC_AUTO_RUN	PROCEDURE	1076	"      from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1077	"     where jyrq > sysdate - 0.002
"
PRC_AUTO_RUN	PROCEDURE	1078	"       and jyrq < sysdate
"
PRC_AUTO_RUN	PROCEDURE	1079	"       and jiaoyilx = 'PRC_AUTO_RUN_QUERY1';
"
PRC_AUTO_RUN	PROCEDURE	1080	"    if v_count = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1081	"      PRC_AUTO_RUN_QUERY1();
"
PRC_AUTO_RUN	PROCEDURE	1082	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1083	"  
"
PRC_AUTO_RUN	PROCEDURE	1084	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1085	"
"
PRC_AUTO_RUN	PROCEDURE	1086	"  --执行失败任务查询  (存储过程，函数失效)
"
PRC_AUTO_RUN	PROCEDURE	1087	"  if ls_now > '07:01' and ls_now <= '07:02' then
"
PRC_AUTO_RUN	PROCEDURE	1088	"    if 0 = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1089	"      -- '执行失败任务查询';
"
PRC_AUTO_RUN	PROCEDURE	1090	"      if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1091	"        v_task := '执行失败任务查询';
"
PRC_AUTO_RUN	PROCEDURE	1092	"      
"
PRC_AUTO_RUN	PROCEDURE	1093	"        select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1094	"          into v_count
"
PRC_AUTO_RUN	PROCEDURE	1095	"          from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1096	"         where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN	PROCEDURE	1097	"           and jylsh = v_task
"
PRC_AUTO_RUN	PROCEDURE	1098	"           and jyrq > sysdate - 0.05;
"
PRC_AUTO_RUN	PROCEDURE	1099	"        --最近1小时已经执行过
"
PRC_AUTO_RUN	PROCEDURE	1100	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1101	"          v_task := ' ';
"
PRC_AUTO_RUN	PROCEDURE	1102	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1103	"      
"
PRC_AUTO_RUN	PROCEDURE	1104	"        if v_task = '执行失败任务查询' then
"
PRC_AUTO_RUN	PROCEDURE	1105	"          insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1106	"            (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN	PROCEDURE	1107	"          values
"
PRC_AUTO_RUN	PROCEDURE	1108	"            (v_Procedure_Name, v_task, 0);
"
PRC_AUTO_RUN	PROCEDURE	1109	"          if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1110	"            commit;
"
PRC_AUTO_RUN	PROCEDURE	1111	"          else
"
PRC_AUTO_RUN	PROCEDURE	1112	"            rollback;
"
PRC_AUTO_RUN	PROCEDURE	1113	"          end if;
"
PRC_AUTO_RUN	PROCEDURE	1114	"        
"
PRC_AUTO_RUN	PROCEDURE	1115	"          select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1116	"            into v_count
"
PRC_AUTO_RUN	PROCEDURE	1117	"            from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1118	"           where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN	PROCEDURE	1119	"             and flag = -1
"
PRC_AUTO_RUN	PROCEDURE	1120	"             and jyrq > sysdate - 1.05;
"
PRC_AUTO_RUN	PROCEDURE	1121	"          if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1122	"            select v_Procedure_Name || ',执行失败任务,sl:' || to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1123	"              into nr
"
PRC_AUTO_RUN	PROCEDURE	1124	"              from dual;
"
PRC_AUTO_RUN	PROCEDURE	1125	"            prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1126	"          end if;
"
PRC_AUTO_RUN	PROCEDURE	1127	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1128	"      
"
PRC_AUTO_RUN	PROCEDURE	1129	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1130	"    
"
PRC_AUTO_RUN	PROCEDURE	1131	"      -- (存储过程，函数失效)
"
PRC_AUTO_RUN	PROCEDURE	1132	"      if 2 = 2 then
"
PRC_AUTO_RUN	PROCEDURE	1133	"      
"
PRC_AUTO_RUN	PROCEDURE	1134	"        select nvl(to_char(wm_concat(object_name)), '')
"
PRC_AUTO_RUN	PROCEDURE	1135	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	1136	"          from v_system_view_fail;
"
PRC_AUTO_RUN	PROCEDURE	1137	"        if length(nr) > 1 then
"
PRC_AUTO_RUN	PROCEDURE	1138	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1139	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1140	"      
"
PRC_AUTO_RUN	PROCEDURE	1141	"        select count(object_name) into v_count from v_system_view_fail;
"
PRC_AUTO_RUN	PROCEDURE	1142	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1143	"          select v_Procedure_Name || ',存储过程，函数失效3,sl:' || to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1144	"            into nr
"
PRC_AUTO_RUN	PROCEDURE	1145	"            from dual;
"
PRC_AUTO_RUN	PROCEDURE	1146	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1147	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1148	"      
"
PRC_AUTO_RUN	PROCEDURE	1149	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1150	"    
"
PRC_AUTO_RUN	PROCEDURE	1151	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1152	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1153	"
"
PRC_AUTO_RUN	PROCEDURE	1154	"  --- 后台短信发送日期调整
"
PRC_AUTO_RUN	PROCEDURE	1155	"  if (ls_now > '07:25' and ls_now <= '07:26') then
"
PRC_AUTO_RUN	PROCEDURE	1156	"    begin
"
PRC_AUTO_RUN	PROCEDURE	1157	"    
"
PRC_AUTO_RUN	PROCEDURE	1158	"      delete zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1159	"       where jiaoyilx in ('门诊记账病人查询', 'MZZJ', 'IP地址判断')
"
PRC_AUTO_RUN	PROCEDURE	1160	"         and jyrq < sysdate - 10;
"
PRC_AUTO_RUN	PROCEDURE	1161	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	1162	"    
"
PRC_AUTO_RUN	PROCEDURE	1163	"      delete zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1164	"       where jiaoyilx in ('增加门诊病人修改记录')
"
PRC_AUTO_RUN	PROCEDURE	1165	"         and jyrq < sysdate - 70;
"
PRC_AUTO_RUN	PROCEDURE	1166	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	1167	"    
"
PRC_AUTO_RUN	PROCEDURE	1168	"      --- 后台短信发送日期调整
"
PRC_AUTO_RUN	PROCEDURE	1169	"      if 3 = 3 then
"
PRC_AUTO_RUN	PROCEDURE	1170	"        select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1171	"          into v_count
"
PRC_AUTO_RUN	PROCEDURE	1172	"          from auto_task_ywzx_send
"
PRC_AUTO_RUN	PROCEDURE	1173	"         where date_add = date_send
"
PRC_AUTO_RUN	PROCEDURE	1174	"           and lx = 'au'
"
PRC_AUTO_RUN	PROCEDURE	1175	"           and date_add > sysdate - 0.3
"
PRC_AUTO_RUN	PROCEDURE	1176	"           and date_add < sysdate - 0.0002;
"
PRC_AUTO_RUN	PROCEDURE	1177	"        --最近1小时已经执行过
"
PRC_AUTO_RUN	PROCEDURE	1178	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1179	"          update auto_task_ywzx_send
"
PRC_AUTO_RUN	PROCEDURE	1180	"             set date_send = null
"
PRC_AUTO_RUN	PROCEDURE	1181	"           where date_add = date_send
"
PRC_AUTO_RUN	PROCEDURE	1182	"             and lx = 'au'
"
PRC_AUTO_RUN	PROCEDURE	1183	"             and date_add > sysdate - 0.29
"
PRC_AUTO_RUN	PROCEDURE	1184	"             and date_add < sysdate - 0.0002;
"
PRC_AUTO_RUN	PROCEDURE	1185	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1186	"      
"
PRC_AUTO_RUN	PROCEDURE	1187	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1188	"    
"
PRC_AUTO_RUN	PROCEDURE	1189	"    end;
"
PRC_AUTO_RUN	PROCEDURE	1190	"  
"
PRC_AUTO_RUN	PROCEDURE	1191	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1192	"
"
PRC_AUTO_RUN	PROCEDURE	1193	"  --全院业务收入，发送短信  '07:30 - 07:31'
"
PRC_AUTO_RUN	PROCEDURE	1194	"  if (ls_now > '07:30' and ls_now <= '07:31') or
"
PRC_AUTO_RUN	PROCEDURE	1195	"     (ls_now > '07:45' and ls_now <= '07:46') then
"
PRC_AUTO_RUN	PROCEDURE	1196	"    if 104 = 104 then
"
PRC_AUTO_RUN	PROCEDURE	1197	"    
"
PRC_AUTO_RUN	PROCEDURE	1198	"      select COUNT(*)
"
PRC_AUTO_RUN	PROCEDURE	1199	"        INTO v_count
"
PRC_AUTO_RUN	PROCEDURE	1200	"        from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1201	"       where jyrq > sysdate - 0.1
"
PRC_AUTO_RUN	PROCEDURE	1202	"         and jyrq < sysdate
"
PRC_AUTO_RUN	PROCEDURE	1203	"         and jiaoyilx = 'PRC_AUTO_RUN_GZL';
"
PRC_AUTO_RUN	PROCEDURE	1204	"      if v_count = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1205	"        prc_auto_run_gzl();
"
PRC_AUTO_RUN	PROCEDURE	1206	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1207	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1208	"  
"
PRC_AUTO_RUN	PROCEDURE	1209	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1210	"
"
PRC_AUTO_RUN	PROCEDURE	1211	"  --空床 发送短信  '08:10'
"
PRC_AUTO_RUN	PROCEDURE	1212	"  if (ls_now > '08:10' and ls_now <= '08:11') or
"
PRC_AUTO_RUN	PROCEDURE	1213	"     (ls_now > '08:20' and ls_now <= '08:21') then
"
PRC_AUTO_RUN	PROCEDURE	1214	"    if 105 = 105 then
"
PRC_AUTO_RUN	PROCEDURE	1215	"    
"
PRC_AUTO_RUN	PROCEDURE	1216	"      select COUNT(*)
"
PRC_AUTO_RUN	PROCEDURE	1217	"        INTO v_count
"
PRC_AUTO_RUN	PROCEDURE	1218	"        from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1219	"       where jyrq > sysdate - 0.01
"
PRC_AUTO_RUN	PROCEDURE	1220	"         and jyrq < sysdate
"
PRC_AUTO_RUN	PROCEDURE	1221	"         and jiaoyilx = 'PRC_AUTO_RUN_GZL_BED';
"
PRC_AUTO_RUN	PROCEDURE	1222	"      if v_count = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1223	"        PRC_AUTO_RUN_GZL_BED();
"
PRC_AUTO_RUN	PROCEDURE	1224	"      
"
PRC_AUTO_RUN	PROCEDURE	1225	"        update auto_task_ywzx_send
"
PRC_AUTO_RUN	PROCEDURE	1226	"           set date_send = null
"
PRC_AUTO_RUN	PROCEDURE	1227	"         where date_add > sysdate - 0.5
"
PRC_AUTO_RUN	PROCEDURE	1228	"           and lx = 'a';
"
PRC_AUTO_RUN	PROCEDURE	1229	"        if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1230	"          commit;
"
PRC_AUTO_RUN	PROCEDURE	1231	"        else
"
PRC_AUTO_RUN	PROCEDURE	1232	"          rollback;
"
PRC_AUTO_RUN	PROCEDURE	1233	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1234	"      
"
PRC_AUTO_RUN	PROCEDURE	1235	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1236	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1237	"  
"
PRC_AUTO_RUN	PROCEDURE	1238	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1239	"
"
PRC_AUTO_RUN	PROCEDURE	1240	"  --空床2 发送短信  '08:10'
"
PRC_AUTO_RUN	PROCEDURE	1241	"  v_temp := substr(ls_now, 4, 2);
"
PRC_AUTO_RUN	PROCEDURE	1242	"  --select  substr('08:02',4,2) from dual 
"
PRC_AUTO_RUN	PROCEDURE	1243	"  if v_temp > '56' and v_temp <= '57' and
"
PRC_AUTO_RUN	PROCEDURE	1244	"     (ls_now > '23:00' or ls_now <= '01:01') then
"
PRC_AUTO_RUN	PROCEDURE	1245	"    PRC_AUTO_RUN_GZL_BED2();
"
PRC_AUTO_RUN	PROCEDURE	1246	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1247	"  --  PRC_AUTO_RUN_GZL_BED2();
"
PRC_AUTO_RUN	PROCEDURE	1248	"  --dj <0  check
"
PRC_AUTO_RUN	PROCEDURE	1249	"
"
PRC_AUTO_RUN	PROCEDURE	1250	"  if (ls_now > '08:00' and ls_now <= '08:01') or
"
PRC_AUTO_RUN	PROCEDURE	1251	"     (ls_now > '08:30' and ls_now <= '08:31') or
"
PRC_AUTO_RUN	PROCEDURE	1252	"     (ls_now > '09:30' and ls_now <= '09:31') or
"
PRC_AUTO_RUN	PROCEDURE	1253	"     (ls_now > '10:30' and ls_now <= '10:31') or
"
PRC_AUTO_RUN	PROCEDURE	1254	"     (ls_now > '11:30' and ls_now <= '11:31') or
"
PRC_AUTO_RUN	PROCEDURE	1255	"     (ls_now > '12:30' and ls_now <= '12:31') or
"
PRC_AUTO_RUN	PROCEDURE	1256	"     (ls_now > '13:30' and ls_now <= '13:31') or
"
PRC_AUTO_RUN	PROCEDURE	1257	"     (ls_now > '14:30' and ls_now <= '14:31') or
"
PRC_AUTO_RUN	PROCEDURE	1258	"     (ls_now > '15:30' and ls_now <= '15:31') or
"
PRC_AUTO_RUN	PROCEDURE	1259	"     (ls_now > '19:30' and ls_now <= '19:31') or
"
PRC_AUTO_RUN	PROCEDURE	1260	"     (ls_now > '16:30' and ls_now <= '16:31') or
"
PRC_AUTO_RUN	PROCEDURE	1261	"     (ls_now > '17:00' and ls_now <= '17:01') or
"
PRC_AUTO_RUN	PROCEDURE	1262	"     (ls_now > '18:00' and ls_now <= '18:01') then
"
PRC_AUTO_RUN	PROCEDURE	1263	"    if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1264	"    
"
PRC_AUTO_RUN	PROCEDURE	1265	"      if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1266	"      
"
PRC_AUTO_RUN	PROCEDURE	1267	"        select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1268	"          into v_count
"
PRC_AUTO_RUN	PROCEDURE	1269	"          From gy_jrjymx
"
PRC_AUTO_RUN	PROCEDURE	1270	"         where jyje > 0
"
PRC_AUTO_RUN	PROCEDURE	1271	"           and jysj > sysdate - 0.5
"
PRC_AUTO_RUN	PROCEDURE	1272	"           and nvl(zxlsh, shlsh) is null;
"
PRC_AUTO_RUN	PROCEDURE	1273	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1274	"          select 'gy_jrjymx记录异常,交易流水号空' into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	1275	"          lxdh := '13777929515';
"
PRC_AUTO_RUN	PROCEDURE	1276	"          prc_sms_send_mark('au', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1277	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1278	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1279	"    
"
PRC_AUTO_RUN	PROCEDURE	1280	"      -- 万达支付 诊间结算核查
"
PRC_AUTO_RUN	PROCEDURE	1281	"      if 1 = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1282	"        v_temp := '';
"
PRC_AUTO_RUN	PROCEDURE	1283	"        select nvl(to_char(wm_concat(ipaddress)), '')
"
PRC_AUTO_RUN	PROCEDURE	1284	"          into v_temp
"
PRC_AUTO_RUN	PROCEDURE	1285	"          from (select distinct (a.ipaddress) ipaddress
"
PRC_AUTO_RUN	PROCEDURE	1286	"                
"
PRC_AUTO_RUN	PROCEDURE	1287	"                  from mz_mzsfk1 a
"
PRC_AUTO_RUN	PROCEDURE	1288	"                 where a.ipaddress is not null
"
PRC_AUTO_RUN	PROCEDURE	1289	"                   and qtsffs in (16, 17)
"
PRC_AUTO_RUN	PROCEDURE	1290	"                   and qtsfje > 0
"
PRC_AUTO_RUN	PROCEDURE	1291	"                   and czgh in ('AUTO4', 'AUTO5')
"
PRC_AUTO_RUN	PROCEDURE	1292	"                   AND a.sfrq > sysdate - 0.2);
"
PRC_AUTO_RUN	PROCEDURE	1293	"        if length(v_temp) > 2 then
"
PRC_AUTO_RUN	PROCEDURE	1294	"          select v_Procedure_Name || ',万达支付 诊间结算核查:' || v_temp
"
PRC_AUTO_RUN	PROCEDURE	1295	"            into nr
"
PRC_AUTO_RUN	PROCEDURE	1296	"            from dual;
"
PRC_AUTO_RUN	PROCEDURE	1297	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1298	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1299	"      
"
PRC_AUTO_RUN	PROCEDURE	1300	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1301	"    
"
PRC_AUTO_RUN	PROCEDURE	1302	"      --执行失败任务查询  (存储过程，函数失效)    
"
PRC_AUTO_RUN	PROCEDURE	1303	"      if ls_now >= '07:01' and ls_now <= '07:02' then
"
PRC_AUTO_RUN	PROCEDURE	1304	"        if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1305	"          if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1306	"            v_task := '执行失败任务查询';
"
PRC_AUTO_RUN	PROCEDURE	1307	"          
"
PRC_AUTO_RUN	PROCEDURE	1308	"            select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1309	"              into v_count
"
PRC_AUTO_RUN	PROCEDURE	1310	"              from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1311	"             where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN	PROCEDURE	1312	"               and jylsh = v_task
"
PRC_AUTO_RUN	PROCEDURE	1313	"               and jyrq > sysdate - 0.05;
"
PRC_AUTO_RUN	PROCEDURE	1314	"            --最近1小时已经执行过
"
PRC_AUTO_RUN	PROCEDURE	1315	"            if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1316	"              v_task := ' ';
"
PRC_AUTO_RUN	PROCEDURE	1317	"            end if;
"
PRC_AUTO_RUN	PROCEDURE	1318	"          
"
PRC_AUTO_RUN	PROCEDURE	1319	"            if v_task = '执行失败任务查询' then
"
PRC_AUTO_RUN	PROCEDURE	1320	"              insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1321	"                (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN	PROCEDURE	1322	"              values
"
PRC_AUTO_RUN	PROCEDURE	1323	"                (v_Procedure_Name, v_task, 0);
"
PRC_AUTO_RUN	PROCEDURE	1324	"              commit;
"
PRC_AUTO_RUN	PROCEDURE	1325	"            
"
PRC_AUTO_RUN	PROCEDURE	1326	"              select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1327	"                into v_count
"
PRC_AUTO_RUN	PROCEDURE	1328	"                from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1329	"               where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN	PROCEDURE	1330	"                 and flag = -1
"
PRC_AUTO_RUN	PROCEDURE	1331	"                 and jyrq > sysdate - 1.05;
"
PRC_AUTO_RUN	PROCEDURE	1332	"              if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1333	"                select v_Procedure_Name || ',执行失败任务,sl:' ||
"
PRC_AUTO_RUN	PROCEDURE	1334	"                       to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1335	"                  into nr
"
PRC_AUTO_RUN	PROCEDURE	1336	"                  from dual;
"
PRC_AUTO_RUN	PROCEDURE	1337	"                prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1338	"              end if;
"
PRC_AUTO_RUN	PROCEDURE	1339	"            end if;
"
PRC_AUTO_RUN	PROCEDURE	1340	"          
"
PRC_AUTO_RUN	PROCEDURE	1341	"          end if;
"
PRC_AUTO_RUN	PROCEDURE	1342	"        
"
PRC_AUTO_RUN	PROCEDURE	1343	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1344	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1345	"    
"
PRC_AUTO_RUN	PROCEDURE	1346	"      --日间病人处理
"
PRC_AUTO_RUN	PROCEDURE	1347	"      --  PRO_ITEM_DO('日间病人处理', '00000006', v_bz);    
"
PRC_AUTO_RUN	PROCEDURE	1348	"      -- zy_detail_charge curr_ks is null 
"
PRC_AUTO_RUN	PROCEDURE	1349	"      if 1 <> 1 then
"
PRC_AUTO_RUN	PROCEDURE	1350	"        select COUNT(*)
"
PRC_AUTO_RUN	PROCEDURE	1351	"          INTO v_count
"
PRC_AUTO_RUN	PROCEDURE	1352	"          From zy_detail_charge
"
PRC_AUTO_RUN	PROCEDURE	1353	"         where js_NO = 0
"
PRC_AUTO_RUN	PROCEDURE	1354	"           and dj < 0
"
PRC_AUTO_RUN	PROCEDURE	1355	"           and jcfx_date > sysdate - 1
"
PRC_AUTO_RUN	PROCEDURE	1356	"           and jcfx_date < sysdate - 0.001;
"
PRC_AUTO_RUN	PROCEDURE	1357	"      
"
PRC_AUTO_RUN	PROCEDURE	1358	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1359	"          select v_Procedure_Name || ',curr_ks is nul,sl:' ||
"
PRC_AUTO_RUN	PROCEDURE	1360	"                 to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1361	"            into nr
"
PRC_AUTO_RUN	PROCEDURE	1362	"            from dual;
"
PRC_AUTO_RUN	PROCEDURE	1363	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1364	"        
"
PRC_AUTO_RUN	PROCEDURE	1365	"          update zy_detail_charge
"
PRC_AUTO_RUN	PROCEDURE	1366	"             set dj = dj * -1, sl = sl * -1
"
PRC_AUTO_RUN	PROCEDURE	1367	"           where js_NO = 0
"
PRC_AUTO_RUN	PROCEDURE	1368	"             and dj < 0
"
PRC_AUTO_RUN	PROCEDURE	1369	"             and jcfx_date > sysdate - 1
"
PRC_AUTO_RUN	PROCEDURE	1370	"             and jcfx_date < sysdate - 0.001;
"
PRC_AUTO_RUN	PROCEDURE	1371	"          if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1372	"            commit;
"
PRC_AUTO_RUN	PROCEDURE	1373	"          else
"
PRC_AUTO_RUN	PROCEDURE	1374	"            rollback;
"
PRC_AUTO_RUN	PROCEDURE	1375	"          end if;
"
PRC_AUTO_RUN	PROCEDURE	1376	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1377	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1378	"    
"
PRC_AUTO_RUN	PROCEDURE	1379	"      --住院预缴款退款失败    
"
PRC_AUTO_RUN	PROCEDURE	1380	"      if 3 = 3 and ls_now >= '09:01' and ls_now <= '09:02' then
"
PRC_AUTO_RUN	PROCEDURE	1381	"        select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1382	"          into v_count
"
PRC_AUTO_RUN	PROCEDURE	1383	"          from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	1384	"         where depo_date > sysdate - 3
"
PRC_AUTO_RUN	PROCEDURE	1385	"           and AMOUNT < 0
"
PRC_AUTO_RUN	PROCEDURE	1386	"           and nvl(cdcs, 0) = 0
"
PRC_AUTO_RUN	PROCEDURE	1387	"           and length(bz) > 30
"
PRC_AUTO_RUN	PROCEDURE	1388	"           and depo_type > 1;
"
PRC_AUTO_RUN	PROCEDURE	1389	"      
"
PRC_AUTO_RUN	PROCEDURE	1390	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1391	"          select v_Procedure_Name || ',住院预缴款退款失败,sl:' || to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1392	"            into nr
"
PRC_AUTO_RUN	PROCEDURE	1393	"            from dual;
"
PRC_AUTO_RUN	PROCEDURE	1394	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1395	"        
"
PRC_AUTO_RUN	PROCEDURE	1396	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1397	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1398	"    
"
PRC_AUTO_RUN	PROCEDURE	1399	"      -- (存储过程，函数失效)
"
PRC_AUTO_RUN	PROCEDURE	1400	"    
"
PRC_AUTO_RUN	PROCEDURE	1401	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1402	"  
"
PRC_AUTO_RUN	PROCEDURE	1403	"    --  zy_patient_information.jtbf_flag  is null 
"
PRC_AUTO_RUN	PROCEDURE	1404	"    if 2 <> 2 then
"
PRC_AUTO_RUN	PROCEDURE	1405	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1406	"        INTO v_count
"
PRC_AUTO_RUN	PROCEDURE	1407	"        from zy_patient_information y
"
PRC_AUTO_RUN	PROCEDURE	1408	"       where patient_No in (select patient_NO
"
PRC_AUTO_RUN	PROCEDURE	1409	"                              from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	1410	"                             where depo_date > sysdate - 2)
"
PRC_AUTO_RUN	PROCEDURE	1411	"         and jtbf_flag is null;
"
PRC_AUTO_RUN	PROCEDURE	1412	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1413	"        select v_Procedure_Name ||
"
PRC_AUTO_RUN	PROCEDURE	1414	"               ',zy_patient_information.jtbf_flag is nul,sl:' ||
"
PRC_AUTO_RUN	PROCEDURE	1415	"               to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1416	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	1417	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	1418	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1419	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1420	"      update zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	1421	"         set jtbf_flag = 0
"
PRC_AUTO_RUN	PROCEDURE	1422	"       where patient_No in
"
PRC_AUTO_RUN	PROCEDURE	1423	"             (select patient_NO
"
PRC_AUTO_RUN	PROCEDURE	1424	"                from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	1425	"               where depo_date > sysdate - 0.6
"
PRC_AUTO_RUN	PROCEDURE	1426	"                 and depo_date < sysdate - 0.001)
"
PRC_AUTO_RUN	PROCEDURE	1427	"         and jtbf_flag is null;
"
PRC_AUTO_RUN	PROCEDURE	1428	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1429	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	1430	"      else
"
PRC_AUTO_RUN	PROCEDURE	1431	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	1432	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1433	"    
"
PRC_AUTO_RUN	PROCEDURE	1434	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1435	"        INTO v_count
"
PRC_AUTO_RUN	PROCEDURE	1436	"        From (select rb_date, sum(je1) aa, sum(je2) bb
"
PRC_AUTO_RUN	PROCEDURE	1437	"                from (select rb_date rb_date, sum(xmje2) je1, 0 je2
"
PRC_AUTO_RUN	PROCEDURE	1438	"                        From zy_rbk2
"
PRC_AUTO_RUN	PROCEDURE	1439	"                       where rb_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	1440	"                         and hh in (27)
"
PRC_AUTO_RUN	PROCEDURE	1441	"                       group by rb_date
"
PRC_AUTO_RUN	PROCEDURE	1442	"                      union all
"
PRC_AUTO_RUN	PROCEDURE	1443	"                      select rb_date, 0 je1, sum(amount) je2
"
PRC_AUTO_RUN	PROCEDURE	1444	"                        from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	1445	"                       where rb_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	1446	"                       group by rb_date)
"
PRC_AUTO_RUN	PROCEDURE	1447	"               group by rb_date)
"
PRC_AUTO_RUN	PROCEDURE	1448	"       where aa <> bb;
"
PRC_AUTO_RUN	PROCEDURE	1449	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1450	"        select v_Procedure_Name || ',住院日报预计款不平  ,sl:' || to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1451	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	1452	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	1453	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1454	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1455	"    
"
PRC_AUTO_RUN	PROCEDURE	1456	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1457	"  
"
PRC_AUTO_RUN	PROCEDURE	1458	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1459	"
"
PRC_AUTO_RUN	PROCEDURE	1460	"  --住院收费 调整工号  加上 2020抢号
"
PRC_AUTO_RUN	PROCEDURE	1461	"  if (ls_now > '17:00' and ls_now <= '17:01') or
"
PRC_AUTO_RUN	PROCEDURE	1462	"     (ls_now > '13:30' and ls_now <= '13:31') or
"
PRC_AUTO_RUN	PROCEDURE	1463	"     (ls_now > '10:30' and ls_now <= '10:31') or
"
PRC_AUTO_RUN	PROCEDURE	1464	"     (ls_now > '15:30' and ls_now <= '15:31') or
"
PRC_AUTO_RUN	PROCEDURE	1465	"     (ls_now > '07:30' and ls_now <= '07:31') or
"
PRC_AUTO_RUN	PROCEDURE	1466	"     (ls_now > '04:30' and ls_now <= '04:31') then
"
PRC_AUTO_RUN	PROCEDURE	1467	"  
"
PRC_AUTO_RUN	PROCEDURE	1468	"    --'2020抢号渠道'
"
PRC_AUTO_RUN	PROCEDURE	1469	"    if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1470	"    
"
PRC_AUTO_RUN	PROCEDURE	1471	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1472	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	1473	"        from (select to_char(yyrq1, 'yyyy-mm-dd'), pbxh, count(*)
"
PRC_AUTO_RUN	PROCEDURE	1474	"                from gh_mzyyk
"
PRC_AUTO_RUN	PROCEDURE	1475	"               where zt >= 0
"
PRC_AUTO_RUN	PROCEDURE	1476	"                 and NVL(CZGH, '0') = 'ZSYY2'
"
PRC_AUTO_RUN	PROCEDURE	1477	"                 and yyrq1 >= trunc(sysdate)
"
PRC_AUTO_RUN	PROCEDURE	1478	"                 and xxczid = '2020抢号渠道'
"
PRC_AUTO_RUN	PROCEDURE	1479	"               group by to_char(yyrq1, 'yyyy-mm-dd'), pbxh
"
PRC_AUTO_RUN	PROCEDURE	1480	"              having count(*) > 3);
"
PRC_AUTO_RUN	PROCEDURE	1481	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1482	"        select v_Procedure_Name || ',2020抢号渠道  ysgh>3  '
"
PRC_AUTO_RUN	PROCEDURE	1483	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	1484	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	1485	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1486	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1487	"    
"
PRC_AUTO_RUN	PROCEDURE	1488	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1489	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	1490	"        from (select sfzh, count(*)
"
PRC_AUTO_RUN	PROCEDURE	1491	"                from gh_mzyyk
"
PRC_AUTO_RUN	PROCEDURE	1492	"               where zt >= 0
"
PRC_AUTO_RUN	PROCEDURE	1493	"                 and NVL(CZGH, '0') = 'ZSYY2'
"
PRC_AUTO_RUN	PROCEDURE	1494	"                 and yyrq1 >= trunc(to_date('20200511', 'yyyymmdd'))
"
PRC_AUTO_RUN	PROCEDURE	1495	"                 and xxczid = '2020抢号渠道'
"
PRC_AUTO_RUN	PROCEDURE	1496	"               group by sfzh
"
PRC_AUTO_RUN	PROCEDURE	1497	"              having count(*) > 1);
"
PRC_AUTO_RUN	PROCEDURE	1498	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1499	"        select v_Procedure_Name || ',2020抢号渠道 sfzh>1  '
"
PRC_AUTO_RUN	PROCEDURE	1500	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	1501	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	1502	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1503	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1504	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1505	"  
"
PRC_AUTO_RUN	PROCEDURE	1506	"    -- --L0482  L0449 L0481
"
PRC_AUTO_RUN	PROCEDURE	1507	"    update zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1508	"       set fplx = 1
"
PRC_AUTO_RUN	PROCEDURE	1509	"     where
"
PRC_AUTO_RUN	PROCEDURE	1510	"    --op_id in ('L0259', 'L0484', 'L0481', 'L0480', 'L0482', 'L0449')
"
PRC_AUTO_RUN	PROCEDURE	1511	"     op_id in ('L0259', 'L0484', '', 'L0480', '', '')
"
PRC_AUTO_RUN	PROCEDURE	1512	"     and nvl(fplx, 0) = 0
"
PRC_AUTO_RUN	PROCEDURE	1513	"     and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1514	"     and flag > 0
"
PRC_AUTO_RUN	PROCEDURE	1515	"     and jz_date > sysdate - 0.5;
"
PRC_AUTO_RUN	PROCEDURE	1516	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1517	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	1518	"      select v_Procedure_Name || ',住院收费 调整工号  ' into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	1519	"      -- prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1520	"    else
"
PRC_AUTO_RUN	PROCEDURE	1521	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	1522	"      select v_Procedure_Name || ',住院收费 调整工号 error XXXX  '
"
PRC_AUTO_RUN	PROCEDURE	1523	"        into nr
"
PRC_AUTO_RUN	PROCEDURE	1524	"        from dual;
"
PRC_AUTO_RUN	PROCEDURE	1525	"      -- prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1526	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1527	"  
"
PRC_AUTO_RUN	PROCEDURE	1528	"    if (ls_now > '17:31') then
"
PRC_AUTO_RUN	PROCEDURE	1529	"      select '当天住院智慧结算率,' ||
"
PRC_AUTO_RUN	PROCEDURE	1530	"             round(x.sl * 100 / decode(y.sl, 0, 1, y.sl), 2) || '%'
"
PRC_AUTO_RUN	PROCEDURE	1531	"        into nr
"
PRC_AUTO_RUN	PROCEDURE	1532	"        from (select count(*) sl
"
PRC_AUTO_RUN	PROCEDURE	1533	"                from zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1534	"               where nvl(fplx, 0) <> 2
"
PRC_AUTO_RUN	PROCEDURE	1535	"                 and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1536	"                 and flag > 0
"
PRC_AUTO_RUN	PROCEDURE	1537	"                 and trunc(jz_date) = trunc(sysdate)
"
PRC_AUTO_RUN	PROCEDURE	1538	"                 and (op_Id like 'AUTO%' or op_Id like 'JD%' or
"
PRC_AUTO_RUN	PROCEDURE	1539	"                      op_id in ('L0259', 'L0484', '', 'L0480', '', ''))) x,
"
PRC_AUTO_RUN	PROCEDURE	1540	"             (select count(*) sl
"
PRC_AUTO_RUN	PROCEDURE	1541	"                from zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1542	"               where js_no >= 1
"
PRC_AUTO_RUN	PROCEDURE	1543	"                 and flag > 0
"
PRC_AUTO_RUN	PROCEDURE	1544	"                 and trunc(jz_date) = trunc(sysdate)) y;
"
PRC_AUTO_RUN	PROCEDURE	1545	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1546	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1547	"    if (ls_now <= '07:31') then
"
PRC_AUTO_RUN	PROCEDURE	1548	"      --20200211
"
PRC_AUTO_RUN	PROCEDURE	1549	"      v_sl_count := 0;
"
PRC_AUTO_RUN	PROCEDURE	1550	"      loop
"
PRC_AUTO_RUN	PROCEDURE	1551	"        v_sl_count := v_sl_count + 1;
"
PRC_AUTO_RUN	PROCEDURE	1552	"        select 100 - bl into v_sl from v_temp_20200211_jsv;
"
PRC_AUTO_RUN	PROCEDURE	1553	"        EXIT WHEN v_sl >= 69 and v_sl <= 74;
"
PRC_AUTO_RUN	PROCEDURE	1554	"      
"
PRC_AUTO_RUN	PROCEDURE	1555	"        EXIT WHEN v_sl_count > 10;
"
PRC_AUTO_RUN	PROCEDURE	1556	"        if v_sl < 69 then
"
PRC_AUTO_RUN	PROCEDURE	1557	"        
"
PRC_AUTO_RUN	PROCEDURE	1558	"          update zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1559	"             set fplx = 1
"
PRC_AUTO_RUN	PROCEDURE	1560	"           where patient_no in
"
PRC_AUTO_RUN	PROCEDURE	1561	"                 (select patient_No
"
PRC_AUTO_RUN	PROCEDURE	1562	"                    from (select rownum, mod(rownum, 10) mod_flag, patient_No
"
PRC_AUTO_RUN	PROCEDURE	1563	"                            from zy_total_fee x
"
PRC_AUTO_RUN	PROCEDURE	1564	"                           where op_id like 'L%'
"
PRC_AUTO_RUN	PROCEDURE	1565	"                             and nvl(fplx, 0) <> 1
"
PRC_AUTO_RUN	PROCEDURE	1566	"                             and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1567	"                             and trunc(jz_date) = trunc(sysdate - 1))
"
PRC_AUTO_RUN	PROCEDURE	1568	"                   where mod_flag = 1)
"
PRC_AUTO_RUN	PROCEDURE	1569	"             and op_id like 'L%'
"
PRC_AUTO_RUN	PROCEDURE	1570	"             and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1571	"             and trunc(jz_date) = trunc(sysdate - 1);
"
PRC_AUTO_RUN	PROCEDURE	1572	"        
"
PRC_AUTO_RUN	PROCEDURE	1573	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1574	"      
"
PRC_AUTO_RUN	PROCEDURE	1575	"        if v_sl > 74 then
"
PRC_AUTO_RUN	PROCEDURE	1576	"          update zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1577	"             set fplx = 2
"
PRC_AUTO_RUN	PROCEDURE	1578	"           where patient_no in
"
PRC_AUTO_RUN	PROCEDURE	1579	"                 (select patient_No
"
PRC_AUTO_RUN	PROCEDURE	1580	"                    from (select rownum, mod(rownum, 10) mod_flag, patient_No
"
PRC_AUTO_RUN	PROCEDURE	1581	"                            from zy_total_fee x
"
PRC_AUTO_RUN	PROCEDURE	1582	"                           where op_id like 'L%'
"
PRC_AUTO_RUN	PROCEDURE	1583	"                             and nvl(fplx, 0) = 1
"
PRC_AUTO_RUN	PROCEDURE	1584	"                             and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1585	"                             and trunc(jz_date) = trunc(sysdate - 1))
"
PRC_AUTO_RUN	PROCEDURE	1586	"                   where mod_flag = 1)
"
PRC_AUTO_RUN	PROCEDURE	1587	"             and op_id like 'L%'
"
PRC_AUTO_RUN	PROCEDURE	1588	"             and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1589	"             and trunc(jz_date) = trunc(sysdate - 1);
"
PRC_AUTO_RUN	PROCEDURE	1590	"        
"
PRC_AUTO_RUN	PROCEDURE	1591	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1592	"        if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1593	"          commit;
"
PRC_AUTO_RUN	PROCEDURE	1594	"        else
"
PRC_AUTO_RUN	PROCEDURE	1595	"          rollback;
"
PRC_AUTO_RUN	PROCEDURE	1596	"        
"
PRC_AUTO_RUN	PROCEDURE	1597	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1598	"      
"
PRC_AUTO_RUN	PROCEDURE	1599	"      end loop;
"
PRC_AUTO_RUN	PROCEDURE	1600	"    
"
PRC_AUTO_RUN	PROCEDURE	1601	"      select to_char(trunc(sysdate - 1), 'yyyy-mm-dd') || '住院智慧结算率,' ||
"
PRC_AUTO_RUN	PROCEDURE	1602	"             round(x.sl * 100 / decode(y.sl, 0, 1, y.sl), 2) || '%'
"
PRC_AUTO_RUN	PROCEDURE	1603	"        into nr
"
PRC_AUTO_RUN	PROCEDURE	1604	"        from (select count(*) sl
"
PRC_AUTO_RUN	PROCEDURE	1605	"                from zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1606	"               where nvl(fplx, 0) <> 2
"
PRC_AUTO_RUN	PROCEDURE	1607	"                 and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1608	"                 and flag > 0
"
PRC_AUTO_RUN	PROCEDURE	1609	"                 and trunc(jz_date) = trunc(sysdate - 1)
"
PRC_AUTO_RUN	PROCEDURE	1610	"                 and (op_Id like 'AUTO%' or op_Id like 'JD%' or fplx = 1)) x,
"
PRC_AUTO_RUN	PROCEDURE	1611	"             (select count(*) sl
"
PRC_AUTO_RUN	PROCEDURE	1612	"                from zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1613	"               where js_no >= 1
"
PRC_AUTO_RUN	PROCEDURE	1614	"                 and flag > 0
"
PRC_AUTO_RUN	PROCEDURE	1615	"                 and trunc(jz_date) = trunc(sysdate - 1)) y;
"
PRC_AUTO_RUN	PROCEDURE	1616	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1617	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1618	"  
"
PRC_AUTO_RUN	PROCEDURE	1619	"    --最近20分钟短信发送数据
"
PRC_AUTO_RUN	PROCEDURE	1620	"    if 3 = 3 then
"
PRC_AUTO_RUN	PROCEDURE	1621	"    
"
PRC_AUTO_RUN	PROCEDURE	1622	"      select to_char(sysdate, 'yyyymmdd hh24:mi:ss') || '最近40分钟短信发送数据'
"
PRC_AUTO_RUN	PROCEDURE	1623	"        into nr
"
PRC_AUTO_RUN	PROCEDURE	1624	"        from (select count(xh) sl
"
PRC_AUTO_RUN	PROCEDURE	1625	"                From auto_task_ywzx_send
"
PRC_AUTO_RUN	PROCEDURE	1626	"               where (date_send > sysdate - 0.03 and
"
PRC_AUTO_RUN	PROCEDURE	1627	"                     date_send < sysdate + 0.01))
"
PRC_AUTO_RUN	PROCEDURE	1628	"       where sl > 0;
"
PRC_AUTO_RUN	PROCEDURE	1629	"    
"
PRC_AUTO_RUN	PROCEDURE	1630	"      if length(nr) > 1 then
"
PRC_AUTO_RUN	PROCEDURE	1631	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1632	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1633	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1634	"  
"
PRC_AUTO_RUN	PROCEDURE	1635	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1636	"
"
PRC_AUTO_RUN	PROCEDURE	1637	"  --prc_auto_task_v1();
"
PRC_AUTO_RUN	PROCEDURE	1638	"  if ls_now > '17:01' and ls_now <= '17:02' then
"
PRC_AUTO_RUN	PROCEDURE	1639	"    prc_auto_task_v1();
"
PRC_AUTO_RUN	PROCEDURE	1640	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1641	"  --
"
PRC_AUTO_RUN	PROCEDURE	1642	"
"
PRC_AUTO_RUN	PROCEDURE	1643	"  if (ls_now > '13:31' and ls_now <= '13:32') or
"
PRC_AUTO_RUN	PROCEDURE	1644	"     (ls_now > '21:01' and ls_now <= '21:02') or
"
PRC_AUTO_RUN	PROCEDURE	1645	"     (ls_now > '06:45' and ls_now <= '06:46') then
"
PRC_AUTO_RUN	PROCEDURE	1646	"  
"
PRC_AUTO_RUN	PROCEDURE	1647	"    select v_Procedure_Name || ',测试短信发送,医保未上传:' ||
"
PRC_AUTO_RUN	PROCEDURE	1648	"           count(distinct(patient_no))
"
PRC_AUTO_RUN	PROCEDURE	1649	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	1650	"      from zy_detail_charge
"
PRC_AUTO_RUN	PROCEDURE	1651	"     where scrq < sysdate - 300
"
PRC_AUTO_RUN	PROCEDURE	1652	"       and jcfx_date < sysdate - 1.5
"
PRC_AUTO_RUN	PROCEDURE	1653	"       and js_no = 0
"
PRC_AUTO_RUN	PROCEDURE	1654	"       and patient_No in (select patient_No
"
PRC_AUTO_RUN	PROCEDURE	1655	"                            From zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	1656	"                           where js_no = 0
"
PRC_AUTO_RUN	PROCEDURE	1657	"                             and brlb = 97
"
PRC_AUTO_RUN	PROCEDURE	1658	"                             and jz_date > sysdate - 2);
"
PRC_AUTO_RUN	PROCEDURE	1659	"  
"
PRC_AUTO_RUN	PROCEDURE	1660	"    --select v_Procedure_Name || ',测试短信发送 ' into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	1661	"    prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1662	"  
"
PRC_AUTO_RUN	PROCEDURE	1663	"    --核查价格修改 
"
PRC_AUTO_RUN	PROCEDURE	1664	"    if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1665	"      select to_char(trunc(sysdate), 'yyyy-mm-dd') || ' 00:00:01'
"
PRC_AUTO_RUN	PROCEDURE	1666	"        into v_temp
"
PRC_AUTO_RUN	PROCEDURE	1667	"        from dual;
"
PRC_AUTO_RUN	PROCEDURE	1668	"      v_count := 0;
"
PRC_AUTO_RUN	PROCEDURE	1669	"      select count(x.glxh)
"
PRC_AUTO_RUN	PROCEDURE	1670	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	1671	"        from ((select a.glxh, sum(b.dj * a.sl) je
"
PRC_AUTO_RUN	PROCEDURE	1672	"                 From gy_ylsftc a, gy_Ylsf b
"
PRC_AUTO_RUN	PROCEDURE	1673	"                where a.ylxh = b.ylxh
"
PRC_AUTO_RUN	PROCEDURE	1674	"                  and nvl(a.yppb, 0) = 0
"
PRC_AUTO_RUN	PROCEDURE	1675	"                group by a.glxh)) x,
"
PRC_AUTO_RUN	PROCEDURE	1676	"             (select a.glxh, sum(b.dj * a.sl) je
"
PRC_AUTO_RUN	PROCEDURE	1677	"                From gy_ylsftc as of timestamp to_timestamp(v_temp, 'yyyy-mm-dd hh24:mi:ss') a,
"
PRC_AUTO_RUN	PROCEDURE	1678	"                     gy_Ylsf   as of timestamp to_timestamp(v_temp, 'yyyy-mm-dd hh24:mi:ss'  ) b
"
PRC_AUTO_RUN	PROCEDURE	1679	"               where a.ylxh = b.ylxh
"
PRC_AUTO_RUN	PROCEDURE	1680	"                 and nvl(a.yppb, 0) = 0
"
PRC_AUTO_RUN	PROCEDURE	1681	"               group by a.glxh) y
"
PRC_AUTO_RUN	PROCEDURE	1682	"       where x.glxh = y.glxh
"
PRC_AUTO_RUN	PROCEDURE	1683	"         and x.je <> y.je;
"
PRC_AUTO_RUN	PROCEDURE	1684	"    
"
PRC_AUTO_RUN	PROCEDURE	1685	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1686	"        select '套餐价格调整： ' || v_count into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	1687	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1688	"        prc_sms_send('ts', '15657971559', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1689	"        select substr(wm_concat((select ylmc
"
PRC_AUTO_RUN	PROCEDURE	1690	"                                   from gy_ylsf
"
PRC_AUTO_RUN	PROCEDURE	1691	"                                  where ylxh = x.glxh) || y.je || ' 调整为' || x.je),
"
PRC_AUTO_RUN	PROCEDURE	1692	"                      1,
"
PRC_AUTO_RUN	PROCEDURE	1693	"                      200)
"
PRC_AUTO_RUN	PROCEDURE	1694	"          into v_msg
"
PRC_AUTO_RUN	PROCEDURE	1695	"          from ((select a.glxh, sum(b.dj * a.sl) je
"
PRC_AUTO_RUN	PROCEDURE	1696	"                   From gy_ylsftc a, gy_Ylsf b
"
PRC_AUTO_RUN	PROCEDURE	1697	"                  where a.ylxh = b.ylxh
"
PRC_AUTO_RUN	PROCEDURE	1698	"                    and nvl(a.yppb, 0) = 0
"
PRC_AUTO_RUN	PROCEDURE	1699	"                  group by a.glxh)) x,
"
PRC_AUTO_RUN	PROCEDURE	1700	"               (select a.glxh, sum(b.dj * a.sl) je
"
PRC_AUTO_RUN	PROCEDURE	1701	"                  From gy_ylsftc as of timestamp to_timestamp(v_temp, 'yyyy-mm-dd hh24:mi:ss') a,
"
PRC_AUTO_RUN	PROCEDURE	1702	"                       gy_Ylsf   as of timestamp to_timestamp(v_temp, 'yyyy-mm-dd hh24:mi:ss'  ) b
"
PRC_AUTO_RUN	PROCEDURE	1703	"                 where a.ylxh = b.ylxh
"
PRC_AUTO_RUN	PROCEDURE	1704	"                   and nvl(a.yppb, 0) = 0
"
PRC_AUTO_RUN	PROCEDURE	1705	"                 group by a.glxh) y
"
PRC_AUTO_RUN	PROCEDURE	1706	"         where x.glxh = y.glxh
"
PRC_AUTO_RUN	PROCEDURE	1707	"           and x.je <> y.je;
"
PRC_AUTO_RUN	PROCEDURE	1708	"        select v_msg into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	1709	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1710	"        prc_sms_send('ts', '15657971559', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1711	"      
"
PRC_AUTO_RUN	PROCEDURE	1712	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1713	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1714	"  
"
PRC_AUTO_RUN	PROCEDURE	1715	"    -- 床位费滚收 js_no<>0 
"
PRC_AUTO_RUN	PROCEDURE	1716	"    if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1717	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1718	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	1719	"        From zy_detail_charge t, zy_patient_information y
"
PRC_AUTO_RUN	PROCEDURE	1720	"       where t.patient_no = y.patient_no
"
PRC_AUTO_RUN	PROCEDURE	1721	"         and t.twice_detail_code = 'AU'
"
PRC_AUTO_RUN	PROCEDURE	1722	"         and t.jcfx_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	1723	"         and y.js_NO > 0
"
PRC_AUTO_RUN	PROCEDURE	1724	"            -- and t.js_No=0
"
PRC_AUTO_RUN	PROCEDURE	1725	"         and sl > 2;
"
PRC_AUTO_RUN	PROCEDURE	1726	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1727	"        select v_Procedure_Name || ',床位费滚收 js_no<>0 ,: ' || v_count
"
PRC_AUTO_RUN	PROCEDURE	1728	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	1729	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	1730	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1731	"      
"
PRC_AUTO_RUN	PROCEDURE	1732	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1733	"    
"
PRC_AUTO_RUN	PROCEDURE	1734	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1735	"  
"
PRC_AUTO_RUN	PROCEDURE	1736	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1737	"
"
PRC_AUTO_RUN	PROCEDURE	1738	"  /*  ln_jcfx_id := To_Number( To_Char( Sysdate - 1, 'YYYYMMD\*D' ));
"
PRC_AUTO_RUN	PROCEDURE	1739	"  pkg_jcfx.prc_zy_sjcj_au( ln_jcfx_id, 1, ln_code, ls_mess );*/
"
PRC_AUTO_RUN	PROCEDURE	1740	"
"
PRC_AUTO_RUN	PROCEDURE	1741	"  /*      select 'zy_detail_charge curr is null，记录为:' || to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1742	"    into nr
"
PRC_AUTO_RUN	PROCEDURE	1743	"    from dual;
"
PRC_AUTO_RUN	PROCEDURE	1744	"  lxdh := '13777929515';
"
PRC_AUTO_RUN	PROCEDURE	1745	"  prc_sms_send('ts', lxdh, nr, v_bz);*/
"
PRC_AUTO_RUN	PROCEDURE	1746	"
"
PRC_AUTO_RUN	PROCEDURE	1747	"  /*  insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1748	"    (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN	PROCEDURE	1749	"  values
"
PRC_AUTO_RUN	PROCEDURE	1750	"    (v_Procedure_Name, '结束', 1);
"
PRC_AUTO_RUN	PROCEDURE	1751	"  commit;*/
"
PRC_AUTO_RUN	PROCEDURE	1752	"
"
PRC_AUTO_RUN	PROCEDURE	1753	"End;
"
