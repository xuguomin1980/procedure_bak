PRC_AUTO_RUN	PROCEDURE	1	"PROCEDURE prc_auto_run Is
"
PRC_AUTO_RUN	PROCEDURE	2	"
"
PRC_AUTO_RUN	PROCEDURE	3	"  /*=============================================================================
"
PRC_AUTO_RUN	PROCEDURE	4	"  || 过程名称 ： PRC_AUTO_RUN 后台自动运行
"
PRC_AUTO_RUN	PROCEDURE	5	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN	PROCEDURE	6	"  || 功能说明 ：  JOB 定时10分钟 执行 后台任务
"
PRC_AUTO_RUN	PROCEDURE	7	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN	PROCEDURE	8	"  || 参数描述 ： 无
"
PRC_AUTO_RUN	PROCEDURE	9	"  ------------------------------------------------------------
"
PRC_AUTO_RUN	PROCEDURE	10	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN	PROCEDURE	11	"  || 注意事项 ：
"
PRC_AUTO_RUN	PROCEDURE	12	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN	PROCEDURE	13	"  || 作    者 ：       完成日期 ：
"
PRC_AUTO_RUN	PROCEDURE	14	"  ||-----------------------------------------------------------------------------
"
PRC_AUTO_RUN	PROCEDURE	15	"  || 修改记录 ：
"
PRC_AUTO_RUN	PROCEDURE	16	"  =============================================================================*/
"
PRC_AUTO_RUN	PROCEDURE	17	"  v_Procedure_Name Varchar2(50);
"
PRC_AUTO_RUN	PROCEDURE	18	"  v_task           Varchar2(30);
"
PRC_AUTO_RUN	PROCEDURE	19	"
"
PRC_AUTO_RUN	PROCEDURE	20	"  ln_jcfx_id   Number;
"
PRC_AUTO_RUN	PROCEDURE	21	"  ln_code      Number;
"
PRC_AUTO_RUN	PROCEDURE	22	"  ls_mess      Varchar2(100);
"
PRC_AUTO_RUN	PROCEDURE	23	"  v_count      number;
"
PRC_AUTO_RUN	PROCEDURE	24	"  v_xh         number;
"
PRC_AUTO_RUN	PROCEDURE	25	"  ls_now       Varchar2(20);
"
PRC_AUTO_RUN	PROCEDURE	26	"  ls_now_minue Varchar2(20);
"
PRC_AUTO_RUN	PROCEDURE	27	"  lxdh         Varchar2(20);
"
PRC_AUTO_RUN	PROCEDURE	28	"  nr           Varchar2(200);
"
PRC_AUTO_RUN	PROCEDURE	29	"  v_bz         Varchar2(200);
"
PRC_AUTO_RUN	PROCEDURE	30	"  v_temp       Varchar2(100);
"
PRC_AUTO_RUN	PROCEDURE	31	"  v_jzkh       Varchar2(100);
"
PRC_AUTO_RUN	PROCEDURE	32	"  v_msg        Varchar2(300);
"
PRC_AUTO_RUN	PROCEDURE	33	"  v_sl         Number;
"
PRC_AUTO_RUN	PROCEDURE	34	"  v_sl_count   Number;
"
PRC_AUTO_RUN	PROCEDURE	35	"  v_laborder   Number;
"
PRC_AUTO_RUN	PROCEDURE	36	"  v_out_code   Number;
"
PRC_AUTO_RUN	PROCEDURE	37	"  v_out_msg    Varchar2(300);
"
PRC_AUTO_RUN	PROCEDURE	38	"  v_yyxh       number;
"
PRC_AUTO_RUN	PROCEDURE	39	"  v_lxdh       NVARCHAR2(30);
"
PRC_AUTO_RUN	PROCEDURE	40	"  v_ypxh       Number;
"
PRC_AUTO_RUN	PROCEDURE	41	"  v_ypcddm     Number;
"
PRC_AUTO_RUN	PROCEDURE	42	"
"
PRC_AUTO_RUN	PROCEDURE	43	"  --预约挂号提醒
"
PRC_AUTO_RUN	PROCEDURE	44	"  cursor cur_mzyyk is
"
PRC_AUTO_RUN	PROCEDURE	45	"    select yyxh
"
PRC_AUTO_RUN	PROCEDURE	46	"      from gh_mzyyk
"
PRC_AUTO_RUN	PROCEDURE	47	"     where djrq > sysdate - 0.01
"
PRC_AUTO_RUN	PROCEDURE	48	"       and djrq < sysdate - 0.001
"
PRC_AUTO_RUN	PROCEDURE	49	"       and czgh < 'Z'
"
PRC_AUTO_RUN	PROCEDURE	50	"       and czgh >= 'B'
"
PRC_AUTO_RUN	PROCEDURE	51	"       and yyxh not in (
"
PRC_AUTO_RUN	PROCEDURE	52	"                        
"
PRC_AUTO_RUN	PROCEDURE	53	"                        select yyxh
"
PRC_AUTO_RUN	PROCEDURE	54	"                          from (select yyxh, lxdh
"
PRC_AUTO_RUN	PROCEDURE	55	"                                   From gh_mzyyk
"
PRC_AUTO_RUN	PROCEDURE	56	"                                  where djrq >= sysdate - 0.015
"
PRC_AUTO_RUN	PROCEDURE	57	"                                    and czgh < 'Z'
"
PRC_AUTO_RUN	PROCEDURE	58	"                                    and czgh >= 'B') x,
"
PRC_AUTO_RUN	PROCEDURE	59	"                                auto_task_ywzx_send y
"
PRC_AUTO_RUN	PROCEDURE	60	"                         where instr(y.bz, x.yyxh) > 0
"
PRC_AUTO_RUN	PROCEDURE	61	"                           and y.date_add > sysdate - 0.015
"
PRC_AUTO_RUN	PROCEDURE	62	"                           and nvl(x.lxdh, '13777929515') = y.lxdh);
"
PRC_AUTO_RUN	PROCEDURE	63	"
"
PRC_AUTO_RUN	PROCEDURE	64	"  --挂号费未缴费提醒1
"
PRC_AUTO_RUN	PROCEDURE	65	"  cursor cur_zlf is
"
PRC_AUTO_RUN	PROCEDURE	66	"    select c.jzkh
"
PRC_AUTO_RUN	PROCEDURE	67	"      From yj_yjk1 a, yj_Yjk2 b, zj_jzxx c
"
PRC_AUTO_RUN	PROCEDURE	68	"     where a.jzxh = c.jzxh
"
PRC_AUTO_RUN	PROCEDURE	69	"       and a.yjsb = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	70	"       and a.sfsb is null
"
PRC_AUTO_RUN	PROCEDURE	71	"       and a.brxh is null
"
PRC_AUTO_RUN	PROCEDURE	72	"       and instr(nvl(b.bz, '0'), '#未缴纳提醒1#') = 0
"
PRC_AUTO_RUN	PROCEDURE	73	"       and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	74	"       and c.jzrq > (sysdate - 0.021 - 0.1)
"
PRC_AUTO_RUN	PROCEDURE	75	"       and c.jzrq < sysdate - 0.021
"
PRC_AUTO_RUN	PROCEDURE	76	"       and c.jzkh = '9'
"
PRC_AUTO_RUN	PROCEDURE	77	"     group by c.jzkh
"
PRC_AUTO_RUN	PROCEDURE	78	"    having sum(sl) > 0;
"
PRC_AUTO_RUN	PROCEDURE	79	"
"
PRC_AUTO_RUN	PROCEDURE	80	"  --挂号费未缴费提醒 2天
"
PRC_AUTO_RUN	PROCEDURE	81	"  cursor cur_zlf_2days is
"
PRC_AUTO_RUN	PROCEDURE	82	"    select distinct (c.jzkh)
"
PRC_AUTO_RUN	PROCEDURE	83	"      From yj_yjk1 a, yj_Yjk2 b, zj_jzxx c
"
PRC_AUTO_RUN	PROCEDURE	84	"     where a.jzxh = c.jzxh
"
PRC_AUTO_RUN	PROCEDURE	85	"       and a.yjsb = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	86	"       and a.sfsb is null
"
PRC_AUTO_RUN	PROCEDURE	87	"       and a.brxh is null
"
PRC_AUTO_RUN	PROCEDURE	88	"       and instr(nvl(b.bz, '0'), '#未缴纳提醒1#') > 0
"
PRC_AUTO_RUN	PROCEDURE	89	"       and instr(nvl(b.bz, '0'), '#未缴纳提醒2#') = 0
"
PRC_AUTO_RUN	PROCEDURE	90	"       and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	91	"       and c.jzrq >= trunc(sysdate - 3)
"
PRC_AUTO_RUN	PROCEDURE	92	"       and c.jzrq < trunc(sysdate - 2)
"
PRC_AUTO_RUN	PROCEDURE	93	"       and c.jzkh = '9';
"
PRC_AUTO_RUN	PROCEDURE	94	"
"
PRC_AUTO_RUN	PROCEDURE	95	"  ---- 疫苗提醒    
"
PRC_AUTO_RUN	PROCEDURE	96	"  cursor cur_sms_yimao is
"
PRC_AUTO_RUN	PROCEDURE	97	"    SELECT distinct c.jzkh
"
PRC_AUTO_RUN	PROCEDURE	98	"      fROM MZ_CFK1 a, mz_cfk2 b, gy_brjbxxk c, zy_jiaoyi_v1_bak d
"
PRC_AUTO_RUN	PROCEDURE	99	"     WHERE a.cfsb = b.cfsb
"
PRC_AUTO_RUN	PROCEDURE	100	"       and a.jzkh = c.jzkh
"
PRC_AUTO_RUN	PROCEDURE	101	"       and to_char(b.ypxh) = to_char(d.bz)
"
PRC_AUTO_RUN	PROCEDURE	102	"       and trunc(b.shenhesj) = trunc(sysdate + 1)
"
PRC_AUTO_RUN	PROCEDURE	103	"       and a.jzxh = d.patient_No
"
PRC_AUTO_RUN	PROCEDURE	104	"       and d.jiaoyilx = '疫苗库存控制';
"
PRC_AUTO_RUN	PROCEDURE	105	"
"
PRC_AUTO_RUN	PROCEDURE	106	"Begin
"
PRC_AUTO_RUN	PROCEDURE	107	"  --2020-06-25
"
PRC_AUTO_RUN	PROCEDURE	108	"  v_Procedure_Name := '后台执行_PRC_AUTO_RUN';
"
PRC_AUTO_RUN	PROCEDURE	109	"  v_task           := ' ';
"
PRC_AUTO_RUN	PROCEDURE	110	"  lxdh             := '13777929515';
"
PRC_AUTO_RUN	PROCEDURE	111	"  v_count          := 0;
"
PRC_AUTO_RUN	PROCEDURE	112	"  /*  insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	113	"    (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN	PROCEDURE	114	"  values
"
PRC_AUTO_RUN	PROCEDURE	115	"    (v_Procedure_Name, '开始', 0);
"
PRC_AUTO_RUN	PROCEDURE	116	"  commit;*/
"
PRC_AUTO_RUN	PROCEDURE	117	"
"
PRC_AUTO_RUN	PROCEDURE	118	"  select to_char(sysdate, 'hh24:mi'),
"
PRC_AUTO_RUN	PROCEDURE	119	"         substr(to_char(sysdate, 'hh24:mi'), 5, 1)
"
PRC_AUTO_RUN	PROCEDURE	120	"    into ls_now, ls_now_minue
"
PRC_AUTO_RUN	PROCEDURE	121	"    from dual;
"
PRC_AUTO_RUN	PROCEDURE	122	"
"
PRC_AUTO_RUN	PROCEDURE	123	"  if 1 = 0 and ((ls_now >= '23:58' and ls_now <= '23:59')) then
"
PRC_AUTO_RUN	PROCEDURE	124	"    null;
"
PRC_AUTO_RUN	PROCEDURE	125	"    /*update gh_mzlbk t
"
PRC_AUTO_RUN	PROCEDURE	126	"       set zlf    = (select zlf from gh_mzlbk_bak where mzlbxh = t.mzlbxh),
"
PRC_AUTO_RUN	PROCEDURE	127	"           zlf_et = (select zlf_et from gh_mzlbk_bak where mzlbxh = t.mzlbxh)
"
PRC_AUTO_RUN	PROCEDURE	128	"     where mzlbxh in (2, 8);
"
PRC_AUTO_RUN	PROCEDURE	129	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	130	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	131	"      prc_sms_send('ts', '13777929515', 'gh_mzlbk=0.01 ok', v_bz);
"
PRC_AUTO_RUN	PROCEDURE	132	"    else
"
PRC_AUTO_RUN	PROCEDURE	133	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	134	"      prc_sms_send('ts', '13777929515', 'gh_mzlbk=0.01 error', v_bz);
"
PRC_AUTO_RUN	PROCEDURE	135	"    end if;*/
"
PRC_AUTO_RUN	PROCEDURE	136	"  
"
PRC_AUTO_RUN	PROCEDURE	137	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	138	"
"
PRC_AUTO_RUN	PROCEDURE	139	"  -- 住院病人现金与预交款不一致
"
PRC_AUTO_RUN	PROCEDURE	140	"  if 1 = 1 and ls_now_minue = '1' then
"
PRC_AUTO_RUN	PROCEDURE	141	"  
"
PRC_AUTO_RUN	PROCEDURE	142	"    select count(patient_no)
"
PRC_AUTO_RUN	PROCEDURE	143	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	144	"      from (select patient_no,
"
PRC_AUTO_RUN	PROCEDURE	145	"                   nvl(t.zf_fee, 0) -
"
PRC_AUTO_RUN	PROCEDURE	146	"                   ((select nvl(sum(amount), 0)
"
PRC_AUTO_RUN	PROCEDURE	147	"                       from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	148	"                      where patient_No = t.patient_no
"
PRC_AUTO_RUN	PROCEDURE	149	"                        and js_No = 1) + nvl(pay_xj, 0) + nvl(pay_zp, 0) -
"
PRC_AUTO_RUN	PROCEDURE	150	"                    nvl(return_xj, 0) - nvl(return_zp, 0)) je
"
PRC_AUTO_RUN	PROCEDURE	151	"            
"
PRC_AUTO_RUN	PROCEDURE	152	"              From zy_total_fee t
"
PRC_AUTO_RUN	PROCEDURE	153	"             where jz_date > sysdate - 0.1
"
PRC_AUTO_RUN	PROCEDURE	154	"               and js_NO = 1)
"
PRC_AUTO_RUN	PROCEDURE	155	"     where je <> 0;
"
PRC_AUTO_RUN	PROCEDURE	156	"    if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	157	"      prc_sms_send('ts',
"
PRC_AUTO_RUN	PROCEDURE	158	"                   '13777929515',
"
PRC_AUTO_RUN	PROCEDURE	159	"                   '住院病人现金与预交款不一致[prc_auto_run]',
"
PRC_AUTO_RUN	PROCEDURE	160	"                   v_bz);
"
PRC_AUTO_RUN	PROCEDURE	161	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	162	"  
"
PRC_AUTO_RUN	PROCEDURE	163	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	164	"
"
PRC_AUTO_RUN	PROCEDURE	165	"  --人工电话预约 漏发短信
"
PRC_AUTO_RUN	PROCEDURE	166	"  IF 1 = 1 THEN
"
PRC_AUTO_RUN	PROCEDURE	167	"  
"
PRC_AUTO_RUN	PROCEDURE	168	"    open cur_mzyyk;
"
PRC_AUTO_RUN	PROCEDURE	169	"    loop
"
PRC_AUTO_RUN	PROCEDURE	170	"      fetch cur_mzyyk
"
PRC_AUTO_RUN	PROCEDURE	171	"        into v_yyxh;
"
PRC_AUTO_RUN	PROCEDURE	172	"    
"
PRC_AUTO_RUN	PROCEDURE	173	"      exit when cur_mzyyk%NOTFOUND;
"
PRC_AUTO_RUN	PROCEDURE	174	"      select nvl(lxdh, '13777929515'),
"
PRC_AUTO_RUN	PROCEDURE	175	"             '就诊科室:' || (select ksmc from gy_ksdm where ksdm = t.ksdm) || ' ' ||
"
PRC_AUTO_RUN	PROCEDURE	176	"             (select '就诊医师:' || xm from gy_zgxx where zgid = ysgh) ||
"
PRC_AUTO_RUN	PROCEDURE	177	"             ',预约号为:' || yyxh || ',预约日期' || to_char(yyrq1, 'yyyy-mm-dd') ||
"
PRC_AUTO_RUN	PROCEDURE	178	"             decode(yysj, 1, '上午', '下午') || ghxh || '号'
"
PRC_AUTO_RUN	PROCEDURE	179	"        into v_lxdh, v_msg
"
PRC_AUTO_RUN	PROCEDURE	180	"        from gh_mzyyk t
"
PRC_AUTO_RUN	PROCEDURE	181	"       where yyxh = v_yyxh;
"
PRC_AUTO_RUN	PROCEDURE	182	"      --v_lxdh := '13777929515';
"
PRC_AUTO_RUN	PROCEDURE	183	"      prc_sms_send('gh', v_lxdh, v_msg, v_temp);
"
PRC_AUTO_RUN	PROCEDURE	184	"    
"
PRC_AUTO_RUN	PROCEDURE	185	"    end loop;
"
PRC_AUTO_RUN	PROCEDURE	186	"    close cur_mzyyk;
"
PRC_AUTO_RUN	PROCEDURE	187	"  
"
PRC_AUTO_RUN	PROCEDURE	188	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	189	"  -- end 人工电话预约 漏发短信
"
PRC_AUTO_RUN	PROCEDURE	190	"
"
PRC_AUTO_RUN	PROCEDURE	191	"  -- 短信提醒 费用未缴纳
"
PRC_AUTO_RUN	PROCEDURE	192	"  if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	193	"  
"
PRC_AUTO_RUN	PROCEDURE	194	"    open cur_zlf;
"
PRC_AUTO_RUN	PROCEDURE	195	"    loop
"
PRC_AUTO_RUN	PROCEDURE	196	"      fetch cur_zlf
"
PRC_AUTO_RUN	PROCEDURE	197	"        into v_jzkh;
"
PRC_AUTO_RUN	PROCEDURE	198	"    
"
PRC_AUTO_RUN	PROCEDURE	199	"      exit when cur_zlf%NOTFOUND;
"
PRC_AUTO_RUN	PROCEDURE	200	"      select trim(lxdh),
"
PRC_AUTO_RUN	PROCEDURE	201	"             xm || ' 您好！您是否还有费用未缴纳，请核实。若已缴或短信误发敬请忽略！'
"
PRC_AUTO_RUN	PROCEDURE	202	"        into v_lxdh, v_msg
"
PRC_AUTO_RUN	PROCEDURE	203	"        from gy_brjbxxk
"
PRC_AUTO_RUN	PROCEDURE	204	"       where jzkh = v_jzkh;
"
PRC_AUTO_RUN	PROCEDURE	205	"      --v_lxdh := '13777929515';
"
PRC_AUTO_RUN	PROCEDURE	206	"    
"
PRC_AUTO_RUN	PROCEDURE	207	"      update yj_Yjk2
"
PRC_AUTO_RUN	PROCEDURE	208	"         set bz = bz || '#未缴纳提醒1#,'
"
PRC_AUTO_RUN	PROCEDURE	209	"       where fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	210	"         and yjsb in (
"
PRC_AUTO_RUN	PROCEDURE	211	"                      
"
PRC_AUTO_RUN	PROCEDURE	212	"                      select a.yjsb
"
PRC_AUTO_RUN	PROCEDURE	213	"                        from yj_Yjk1 a, yj_Yjk2 b, zj_jzxx c
"
PRC_AUTO_RUN	PROCEDURE	214	"                       where a.jzxh = c.jzxh
"
PRC_AUTO_RUN	PROCEDURE	215	"                         and a.yjsb = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	216	"                         and a.sfsb is null
"
PRC_AUTO_RUN	PROCEDURE	217	"                         and a.brxh is null
"
PRC_AUTO_RUN	PROCEDURE	218	"                         and instr(nvl(b.bz, '0'), '#未缴纳提醒1#') = 0
"
PRC_AUTO_RUN	PROCEDURE	219	"                         and sl > 0
"
PRC_AUTO_RUN	PROCEDURE	220	"                         and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	221	"                         and c.jzrq > (sysdate - 0.5)
"
PRC_AUTO_RUN	PROCEDURE	222	"                         and c.jzrq < sysdate - 0.021
"
PRC_AUTO_RUN	PROCEDURE	223	"                         and c.jzkh = v_jzkh);
"
PRC_AUTO_RUN	PROCEDURE	224	"    
"
PRC_AUTO_RUN	PROCEDURE	225	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	226	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	227	"      
"
PRC_AUTO_RUN	PROCEDURE	228	"        prc_sms_send('未缴纳提醒', v_lxdh, v_msg, v_temp);
"
PRC_AUTO_RUN	PROCEDURE	229	"      else
"
PRC_AUTO_RUN	PROCEDURE	230	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	231	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	232	"    end loop;
"
PRC_AUTO_RUN	PROCEDURE	233	"    close cur_zlf;
"
PRC_AUTO_RUN	PROCEDURE	234	"  
"
PRC_AUTO_RUN	PROCEDURE	235	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	236	"  -- end  短信提醒 费用未缴纳
"
PRC_AUTO_RUN	PROCEDURE	237	"
"
PRC_AUTO_RUN	PROCEDURE	238	"  --   短信提醒 2天 费用未缴纳
"
PRC_AUTO_RUN	PROCEDURE	239	"  if 1 = 1 and ((ls_now > '08:00' and ls_now <= '08:01')) then
"
PRC_AUTO_RUN	PROCEDURE	240	"  
"
PRC_AUTO_RUN	PROCEDURE	241	"    open cur_zlf_2days;
"
PRC_AUTO_RUN	PROCEDURE	242	"    loop
"
PRC_AUTO_RUN	PROCEDURE	243	"      fetch cur_zlf_2days
"
PRC_AUTO_RUN	PROCEDURE	244	"        into v_jzkh;
"
PRC_AUTO_RUN	PROCEDURE	245	"    
"
PRC_AUTO_RUN	PROCEDURE	246	"      exit when cur_zlf_2days%NOTFOUND;
"
PRC_AUTO_RUN	PROCEDURE	247	"      select trim(lxdh),
"
PRC_AUTO_RUN	PROCEDURE	248	"             xm ||
"
PRC_AUTO_RUN	PROCEDURE	249	"              ' 亲爱的病友，您好！您近期在我院就诊时，部分诊疗费用尚未结清，
"
PRC_AUTO_RUN	PROCEDURE	250	"请您尽快到院进行结算，以免对您的后续诊疗及个人信用产生不良影响。感谢您的配合，祝您早日康复！若已缴或短信误发敬请忽略！'
"
PRC_AUTO_RUN	PROCEDURE	251	"        into v_lxdh, v_msg
"
PRC_AUTO_RUN	PROCEDURE	252	"        from gy_brjbxxk
"
PRC_AUTO_RUN	PROCEDURE	253	"       where jzkh = v_jzkh;
"
PRC_AUTO_RUN	PROCEDURE	254	"    
"
PRC_AUTO_RUN	PROCEDURE	255	"      update yj_Yjk2
"
PRC_AUTO_RUN	PROCEDURE	256	"         set bz = bz || '#未缴纳提醒2#,'
"
PRC_AUTO_RUN	PROCEDURE	257	"       where fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	258	"         and yjsb in (select a.yjsb
"
PRC_AUTO_RUN	PROCEDURE	259	"                        from yj_Yjk1 a, yj_Yjk2 b, zj_jzxx c
"
PRC_AUTO_RUN	PROCEDURE	260	"                       where a.jzxh = c.jzxh
"
PRC_AUTO_RUN	PROCEDURE	261	"                         and a.yjsb = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	262	"                         and a.sfsb is null
"
PRC_AUTO_RUN	PROCEDURE	263	"                         and a.brxh is null
"
PRC_AUTO_RUN	PROCEDURE	264	"                         and instr(nvl(b.bz, '0'), '#未缴纳提醒1#') > 0
"
PRC_AUTO_RUN	PROCEDURE	265	"                         and instr(nvl(b.bz, '0'), '#未缴纳提醒2#') = 0
"
PRC_AUTO_RUN	PROCEDURE	266	"                         and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	267	"                         and b.sl > 0
"
PRC_AUTO_RUN	PROCEDURE	268	"                         and c.jzrq >= trunc(sysdate - 3)
"
PRC_AUTO_RUN	PROCEDURE	269	"                         and c.jzrq < trunc(sysdate - 2)
"
PRC_AUTO_RUN	PROCEDURE	270	"                         and c.jzkh = v_jzkh);
"
PRC_AUTO_RUN	PROCEDURE	271	"    
"
PRC_AUTO_RUN	PROCEDURE	272	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	273	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	274	"      
"
PRC_AUTO_RUN	PROCEDURE	275	"        prc_sms_send('未缴纳提醒', v_lxdh, v_msg, v_temp);
"
PRC_AUTO_RUN	PROCEDURE	276	"      else
"
PRC_AUTO_RUN	PROCEDURE	277	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	278	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	279	"    end loop;
"
PRC_AUTO_RUN	PROCEDURE	280	"    close cur_zlf_2days;
"
PRC_AUTO_RUN	PROCEDURE	281	"  
"
PRC_AUTO_RUN	PROCEDURE	282	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	283	"  -- end  短信提醒 2天 费用未缴纳
"
PRC_AUTO_RUN	PROCEDURE	284	"
"
PRC_AUTO_RUN	PROCEDURE	285	"  --  疫苗  短信提醒
"
PRC_AUTO_RUN	PROCEDURE	286	"  if 1 = 1 and ((ls_now > '16:05' and ls_now <= '16:06')) then
"
PRC_AUTO_RUN	PROCEDURE	287	"  
"
PRC_AUTO_RUN	PROCEDURE	288	"    -- select distinct a.jzkh, b.ypxh,b.ypcddm      
"
PRC_AUTO_RUN	PROCEDURE	289	"  
"
PRC_AUTO_RUN	PROCEDURE	290	"    open cur_sms_yimao;
"
PRC_AUTO_RUN	PROCEDURE	291	"    loop
"
PRC_AUTO_RUN	PROCEDURE	292	"      fetch cur_sms_yimao
"
PRC_AUTO_RUN	PROCEDURE	293	"        into v_jzkh;
"
PRC_AUTO_RUN	PROCEDURE	294	"    
"
PRC_AUTO_RUN	PROCEDURE	295	"      exit when cur_sms_yimao%NOTFOUND;
"
PRC_AUTO_RUN	PROCEDURE	296	"      select trim(lxdh),
"
PRC_AUTO_RUN	PROCEDURE	297	"             xm || ' 亲爱的病友，您好！明天有预约疫苗需要接种！若已处理或短信误发敬请忽略！'
"
PRC_AUTO_RUN	PROCEDURE	298	"        into v_lxdh, v_msg
"
PRC_AUTO_RUN	PROCEDURE	299	"        from gy_brjbxxk
"
PRC_AUTO_RUN	PROCEDURE	300	"       where jzkh = v_jzkh;
"
PRC_AUTO_RUN	PROCEDURE	301	"      prc_sms_send('ts', v_lxdh, v_msg, v_temp);
"
PRC_AUTO_RUN	PROCEDURE	302	"    
"
PRC_AUTO_RUN	PROCEDURE	303	"    end loop;
"
PRC_AUTO_RUN	PROCEDURE	304	"    close cur_sms_yimao;
"
PRC_AUTO_RUN	PROCEDURE	305	"  
"
PRC_AUTO_RUN	PROCEDURE	306	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	307	"  -- end  疫苗  短信提醒
"
PRC_AUTO_RUN	PROCEDURE	308	"
"
PRC_AUTO_RUN	PROCEDURE	309	"  --  本院核酸收费标志 
"
PRC_AUTO_RUN	PROCEDURE	310	"  if 1 = 1 and ((ls_now > '08:27' and ls_now <= '08:28')) then
"
PRC_AUTO_RUN	PROCEDURE	311	"  
"
PRC_AUTO_RUN	PROCEDURE	312	"    update l_patientinfo
"
PRC_AUTO_RUN	PROCEDURE	313	"       set feestatus = 6
"
PRC_AUTO_RUN	PROCEDURE	314	"     where feestatus = 1
"
PRC_AUTO_RUN	PROCEDURE	315	"       and patientid like 'BY%'
"
PRC_AUTO_RUN	PROCEDURE	316	"       and sampleno >= to_char(sysdate - 7, 'yyyymmdd');
"
PRC_AUTO_RUN	PROCEDURE	317	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	318	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	319	"    else
"
PRC_AUTO_RUN	PROCEDURE	320	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	321	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	322	"  
"
PRC_AUTO_RUN	PROCEDURE	323	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	324	"  -- end  本院核酸收费标志 
"
PRC_AUTO_RUN	PROCEDURE	325	"
"
PRC_AUTO_RUN	PROCEDURE	326	"  --zfl=0.01
"
PRC_AUTO_RUN	PROCEDURE	327	"  if 1 = 0 and (((ls_now > '06:01' and ls_now <= '06:02')) or
"
PRC_AUTO_RUN	PROCEDURE	328	"     ((ls_now > '06:11' and ls_now <= '06:12'))) then
"
PRC_AUTO_RUN	PROCEDURE	329	"  
"
PRC_AUTO_RUN	PROCEDURE	330	"    update gh_mzlbk
"
PRC_AUTO_RUN	PROCEDURE	331	"       set zlf = 0.01, zlf_et = 0.01
"
PRC_AUTO_RUN	PROCEDURE	332	"     where mzlbxh not in (2, 6, 7)
"
PRC_AUTO_RUN	PROCEDURE	333	"       and mzlbxh = 0
"
PRC_AUTO_RUN	PROCEDURE	334	"       and (zlf > 1 or zlf_et > 1)
"
PRC_AUTO_RUN	PROCEDURE	335	"       and to_char(sysdate, 'yyyymmdd') = '20210110';
"
PRC_AUTO_RUN	PROCEDURE	336	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	337	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	338	"    
"
PRC_AUTO_RUN	PROCEDURE	339	"    else
"
PRC_AUTO_RUN	PROCEDURE	340	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	341	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	342	"  
"
PRC_AUTO_RUN	PROCEDURE	343	"    select count(*)
"
PRC_AUTO_RUN	PROCEDURE	344	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	345	"      from gh_mzlbk
"
PRC_AUTO_RUN	PROCEDURE	346	"     where (zlf > 1 or zlf_et > 1);
"
PRC_AUTO_RUN	PROCEDURE	347	"    select '不免费挂号类别:' || v_count into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	348	"    prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	349	"  
"
PRC_AUTO_RUN	PROCEDURE	350	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	351	"  -- end zfl=0.01
"
PRC_AUTO_RUN	PROCEDURE	352	"
"
PRC_AUTO_RUN	PROCEDURE	353	"  --dj<0 fjxx=074
"
PRC_AUTO_RUN	PROCEDURE	354	"  if 0 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	355	"    select count(a.yjsb)
"
PRC_AUTO_RUN	PROCEDURE	356	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	357	"      From yj_Yjk1 A, YJ_YJK2 B
"
PRC_AUTO_RUN	PROCEDURE	358	"     where A.YJSB = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	359	"       and b.dj < 0.1
"
PRC_AUTO_RUN	PROCEDURE	360	"       and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	361	"       and a. SFSB IN (SELECT SFSB
"
PRC_AUTO_RUN	PROCEDURE	362	"                      fROM mz_mzsfk1 t
"
PRC_AUTO_RUN	PROCEDURE	363	"                     where sfrq > sysdate - 0.001
"
PRC_AUTO_RUN	PROCEDURE	364	"                       and czgh in ('AUTO5', 'AUTO1')
"
PRC_AUTO_RUN	PROCEDURE	365	"                       and fjxx >= '073');
"
PRC_AUTO_RUN	PROCEDURE	366	"  
"
PRC_AUTO_RUN	PROCEDURE	367	"    if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	368	"      select 'dj<0, fjxx=074, fygl=13,sl=' || v_count into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	369	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	370	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	371	"  
"
PRC_AUTO_RUN	PROCEDURE	372	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	373	"  if 0 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	374	"  
"
PRC_AUTO_RUN	PROCEDURE	375	"    SELECT nvl(TO_CHAR(wm_concat(('073 _ ' || t.ipaddress))), '0')
"
PRC_AUTO_RUN	PROCEDURE	376	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	377	"      fROM mz_mzsfk1 t
"
PRC_AUTO_RUN	PROCEDURE	378	"     where sfrq > sysdate - 0.001
"
PRC_AUTO_RUN	PROCEDURE	379	"       and fjxx = '073';
"
PRC_AUTO_RUN	PROCEDURE	380	"    if length(nr) > 2 then
"
PRC_AUTO_RUN	PROCEDURE	381	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	382	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	383	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	384	"
"
PRC_AUTO_RUN	PROCEDURE	385	"  -- 存储过程失效
"
PRC_AUTO_RUN	PROCEDURE	386	"  if 0 = 0 then
"
PRC_AUTO_RUN	PROCEDURE	387	"  
"
PRC_AUTO_RUN	PROCEDURE	388	"    select nvl(to_char(wm_concat(object_name)), '')
"
PRC_AUTO_RUN	PROCEDURE	389	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	390	"      from v_system_view_fail;
"
PRC_AUTO_RUN	PROCEDURE	391	"    if length(nr) > 1 then
"
PRC_AUTO_RUN	PROCEDURE	392	"      select '存储过程失效[prc_auto_run]:' || nr into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	393	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	394	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	395	"  
"
PRC_AUTO_RUN	PROCEDURE	396	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	397	"  -- 2020-06-01 免费检查
"
PRC_AUTO_RUN	PROCEDURE	398	"  if 0 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	399	"    select count(*)
"
PRC_AUTO_RUN	PROCEDURE	400	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	401	"      from temp_20200507_saicab t
"
PRC_AUTO_RUN	PROCEDURE	402	"     where jzrq > sysdate - 0.3;
"
PRC_AUTO_RUN	PROCEDURE	403	"    if v_count > 1 and v_count < 6 then
"
PRC_AUTO_RUN	PROCEDURE	404	"      /* v_sl_count := 0;
"
PRC_AUTO_RUN	PROCEDURE	405	"      select nvl(sum(sl), 0)
"
PRC_AUTO_RUN	PROCEDURE	406	"        into v_sl_count
"
PRC_AUTO_RUN	PROCEDURE	407	"        from temp_20200507_saicab
"
PRC_AUTO_RUN	PROCEDURE	408	"       where jzrq >= trunc(sysdate);*/
"
PRC_AUTO_RUN	PROCEDURE	409	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	410	"        select '2020-06-01 免费检查活动：' || v_count into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	411	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	412	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	413	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	414	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	415	"
"
PRC_AUTO_RUN	PROCEDURE	416	"  -- 2020-06-01 免费挂号
"
PRC_AUTO_RUN	PROCEDURE	417	"  if 0 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	418	"  
"
PRC_AUTO_RUN	PROCEDURE	419	"    select count(a.yjsb)
"
PRC_AUTO_RUN	PROCEDURE	420	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	421	"      From yj_Yjk1 A, YJ_YJK2 B
"
PRC_AUTO_RUN	PROCEDURE	422	"     where A.YJSB = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	423	"       and b.dj < 0.1
"
PRC_AUTO_RUN	PROCEDURE	424	"       and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	425	"       and a.kdsj > sysdate - 0.1;
"
PRC_AUTO_RUN	PROCEDURE	426	"  
"
PRC_AUTO_RUN	PROCEDURE	427	"    if v_count > 1 and v_count < 6 then
"
PRC_AUTO_RUN	PROCEDURE	428	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	429	"        select '2020-06-01 免费挂号活动：' || v_count into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	430	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	431	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	432	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	433	"  
"
PRC_AUTO_RUN	PROCEDURE	434	"    select count(a.yjsb)
"
PRC_AUTO_RUN	PROCEDURE	435	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	436	"      From yj_Yjk1 A, YJ_YJK2 B
"
PRC_AUTO_RUN	PROCEDURE	437	"     where A.YJSB = b.yjsb
"
PRC_AUTO_RUN	PROCEDURE	438	"       and a.sjksdm not in (select ksdm from gh_jjr_ksdm)
"
PRC_AUTO_RUN	PROCEDURE	439	"          
"
PRC_AUTO_RUN	PROCEDURE	440	"       and b.dj < 0.1
"
PRC_AUTO_RUN	PROCEDURE	441	"       and b.fygb = 13
"
PRC_AUTO_RUN	PROCEDURE	442	"       and a.kdsj > sysdate - 0.1;
"
PRC_AUTO_RUN	PROCEDURE	443	"  
"
PRC_AUTO_RUN	PROCEDURE	444	"    if v_count > 1 and v_count < 6 then
"
PRC_AUTO_RUN	PROCEDURE	445	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	446	"        select '2020-06-01 not ksdm 免费挂号活动：' || v_count
"
PRC_AUTO_RUN	PROCEDURE	447	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	448	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	449	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	450	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	451	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	452	"  
"
PRC_AUTO_RUN	PROCEDURE	453	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	454	"
"
PRC_AUTO_RUN	PROCEDURE	455	"  --新型冠状病毒核酸检测 待复查 转发
"
PRC_AUTO_RUN	PROCEDURE	456	"  if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	457	"    v_xh       := 1;
"
PRC_AUTO_RUN	PROCEDURE	458	"    v_sl_count := 0;
"
PRC_AUTO_RUN	PROCEDURE	459	"    while v_xh > 0 loop
"
PRC_AUTO_RUN	PROCEDURE	460	"    
"
PRC_AUTO_RUN	PROCEDURE	461	"      v_sl_count := v_sl_count + 1;
"
PRC_AUTO_RUN	PROCEDURE	462	"      if v_sl_count > 6 then
"
PRC_AUTO_RUN	PROCEDURE	463	"        exit;
"
PRC_AUTO_RUN	PROCEDURE	464	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	465	"      select nvl(max(xh), 0)
"
PRC_AUTO_RUN	PROCEDURE	466	"        into v_xh
"
PRC_AUTO_RUN	PROCEDURE	467	"        from auto_task_ywzx_send
"
PRC_AUTO_RUN	PROCEDURE	468	"       where date_send > sysdate - 0.1
"
PRC_AUTO_RUN	PROCEDURE	469	"         and instr(bz, '转发') = 0
"
PRC_AUTO_RUN	PROCEDURE	470	"         and instr(bz, 'IgM') > 0
"
PRC_AUTO_RUN	PROCEDURE	471	"         and instr(bz, '待复查') > 0
"
PRC_AUTO_RUN	PROCEDURE	472	"         and instr(bz, '新型冠状病毒') > 0
"
PRC_AUTO_RUN	PROCEDURE	473	"         and laborder > 0;
"
PRC_AUTO_RUN	PROCEDURE	474	"      if v_xh > 0 then
"
PRC_AUTO_RUN	PROCEDURE	475	"      
"
PRC_AUTO_RUN	PROCEDURE	476	"        select bz, nvl(laborder, 0)
"
PRC_AUTO_RUN	PROCEDURE	477	"          into nr, v_laborder
"
PRC_AUTO_RUN	PROCEDURE	478	"          from auto_task_ywzx_send
"
PRC_AUTO_RUN	PROCEDURE	479	"         where xh = v_xh;
"
PRC_AUTO_RUN	PROCEDURE	480	"      
"
PRC_AUTO_RUN	PROCEDURE	481	"        select nvl(max(y.lxdh), '无')
"
PRC_AUTO_RUN	PROCEDURE	482	"          into v_temp
"
PRC_AUTO_RUN	PROCEDURE	483	"          from l_patientinfo t, gy_brjbxxk y
"
PRC_AUTO_RUN	PROCEDURE	484	"         where t.patientid = y.jzkh
"
PRC_AUTO_RUN	PROCEDURE	485	"           and t.stayhospitalmode = 1
"
PRC_AUTO_RUN	PROCEDURE	486	"           and t.doctadviseno > 0
"
PRC_AUTO_RUN	PROCEDURE	487	"           and t.doctadviseno = v_laborder;
"
PRC_AUTO_RUN	PROCEDURE	488	"      
"
PRC_AUTO_RUN	PROCEDURE	489	"        select nr || ',患者联系电话:' || v_temp into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	490	"      
"
PRC_AUTO_RUN	PROCEDURE	491	"        -- select bz into nr from auto_task_ywzx_send where xh = v_xh;
"
PRC_AUTO_RUN	PROCEDURE	492	"        --  prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	493	"        prc_sms_send('ts', '13735759506', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	494	"        prc_sms_send('ts', '13867936636', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	495	"        prc_sms_send('ts', '15825760232', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	496	"        prc_sms_send('ts', '18458034799', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	497	"        update auto_task_ywzx_send set bz = bz || '[转发]' where xh = v_xh;
"
PRC_AUTO_RUN	PROCEDURE	498	"        if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	499	"          commit;
"
PRC_AUTO_RUN	PROCEDURE	500	"        else
"
PRC_AUTO_RUN	PROCEDURE	501	"          rollback;
"
PRC_AUTO_RUN	PROCEDURE	502	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	503	"      
"
PRC_AUTO_RUN	PROCEDURE	504	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	505	"    end loop;
"
PRC_AUTO_RUN	PROCEDURE	506	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	507	"
"
PRC_AUTO_RUN	PROCEDURE	508	"  --新型冠状病毒核酸检测 待复查 转发 end 
"
PRC_AUTO_RUN	PROCEDURE	509	"
"
PRC_AUTO_RUN	PROCEDURE	510	"  -- 'ylsbgl.wz_nzwcgsqxx 高值计费 老系统记录'
"
PRC_AUTO_RUN	PROCEDURE	511	"  /*  if 0 = 0 then
"
PRC_AUTO_RUN	PROCEDURE	512	"    select count(*)
"
PRC_AUTO_RUN	PROCEDURE	513	"      into v_count
"
PRC_AUTO_RUN	PROCEDURE	514	"      From ylsbgl.wz_nzwcgsqxx a
"
PRC_AUTO_RUN	PROCEDURE	515	"     where sqrq > sysdate - 0.1;
"
PRC_AUTO_RUN	PROCEDURE	516	"  
"
PRC_AUTO_RUN	PROCEDURE	517	"    if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	518	"      select 'ylsbgl.wz_nzwcgsqxx 高值计费 老系统记录' into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	519	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	520	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	521	"  end if;*/
"
PRC_AUTO_RUN	PROCEDURE	522	"
"
PRC_AUTO_RUN	PROCEDURE	523	"  --'抗菌药物停止通知'
"
PRC_AUTO_RUN	PROCEDURE	524	"  if 1 = 1 and ((ls_now > '07:40' and ls_now <= '07:41') or
"
PRC_AUTO_RUN	PROCEDURE	525	"     (ls_now > '08:40' and ls_now <= '08:41') or
"
PRC_AUTO_RUN	PROCEDURE	526	"     (ls_now > '09:40' and ls_now <= '09:41') or
"
PRC_AUTO_RUN	PROCEDURE	527	"     (ls_now > '10:40' and ls_now <= '10:41') or
"
PRC_AUTO_RUN	PROCEDURE	528	"     (ls_now > '11:40' and ls_now <= '11:41') or
"
PRC_AUTO_RUN	PROCEDURE	529	"     (ls_now > '12:40' and ls_now <= '12:41') or
"
PRC_AUTO_RUN	PROCEDURE	530	"     (ls_now > '13:40' and ls_now <= '13:41') or
"
PRC_AUTO_RUN	PROCEDURE	531	"     (ls_now > '14:40' and ls_now <= '14:41') or
"
PRC_AUTO_RUN	PROCEDURE	532	"     (ls_now > '15:40' and ls_now <= '15:41') or
"
PRC_AUTO_RUN	PROCEDURE	533	"     (ls_now > '16:40' and ls_now <= '16:41') or
"
PRC_AUTO_RUN	PROCEDURE	534	"     (ls_now > '17:40' and ls_now <= '17:41') or
"
PRC_AUTO_RUN	PROCEDURE	535	"     (ls_now > '19:40' and ls_now <= '19:41') or
"
PRC_AUTO_RUN	PROCEDURE	536	"     
"
PRC_AUTO_RUN	PROCEDURE	537	"     (ls_now > '21:40' and ls_now <= '21:41')) then
"
PRC_AUTO_RUN	PROCEDURE	538	"  
"
PRC_AUTO_RUN	PROCEDURE	539	"    --留义温暖基金
"
PRC_AUTO_RUN	PROCEDURE	540	"    if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	541	"    
"
PRC_AUTO_RUN	PROCEDURE	542	"      select to_char(nvl(wm_concat('留义温暖基金 ' || fs || ':' || je), '0'))
"
PRC_AUTO_RUN	PROCEDURE	543	"        into nr
"
PRC_AUTO_RUN	PROCEDURE	544	"        from (select decode(depo_type, 1, '现金', 2, '支票', '其它方式') fs,
"
PRC_AUTO_RUN	PROCEDURE	545	"                     sum(amount) je
"
PRC_AUTO_RUN	PROCEDURE	546	"                from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	547	"               where depo_date > sysdate - 0.2
"
PRC_AUTO_RUN	PROCEDURE	548	"                 and op_Id = 'AU002'
"
PRC_AUTO_RUN	PROCEDURE	549	"               group by depo_type);
"
PRC_AUTO_RUN	PROCEDURE	550	"    
"
PRC_AUTO_RUN	PROCEDURE	551	"      if length(nr) > 5 then
"
PRC_AUTO_RUN	PROCEDURE	552	"        prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	553	"      
"
PRC_AUTO_RUN	PROCEDURE	554	"        select to_char(nvl(wm_concat('留义温暖基金大于1000 ' || to_char(patient_no）), '0')) into nr from (select patient_no
"
PRC_AUTO_RUN	PROCEDURE	555	"                                                                                                    from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	556	"                                                                                                   where patient_No in
"
PRC_AUTO_RUN	PROCEDURE	557	"                                                                                                         (select patient_no
"
PRC_AUTO_RUN	PROCEDURE	558	"                                                                                                            from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	559	"                                                                                                           where depo_date >
"
PRC_AUTO_RUN	PROCEDURE	560	"                                                                                                                 sysdate - 0.2
"
PRC_AUTO_RUN	PROCEDURE	561	"                                                                                                             and op_Id =
"
PRC_AUTO_RUN	PROCEDURE	562	"                                                                                                                 'AU002')
"
PRC_AUTO_RUN	PROCEDURE	563	"                                                                                                     and op_Id =
"
PRC_AUTO_RUN	PROCEDURE	564	"                                                                                                         'AU002'
"
PRC_AUTO_RUN	PROCEDURE	565	"                                                                                                   group by patient_no
"
PRC_AUTO_RUN	PROCEDURE	566	"                                                                                                  having sum(amount) > 1000);
"
PRC_AUTO_RUN	PROCEDURE	567	"      
"
PRC_AUTO_RUN	PROCEDURE	568	"        if length(nr) > 2 then
"
PRC_AUTO_RUN	PROCEDURE	569	"          prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	570	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	571	"      
"
PRC_AUTO_RUN	PROCEDURE	572	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	573	"    
"
PRC_AUTO_RUN	PROCEDURE	574	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	575	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	576	"        from (select (select nvl(to_char(cwfp_date, 'yyyymmdd'), '20210101')
"
PRC_AUTO_RUN	PROCEDURE	577	"                        from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	578	"                       where patient_no = t.patient_no) rq
"
PRC_AUTO_RUN	PROCEDURE	579	"                From zy_deposit_file t
"
PRC_AUTO_RUN	PROCEDURE	580	"               where patient_no <> 851509
"
PRC_AUTO_RUN	PROCEDURE	581	"                 and op_id = 'AU002'
"
PRC_AUTO_RUN	PROCEDURE	582	"                 and patient_no > 0
"
PRC_AUTO_RUN	PROCEDURE	583	"                 and depo_date > sysdate - 2)
"
PRC_AUTO_RUN	PROCEDURE	584	"       where rq < '20210210'
"
PRC_AUTO_RUN	PROCEDURE	585	"          or rq > '20210221';
"
PRC_AUTO_RUN	PROCEDURE	586	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	587	"        select '留义温暖基金,床位分配时间不在0210-0221,数量=' || v_count
"
PRC_AUTO_RUN	PROCEDURE	588	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	589	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	590	"      
"
PRC_AUTO_RUN	PROCEDURE	591	"        select count(*)
"
PRC_AUTO_RUN	PROCEDURE	592	"          into v_count
"
PRC_AUTO_RUN	PROCEDURE	593	"          from (select (select count(*)
"
PRC_AUTO_RUN	PROCEDURE	594	"                          from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	595	"                         where patient_no = t.patient_no
"
PRC_AUTO_RUN	PROCEDURE	596	"                           and cwfp_date is null) sl
"
PRC_AUTO_RUN	PROCEDURE	597	"                  From zy_deposit_file t
"
PRC_AUTO_RUN	PROCEDURE	598	"                 where patient_no <> 851509
"
PRC_AUTO_RUN	PROCEDURE	599	"                   and op_id = 'AU002'
"
PRC_AUTO_RUN	PROCEDURE	600	"                   and patient_no > 0
"
PRC_AUTO_RUN	PROCEDURE	601	"                   and depo_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	602	"                   and depo_date < sysdate)
"
PRC_AUTO_RUN	PROCEDURE	603	"         where sl = 1;
"
PRC_AUTO_RUN	PROCEDURE	604	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	605	"          select nr || ',cwfp_date =null,数量=' || v_count
"
PRC_AUTO_RUN	PROCEDURE	606	"            into nr
"
PRC_AUTO_RUN	PROCEDURE	607	"            from dual;
"
PRC_AUTO_RUN	PROCEDURE	608	"        
"
PRC_AUTO_RUN	PROCEDURE	609	"          /*      update zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	610	"               set patient_no = patient_no * -1
"
PRC_AUTO_RUN	PROCEDURE	611	"             where op_id = 'AU002'
"
PRC_AUTO_RUN	PROCEDURE	612	"               and depo_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	613	"               and patient_No in
"
PRC_AUTO_RUN	PROCEDURE	614	"                   (select patient_no
"
PRC_AUTO_RUN	PROCEDURE	615	"                      from (select (select count(*)
"
PRC_AUTO_RUN	PROCEDURE	616	"                                      from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	617	"                                     where patient_no = t.patient_no
"
PRC_AUTO_RUN	PROCEDURE	618	"                                       and cwfp_date is null) sl,
"
PRC_AUTO_RUN	PROCEDURE	619	"                                   patient_no
"
PRC_AUTO_RUN	PROCEDURE	620	"                              From zy_deposit_file t
"
PRC_AUTO_RUN	PROCEDURE	621	"                             where patient_no <> 851509
"
PRC_AUTO_RUN	PROCEDURE	622	"                               and op_id = 'AU002'
"
PRC_AUTO_RUN	PROCEDURE	623	"                               and patient_no > 0
"
PRC_AUTO_RUN	PROCEDURE	624	"                               and js_No = 0
"
PRC_AUTO_RUN	PROCEDURE	625	"                               and depo_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	626	"                               and depo_date < sysdate - 0.05)
"
PRC_AUTO_RUN	PROCEDURE	627	"                     where sl = 1);
"
PRC_AUTO_RUN	PROCEDURE	628	"            if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	629	"              commit;
"
PRC_AUTO_RUN	PROCEDURE	630	"            else
"
PRC_AUTO_RUN	PROCEDURE	631	"              rollback;
"
PRC_AUTO_RUN	PROCEDURE	632	"            end if;
"
PRC_AUTO_RUN	PROCEDURE	633	"          */
"
PRC_AUTO_RUN	PROCEDURE	634	"        
"
PRC_AUTO_RUN	PROCEDURE	635	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	636	"      
"
PRC_AUTO_RUN	PROCEDURE	637	"        prc_sms_send('ts', '13777929515', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	638	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	639	"    
"
PRC_AUTO_RUN	PROCEDURE	640	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	641	"    --end 留义温暖基金
"
PRC_AUTO_RUN	PROCEDURE	642	"  
"
PRC_AUTO_RUN	PROCEDURE	643	"    prc_xiangmu_cursor_do('抗菌药物停止通知',
"
PRC_AUTO_RUN	PROCEDURE	644	"                          '',
"
PRC_AUTO_RUN	PROCEDURE	645	"                          '',
"
PRC_AUTO_RUN	PROCEDURE	646	"                          v_out_code,
"
PRC_AUTO_RUN	PROCEDURE	647	"                          v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	648	"  
"
PRC_AUTO_RUN	PROCEDURE	649	"    prc_xiangmu_cursor_do('门诊停诊通知', '', '', v_out_code, v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	650	"    prc_xiangmu_cursor_do('物价核查通知', '', '', v_out_code, v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	651	"  
"
PRC_AUTO_RUN	PROCEDURE	652	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	653	"
"
PRC_AUTO_RUN	PROCEDURE	654	"  -- 短信提醒： 化验结果提醒  化验项目未做提醒  药品未取提醒  检查项目未做提醒
"
PRC_AUTO_RUN	PROCEDURE	655	"
"
PRC_AUTO_RUN	PROCEDURE	656	"  if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	657	"    if 1 = 1 and (ls_now > '15:50' and ls_now <= '16:50') then
"
PRC_AUTO_RUN	PROCEDURE	658	"      if 1 = 1 and ls_now_minue = '1' then
"
PRC_AUTO_RUN	PROCEDURE	659	"        prc_xiangmu_sms_send('化验结果提醒', '', '', v_out_code, v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	660	"      
"
PRC_AUTO_RUN	PROCEDURE	661	"        prc_xiangmu_sms_send('化验项目未做提醒',
"
PRC_AUTO_RUN	PROCEDURE	662	"                             '',
"
PRC_AUTO_RUN	PROCEDURE	663	"                             '',
"
PRC_AUTO_RUN	PROCEDURE	664	"                             v_out_code,
"
PRC_AUTO_RUN	PROCEDURE	665	"                             v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	666	"        prc_xiangmu_sms_send('医后付未结算提醒',
"
PRC_AUTO_RUN	PROCEDURE	667	"                             '',
"
PRC_AUTO_RUN	PROCEDURE	668	"                             '',
"
PRC_AUTO_RUN	PROCEDURE	669	"                             v_out_code,
"
PRC_AUTO_RUN	PROCEDURE	670	"                             v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	671	"      
"
PRC_AUTO_RUN	PROCEDURE	672	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	673	"    
"
PRC_AUTO_RUN	PROCEDURE	674	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	675	"  
"
PRC_AUTO_RUN	PROCEDURE	676	"    if 1 = 1 and (ls_now > '07:50' and ls_now <= '16:50') then
"
PRC_AUTO_RUN	PROCEDURE	677	"      if 1 = 1 and ls_now_minue = '4' then
"
PRC_AUTO_RUN	PROCEDURE	678	"        prc_xiangmu_sms_send('药品未取提醒', '', '', v_out_code, v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	679	"      
"
PRC_AUTO_RUN	PROCEDURE	680	"        prc_xiangmu_sms_send('检查项目未做提醒',
"
PRC_AUTO_RUN	PROCEDURE	681	"                             '',
"
PRC_AUTO_RUN	PROCEDURE	682	"                             '',
"
PRC_AUTO_RUN	PROCEDURE	683	"                             v_out_code,
"
PRC_AUTO_RUN	PROCEDURE	684	"                             v_out_msg);
"
PRC_AUTO_RUN	PROCEDURE	685	"      
"
PRC_AUTO_RUN	PROCEDURE	686	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	687	"    
"
PRC_AUTO_RUN	PROCEDURE	688	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	689	"  
"
PRC_AUTO_RUN	PROCEDURE	690	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	691	"
"
PRC_AUTO_RUN	PROCEDURE	692	"  --  error 更新单价<0  ys_code null curr_ks=null
"
PRC_AUTO_RUN	PROCEDURE	693	"  if 1 = 1 and ls_now_minue = '2' then
"
PRC_AUTO_RUN	PROCEDURE	694	"  
"
PRC_AUTO_RUN	PROCEDURE	695	"    if (ls_now > '07:00' and ls_now <= '18:01') then
"
PRC_AUTO_RUN	PROCEDURE	696	"      update zy_detail_charge
"
PRC_AUTO_RUN	PROCEDURE	697	"         set dj = dj * -1, sl = sl * -1
"
PRC_AUTO_RUN	PROCEDURE	698	"       where js_no = 0
"
PRC_AUTO_RUN	PROCEDURE	699	"         and dj < 0
"
PRC_AUTO_RUN	PROCEDURE	700	"         and jcfx_date > sysdate - 0.011;
"
PRC_AUTO_RUN	PROCEDURE	701	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	702	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	703	"      else
"
PRC_AUTO_RUN	PROCEDURE	704	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	705	"        prc_sms_send('ts',
"
PRC_AUTO_RUN	PROCEDURE	706	"                     '13777929515',
"
PRC_AUTO_RUN	PROCEDURE	707	"                     'dj<0 update [prc_autu_run]',
"
PRC_AUTO_RUN	PROCEDURE	708	"                     v_bz);
"
PRC_AUTO_RUN	PROCEDURE	709	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	710	"    
"
PRC_AUTO_RUN	PROCEDURE	711	"      update zy_detail_charge x
"
PRC_AUTO_RUN	PROCEDURE	712	"         set ys_code = (select zzys
"
PRC_AUTO_RUN	PROCEDURE	713	"                          from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	714	"                         where patient_No = x.patient_no)
"
PRC_AUTO_RUN	PROCEDURE	715	"       where nvl(ys_code, 0) not in (select zgid from gy_zgxx)
"
PRC_AUTO_RUN	PROCEDURE	716	"         and js_no = 0
"
PRC_AUTO_RUN	PROCEDURE	717	"         and jcfx_date > sysdate - 0.011;
"
PRC_AUTO_RUN	PROCEDURE	718	"    
"
PRC_AUTO_RUN	PROCEDURE	719	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	720	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	721	"      else
"
PRC_AUTO_RUN	PROCEDURE	722	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	723	"        prc_sms_send('ts',
"
PRC_AUTO_RUN	PROCEDURE	724	"                     '13777929515',
"
PRC_AUTO_RUN	PROCEDURE	725	"                     'zzys null update [prc_autu_run] ',
"
PRC_AUTO_RUN	PROCEDURE	726	"                     v_bz);
"
PRC_AUTO_RUN	PROCEDURE	727	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	728	"    
"
PRC_AUTO_RUN	PROCEDURE	729	"      update zy_detail_charge t
"
PRC_AUTO_RUN	PROCEDURE	730	"         set curr_ks = (select curr_ks
"
PRC_AUTO_RUN	PROCEDURE	731	"                          from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	732	"                         where patient_no = t.patient_no)
"
PRC_AUTO_RUN	PROCEDURE	733	"       where trim(curr_ks) is null
"
PRC_AUTO_RUN	PROCEDURE	734	"         and jcfx_date > sysdate - 0.2
"
PRC_AUTO_RUN	PROCEDURE	735	"         and jcfx_date < sysdate - 0.001;
"
PRC_AUTO_RUN	PROCEDURE	736	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	737	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	738	"      else
"
PRC_AUTO_RUN	PROCEDURE	739	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	740	"        prc_sms_send('ts',
"
PRC_AUTO_RUN	PROCEDURE	741	"                     '13777929515',
"
PRC_AUTO_RUN	PROCEDURE	742	"                     'curr_ks null   [prc_autu_run]',
"
PRC_AUTO_RUN	PROCEDURE	743	"                     v_bz);
"
PRC_AUTO_RUN	PROCEDURE	744	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	745	"    
"
PRC_AUTO_RUN	PROCEDURE	746	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	747	"  
"
PRC_AUTO_RUN	PROCEDURE	748	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	749	"  --旧高值耗材更新价格
"
PRC_AUTO_RUN	PROCEDURE	750	"  if 1 = 0 then
"
PRC_AUTO_RUN	PROCEDURE	751	"    update zy_detail_charge t
"
PRC_AUTO_RUN	PROCEDURE	752	"       set dj = dj - 100, tsyybz = ' '
"
PRC_AUTO_RUN	PROCEDURE	753	"     where fygl = 25
"
PRC_AUTO_RUN	PROCEDURE	754	"       and tsyybz is null
"
PRC_AUTO_RUN	PROCEDURE	755	"       and t.twice_detail_code = 'SB'
"
PRC_AUTO_RUN	PROCEDURE	756	"       and js_No = 0
"
PRC_AUTO_RUN	PROCEDURE	757	"       and dj >= 2000
"
PRC_AUTO_RUN	PROCEDURE	758	"       and jlxh >= 293106684
"
PRC_AUTO_RUN	PROCEDURE	759	"       and jcfx_date > sysdate - 0.5
"
PRC_AUTO_RUN	PROCEDURE	760	"       and jcfx_date < sysdate - 0.0001;
"
PRC_AUTO_RUN	PROCEDURE	761	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	762	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	763	"    else
"
PRC_AUTO_RUN	PROCEDURE	764	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	765	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	766	"  
"
PRC_AUTO_RUN	PROCEDURE	767	"    update zy_detail_charge t
"
PRC_AUTO_RUN	PROCEDURE	768	"       set dj = round(dj / 1.05, 0), tsyybz = ' '
"
PRC_AUTO_RUN	PROCEDURE	769	"     where fygl = 25
"
PRC_AUTO_RUN	PROCEDURE	770	"       and tsyybz is null
"
PRC_AUTO_RUN	PROCEDURE	771	"       and t.twice_detail_code = 'SB'
"
PRC_AUTO_RUN	PROCEDURE	772	"       and js_No = 0
"
PRC_AUTO_RUN	PROCEDURE	773	"       and dj < 2000
"
PRC_AUTO_RUN	PROCEDURE	774	"       and jlxh >= 293106684
"
PRC_AUTO_RUN	PROCEDURE	775	"       and jcfx_date > sysdate - 0.5
"
PRC_AUTO_RUN	PROCEDURE	776	"       and jcfx_date < sysdate - 0.0001;
"
PRC_AUTO_RUN	PROCEDURE	777	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	778	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	779	"    else
"
PRC_AUTO_RUN	PROCEDURE	780	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	781	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	782	"    update gy_xtcs
"
PRC_AUTO_RUN	PROCEDURE	783	"       set csz1 = to_char(sysdate + 0.042, 'yyyymmddhh24')
"
PRC_AUTO_RUN	PROCEDURE	784	"     where xtxh = 0
"
PRC_AUTO_RUN	PROCEDURE	785	"       and csmc = 'AUTO_SB';
"
PRC_AUTO_RUN	PROCEDURE	786	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	787	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	788	"    else
"
PRC_AUTO_RUN	PROCEDURE	789	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	790	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	791	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	792	"
"
PRC_AUTO_RUN	PROCEDURE	793	"  --发热病人统计数据，发送短信  '12:01 - 12:02'
"
PRC_AUTO_RUN	PROCEDURE	794	"  if 101 = 101 and ((ls_now > '07:41' and ls_now <= '07:42')) then
"
PRC_AUTO_RUN	PROCEDURE	795	"    -- count(distinct to_char(jzrq, 'yyyymmdd') || ' ' || jzkh) ||
"
PRC_AUTO_RUN	PROCEDURE	796	"  
"
PRC_AUTO_RUN	PROCEDURE	797	"    /*  select to_char(trunc(sysdate - 1) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN	PROCEDURE	798	"               ' 至 ' || to_char(trunc(sysdate) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN	PROCEDURE	799	"               '为止,发热门诊病人: ' ||wm_concat(bz) from (
"
PRC_AUTO_RUN	PROCEDURE	800	"    select (select ksmc from gy_ksdm where ksdm=t.ksdm)|| count(distinct jzkh) || ' 例 ' bz   
"
PRC_AUTO_RUN	PROCEDURE	801	"          from zj_jzxx t      where ksdm in ('2270006', '2010040', '2100005')
"
PRC_AUTO_RUN	PROCEDURE	802	"           and jzrq between trunc(sysdate - 1) + 0.5 and trunc(sysdate) + 0.5
"
PRC_AUTO_RUN	PROCEDURE	803	"           group by t.ksdm )*/
"
PRC_AUTO_RUN	PROCEDURE	804	"  
"
PRC_AUTO_RUN	PROCEDURE	805	"    /* select to_char(trunc(sysdate - 1) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN	PROCEDURE	806	"           ' 至 ' || to_char(trunc(sysdate) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN	PROCEDURE	807	"           '为止,发热门诊病人: ' || count(distinct jzkh) || ' 例 '
"
PRC_AUTO_RUN	PROCEDURE	808	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	809	"      from zj_jzxx
"
PRC_AUTO_RUN	PROCEDURE	810	"     where ksdm in ('2270006', '2010040')
"
PRC_AUTO_RUN	PROCEDURE	811	"       and jzrq between trunc(sysdate - 1) + 0.5 and trunc(sysdate) + 0.5;
"
PRC_AUTO_RUN	PROCEDURE	812	"    
"
PRC_AUTO_RUN	PROCEDURE	813	"    select nr || ';发热门诊有发热症状的例数: ' || count(distinct(bingrenhm)) || ' 例 '
"
PRC_AUTO_RUN	PROCEDURE	814	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	815	"      from zj_menzhenblxx a, zj_jzxx b
"
PRC_AUTO_RUN	PROCEDURE	816	"     where a.jiuzhenxh = b.jzxh
"
PRC_AUTO_RUN	PROCEDURE	817	"       and a.zhushu like '%发热%'
"
PRC_AUTO_RUN	PROCEDURE	818	"       and b.ksdm in ('2270006', '2010040')
"
PRC_AUTO_RUN	PROCEDURE	819	"       and b.jzrq between trunc(sysdate - 1) + 0.5 and trunc(sysdate) + 0.5;*/
"
PRC_AUTO_RUN	PROCEDURE	820	"  
"
PRC_AUTO_RUN	PROCEDURE	821	"    select to_char(trunc(sysdate - 1), 'yyyy-mm-dd') || ' 发热门诊病人: ' ||
"
PRC_AUTO_RUN	PROCEDURE	822	"           count(distinct jzkh) || ' 例 '
"
PRC_AUTO_RUN	PROCEDURE	823	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	824	"      from zj_jzxx
"
PRC_AUTO_RUN	PROCEDURE	825	"     where ksdm in ('2270006', '2010040')
"
PRC_AUTO_RUN	PROCEDURE	826	"       and jzrq between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN	PROCEDURE	827	"  
"
PRC_AUTO_RUN	PROCEDURE	828	"    select nr || ',有发热症状的例数: ' || count(distinct(jzkh)) || ' 例; '
"
PRC_AUTO_RUN	PROCEDURE	829	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	830	"      from zj_jzxx b
"
PRC_AUTO_RUN	PROCEDURE	831	"     where b.BRTW > 37.5
"
PRC_AUTO_RUN	PROCEDURE	832	"       and b.ksdm in ('2270006', '2010040')
"
PRC_AUTO_RUN	PROCEDURE	833	"       and b.jzrq between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN	PROCEDURE	834	"  
"
PRC_AUTO_RUN	PROCEDURE	835	"    /*    prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	836	"    prc_sms_send('ts', '13958443561', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	837	"    prc_sms_send('ts', '13867936636', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	838	"    prc_sms_send('ts', '15757996037', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	839	"    prc_sms_send('ts', '15868957673', nr, v_bz);*/
"
PRC_AUTO_RUN	PROCEDURE	840	"  
"
PRC_AUTO_RUN	PROCEDURE	841	"    select nr || to_char(trunc(sysdate - 1), 'yyyy-mm-dd') || ' 儿科发热门诊病人: ' ||
"
PRC_AUTO_RUN	PROCEDURE	842	"           count(distinct jzkh) || ' 例 '
"
PRC_AUTO_RUN	PROCEDURE	843	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	844	"      from zj_jzxx
"
PRC_AUTO_RUN	PROCEDURE	845	"     where ksdm in ('2100005', '2020014')
"
PRC_AUTO_RUN	PROCEDURE	846	"       and jzrq between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN	PROCEDURE	847	"  
"
PRC_AUTO_RUN	PROCEDURE	848	"    select nr || ',有发热症状的例数: ' || count(distinct(jzkh)) || ' 例 '
"
PRC_AUTO_RUN	PROCEDURE	849	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	850	"      from zj_jzxx b
"
PRC_AUTO_RUN	PROCEDURE	851	"     where b.BRTW > 37.5
"
PRC_AUTO_RUN	PROCEDURE	852	"       and b.ksdm in ('2100005', '2020014')
"
PRC_AUTO_RUN	PROCEDURE	853	"       and b.jzrq between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN	PROCEDURE	854	"  
"
PRC_AUTO_RUN	PROCEDURE	855	"    prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	856	"    prc_sms_send('ts', '13958443561', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	857	"    prc_sms_send('ts', '13867936636', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	858	"    prc_sms_send('ts', '15757996037', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	859	"    prc_sms_send('ts', '15868957673', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	860	"    prc_sms_send('ts', '13516995998', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	861	"  
"
PRC_AUTO_RUN	PROCEDURE	862	"    --mz_jkk更新5天
"
PRC_AUTO_RUN	PROCEDURE	863	"    /*    if 1 = 0 then
"
PRC_AUTO_RUN	PROCEDURE	864	"      update mz_jkk
"
PRC_AUTO_RUN	PROCEDURE	865	"         set kzrq = jkrq + 6
"
PRC_AUTO_RUN	PROCEDURE	866	"       where jkcs = 1
"
PRC_AUTO_RUN	PROCEDURE	867	"         and wym = 2
"
PRC_AUTO_RUN	PROCEDURE	868	"         and xtbz = 0
"
PRC_AUTO_RUN	PROCEDURE	869	"         and sfsb is null
"
PRC_AUTO_RUN	PROCEDURE	870	"         and kzrq < jkrq + 6
"
PRC_AUTO_RUN	PROCEDURE	871	"         and jkrq > sysdate - 10
"
PRC_AUTO_RUN	PROCEDURE	872	"         and jkrq < sysdate - 0.1;
"
PRC_AUTO_RUN	PROCEDURE	873	"    
"
PRC_AUTO_RUN	PROCEDURE	874	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	875	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	876	"      else
"
PRC_AUTO_RUN	PROCEDURE	877	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	878	"        nr := 'mz_jkk更新5天报错，prc_auto_run';
"
PRC_AUTO_RUN	PROCEDURE	879	"        prc_sms_send('ts', '13867936636', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	880	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	881	"    end if;*/
"
PRC_AUTO_RUN	PROCEDURE	882	"  
"
PRC_AUTO_RUN	PROCEDURE	883	"    -- 门诊挂号人次
"
PRC_AUTO_RUN	PROCEDURE	884	"    /*   SELECT to_char(trunc(sysdate - 1) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN	PROCEDURE	885	"          ' 至 ' || to_char(trunc(sysdate) + 0.5, 'yyyy-mm-dd hh24:mi:ss') ||
"
PRC_AUTO_RUN	PROCEDURE	886	"          '为止,门诊挂号人次' || SUM(DECODE(A.THBZ,
"
PRC_AUTO_RUN	PROCEDURE	887	"                                    0,
"
PRC_AUTO_RUN	PROCEDURE	888	"                                    DECODE(A.ZFPB,
"
PRC_AUTO_RUN	PROCEDURE	889	"                                           NULL,
"
PRC_AUTO_RUN	PROCEDURE	890	"                                           DECODE(A.MZLBXH, 2, 0, 8, 0, 1),
"
PRC_AUTO_RUN	PROCEDURE	891	"                                           0),
"
PRC_AUTO_RUN	PROCEDURE	892	"                                    0)) || ' , 急诊挂号人次' ||
"
PRC_AUTO_RUN	PROCEDURE	893	"          SUM(DECODE(A.THBZ,
"
PRC_AUTO_RUN	PROCEDURE	894	"                     0,
"
PRC_AUTO_RUN	PROCEDURE	895	"                     DECODE(A.ZFPB,
"
PRC_AUTO_RUN	PROCEDURE	896	"                            NULL,
"
PRC_AUTO_RUN	PROCEDURE	897	"                            DECODE(A.MZLBXH, 2, 1, 8, 1, 0),
"
PRC_AUTO_RUN	PROCEDURE	898	"                            0),
"
PRC_AUTO_RUN	PROCEDURE	899	"                     0))
"
PRC_AUTO_RUN	PROCEDURE	900	"     into nr
"
PRC_AUTO_RUN	PROCEDURE	901	"     FROM GH_GHK A, GY_KSDM B
"
PRC_AUTO_RUN	PROCEDURE	902	"    WHERE A.KSDM = B.KSDM
"
PRC_AUTO_RUN	PROCEDURE	903	"      AND A.GHRQ between trunc(sysdate - 1) + 0.5 and trunc(sysdate) + 0.5;*/
"
PRC_AUTO_RUN	PROCEDURE	904	"  
"
PRC_AUTO_RUN	PROCEDURE	905	"    SELECT to_char(trunc(sysdate - 1), 'yyyy-mm-dd') || ' 门诊挂号人次' ||
"
PRC_AUTO_RUN	PROCEDURE	906	"           SUM(DECODE(A.THBZ,
"
PRC_AUTO_RUN	PROCEDURE	907	"                      0,
"
PRC_AUTO_RUN	PROCEDURE	908	"                      DECODE(A.ZFPB,
"
PRC_AUTO_RUN	PROCEDURE	909	"                             NULL,
"
PRC_AUTO_RUN	PROCEDURE	910	"                             DECODE(A.MZLBXH, 2, 0, 8, 0, 1),
"
PRC_AUTO_RUN	PROCEDURE	911	"                             0),
"
PRC_AUTO_RUN	PROCEDURE	912	"                      0)) || ' , 急诊挂号人次' ||
"
PRC_AUTO_RUN	PROCEDURE	913	"           SUM(DECODE(A.THBZ,
"
PRC_AUTO_RUN	PROCEDURE	914	"                      0,
"
PRC_AUTO_RUN	PROCEDURE	915	"                      DECODE(A.ZFPB,
"
PRC_AUTO_RUN	PROCEDURE	916	"                             NULL,
"
PRC_AUTO_RUN	PROCEDURE	917	"                             DECODE(A.MZLBXH, 2, 1, 8, 1, 0),
"
PRC_AUTO_RUN	PROCEDURE	918	"                             0),
"
PRC_AUTO_RUN	PROCEDURE	919	"                      0))
"
PRC_AUTO_RUN	PROCEDURE	920	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	921	"      FROM GH_GHK A, GY_KSDM B
"
PRC_AUTO_RUN	PROCEDURE	922	"     WHERE A.KSDM = B.KSDM
"
PRC_AUTO_RUN	PROCEDURE	923	"       AND A.GHRQ between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN	PROCEDURE	924	"  
"
PRC_AUTO_RUN	PROCEDURE	925	"    SELECT nr || ',本院核酸开单:' || count(jlxh)
"
PRC_AUTO_RUN	PROCEDURE	926	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	927	"      FROM GH_GHK A
"
PRC_AUTO_RUN	PROCEDURE	928	"     WHERE a.jzkh like 'BY%'
"
PRC_AUTO_RUN	PROCEDURE	929	"       AND A.GHRQ between trunc(sysdate - 1) and trunc(sysdate);
"
PRC_AUTO_RUN	PROCEDURE	930	"  
"
PRC_AUTO_RUN	PROCEDURE	931	"    prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	932	"    prc_sms_send('ts', '13958443561', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	933	"    prc_sms_send('ts', '13516995998', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	934	"    prc_sms_send('ts', '15868957673', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	935	"  
"
PRC_AUTO_RUN	PROCEDURE	936	"    --新冠统计
"
PRC_AUTO_RUN	PROCEDURE	937	"    select to_char(mc) into nr from v_auto_xingguang1218;
"
PRC_AUTO_RUN	PROCEDURE	938	"    prc_sms_send('ts', '13958443561', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	939	"    prc_sms_send('ts', '15868957673', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	940	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	941	"
"
PRC_AUTO_RUN	PROCEDURE	942	"  --决策分析_业务数据采集
"
PRC_AUTO_RUN	PROCEDURE	943	"  if ls_now > '02:01' and ls_now <= '02:02' then
"
PRC_AUTO_RUN	PROCEDURE	944	"    if 101 = 101 then
"
PRC_AUTO_RUN	PROCEDURE	945	"    
"
PRC_AUTO_RUN	PROCEDURE	946	"      v_task := '决策分析_业务数据采集';
"
PRC_AUTO_RUN	PROCEDURE	947	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	948	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	949	"        from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	950	"       where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN	PROCEDURE	951	"         and jylsh = v_task
"
PRC_AUTO_RUN	PROCEDURE	952	"         and jyrq > sysdate - 0.05;
"
PRC_AUTO_RUN	PROCEDURE	953	"      --最近1小时已经执行过
"
PRC_AUTO_RUN	PROCEDURE	954	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	955	"        v_task := ' ';
"
PRC_AUTO_RUN	PROCEDURE	956	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	957	"    
"
PRC_AUTO_RUN	PROCEDURE	958	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	959	"  
"
PRC_AUTO_RUN	PROCEDURE	960	"    -- 决策分析_业务数据采集 采集数据失败 zy_detail_charge curr_ks is null
"
PRC_AUTO_RUN	PROCEDURE	961	"    if v_task = '决策分析_业务数据采集' then
"
PRC_AUTO_RUN	PROCEDURE	962	"      insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	963	"        (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN	PROCEDURE	964	"      values
"
PRC_AUTO_RUN	PROCEDURE	965	"        (v_Procedure_Name, v_task, -1);
"
PRC_AUTO_RUN	PROCEDURE	966	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	967	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	968	"      else
"
PRC_AUTO_RUN	PROCEDURE	969	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	970	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	971	"    
"
PRC_AUTO_RUN	PROCEDURE	972	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	973	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	974	"        from Zy_Detail_Charge
"
PRC_AUTO_RUN	PROCEDURE	975	"       WHERE jcfx_date > sysdate - 3
"
PRC_AUTO_RUN	PROCEDURE	976	"         and jcfx_date < trunc(sysdate)
"
PRC_AUTO_RUN	PROCEDURE	977	"         and CURR_KS IS NULL;
"
PRC_AUTO_RUN	PROCEDURE	978	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	979	"        insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	980	"          (jiaoyilx, jylsh, patient_no)
"
PRC_AUTO_RUN	PROCEDURE	981	"        values
"
PRC_AUTO_RUN	PROCEDURE	982	"          (v_Procedure_Name,
"
PRC_AUTO_RUN	PROCEDURE	983	"           '决策分析_业务数据采集 zy_detail_charge curr_ks is null  数量为 patient_no',
"
PRC_AUTO_RUN	PROCEDURE	984	"           v_count);
"
PRC_AUTO_RUN	PROCEDURE	985	"        if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	986	"          commit;
"
PRC_AUTO_RUN	PROCEDURE	987	"        else
"
PRC_AUTO_RUN	PROCEDURE	988	"          rollback;
"
PRC_AUTO_RUN	PROCEDURE	989	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	990	"      
"
PRC_AUTO_RUN	PROCEDURE	991	"        update zy_detail_charge x
"
PRC_AUTO_RUN	PROCEDURE	992	"           set curr_ks = (select curr_ks
"
PRC_AUTO_RUN	PROCEDURE	993	"                            from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	994	"                           where zy_patient_information.patient_No =
"
PRC_AUTO_RUN	PROCEDURE	995	"                                 x.patient_No)
"
PRC_AUTO_RUN	PROCEDURE	996	"         where x.curr_ks is null
"
PRC_AUTO_RUN	PROCEDURE	997	"           and x.jcfx_date > sysdate - 3
"
PRC_AUTO_RUN	PROCEDURE	998	"           and jcfx_date < trunc(sysdate)
"
PRC_AUTO_RUN	PROCEDURE	999	"           and exists
"
PRC_AUTO_RUN	PROCEDURE	1000	"         (select 1
"
PRC_AUTO_RUN	PROCEDURE	1001	"                  from zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	1002	"                 where zy_patient_information.patient_No = x.patient_NO);
"
PRC_AUTO_RUN	PROCEDURE	1003	"        if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1004	"          commit;
"
PRC_AUTO_RUN	PROCEDURE	1005	"        else
"
PRC_AUTO_RUN	PROCEDURE	1006	"          rollback;
"
PRC_AUTO_RUN	PROCEDURE	1007	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1008	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1009	"    
"
PRC_AUTO_RUN	PROCEDURE	1010	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1011	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	1012	"        from Zy_Detail_Charge
"
PRC_AUTO_RUN	PROCEDURE	1013	"       WHERE jcfx_date > sysdate - 3
"
PRC_AUTO_RUN	PROCEDURE	1014	"         and jcfx_date < trunc(sysdate)
"
PRC_AUTO_RUN	PROCEDURE	1015	"         and CURR_KS IS NULL;
"
PRC_AUTO_RUN	PROCEDURE	1016	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1017	"        insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1018	"          (jiaoyilx, jylsh, patient_no)
"
PRC_AUTO_RUN	PROCEDURE	1019	"        values
"
PRC_AUTO_RUN	PROCEDURE	1020	"          (v_Procedure_Name,
"
PRC_AUTO_RUN	PROCEDURE	1021	"           '决策分析_业务数据采集 zy_detail_charge curr_ks is null 调整jcfx_date 数量为 patient_no',
"
PRC_AUTO_RUN	PROCEDURE	1022	"           v_count);
"
PRC_AUTO_RUN	PROCEDURE	1023	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	1024	"      
"
PRC_AUTO_RUN	PROCEDURE	1025	"        update Zy_Detail_Charge
"
PRC_AUTO_RUN	PROCEDURE	1026	"           set jcfx_date = sysdate
"
PRC_AUTO_RUN	PROCEDURE	1027	"         WHERE jcfx_date > sysdate - 3
"
PRC_AUTO_RUN	PROCEDURE	1028	"           and jcfx_date < trunc(sysdate)
"
PRC_AUTO_RUN	PROCEDURE	1029	"           and CURR_KS IS NULL;
"
PRC_AUTO_RUN	PROCEDURE	1030	"        if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1031	"          commit;
"
PRC_AUTO_RUN	PROCEDURE	1032	"        else
"
PRC_AUTO_RUN	PROCEDURE	1033	"          rollback;
"
PRC_AUTO_RUN	PROCEDURE	1034	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1035	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1036	"      --执行数据采集 存储过程
"
PRC_AUTO_RUN	PROCEDURE	1037	"      prc_sjcj();
"
PRC_AUTO_RUN	PROCEDURE	1038	"      /* insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1039	"        (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN	PROCEDURE	1040	"      values
"
PRC_AUTO_RUN	PROCEDURE	1041	"        (v_Procedure_Name, v_task, 1);*/
"
PRC_AUTO_RUN	PROCEDURE	1042	"      update zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1043	"         set flag = 1
"
PRC_AUTO_RUN	PROCEDURE	1044	"       where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN	PROCEDURE	1045	"         and jylsh = v_task
"
PRC_AUTO_RUN	PROCEDURE	1046	"         and jyrq > sysdate - 0.05;
"
PRC_AUTO_RUN	PROCEDURE	1047	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1048	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	1049	"      else
"
PRC_AUTO_RUN	PROCEDURE	1050	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	1051	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1052	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1053	"  
"
PRC_AUTO_RUN	PROCEDURE	1054	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1055	"
"
PRC_AUTO_RUN	PROCEDURE	1056	"  --后台运行统计数据，发送短信  '02:01 - 02:02'
"
PRC_AUTO_RUN	PROCEDURE	1057	"  if 103 = 103 and ((ls_now > '03:01' and ls_now <= '03:02')) then
"
PRC_AUTO_RUN	PROCEDURE	1058	"  
"
PRC_AUTO_RUN	PROCEDURE	1059	"    select COUNT(*)
"
PRC_AUTO_RUN	PROCEDURE	1060	"      INTO v_count
"
PRC_AUTO_RUN	PROCEDURE	1061	"      from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1062	"     where jyrq > sysdate - 0.002
"
PRC_AUTO_RUN	PROCEDURE	1063	"       and jyrq < sysdate
"
PRC_AUTO_RUN	PROCEDURE	1064	"       and jiaoyilx = 'PRC_AUTO_RUN_QUERY1';
"
PRC_AUTO_RUN	PROCEDURE	1065	"    if v_count = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1066	"      PRC_AUTO_RUN_QUERY1();
"
PRC_AUTO_RUN	PROCEDURE	1067	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1068	"  
"
PRC_AUTO_RUN	PROCEDURE	1069	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1070	"
"
PRC_AUTO_RUN	PROCEDURE	1071	"  --执行失败任务查询  (存储过程，函数失效)
"
PRC_AUTO_RUN	PROCEDURE	1072	"  if ls_now > '07:01' and ls_now <= '07:02' then
"
PRC_AUTO_RUN	PROCEDURE	1073	"    if 0 = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1074	"      -- '执行失败任务查询';
"
PRC_AUTO_RUN	PROCEDURE	1075	"      if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1076	"        v_task := '执行失败任务查询';
"
PRC_AUTO_RUN	PROCEDURE	1077	"      
"
PRC_AUTO_RUN	PROCEDURE	1078	"        select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1079	"          into v_count
"
PRC_AUTO_RUN	PROCEDURE	1080	"          from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1081	"         where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN	PROCEDURE	1082	"           and jylsh = v_task
"
PRC_AUTO_RUN	PROCEDURE	1083	"           and jyrq > sysdate - 0.05;
"
PRC_AUTO_RUN	PROCEDURE	1084	"        --最近1小时已经执行过
"
PRC_AUTO_RUN	PROCEDURE	1085	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1086	"          v_task := ' ';
"
PRC_AUTO_RUN	PROCEDURE	1087	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1088	"      
"
PRC_AUTO_RUN	PROCEDURE	1089	"        if v_task = '执行失败任务查询' then
"
PRC_AUTO_RUN	PROCEDURE	1090	"          insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1091	"            (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN	PROCEDURE	1092	"          values
"
PRC_AUTO_RUN	PROCEDURE	1093	"            (v_Procedure_Name, v_task, 0);
"
PRC_AUTO_RUN	PROCEDURE	1094	"          if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1095	"            commit;
"
PRC_AUTO_RUN	PROCEDURE	1096	"          else
"
PRC_AUTO_RUN	PROCEDURE	1097	"            rollback;
"
PRC_AUTO_RUN	PROCEDURE	1098	"          end if;
"
PRC_AUTO_RUN	PROCEDURE	1099	"        
"
PRC_AUTO_RUN	PROCEDURE	1100	"          select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1101	"            into v_count
"
PRC_AUTO_RUN	PROCEDURE	1102	"            from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1103	"           where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN	PROCEDURE	1104	"             and flag = -1
"
PRC_AUTO_RUN	PROCEDURE	1105	"             and jyrq > sysdate - 1.05;
"
PRC_AUTO_RUN	PROCEDURE	1106	"          if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1107	"            select v_Procedure_Name || ',执行失败任务,sl:' || to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1108	"              into nr
"
PRC_AUTO_RUN	PROCEDURE	1109	"              from dual;
"
PRC_AUTO_RUN	PROCEDURE	1110	"            prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1111	"          end if;
"
PRC_AUTO_RUN	PROCEDURE	1112	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1113	"      
"
PRC_AUTO_RUN	PROCEDURE	1114	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1115	"    
"
PRC_AUTO_RUN	PROCEDURE	1116	"      -- (存储过程，函数失效)
"
PRC_AUTO_RUN	PROCEDURE	1117	"      if 2 = 2 then
"
PRC_AUTO_RUN	PROCEDURE	1118	"      
"
PRC_AUTO_RUN	PROCEDURE	1119	"        select nvl(to_char(wm_concat(object_name)), '')
"
PRC_AUTO_RUN	PROCEDURE	1120	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	1121	"          from v_system_view_fail;
"
PRC_AUTO_RUN	PROCEDURE	1122	"        if length(nr) > 1 then
"
PRC_AUTO_RUN	PROCEDURE	1123	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1124	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1125	"      
"
PRC_AUTO_RUN	PROCEDURE	1126	"        select count(object_name) into v_count from v_system_view_fail;
"
PRC_AUTO_RUN	PROCEDURE	1127	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1128	"          select v_Procedure_Name || ',存储过程，函数失效3,sl:' || to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1129	"            into nr
"
PRC_AUTO_RUN	PROCEDURE	1130	"            from dual;
"
PRC_AUTO_RUN	PROCEDURE	1131	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1132	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1133	"      
"
PRC_AUTO_RUN	PROCEDURE	1134	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1135	"    
"
PRC_AUTO_RUN	PROCEDURE	1136	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1137	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1138	"
"
PRC_AUTO_RUN	PROCEDURE	1139	"  --- 后台短信发送日期调整
"
PRC_AUTO_RUN	PROCEDURE	1140	"  if (ls_now > '07:25' and ls_now <= '07:26') then
"
PRC_AUTO_RUN	PROCEDURE	1141	"    begin
"
PRC_AUTO_RUN	PROCEDURE	1142	"    
"
PRC_AUTO_RUN	PROCEDURE	1143	"      delete zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1144	"       where jiaoyilx in ('门诊记账病人查询', 'MZZJ', 'IP地址判断')
"
PRC_AUTO_RUN	PROCEDURE	1145	"         and jyrq < sysdate - 10;
"
PRC_AUTO_RUN	PROCEDURE	1146	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	1147	"    
"
PRC_AUTO_RUN	PROCEDURE	1148	"      delete zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1149	"       where jiaoyilx in ('增加门诊病人修改记录')
"
PRC_AUTO_RUN	PROCEDURE	1150	"         and jyrq < sysdate - 70;
"
PRC_AUTO_RUN	PROCEDURE	1151	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	1152	"    
"
PRC_AUTO_RUN	PROCEDURE	1153	"      --- 后台短信发送日期调整
"
PRC_AUTO_RUN	PROCEDURE	1154	"      if 3 = 3 then
"
PRC_AUTO_RUN	PROCEDURE	1155	"        select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1156	"          into v_count
"
PRC_AUTO_RUN	PROCEDURE	1157	"          from auto_task_ywzx_send
"
PRC_AUTO_RUN	PROCEDURE	1158	"         where date_add = date_send
"
PRC_AUTO_RUN	PROCEDURE	1159	"           and lx = 'au'
"
PRC_AUTO_RUN	PROCEDURE	1160	"           and date_add > sysdate - 0.3
"
PRC_AUTO_RUN	PROCEDURE	1161	"           and date_add < sysdate - 0.0002;
"
PRC_AUTO_RUN	PROCEDURE	1162	"        --最近1小时已经执行过
"
PRC_AUTO_RUN	PROCEDURE	1163	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1164	"          update auto_task_ywzx_send
"
PRC_AUTO_RUN	PROCEDURE	1165	"             set date_send = null
"
PRC_AUTO_RUN	PROCEDURE	1166	"           where date_add = date_send
"
PRC_AUTO_RUN	PROCEDURE	1167	"             and lx = 'au'
"
PRC_AUTO_RUN	PROCEDURE	1168	"             and date_add > sysdate - 0.29
"
PRC_AUTO_RUN	PROCEDURE	1169	"             and date_add < sysdate - 0.0002;
"
PRC_AUTO_RUN	PROCEDURE	1170	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1171	"      
"
PRC_AUTO_RUN	PROCEDURE	1172	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1173	"    
"
PRC_AUTO_RUN	PROCEDURE	1174	"    end;
"
PRC_AUTO_RUN	PROCEDURE	1175	"  
"
PRC_AUTO_RUN	PROCEDURE	1176	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1177	"
"
PRC_AUTO_RUN	PROCEDURE	1178	"  --全院业务收入，发送短信  '07:30 - 07:31'
"
PRC_AUTO_RUN	PROCEDURE	1179	"  if (ls_now > '07:30' and ls_now <= '07:31') or
"
PRC_AUTO_RUN	PROCEDURE	1180	"     (ls_now > '07:45' and ls_now <= '07:46') then
"
PRC_AUTO_RUN	PROCEDURE	1181	"    if 104 = 104 then
"
PRC_AUTO_RUN	PROCEDURE	1182	"    
"
PRC_AUTO_RUN	PROCEDURE	1183	"      select COUNT(*)
"
PRC_AUTO_RUN	PROCEDURE	1184	"        INTO v_count
"
PRC_AUTO_RUN	PROCEDURE	1185	"        from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1186	"       where jyrq > sysdate - 0.1
"
PRC_AUTO_RUN	PROCEDURE	1187	"         and jyrq < sysdate
"
PRC_AUTO_RUN	PROCEDURE	1188	"         and jiaoyilx = 'PRC_AUTO_RUN_GZL';
"
PRC_AUTO_RUN	PROCEDURE	1189	"      if v_count = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1190	"        prc_auto_run_gzl();
"
PRC_AUTO_RUN	PROCEDURE	1191	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1192	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1193	"  
"
PRC_AUTO_RUN	PROCEDURE	1194	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1195	"
"
PRC_AUTO_RUN	PROCEDURE	1196	"  --空床 发送短信  '08:10'
"
PRC_AUTO_RUN	PROCEDURE	1197	"  if (ls_now > '08:10' and ls_now <= '08:11') or
"
PRC_AUTO_RUN	PROCEDURE	1198	"     (ls_now > '08:20' and ls_now <= '08:21') then
"
PRC_AUTO_RUN	PROCEDURE	1199	"    if 105 = 105 then
"
PRC_AUTO_RUN	PROCEDURE	1200	"    
"
PRC_AUTO_RUN	PROCEDURE	1201	"      select COUNT(*)
"
PRC_AUTO_RUN	PROCEDURE	1202	"        INTO v_count
"
PRC_AUTO_RUN	PROCEDURE	1203	"        from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1204	"       where jyrq > sysdate - 0.01
"
PRC_AUTO_RUN	PROCEDURE	1205	"         and jyrq < sysdate
"
PRC_AUTO_RUN	PROCEDURE	1206	"         and jiaoyilx = 'PRC_AUTO_RUN_GZL_BED';
"
PRC_AUTO_RUN	PROCEDURE	1207	"      if v_count = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1208	"        PRC_AUTO_RUN_GZL_BED();
"
PRC_AUTO_RUN	PROCEDURE	1209	"      
"
PRC_AUTO_RUN	PROCEDURE	1210	"        update auto_task_ywzx_send
"
PRC_AUTO_RUN	PROCEDURE	1211	"           set date_send = null
"
PRC_AUTO_RUN	PROCEDURE	1212	"         where date_add > sysdate - 0.5
"
PRC_AUTO_RUN	PROCEDURE	1213	"           and lx = 'a';
"
PRC_AUTO_RUN	PROCEDURE	1214	"        if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1215	"          commit;
"
PRC_AUTO_RUN	PROCEDURE	1216	"        else
"
PRC_AUTO_RUN	PROCEDURE	1217	"          rollback;
"
PRC_AUTO_RUN	PROCEDURE	1218	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1219	"      
"
PRC_AUTO_RUN	PROCEDURE	1220	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1221	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1222	"  
"
PRC_AUTO_RUN	PROCEDURE	1223	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1224	"
"
PRC_AUTO_RUN	PROCEDURE	1225	"  --空床2 发送短信  '08:10'
"
PRC_AUTO_RUN	PROCEDURE	1226	"  v_temp := substr(ls_now, 4, 2);
"
PRC_AUTO_RUN	PROCEDURE	1227	"  --select  substr('08:02',4,2) from dual 
"
PRC_AUTO_RUN	PROCEDURE	1228	"  if v_temp > '56' and v_temp <= '57' and
"
PRC_AUTO_RUN	PROCEDURE	1229	"     (ls_now > '23:00' or ls_now <= '01:01') then
"
PRC_AUTO_RUN	PROCEDURE	1230	"    PRC_AUTO_RUN_GZL_BED2();
"
PRC_AUTO_RUN	PROCEDURE	1231	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1232	"  --  PRC_AUTO_RUN_GZL_BED2();
"
PRC_AUTO_RUN	PROCEDURE	1233	"  --dj <0  check
"
PRC_AUTO_RUN	PROCEDURE	1234	"
"
PRC_AUTO_RUN	PROCEDURE	1235	"  if (ls_now > '08:00' and ls_now <= '08:01') or
"
PRC_AUTO_RUN	PROCEDURE	1236	"     (ls_now > '08:30' and ls_now <= '08:31') or
"
PRC_AUTO_RUN	PROCEDURE	1237	"     (ls_now > '09:30' and ls_now <= '09:31') or
"
PRC_AUTO_RUN	PROCEDURE	1238	"     (ls_now > '10:30' and ls_now <= '10:31') or
"
PRC_AUTO_RUN	PROCEDURE	1239	"     (ls_now > '11:30' and ls_now <= '11:31') or
"
PRC_AUTO_RUN	PROCEDURE	1240	"     (ls_now > '12:30' and ls_now <= '12:31') or
"
PRC_AUTO_RUN	PROCEDURE	1241	"     (ls_now > '13:30' and ls_now <= '13:31') or
"
PRC_AUTO_RUN	PROCEDURE	1242	"     (ls_now > '14:30' and ls_now <= '14:31') or
"
PRC_AUTO_RUN	PROCEDURE	1243	"     (ls_now > '15:30' and ls_now <= '15:31') or
"
PRC_AUTO_RUN	PROCEDURE	1244	"     (ls_now > '19:30' and ls_now <= '19:31') or
"
PRC_AUTO_RUN	PROCEDURE	1245	"     (ls_now > '16:30' and ls_now <= '16:31') or
"
PRC_AUTO_RUN	PROCEDURE	1246	"     (ls_now > '17:00' and ls_now <= '17:01') or
"
PRC_AUTO_RUN	PROCEDURE	1247	"     (ls_now > '18:00' and ls_now <= '18:01') then
"
PRC_AUTO_RUN	PROCEDURE	1248	"    if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1249	"    
"
PRC_AUTO_RUN	PROCEDURE	1250	"      if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1251	"      
"
PRC_AUTO_RUN	PROCEDURE	1252	"        select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1253	"          into v_count
"
PRC_AUTO_RUN	PROCEDURE	1254	"          From gy_jrjymx
"
PRC_AUTO_RUN	PROCEDURE	1255	"         where jyje > 0
"
PRC_AUTO_RUN	PROCEDURE	1256	"           and jysj > sysdate - 0.5
"
PRC_AUTO_RUN	PROCEDURE	1257	"           and nvl(zxlsh, shlsh) is null;
"
PRC_AUTO_RUN	PROCEDURE	1258	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1259	"          select 'gy_jrjymx记录异常,交易流水号空' into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	1260	"          lxdh := '13777929515';
"
PRC_AUTO_RUN	PROCEDURE	1261	"          prc_sms_send_mark('au', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1262	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1263	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1264	"    
"
PRC_AUTO_RUN	PROCEDURE	1265	"      -- 万达支付 诊间结算核查
"
PRC_AUTO_RUN	PROCEDURE	1266	"      if 1 = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1267	"        v_temp := '';
"
PRC_AUTO_RUN	PROCEDURE	1268	"        select nvl(to_char(wm_concat(ipaddress)), '')
"
PRC_AUTO_RUN	PROCEDURE	1269	"          into v_temp
"
PRC_AUTO_RUN	PROCEDURE	1270	"          from (select distinct (a.ipaddress) ipaddress
"
PRC_AUTO_RUN	PROCEDURE	1271	"                
"
PRC_AUTO_RUN	PROCEDURE	1272	"                  from mz_mzsfk1 a
"
PRC_AUTO_RUN	PROCEDURE	1273	"                 where a.ipaddress is not null
"
PRC_AUTO_RUN	PROCEDURE	1274	"                   and qtsffs in (16, 17)
"
PRC_AUTO_RUN	PROCEDURE	1275	"                   and qtsfje > 0
"
PRC_AUTO_RUN	PROCEDURE	1276	"                   and czgh in ('AUTO4', 'AUTO5')
"
PRC_AUTO_RUN	PROCEDURE	1277	"                   AND a.sfrq > sysdate - 0.2);
"
PRC_AUTO_RUN	PROCEDURE	1278	"        if length(v_temp) > 2 then
"
PRC_AUTO_RUN	PROCEDURE	1279	"          select v_Procedure_Name || ',万达支付 诊间结算核查:' || v_temp
"
PRC_AUTO_RUN	PROCEDURE	1280	"            into nr
"
PRC_AUTO_RUN	PROCEDURE	1281	"            from dual;
"
PRC_AUTO_RUN	PROCEDURE	1282	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1283	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1284	"      
"
PRC_AUTO_RUN	PROCEDURE	1285	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1286	"    
"
PRC_AUTO_RUN	PROCEDURE	1287	"      --执行失败任务查询  (存储过程，函数失效)    
"
PRC_AUTO_RUN	PROCEDURE	1288	"      if ls_now >= '07:01' and ls_now <= '07:02' then
"
PRC_AUTO_RUN	PROCEDURE	1289	"        if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1290	"          if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1291	"            v_task := '执行失败任务查询';
"
PRC_AUTO_RUN	PROCEDURE	1292	"          
"
PRC_AUTO_RUN	PROCEDURE	1293	"            select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1294	"              into v_count
"
PRC_AUTO_RUN	PROCEDURE	1295	"              from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1296	"             where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN	PROCEDURE	1297	"               and jylsh = v_task
"
PRC_AUTO_RUN	PROCEDURE	1298	"               and jyrq > sysdate - 0.05;
"
PRC_AUTO_RUN	PROCEDURE	1299	"            --最近1小时已经执行过
"
PRC_AUTO_RUN	PROCEDURE	1300	"            if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1301	"              v_task := ' ';
"
PRC_AUTO_RUN	PROCEDURE	1302	"            end if;
"
PRC_AUTO_RUN	PROCEDURE	1303	"          
"
PRC_AUTO_RUN	PROCEDURE	1304	"            if v_task = '执行失败任务查询' then
"
PRC_AUTO_RUN	PROCEDURE	1305	"              insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1306	"                (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN	PROCEDURE	1307	"              values
"
PRC_AUTO_RUN	PROCEDURE	1308	"                (v_Procedure_Name, v_task, 0);
"
PRC_AUTO_RUN	PROCEDURE	1309	"              commit;
"
PRC_AUTO_RUN	PROCEDURE	1310	"            
"
PRC_AUTO_RUN	PROCEDURE	1311	"              select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1312	"                into v_count
"
PRC_AUTO_RUN	PROCEDURE	1313	"                from zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1314	"               where jiaoyilx = v_Procedure_Name
"
PRC_AUTO_RUN	PROCEDURE	1315	"                 and flag = -1
"
PRC_AUTO_RUN	PROCEDURE	1316	"                 and jyrq > sysdate - 1.05;
"
PRC_AUTO_RUN	PROCEDURE	1317	"              if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1318	"                select v_Procedure_Name || ',执行失败任务,sl:' ||
"
PRC_AUTO_RUN	PROCEDURE	1319	"                       to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1320	"                  into nr
"
PRC_AUTO_RUN	PROCEDURE	1321	"                  from dual;
"
PRC_AUTO_RUN	PROCEDURE	1322	"                prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1323	"              end if;
"
PRC_AUTO_RUN	PROCEDURE	1324	"            end if;
"
PRC_AUTO_RUN	PROCEDURE	1325	"          
"
PRC_AUTO_RUN	PROCEDURE	1326	"          end if;
"
PRC_AUTO_RUN	PROCEDURE	1327	"        
"
PRC_AUTO_RUN	PROCEDURE	1328	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1329	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1330	"    
"
PRC_AUTO_RUN	PROCEDURE	1331	"      --日间病人处理
"
PRC_AUTO_RUN	PROCEDURE	1332	"      --  PRO_ITEM_DO('日间病人处理', '00000006', v_bz);    
"
PRC_AUTO_RUN	PROCEDURE	1333	"      -- zy_detail_charge curr_ks is null 
"
PRC_AUTO_RUN	PROCEDURE	1334	"      if 1 <> 1 then
"
PRC_AUTO_RUN	PROCEDURE	1335	"        select COUNT(*)
"
PRC_AUTO_RUN	PROCEDURE	1336	"          INTO v_count
"
PRC_AUTO_RUN	PROCEDURE	1337	"          From zy_detail_charge
"
PRC_AUTO_RUN	PROCEDURE	1338	"         where js_NO = 0
"
PRC_AUTO_RUN	PROCEDURE	1339	"           and dj < 0
"
PRC_AUTO_RUN	PROCEDURE	1340	"           and jcfx_date > sysdate - 1
"
PRC_AUTO_RUN	PROCEDURE	1341	"           and jcfx_date < sysdate - 0.001;
"
PRC_AUTO_RUN	PROCEDURE	1342	"      
"
PRC_AUTO_RUN	PROCEDURE	1343	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1344	"          select v_Procedure_Name || ',curr_ks is nul,sl:' ||
"
PRC_AUTO_RUN	PROCEDURE	1345	"                 to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1346	"            into nr
"
PRC_AUTO_RUN	PROCEDURE	1347	"            from dual;
"
PRC_AUTO_RUN	PROCEDURE	1348	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1349	"        
"
PRC_AUTO_RUN	PROCEDURE	1350	"          update zy_detail_charge
"
PRC_AUTO_RUN	PROCEDURE	1351	"             set dj = dj * -1, sl = sl * -1
"
PRC_AUTO_RUN	PROCEDURE	1352	"           where js_NO = 0
"
PRC_AUTO_RUN	PROCEDURE	1353	"             and dj < 0
"
PRC_AUTO_RUN	PROCEDURE	1354	"             and jcfx_date > sysdate - 1
"
PRC_AUTO_RUN	PROCEDURE	1355	"             and jcfx_date < sysdate - 0.001;
"
PRC_AUTO_RUN	PROCEDURE	1356	"          if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1357	"            commit;
"
PRC_AUTO_RUN	PROCEDURE	1358	"          else
"
PRC_AUTO_RUN	PROCEDURE	1359	"            rollback;
"
PRC_AUTO_RUN	PROCEDURE	1360	"          end if;
"
PRC_AUTO_RUN	PROCEDURE	1361	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1362	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1363	"    
"
PRC_AUTO_RUN	PROCEDURE	1364	"      --住院预缴款退款失败    
"
PRC_AUTO_RUN	PROCEDURE	1365	"      if 3 = 3 and ls_now >= '09:01' and ls_now <= '09:02' then
"
PRC_AUTO_RUN	PROCEDURE	1366	"        select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1367	"          into v_count
"
PRC_AUTO_RUN	PROCEDURE	1368	"          from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	1369	"         where depo_date > sysdate - 3
"
PRC_AUTO_RUN	PROCEDURE	1370	"           and AMOUNT < 0
"
PRC_AUTO_RUN	PROCEDURE	1371	"           and nvl(cdcs, 0) = 0
"
PRC_AUTO_RUN	PROCEDURE	1372	"           and length(bz) > 30
"
PRC_AUTO_RUN	PROCEDURE	1373	"           and depo_type > 1;
"
PRC_AUTO_RUN	PROCEDURE	1374	"      
"
PRC_AUTO_RUN	PROCEDURE	1375	"        if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1376	"          select v_Procedure_Name || ',住院预缴款退款失败,sl:' || to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1377	"            into nr
"
PRC_AUTO_RUN	PROCEDURE	1378	"            from dual;
"
PRC_AUTO_RUN	PROCEDURE	1379	"          prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1380	"        
"
PRC_AUTO_RUN	PROCEDURE	1381	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1382	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1383	"    
"
PRC_AUTO_RUN	PROCEDURE	1384	"      -- (存储过程，函数失效)
"
PRC_AUTO_RUN	PROCEDURE	1385	"    
"
PRC_AUTO_RUN	PROCEDURE	1386	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1387	"  
"
PRC_AUTO_RUN	PROCEDURE	1388	"    --  zy_patient_information.jtbf_flag  is null 
"
PRC_AUTO_RUN	PROCEDURE	1389	"    if 2 <> 2 then
"
PRC_AUTO_RUN	PROCEDURE	1390	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1391	"        INTO v_count
"
PRC_AUTO_RUN	PROCEDURE	1392	"        from zy_patient_information y
"
PRC_AUTO_RUN	PROCEDURE	1393	"       where patient_No in (select patient_NO
"
PRC_AUTO_RUN	PROCEDURE	1394	"                              from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	1395	"                             where depo_date > sysdate - 2)
"
PRC_AUTO_RUN	PROCEDURE	1396	"         and jtbf_flag is null;
"
PRC_AUTO_RUN	PROCEDURE	1397	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1398	"        select v_Procedure_Name ||
"
PRC_AUTO_RUN	PROCEDURE	1399	"               ',zy_patient_information.jtbf_flag is nul,sl:' ||
"
PRC_AUTO_RUN	PROCEDURE	1400	"               to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1401	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	1402	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	1403	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1404	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1405	"      update zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	1406	"         set jtbf_flag = 0
"
PRC_AUTO_RUN	PROCEDURE	1407	"       where patient_No in
"
PRC_AUTO_RUN	PROCEDURE	1408	"             (select patient_NO
"
PRC_AUTO_RUN	PROCEDURE	1409	"                from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	1410	"               where depo_date > sysdate - 0.6
"
PRC_AUTO_RUN	PROCEDURE	1411	"                 and depo_date < sysdate - 0.001)
"
PRC_AUTO_RUN	PROCEDURE	1412	"         and jtbf_flag is null;
"
PRC_AUTO_RUN	PROCEDURE	1413	"      if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1414	"        commit;
"
PRC_AUTO_RUN	PROCEDURE	1415	"      else
"
PRC_AUTO_RUN	PROCEDURE	1416	"        rollback;
"
PRC_AUTO_RUN	PROCEDURE	1417	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1418	"    
"
PRC_AUTO_RUN	PROCEDURE	1419	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1420	"        INTO v_count
"
PRC_AUTO_RUN	PROCEDURE	1421	"        From (select rb_date, sum(je1) aa, sum(je2) bb
"
PRC_AUTO_RUN	PROCEDURE	1422	"                from (select rb_date rb_date, sum(xmje2) je1, 0 je2
"
PRC_AUTO_RUN	PROCEDURE	1423	"                        From zy_rbk2
"
PRC_AUTO_RUN	PROCEDURE	1424	"                       where rb_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	1425	"                         and hh in (27)
"
PRC_AUTO_RUN	PROCEDURE	1426	"                       group by rb_date
"
PRC_AUTO_RUN	PROCEDURE	1427	"                      union all
"
PRC_AUTO_RUN	PROCEDURE	1428	"                      select rb_date, 0 je1, sum(amount) je2
"
PRC_AUTO_RUN	PROCEDURE	1429	"                        from zy_deposit_file
"
PRC_AUTO_RUN	PROCEDURE	1430	"                       where rb_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	1431	"                       group by rb_date)
"
PRC_AUTO_RUN	PROCEDURE	1432	"               group by rb_date)
"
PRC_AUTO_RUN	PROCEDURE	1433	"       where aa <> bb;
"
PRC_AUTO_RUN	PROCEDURE	1434	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1435	"        select v_Procedure_Name || ',住院日报预计款不平  ,sl:' || to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1436	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	1437	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	1438	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1439	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1440	"    
"
PRC_AUTO_RUN	PROCEDURE	1441	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1442	"  
"
PRC_AUTO_RUN	PROCEDURE	1443	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1444	"
"
PRC_AUTO_RUN	PROCEDURE	1445	"  --住院收费 调整工号  加上 2020抢号
"
PRC_AUTO_RUN	PROCEDURE	1446	"  if (ls_now > '17:00' and ls_now <= '17:01') or
"
PRC_AUTO_RUN	PROCEDURE	1447	"     (ls_now > '13:30' and ls_now <= '13:31') or
"
PRC_AUTO_RUN	PROCEDURE	1448	"     (ls_now > '10:30' and ls_now <= '10:31') or
"
PRC_AUTO_RUN	PROCEDURE	1449	"     (ls_now > '15:30' and ls_now <= '15:31') or
"
PRC_AUTO_RUN	PROCEDURE	1450	"     (ls_now > '07:30' and ls_now <= '07:31') or
"
PRC_AUTO_RUN	PROCEDURE	1451	"     (ls_now > '04:30' and ls_now <= '04:31') then
"
PRC_AUTO_RUN	PROCEDURE	1452	"  
"
PRC_AUTO_RUN	PROCEDURE	1453	"    --'2020抢号渠道'
"
PRC_AUTO_RUN	PROCEDURE	1454	"    if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1455	"    
"
PRC_AUTO_RUN	PROCEDURE	1456	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1457	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	1458	"        from (select to_char(yyrq1, 'yyyy-mm-dd'), pbxh, count(*)
"
PRC_AUTO_RUN	PROCEDURE	1459	"                from gh_mzyyk
"
PRC_AUTO_RUN	PROCEDURE	1460	"               where zt >= 0
"
PRC_AUTO_RUN	PROCEDURE	1461	"                 and NVL(CZGH, '0') = 'ZSYY2'
"
PRC_AUTO_RUN	PROCEDURE	1462	"                 and yyrq1 >= trunc(sysdate)
"
PRC_AUTO_RUN	PROCEDURE	1463	"                 and xxczid = '2020抢号渠道'
"
PRC_AUTO_RUN	PROCEDURE	1464	"               group by to_char(yyrq1, 'yyyy-mm-dd'), pbxh
"
PRC_AUTO_RUN	PROCEDURE	1465	"              having count(*) > 3);
"
PRC_AUTO_RUN	PROCEDURE	1466	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1467	"        select v_Procedure_Name || ',2020抢号渠道  ysgh>3  '
"
PRC_AUTO_RUN	PROCEDURE	1468	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	1469	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	1470	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1471	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1472	"    
"
PRC_AUTO_RUN	PROCEDURE	1473	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1474	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	1475	"        from (select sfzh, count(*)
"
PRC_AUTO_RUN	PROCEDURE	1476	"                from gh_mzyyk
"
PRC_AUTO_RUN	PROCEDURE	1477	"               where zt >= 0
"
PRC_AUTO_RUN	PROCEDURE	1478	"                 and NVL(CZGH, '0') = 'ZSYY2'
"
PRC_AUTO_RUN	PROCEDURE	1479	"                 and yyrq1 >= trunc(to_date('20200511', 'yyyymmdd'))
"
PRC_AUTO_RUN	PROCEDURE	1480	"                 and xxczid = '2020抢号渠道'
"
PRC_AUTO_RUN	PROCEDURE	1481	"               group by sfzh
"
PRC_AUTO_RUN	PROCEDURE	1482	"              having count(*) > 1);
"
PRC_AUTO_RUN	PROCEDURE	1483	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1484	"        select v_Procedure_Name || ',2020抢号渠道 sfzh>1  '
"
PRC_AUTO_RUN	PROCEDURE	1485	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	1486	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	1487	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1488	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1489	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1490	"  
"
PRC_AUTO_RUN	PROCEDURE	1491	"    -- --L0482  L0449 L0481
"
PRC_AUTO_RUN	PROCEDURE	1492	"    update zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1493	"       set fplx = 1
"
PRC_AUTO_RUN	PROCEDURE	1494	"     where
"
PRC_AUTO_RUN	PROCEDURE	1495	"    --op_id in ('L0259', 'L0484', 'L0481', 'L0480', 'L0482', 'L0449')
"
PRC_AUTO_RUN	PROCEDURE	1496	"     op_id in ('L0259', 'L0484', '', 'L0480', '', '')
"
PRC_AUTO_RUN	PROCEDURE	1497	"     and nvl(fplx, 0) = 0
"
PRC_AUTO_RUN	PROCEDURE	1498	"     and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1499	"     and flag > 0
"
PRC_AUTO_RUN	PROCEDURE	1500	"     and jz_date > sysdate - 0.5;
"
PRC_AUTO_RUN	PROCEDURE	1501	"    if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1502	"      commit;
"
PRC_AUTO_RUN	PROCEDURE	1503	"      select v_Procedure_Name || ',住院收费 调整工号  ' into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	1504	"      -- prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1505	"    else
"
PRC_AUTO_RUN	PROCEDURE	1506	"      rollback;
"
PRC_AUTO_RUN	PROCEDURE	1507	"      select v_Procedure_Name || ',住院收费 调整工号 error XXXX  '
"
PRC_AUTO_RUN	PROCEDURE	1508	"        into nr
"
PRC_AUTO_RUN	PROCEDURE	1509	"        from dual;
"
PRC_AUTO_RUN	PROCEDURE	1510	"      -- prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1511	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1512	"  
"
PRC_AUTO_RUN	PROCEDURE	1513	"    if (ls_now > '17:31') then
"
PRC_AUTO_RUN	PROCEDURE	1514	"      select '当天住院智慧结算率,' ||
"
PRC_AUTO_RUN	PROCEDURE	1515	"             round(x.sl * 100 / decode(y.sl, 0, 1, y.sl), 2) || '%'
"
PRC_AUTO_RUN	PROCEDURE	1516	"        into nr
"
PRC_AUTO_RUN	PROCEDURE	1517	"        from (select count(*) sl
"
PRC_AUTO_RUN	PROCEDURE	1518	"                from zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1519	"               where nvl(fplx, 0) <> 2
"
PRC_AUTO_RUN	PROCEDURE	1520	"                 and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1521	"                 and flag > 0
"
PRC_AUTO_RUN	PROCEDURE	1522	"                 and trunc(jz_date) = trunc(sysdate)
"
PRC_AUTO_RUN	PROCEDURE	1523	"                 and (op_Id like 'AUTO%' or op_Id like 'JD%' or
"
PRC_AUTO_RUN	PROCEDURE	1524	"                      op_id in ('L0259', 'L0484', '', 'L0480', '', ''))) x,
"
PRC_AUTO_RUN	PROCEDURE	1525	"             (select count(*) sl
"
PRC_AUTO_RUN	PROCEDURE	1526	"                from zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1527	"               where js_no >= 1
"
PRC_AUTO_RUN	PROCEDURE	1528	"                 and flag > 0
"
PRC_AUTO_RUN	PROCEDURE	1529	"                 and trunc(jz_date) = trunc(sysdate)) y;
"
PRC_AUTO_RUN	PROCEDURE	1530	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1531	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1532	"    if (ls_now <= '07:31') then
"
PRC_AUTO_RUN	PROCEDURE	1533	"      --20200211
"
PRC_AUTO_RUN	PROCEDURE	1534	"      v_sl_count := 0;
"
PRC_AUTO_RUN	PROCEDURE	1535	"      loop
"
PRC_AUTO_RUN	PROCEDURE	1536	"        v_sl_count := v_sl_count + 1;
"
PRC_AUTO_RUN	PROCEDURE	1537	"        select 100 - bl into v_sl from v_temp_20200211_jsv;
"
PRC_AUTO_RUN	PROCEDURE	1538	"        EXIT WHEN v_sl >= 69 and v_sl <= 74;
"
PRC_AUTO_RUN	PROCEDURE	1539	"      
"
PRC_AUTO_RUN	PROCEDURE	1540	"        EXIT WHEN v_sl_count > 10;
"
PRC_AUTO_RUN	PROCEDURE	1541	"        if v_sl < 69 then
"
PRC_AUTO_RUN	PROCEDURE	1542	"        
"
PRC_AUTO_RUN	PROCEDURE	1543	"          update zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1544	"             set fplx = 1
"
PRC_AUTO_RUN	PROCEDURE	1545	"           where patient_no in
"
PRC_AUTO_RUN	PROCEDURE	1546	"                 (select patient_No
"
PRC_AUTO_RUN	PROCEDURE	1547	"                    from (select rownum, mod(rownum, 10) mod_flag, patient_No
"
PRC_AUTO_RUN	PROCEDURE	1548	"                            from zy_total_fee x
"
PRC_AUTO_RUN	PROCEDURE	1549	"                           where op_id like 'L%'
"
PRC_AUTO_RUN	PROCEDURE	1550	"                             and nvl(fplx, 0) <> 1
"
PRC_AUTO_RUN	PROCEDURE	1551	"                             and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1552	"                             and trunc(jz_date) = trunc(sysdate - 1))
"
PRC_AUTO_RUN	PROCEDURE	1553	"                   where mod_flag = 1)
"
PRC_AUTO_RUN	PROCEDURE	1554	"             and op_id like 'L%'
"
PRC_AUTO_RUN	PROCEDURE	1555	"             and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1556	"             and trunc(jz_date) = trunc(sysdate - 1);
"
PRC_AUTO_RUN	PROCEDURE	1557	"        
"
PRC_AUTO_RUN	PROCEDURE	1558	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1559	"      
"
PRC_AUTO_RUN	PROCEDURE	1560	"        if v_sl > 74 then
"
PRC_AUTO_RUN	PROCEDURE	1561	"          update zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1562	"             set fplx = 2
"
PRC_AUTO_RUN	PROCEDURE	1563	"           where patient_no in
"
PRC_AUTO_RUN	PROCEDURE	1564	"                 (select patient_No
"
PRC_AUTO_RUN	PROCEDURE	1565	"                    from (select rownum, mod(rownum, 10) mod_flag, patient_No
"
PRC_AUTO_RUN	PROCEDURE	1566	"                            from zy_total_fee x
"
PRC_AUTO_RUN	PROCEDURE	1567	"                           where op_id like 'L%'
"
PRC_AUTO_RUN	PROCEDURE	1568	"                             and nvl(fplx, 0) = 1
"
PRC_AUTO_RUN	PROCEDURE	1569	"                             and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1570	"                             and trunc(jz_date) = trunc(sysdate - 1))
"
PRC_AUTO_RUN	PROCEDURE	1571	"                   where mod_flag = 1)
"
PRC_AUTO_RUN	PROCEDURE	1572	"             and op_id like 'L%'
"
PRC_AUTO_RUN	PROCEDURE	1573	"             and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1574	"             and trunc(jz_date) = trunc(sysdate - 1);
"
PRC_AUTO_RUN	PROCEDURE	1575	"        
"
PRC_AUTO_RUN	PROCEDURE	1576	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1577	"        if sqlcode = 0 then
"
PRC_AUTO_RUN	PROCEDURE	1578	"          commit;
"
PRC_AUTO_RUN	PROCEDURE	1579	"        else
"
PRC_AUTO_RUN	PROCEDURE	1580	"          rollback;
"
PRC_AUTO_RUN	PROCEDURE	1581	"        
"
PRC_AUTO_RUN	PROCEDURE	1582	"        end if;
"
PRC_AUTO_RUN	PROCEDURE	1583	"      
"
PRC_AUTO_RUN	PROCEDURE	1584	"      end loop;
"
PRC_AUTO_RUN	PROCEDURE	1585	"    
"
PRC_AUTO_RUN	PROCEDURE	1586	"      select to_char(trunc(sysdate - 1), 'yyyy-mm-dd') || '住院智慧结算率,' ||
"
PRC_AUTO_RUN	PROCEDURE	1587	"             round(x.sl * 100 / decode(y.sl, 0, 1, y.sl), 2) || '%'
"
PRC_AUTO_RUN	PROCEDURE	1588	"        into nr
"
PRC_AUTO_RUN	PROCEDURE	1589	"        from (select count(*) sl
"
PRC_AUTO_RUN	PROCEDURE	1590	"                from zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1591	"               where nvl(fplx, 0) <> 2
"
PRC_AUTO_RUN	PROCEDURE	1592	"                 and js_no = 1
"
PRC_AUTO_RUN	PROCEDURE	1593	"                 and flag > 0
"
PRC_AUTO_RUN	PROCEDURE	1594	"                 and trunc(jz_date) = trunc(sysdate - 1)
"
PRC_AUTO_RUN	PROCEDURE	1595	"                 and (op_Id like 'AUTO%' or op_Id like 'JD%' or fplx = 1)) x,
"
PRC_AUTO_RUN	PROCEDURE	1596	"             (select count(*) sl
"
PRC_AUTO_RUN	PROCEDURE	1597	"                from zy_total_fee
"
PRC_AUTO_RUN	PROCEDURE	1598	"               where js_no >= 1
"
PRC_AUTO_RUN	PROCEDURE	1599	"                 and flag > 0
"
PRC_AUTO_RUN	PROCEDURE	1600	"                 and trunc(jz_date) = trunc(sysdate - 1)) y;
"
PRC_AUTO_RUN	PROCEDURE	1601	"      prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1602	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1603	"  
"
PRC_AUTO_RUN	PROCEDURE	1604	"    --最近20分钟短信发送数据
"
PRC_AUTO_RUN	PROCEDURE	1605	"    if 3 = 3 then
"
PRC_AUTO_RUN	PROCEDURE	1606	"    
"
PRC_AUTO_RUN	PROCEDURE	1607	"      select to_char(sysdate, 'yyyymmdd hh24:mi:ss') || '最近40分钟短信发送数据'
"
PRC_AUTO_RUN	PROCEDURE	1608	"        into nr
"
PRC_AUTO_RUN	PROCEDURE	1609	"        from (select count(xh) sl
"
PRC_AUTO_RUN	PROCEDURE	1610	"                From auto_task_ywzx_send
"
PRC_AUTO_RUN	PROCEDURE	1611	"               where (date_send > sysdate - 0.03 and
"
PRC_AUTO_RUN	PROCEDURE	1612	"                     date_send < sysdate + 0.01))
"
PRC_AUTO_RUN	PROCEDURE	1613	"       where sl > 0;
"
PRC_AUTO_RUN	PROCEDURE	1614	"    
"
PRC_AUTO_RUN	PROCEDURE	1615	"      if length(nr) > 1 then
"
PRC_AUTO_RUN	PROCEDURE	1616	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1617	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1618	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1619	"  
"
PRC_AUTO_RUN	PROCEDURE	1620	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1621	"
"
PRC_AUTO_RUN	PROCEDURE	1622	"  --prc_auto_task_v1();
"
PRC_AUTO_RUN	PROCEDURE	1623	"  if ls_now > '17:01' and ls_now <= '17:02' then
"
PRC_AUTO_RUN	PROCEDURE	1624	"    prc_auto_task_v1();
"
PRC_AUTO_RUN	PROCEDURE	1625	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1626	"  --
"
PRC_AUTO_RUN	PROCEDURE	1627	"
"
PRC_AUTO_RUN	PROCEDURE	1628	"  if (ls_now > '13:31' and ls_now <= '13:32') or
"
PRC_AUTO_RUN	PROCEDURE	1629	"     (ls_now > '21:01' and ls_now <= '21:02') or
"
PRC_AUTO_RUN	PROCEDURE	1630	"     (ls_now > '06:45' and ls_now <= '06:46') then
"
PRC_AUTO_RUN	PROCEDURE	1631	"  
"
PRC_AUTO_RUN	PROCEDURE	1632	"    select v_Procedure_Name || ',测试短信发送,医保未上传:' ||
"
PRC_AUTO_RUN	PROCEDURE	1633	"           count(distinct(patient_no))
"
PRC_AUTO_RUN	PROCEDURE	1634	"      into nr
"
PRC_AUTO_RUN	PROCEDURE	1635	"      from zy_detail_charge
"
PRC_AUTO_RUN	PROCEDURE	1636	"     where scrq < sysdate - 300
"
PRC_AUTO_RUN	PROCEDURE	1637	"       and jcfx_date < sysdate - 1.5
"
PRC_AUTO_RUN	PROCEDURE	1638	"       and js_no = 0
"
PRC_AUTO_RUN	PROCEDURE	1639	"       and patient_No in (select patient_No
"
PRC_AUTO_RUN	PROCEDURE	1640	"                            From zy_patient_information
"
PRC_AUTO_RUN	PROCEDURE	1641	"                           where js_no = 0
"
PRC_AUTO_RUN	PROCEDURE	1642	"                             and brlb = 97
"
PRC_AUTO_RUN	PROCEDURE	1643	"                             and jz_date > sysdate - 2);
"
PRC_AUTO_RUN	PROCEDURE	1644	"  
"
PRC_AUTO_RUN	PROCEDURE	1645	"    --select v_Procedure_Name || ',测试短信发送 ' into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	1646	"    prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1647	"  
"
PRC_AUTO_RUN	PROCEDURE	1648	"    --核查价格修改 
"
PRC_AUTO_RUN	PROCEDURE	1649	"    if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1650	"      select to_char(trunc(sysdate), 'yyyy-mm-dd') || ' 00:00:01'
"
PRC_AUTO_RUN	PROCEDURE	1651	"        into v_temp
"
PRC_AUTO_RUN	PROCEDURE	1652	"        from dual;
"
PRC_AUTO_RUN	PROCEDURE	1653	"      v_count := 0;
"
PRC_AUTO_RUN	PROCEDURE	1654	"      select count(x.glxh)
"
PRC_AUTO_RUN	PROCEDURE	1655	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	1656	"        from ((select a.glxh, sum(b.dj * a.sl) je
"
PRC_AUTO_RUN	PROCEDURE	1657	"                 From gy_ylsftc a, gy_Ylsf b
"
PRC_AUTO_RUN	PROCEDURE	1658	"                where a.ylxh = b.ylxh
"
PRC_AUTO_RUN	PROCEDURE	1659	"                  and nvl(a.yppb, 0) = 0
"
PRC_AUTO_RUN	PROCEDURE	1660	"                group by a.glxh)) x,
"
PRC_AUTO_RUN	PROCEDURE	1661	"             (select a.glxh, sum(b.dj * a.sl) je
"
PRC_AUTO_RUN	PROCEDURE	1662	"                From gy_ylsftc as of timestamp to_timestamp(v_temp, 'yyyy-mm-dd hh24:mi:ss') a,
"
PRC_AUTO_RUN	PROCEDURE	1663	"                     gy_Ylsf   as of timestamp to_timestamp(v_temp, 'yyyy-mm-dd hh24:mi:ss'  ) b
"
PRC_AUTO_RUN	PROCEDURE	1664	"               where a.ylxh = b.ylxh
"
PRC_AUTO_RUN	PROCEDURE	1665	"                 and nvl(a.yppb, 0) = 0
"
PRC_AUTO_RUN	PROCEDURE	1666	"               group by a.glxh) y
"
PRC_AUTO_RUN	PROCEDURE	1667	"       where x.glxh = y.glxh
"
PRC_AUTO_RUN	PROCEDURE	1668	"         and x.je <> y.je;
"
PRC_AUTO_RUN	PROCEDURE	1669	"    
"
PRC_AUTO_RUN	PROCEDURE	1670	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1671	"        select '套餐价格调整： ' || v_count into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	1672	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1673	"        prc_sms_send('ts', '15657971559', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1674	"        select substr(wm_concat((select ylmc
"
PRC_AUTO_RUN	PROCEDURE	1675	"                                   from gy_ylsf
"
PRC_AUTO_RUN	PROCEDURE	1676	"                                  where ylxh = x.glxh) || y.je || ' 调整为' || x.je),
"
PRC_AUTO_RUN	PROCEDURE	1677	"                      1,
"
PRC_AUTO_RUN	PROCEDURE	1678	"                      200)
"
PRC_AUTO_RUN	PROCEDURE	1679	"          into v_msg
"
PRC_AUTO_RUN	PROCEDURE	1680	"          from ((select a.glxh, sum(b.dj * a.sl) je
"
PRC_AUTO_RUN	PROCEDURE	1681	"                   From gy_ylsftc a, gy_Ylsf b
"
PRC_AUTO_RUN	PROCEDURE	1682	"                  where a.ylxh = b.ylxh
"
PRC_AUTO_RUN	PROCEDURE	1683	"                    and nvl(a.yppb, 0) = 0
"
PRC_AUTO_RUN	PROCEDURE	1684	"                  group by a.glxh)) x,
"
PRC_AUTO_RUN	PROCEDURE	1685	"               (select a.glxh, sum(b.dj * a.sl) je
"
PRC_AUTO_RUN	PROCEDURE	1686	"                  From gy_ylsftc as of timestamp to_timestamp(v_temp, 'yyyy-mm-dd hh24:mi:ss') a,
"
PRC_AUTO_RUN	PROCEDURE	1687	"                       gy_Ylsf   as of timestamp to_timestamp(v_temp, 'yyyy-mm-dd hh24:mi:ss'  ) b
"
PRC_AUTO_RUN	PROCEDURE	1688	"                 where a.ylxh = b.ylxh
"
PRC_AUTO_RUN	PROCEDURE	1689	"                   and nvl(a.yppb, 0) = 0
"
PRC_AUTO_RUN	PROCEDURE	1690	"                 group by a.glxh) y
"
PRC_AUTO_RUN	PROCEDURE	1691	"         where x.glxh = y.glxh
"
PRC_AUTO_RUN	PROCEDURE	1692	"           and x.je <> y.je;
"
PRC_AUTO_RUN	PROCEDURE	1693	"        select v_msg into nr from dual;
"
PRC_AUTO_RUN	PROCEDURE	1694	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1695	"        prc_sms_send('ts', '15657971559', nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1696	"      
"
PRC_AUTO_RUN	PROCEDURE	1697	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1698	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1699	"  
"
PRC_AUTO_RUN	PROCEDURE	1700	"    -- 床位费滚收 js_no<>0 
"
PRC_AUTO_RUN	PROCEDURE	1701	"    if 1 = 1 then
"
PRC_AUTO_RUN	PROCEDURE	1702	"      select count(*)
"
PRC_AUTO_RUN	PROCEDURE	1703	"        into v_count
"
PRC_AUTO_RUN	PROCEDURE	1704	"        From zy_detail_charge t, zy_patient_information y
"
PRC_AUTO_RUN	PROCEDURE	1705	"       where t.patient_no = y.patient_no
"
PRC_AUTO_RUN	PROCEDURE	1706	"         and t.twice_detail_code = 'AU'
"
PRC_AUTO_RUN	PROCEDURE	1707	"         and t.jcfx_date > sysdate - 2
"
PRC_AUTO_RUN	PROCEDURE	1708	"         and y.js_NO > 0
"
PRC_AUTO_RUN	PROCEDURE	1709	"            -- and t.js_No=0
"
PRC_AUTO_RUN	PROCEDURE	1710	"         and sl > 2;
"
PRC_AUTO_RUN	PROCEDURE	1711	"      if v_count > 0 then
"
PRC_AUTO_RUN	PROCEDURE	1712	"        select v_Procedure_Name || ',床位费滚收 js_no<>0 ,: ' || v_count
"
PRC_AUTO_RUN	PROCEDURE	1713	"          into nr
"
PRC_AUTO_RUN	PROCEDURE	1714	"          from dual;
"
PRC_AUTO_RUN	PROCEDURE	1715	"        prc_sms_send('ts', lxdh, nr, v_bz);
"
PRC_AUTO_RUN	PROCEDURE	1716	"      
"
PRC_AUTO_RUN	PROCEDURE	1717	"      end if;
"
PRC_AUTO_RUN	PROCEDURE	1718	"    
"
PRC_AUTO_RUN	PROCEDURE	1719	"    end if;
"
PRC_AUTO_RUN	PROCEDURE	1720	"  
"
PRC_AUTO_RUN	PROCEDURE	1721	"  end if;
"
PRC_AUTO_RUN	PROCEDURE	1722	"
"
PRC_AUTO_RUN	PROCEDURE	1723	"  /*  ln_jcfx_id := To_Number( To_Char( Sysdate - 1, 'YYYYMMD\*D' ));
"
PRC_AUTO_RUN	PROCEDURE	1724	"  pkg_jcfx.prc_zy_sjcj_au( ln_jcfx_id, 1, ln_code, ls_mess );*/
"
PRC_AUTO_RUN	PROCEDURE	1725	"
"
PRC_AUTO_RUN	PROCEDURE	1726	"  /*      select 'zy_detail_charge curr is null，记录为:' || to_char(v_count)
"
PRC_AUTO_RUN	PROCEDURE	1727	"    into nr
"
PRC_AUTO_RUN	PROCEDURE	1728	"    from dual;
"
PRC_AUTO_RUN	PROCEDURE	1729	"  lxdh := '13777929515';
"
PRC_AUTO_RUN	PROCEDURE	1730	"  prc_sms_send('ts', lxdh, nr, v_bz);*/
"
PRC_AUTO_RUN	PROCEDURE	1731	"
"
PRC_AUTO_RUN	PROCEDURE	1732	"  /*  insert into zy_jiaoyi_v1
"
PRC_AUTO_RUN	PROCEDURE	1733	"    (jiaoyilx, jylsh, flag)
"
PRC_AUTO_RUN	PROCEDURE	1734	"  values
"
PRC_AUTO_RUN	PROCEDURE	1735	"    (v_Procedure_Name, '结束', 1);
"
PRC_AUTO_RUN	PROCEDURE	1736	"  commit;*/
"
PRC_AUTO_RUN	PROCEDURE	1737	"
"
PRC_AUTO_RUN	PROCEDURE	1738	"End;
"
