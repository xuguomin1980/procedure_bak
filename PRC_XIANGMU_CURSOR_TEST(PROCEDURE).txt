PRC_XIANGMU_CURSOR_TEST	PROCEDURE	1	"procedure prc_xiangmu_cursor_test(in_jiaoyilx in varchar2, --交易类型
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	2	"                                                    in_caozuogh in varchar2, --操作工号                                            
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	3	"                                                    in_jylsh    in varchar2, --其它参数
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	4	"                                                    out_code    out INTEGER, -- 返回结果 0为执行成功
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	5	"                                                    out_msg     out varchar2) is
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	6	"
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	7	"  v_icd10      varchar2(30);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	8	"  v_icd10_from varchar2(30);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	9	"  v_data       varchar2(300);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	10	"  v_data_temp  varchar2(200);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	11	"  v_sfzh       varchar2(50);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	12	"  v_str1       varchar2(20);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	13	"  v_str2       varchar2(20);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	14	"  v_str3       varchar2(20);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	15	"  v_str4       varchar2(20);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	16	"  v_str5       varchar2(20);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	17	"  v_str6       varchar2(20);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	18	"  v_str7       varchar2(20);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	19	"  v_str8       varchar2(20);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	20	"  v_str9       varchar2(20);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	21	"  v_temp       varchar2(200);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	22	"  v_temp2      varchar2(200);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	23	"  v_flag1      varchar2(10);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	24	"  v_flag2      varchar2(10);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	25	"  v_ysgh       varchar2(20);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	26	"  v_lxdh       varchar2(20);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	27	"  v_lxdh2      varchar2(20);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	28	"  v_ksdm       varchar2(30);
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	29	"  --临时的统计的数量
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	30	"  v_count       number;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	31	"  v_count2      number;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	32	"  ll_count2     number;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	33	"  v_order_no    number;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	34	"  v_dqz         number;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	35	"  v_sfsb        number;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	36	"  v_ysfsb       number;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	37	"  ll_patient_no number;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	38	"
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	39	"  v_jzxh number;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	40	"  --计费
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	41	"
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	42	"  --定义游标
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	43	"  CURSOR cursor_test IS
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	44	"  
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	45	"    select patient_no
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	46	"      from (select patient_No,
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	47	"                   (select count(patient_No)
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	48	"                      from zy_deposit_file
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	49	"                     where op_id = 'AU002'
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	50	"                       and patient_no = t.patient_no) sl
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	51	"              from zy_patient_information t
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	52	"             where js_No = 0
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	53	"               and cwfp_date >= trunc(sysdate)
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	54	"               and cwfp_date < sysdate)
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	55	"     where sl = 0;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	56	"
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	57	"begin
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	58	"
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	59	"  out_code := 1;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	60	"  out_msg  := '';
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	61	"
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	62	"  if 1 = 1 then
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	63	"  
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	64	"    begin
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	65	"      select sfsb into v_sfsb from mz_mzsfk1 where rownum < 5;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	66	"    exception
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	67	"      when too_many_rows then
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	68	"        dbms_output.put_line('select into语句匹配了多行');
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	69	"      when others then
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	70	"        dbms_output.put_line('其他例外');
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	71	"      
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	72	"    end;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	73	"  end if;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	74	"
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	75	"  if 1 = 0 then
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	76	"  
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	77	"    v_count := 0;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	78	"    --循环开始
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	79	"    LOOP
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	80	"    
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	81	"      IF NOT cursor_test%ISOPEN THEN
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	82	"        --打开游标
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	83	"        OPEN cursor_test;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	84	"      END IF;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	85	"    
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	86	"      FETCH cursor_test
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	87	"        INTO v_sfsb;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	88	"      --退出循环的条件
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	89	"      EXIT WHEN cursor_test%NOTFOUND OR cursor_test%NOTFOUND IS NULL;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	90	"    
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	91	"      --预交款 留义温暖基金
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	92	"    
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	93	"      ll_patient_no := v_sfsb;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	94	"      IF 1 = 1 THEN
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	95	"        select to_char(trunC(sysdate), 'yyyy-mm-dd')
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	96	"          into v_temp2
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	97	"          from dual;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	98	"      
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	99	"        -- 日期范围 
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	100	"        if v_temp2 >= '2021-02-10' and v_temp2 <= '2021-02-21' then
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	101	"        
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	102	"          select count(*)
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	103	"            into ll_count2
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	104	"            from zy_patient_information t
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	105	"           where nvl(t.cwfp_date, sysdate) >= trunc(sysdate)
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	106	"             and patient_no = ll_patient_no;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	107	"          --24小时没有预出院
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	108	"          SELECT count(*)
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	109	"            into v_count
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	110	"            FROM ZY_PATIENT_INFORMATION
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	111	"           WHERE bah in (select bah
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	112	"                           from zy_patient_information
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	113	"                          where patient_no = ll_patient_no)
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	114	"             and (sysdate - preout_date) <= 1
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	115	"             and preout_date is not null;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	116	"        
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	117	"          if v_count = 0 and ll_count2 = 1 then
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	118	"            --判断重复记录
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	119	"            SELECT count(*)
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	120	"              into v_count
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	121	"              FROM zy_deposit_file t
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	122	"             WHERE t.depo_type = 2
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	123	"               and op_id = 'AU002'
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	124	"               and patient_no = ll_patient_no;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	125	"          
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	126	"          end if;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	127	"        
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	128	"        end if;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	129	"      
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	130	"      end if;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	131	"    
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	132	"    END LOOP;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	133	"    close cursor_test;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	134	"  end if;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	135	"
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	136	"  out_code := 1;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	137	"  out_msg  := '';
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	138	"  return;
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	139	"
"
PRC_XIANGMU_CURSOR_TEST	PROCEDURE	140	"end;
"
